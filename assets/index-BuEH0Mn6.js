var _t=Object.defineProperty;var vt=(t,a,e)=>a in t?_t(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e;var o=(t,a,e)=>vt(t,typeof a!="symbol"?a+"":a,e);import{r as Dt,a as kt}from"./phaser-LhFSXt8Z.js";import{r as Rt}from"./colyseus.js-BZ3dtEL4.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();var ct=Dt();const ve=kt(ct);var Ot=Rt(),z=(t=>(t.PHYSICAL="physical",t.MAGICAL="magical",t))(z||{}),N=(t=>(t.SEARCHING="searching",t.PLAYING="playing",t.FINISHED="finished",t.CHALLENGE="challenge",t))(N||{}),He=(t=>(t.CRYSTAL="Crystal victory",t.UNITS="Hero victory",t.TIME="Timeout",t.CONCEDED="Game conceded",t))(He||{}),B=(t=>(t.COUNCIL="Council",t.DARK_ELVES="Dark Elves",t.DWARVES="Dwarves",t))(B||{}),b=(t=>(t.MOVE="move",t.ATTACK="attack",t.HEAL="heal",t.SPAWN="spawn",t.SPAWN_PHANTOM="phantom",t.USE="use",t.SHUFFLE="shuffle",t.SPECIAL="special",t.CONCEDE="concede",t.DRAW="draw",t.PASS="pass",t.REMOVE_UNITS="removeUnits",t))(b||{}),Te=(t=>(t.USER="user",t.AUTO="automatic",t))(Te||{}),S=(t=>(t.SHINING_HELM="shiningHelm",t.RUNE_METAL="runeMetal",t.SUPERCHARGE="superCharge",t.DRAGON_SCALE="dragonScale",t.HEALING_POTION="healingPotion",t.INFERNO="inferno",t.SOUL_STONE="soulStone",t.SOUL_HARVEST="soulHarvest",t.MANA_VIAL="manaVial",t.DWARVERN_BREW="dwarvernBrew",t.PULVERIZER="pulverizer",t))(S||{}),j=(t=>(t.HERO="hero",t.ITEM="item",t))(j||{}),g=(t=>(t.ARCHER="archer",t.CLERIC="cleric",t.KNIGHT="knight",t.NINJA="ninja",t.WIZARD="wizard",t.PRIESTESS="priestess",t.IMPALER="impaler",t.NECROMANCER="necromancer",t.PHANTOM="phantom",t.VOIDMONK="voidmonk",t.WRAITH="wraith",t.PALADIN="paladin",t.GRENADIER="grenadier",t.GUNNER="gunner",t.ENGINEER="engineer",t.ANNIHILATOR="annihilator",t))(g||{}),A=(t=>(t.BASIC="basic",t.POWER="powerTile",t.PHYSICAL_RESISTANCE="shieldTile",t.MAGICAL_RESISTANCE="helmetTile",t.CRYSTAL_DAMAGE="crystalDamageTile",t.TELEPORTER="teleporterTile",t.CRYSTAL="crystal",t.CRYSTAL_BIG="crystalBig",t.CRYSTAL_SMALL="crystalSmall",t.SPAWN="spawnTile",t.SPEED="speedTile",t.PALADIN_AURA="paladinAura",t))(A||{}),Y=(t=>(t.MOVE="move",t.ATTACK="attack",t.HEAL="healing",t))(Y||{}),v=(t=>(t.SHOOTER="Shooter",t.FIGHTER="Fighter",t.CASTER="Caster",t.SUPPORT="Support",t.EQUIPMENT="Equipment",t.BUFF="Buff",t.VICTORY="Victory Unit",t.SUPER="Super Unit",t.SUMMONED="Summoned",t.SPELL="Spell",t.CONSUMABLE="Consumable",t.SPECIAL_TILE="Special Tile",t))(v||{}),he=(t=>(t.SEND="send",t.ACCEPT="accept",t))(he||{}),w=(t=>(t.BUTTON_PLAY="battleButtonSound",t.BUTTON_GENERIC="buttonPressGenericSound",t.BUTTON_FAILED="buttonFailedSound",t.GAME_DELETE="deleteGameSound",t.RESIGN="resignSound",t.WIN_SFX="winSFXSound",t.LOSE_SFX="loseSFXSound",t))(w||{}),m=(t=>(t.HERO_HAND_SELECT="selectHeroFromHandSound",t.HERO_BOARD_SELECT="selectHeroFromBoardSound",t.HERO_SPAWN="spawnHeroSound",t.HERO_MOVE="moveHeroSound",t.MOVE_FLY="moveFlySound",t.MOVE_WALK="moveWalkSound",t.HEAL="healSound",t.HEAL_EXTRA="healExtraSound",t.HERO_STOMP="stompSound",t.VANISH="vanishSound",t.HERO_REVIVE="reviveHeroSound",t.SCROLL_SELECT="selectScrollSound",t.RUNE_METAL_SELECT="selectRuneMetalSound",t.SHIELD_SELECT="selectDragonScaleSound",t.ITEM_SELECT="selectItemGenericSound",t.POTION_SELECT="selectPotionSound",t.AOE_SPELL_SELECT="selectInfernoSound",t.SCROLL_USE="useScrollSound",t.RUNE_METAL_USE="useRuneMetalSound",t.DRAGON_SCALE_USE="useDragonScaleSound",t.ITEM_USE="useItemGenericSound",t.POTION_USE="usePotionSound",t.SWORD_TILE="swordTileSound",t.SHIELD_TILE="shieldTileSound",t.HELM_TILE="helmTileSound",t.CRYSTAL_TILE="crystalTileSound",t.RESET_TURN="resetTurnSound",t.DRAW="newItemsSound",t.SHUFFLE="returnItemSound",t.CRYSTAL_DAMAGE="damageCrystal1Sound",t.CRYSTAL_DAMAGE_BUFF="damageCrystal2Sound",t.CRYSTAL_DESTROY="destroyCrystalSound",t.ARCHER_ATTACK="archerAttackSound",t.ARCHER_ATTACK_BIG="archerAttackBigSound",t.ARCHER_ATTACK_MELEE="archerAttackMeleeSound",t.ARCHER_DEATH="archerDeathSound",t.CLERIC_ATTACK="clericAttackSound",t.CLERIC_ATTACK_BIG="clericAttackBigSound",t.CLERIC_DEATH="clericDeathSound",t.KNIGHT_ATTACK="knightAttackSound",t.KNIGHT_ATTACK_BIG="knightAttackBigSound",t.KNIGHT_DEATH="knightDeathSound",t.NINJA_ATTACK="ninjaAttackSound",t.NINJA_ATTACK_BIG="ninjaAttackBigSound",t.NINJA_ATTACK_RANGED="ninjaAttackRangedSound",t.NINJA_DEATH="ninjaDeathSound",t.NINJA_SMOKE="ninjaSmokeSound",t.WIZARD_ATTACK="wizardAttackSound",t.WIZARD_ATTACK_BIG="wizardAttackBigSound",t.WIZARD_DEATH="wizardDeathSound",t.INFERNO_USE="useInfernoSound",t.PRIESTESS_ATTACK="priestessAttackSound",t.PRIESTESS_DEATH="priestessDeathSound",t.IMPALER_ATTACK="impalerAttackSound",t.IMPALER_ATTACK_BIG="impalerAttackBigSound",t.IMPALER_ATTACK_MELEE="impalerAttackMeleeSound",t.IMPALER_DEATH="impalerDeathSound",t.NECROMANCER_ATTACK="necroAttackSound",t.NECROMANCER_ATTACK_BIG="necroAttackBigSound",t.NECROMANCER_DEATH="necromancerDeathSound",t.PHANTOM_SPAWN="phantomSpawnSound",t.PHANTOM_DEATH="phantomDeathSound",t.VOIDMONK_ATTACK="voidmonkAttackSound",t.VOIDMONK_ATTACK_BIG="voidmonkAttackBigSound",t.VOIDMONK_DEATH="voidmonkDeathSound",t.WRAITH_ATTACK="wraithAttackSound",t.WRAITH_ATTACK_BIG="wraithAttackBigSound",t.WRAITH_DEATH="wraithDeathSound",t.WRAITH_CONSUME="wraithConsumeSound",t.USE_HARVEST="useHarvestSound",t.PALADIN_HEAL="paladinHealSound",t.PALADIN_ATTACK="paladinAttackSound",t.PALADIN_ATTACK_BIG="paladinAttackBigSound",t.PALADIN_DEATH="paladinDeath",t.ENGINEER_ATTACK="engineerAttackSound",t.ENGINEER_ATTACK_BIG="engineerAttackBigSound",t.ENGINEER_SHIELD_MAKE="engineerShieldMake",t.ENGINEER_SHIELD_BREAK="engineerShieldBreak",t.GRENADIER_ATTACK="grenadierAttack",t.GRENADIER_ATTACK_BIG="grenadierAttackBig",t.GRENADIER_ATTACK_MELEE="grenadierAttackMelee",t.GRENADIER_DEATH="grenadierDeath",t.GUNNER_ATTACK="gunnerAttack",t.GUNNER_JUMP="gunnerJump",t.GUNNER_ATTACK_ONLY="gunnerAttackGunOnly",t.GUNNER_DEATH="gunnerDeath",t.ANNIHILATOR_SHOOT="annihilatorShoot",t.ANNIHILATOR_HIT="annihilatorHit",t.ANNIHILATOR_WINDUP="annihilatorWindup",t.BREW_SELECT="brewSelect",t.BREW_USE="brewUse",t.DRILL_SELECT="drillSelect",t.DRILL_USE="drillUse",t))(m||{});class Ht extends Phaser.GameObjects.Container{constructor(e){super(e,50,50);o(this,"button");o(this,"buttonText");this.button=e.add.image(10,-25,"playButton").setDisplaySize(100,50).setOrigin(.5).setInteractive({useHandCursor:!0}),this.buttonText=e.add.text(10,-25,"Home",{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.add([this.button,this.buttonText]).setScale(.8),this.button.on("pointerdown",async()=>{var n,r;this.scene.sound.play(w.BUTTON_GENERIC),await((n=e.lobbyRoom)==null?void 0:n.leave()),await((r=e.currentRoom)==null?void 0:r.leave()),e.currentRoom=void 0,e.scene.stop("GameScene"),e.scene.start("MainMenuScene")}),e.add.existing(this)}}async function Nt(t){console.log("Fetching game list...");const a=localStorage.getItem("jwt"),e=`https://scribble-academy-be.onrender.com/games/playing?userId=${encodeURIComponent(t)}`,i=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),s=await i.json();return i.status!==200?(console.log("Error fetching the game list..."),[]):(console.log("Game list fetched..."),s)}async function Bt(t,a,e){const i=localStorage.getItem("jwt");console.log("Sending challenge to player... ");const s=`https://scribble-academy-be.onrender.com/games/newGame?userId=${encodeURIComponent(t)}&faction=${encodeURIComponent(a)}&opponentId=${encodeURIComponent(e)}`,n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}}),r=await n.json();return n.status!==200?(console.error("Error sending challenge...",r.message),null):(console.log("Challenge sent",r),r)}function $e(t){var a;return((a=t.player1)==null?void 0:a.playerId)===t.userId?{player:"player1",opponent:"player2"}:{player:"player2",opponent:"player1"}}function xe(t){return t.isPlayerOne?t.player1:t.player2}function ht(t){const e=/[a-zA-Z]/.test(t),i=/\d/.test(t);return t.length>=8&&e&&i}function Xe(t,a){var e,i;a.isActive=!0,t.activeUnit=a,a.class===j.HERO&&((e=t.gameController)==null||e.onHeroClicked(a)),a.class===j.ITEM&&((i=t.gameController)==null||i.onItemClicked(a))}function ye(t){var a,e;t.activeUnit&&(t.activeUnit.isActive=!1,t.activeUnit=void 0,(a=t.gameController)==null||a.board.clearHighlights(),(e=t.gameController)==null||e.board.removeReticles())}function dt(t,a){t.on("pointerdown",(e,i,s,n)=>{a.currentGame.status!==N.FINISHED&&(Ne(a),e.button===2&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t,n.stopPropagation()),a.longPressStart=a.time.now,e.button===0&&Lt(t,a))}),t.on("pointerup",e=>{a.currentGame.status!==N.FINISHED&&e.button!==2&&a.longPressStart&&a.time.now-a.longPressStart>500&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t)})}function Lt(t,a){if(console.log(`Unit in ${t.boardPosition}`,t),a.activePlayer!==a.userId||a.currentTurnAction>5)return;const e=a.activeUnit,i=me(a,t),s=R(t)&&!i,n=(e==null?void 0:e.unitId)===t.unitId,r=R(t)?t.getByName("healReticle"):void 0,c=R(t)?t.getByName("attackReticle"):void 0,h=R(t)?t.getByName("allyReticle"):void 0;if(!e&&i){if(R(t)&&t.isKO)return;t.boardPosition>=45?(R(t)&&f(a,m.HERO_HAND_SELECT),ae(t)&&Ze(a,t.itemType)):f(a,m.HERO_BOARD_SELECT),Xe(a,t);return}if(n){if(R(e)&&e.canHeal&&(r!=null&&r.visible)&&R(t)){e.heal(t);return}else ye(a);return}if(e&&!n){if(R(t)&&t.isKO&&R(e)&&e.unitType===g.WRAITH&&e.boardPosition>=45&&!$(a,t.getTile())){e.spawn(t.getTile());return}if(s){const d=a.gameController.board.getTileFromBoardPosition(t.boardPosition);if(R(e)&&(c!=null&&c.visible)){e.attack(t);return}if(R(e)&&e.boardPosition<45){const p=a.gameController.board.getHeroTilesInRange(e,Y.MOVE).find(y=>y.boardPosition===t.boardPosition);if(t.isKO&&e.unitType!==g.NECROMANCER&&(p||d.isHighlighted)){e.move(d);return}if(t.isKO&&e.unitType===g.NECROMANCER&&t.blockedLOS.visible&&(p||d.isHighlighted)){e.move(d);return}}if(R(e)&&e.boardPosition>=45&&(t.isKO||t.unitType===g.PHANTOM)&&!$(a,d)&&d.isHighlighted){e.spawn(t.getTile());return}if(R(e)&&e.boardPosition>=45&&t.unitType===g.PHANTOM&&!$(a,d)){e.spawn(t.getTile());return}if(ae(e)&&e.dealsDamage){e.use(t.getTile());return}}if(R(t)&&i&&t.boardPosition<45){if(R(e)&&[g.NECROMANCER,g.WRAITH].includes(e.unitType)&&t.isKO&&(c!=null&&c.visible)){e.attack(t);return}if(R(e)){const d=t.getTile();if(t.isKO&&d.tileType===A.SPAWN&&d.isHighlighted&&e.boardPosition>=45){e.spawn(d);return}if(e.canHeal&&(r!=null&&r.visible)){e.heal(t);return}if(e.unitType===g.NINJA&&(h!=null&&h.visible)&&!t.isKO){e.special(t);return}if(e.unitType===g.ENGINEER&&(r!=null&&r.visible)&&!t.isKO){e.special(t);return}if(e.boardPosition<45){const p=a.gameController.board.getHeroTilesInRange(e,Y.MOVE).find(y=>y.boardPosition===t.boardPosition);if(t.isKO&&e.unitType!==g.NECROMANCER&&(p||d.isHighlighted)){const y=a.gameController.board.getTileFromBoardPosition(t.boardPosition);e.move(y);return}}}if(ae(e)){if(t.isAlreadyEquipped(e)||t.unitType===g.PHANTOM)return;e.dealsDamage&&e.use(t.getTile()),!e.dealsDamage&&(!t.isKO||e.itemType===S.HEALING_POTION)&&e.use(t);return}}if(i){if(R(t)&&t.isKO)return;ye(a),t.boardPosition>=45?(R(t)&&f(a,m.HERO_HAND_SELECT),ae(t)&&Ze(a,t.itemType)):f(a,m.HERO_BOARD_SELECT),Xe(a,t);return}}}function Mt(t,a){t.on("pointerdown",(e,i,s,n)=>{if(a.currentGame.status===N.FINISHED)return;if(Ne(a),a.longPressStart=a.time.now,e.button===2){const h=t.tileType!==A.BASIC&&t.tileType!==A.CRYSTAL,d=!t.hero&&!t.crystal;h&&d&&(t.setDepth(1001),t.unitCard&&t.unitCard.setVisible(!0),a.visibleUnitCard=t,n.stopPropagation())}if(a.activePlayer!==a.userId||a.currentTurnAction>5)return;const r=a.activeUnit,c=a.gameController;!r||!c||(r.boardPosition<45&&t.isHighlighted&&R(r)&&(r.move(t),f(a,m.HERO_MOVE)),r.boardPosition>44&&t.isHighlighted&&(R(r)&&r.spawn(t),ae(r)&&r.dealsDamage&&r.use(t)))}),a.input.on("pointerdown",()=>{t.icon&&t.icon.setDepth(2)}),t.on("pointerup",()=>{a.currentGame.status!==N.FINISHED&&a.longPressStart&&a.time.now-a.longPressStart>500&&(t.setDepth(1001),t.unitCard&&t.unitCard.setVisible(!0),a.visibleUnitCard=t)}),t.on("pointerout",()=>{a.visibleUnitCard||(t.icon&&t.icon.setDepth(2),t.unitCard&&t.unitCard.setVisible(!1))})}function Ft(t,a){t.on("pointerdown",(e,i,s,n)=>{if(a.currentGame.status!==N.FINISHED&&(console.log(`Crystal on ${t.boardPosition}`,t),Ne(a),e.button===2&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t,n.stopPropagation()),a.longPressStart=a.time.now,e.button===0)){const r=t.attackReticle,c=a.activeUnit;if(c){if(R(c)&&r.visible){c.attack(t);return}if(ae(c)&&(c!=null&&c.dealsDamage)){c.use(t.getTile());return}}}}),t.on("pointerup",()=>{a.currentGame.status!==N.FINISHED&&a.longPressStart&&a.time.now-a.longPressStart>500&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t)}),t.on("pointerout",()=>{a.visibleUnitCard||(t.setDepth(t.row+10),t.unitCard.setVisible(!1))})}class $t extends Phaser.GameObjects.Container{constructor(e,i){super(e,0,0);o(this,"cardBackgroundImage");o(this,"unitPictureImage");o(this,"cardSeparatorImage");o(this,"hpBackgroundImage");o(this,"hpBarImage");o(this,"magicalResistanceImage");o(this,"physicalResistanceImage");o(this,"hpIconImage");o(this,"context");o(this,"currentHpText");o(this,"magicalResistanceText");o(this,"physicalResistanceText");o(this,"cardFlavorText");o(this,"cardTypeText");o(this,"cardNameText");this.context=e,this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,"crystalCardPic").setOrigin(.5).setScale(.4),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3),this.cardNameText=this.context.add.text(55,-170,"Crystal",{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,"Victory Unit",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.hpBackgroundImage=e.add.image(-60,-60,"hpBackground").setOrigin(.5),this.hpBarImage=e.add.image(-118,-72,"hpBar").setOrigin(0),this.setHealthBar(i.currentHealth,i.maxHealth),this.currentHpText=this.context.add.text(100,-60,`${i.currentHealth}/${i.maxHealth}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.hpIconImage=e.add.image(-150,-60,"hpIcon").setOrigin(.5),this.magicalResistanceImage=e.add.image(40,-10,"magicalResistance").setOrigin(.5),this.magicalResistanceText=this.context.add.text(100,-10,`${i.magicalDamageResistance}%`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.physicalResistanceImage=e.add.image(-150,-10,"physicalResistance").setOrigin(.5),this.physicalResistanceText=this.context.add.text(-85,-10,`${i.physicalDamageResistance}%`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.cardFlavorText=this.context.add.text(0,50,"Destroy all crystals to win the game!",{fontFamily:"proLight",fontSize:30,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(.5),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.hpBackgroundImage,this.hpBarImage,this.magicalResistanceImage,this.physicalResistanceImage,this.hpIconImage,this.currentHpText,this.cardFlavorText,this.cardTypeText,this.cardNameText,this.physicalResistanceText,this.magicalResistanceText])}getTextColor(e,i){return e>i?"#00FF00":e<i?"#ff0000":"#ffffff"}updateCardHealth(e,i){this.currentHpText.setText(`${e}/${i}`),this.setHealthBar(e,i)}updateCardPhysicalResistance(e){this.physicalResistanceText.setText(`${x(e.physicalDamageResistance)} %`),this.physicalResistanceText.setColor(this.getTextColor(e.physicalDamageResistance,0))}updateCardMagicalResistance(e){this.magicalResistanceText.setText(`${x(e.magicalDamageResistance)} %`),this.magicalResistanceText.setColor(this.getTextColor(e.magicalDamageResistance,0))}updateCardData(e){this.updateCardPhysicalResistance(e),this.updateCardMagicalResistance(e),this.updateCardHealth(e.currentHealth,e.maxHealth)}setHealthBar(e,i){const s=this.hpBackgroundImage.width-10,n=e/i;this.hpBarImage.displayWidth=s*n}}class fe extends Phaser.GameObjects.Container{constructor(a,e,i,s,n=!1){super(a,e,i);const r=n?"greenFont":"redFont",c=n?.7:.5;let h=0;for(const u of s){const p=a.textures.get(r).get(u);p&&(h+=p.width*c)}let d=-h/2;for(const u of s){const p=a.add.image(0,0,r,u).setOrigin(0,.7).setScale(c),y=p.frame.width*c;p.x=d,p.y=0,this.add(p),d+=y}this.setDepth(1e3),a.add.existing(this),a.tweens.add({targets:this,y:i-30,duration:1500,ease:"easeOut",alpha:0,onComplete:()=>this.destroy()})}}class ut extends Phaser.GameObjects.Container{constructor(e,i,s,n){super(e,s,n);o(this,"context");o(this,"background");o(this,"healthBar");o(this,"fullWidth",78);this.context=e,this.background=e.add.image(0,0,"HpBackground").setOrigin(0);const r=me(e,i)?"HpAlly":"HpEnemy";this.healthBar=e.add.image(0,0,r).setOrigin(0),this.setHealth(i.maxHealth,i.currentHealth),this.add([this.background,this.healthBar])}setHealth(e,i){const s=i/e;this.healthBar.displayWidth=this.fullWidth*s}}class De extends Phaser.GameObjects.Container{constructor(e,i,s){const{x:n,y:r}=e.centerPoints[i.boardPosition];super(e,n,r);o(this,"belongsTo");o(this,"maxHealth");o(this,"currentHealth");o(this,"isDestroyed");o(this,"isLastCrystal");o(this,"boardPosition");o(this,"row");o(this,"col");o(this,"debuffAmount");o(this,"debuffLevel");o(this,"annihilatorDebuff");o(this,"isShielded");o(this,"paladinAura");o(this,"physicalDamageResistance");o(this,"magicalDamageResistance");o(this,"context");o(this,"pedestalImage");o(this,"crystalImage");o(this,"singleCrystalDebuff");o(this,"doubleCrystalDebuff");o(this,"annihilatorDebuffImage");o(this,"shieldImage");o(this,"attackReticle");o(this,"blockedLOS");o(this,"debuffEventSingle");o(this,"debuffEventDouble");o(this,"healthBar");o(this,"unitCard");this.context=e,this.maxHealth=i.maxHealth,this.currentHealth=i.currentHealth,this.isDestroyed=i.isDestroyed,this.isLastCrystal=s.tileType===A.CRYSTAL_BIG?!0:i.isLastCrystal,this.boardPosition=i.boardPosition,this.row=s.row,this.col=s.col,this.belongsTo=i.belongsTo,this.debuffAmount=i.debuffAmount<0?0:i.debuffAmount,this.debuffLevel=i.debuffLevel<0||i.debuffLevel===void 0?0:i.debuffLevel,this.isShielded=i.isShielded,this.annihilatorDebuff=i.annihilatorDebuff,this.paladinAura=i.paladinAura??0,this.physicalDamageResistance=i.physicalDamageResistance??0,this.magicalDamageResistance=i.magicalDamageResistance??0,this.healthBar=new ut(e,i,-38,-70),this.unitCard=new $t(e,i).setVisible(!1);const c=this.maxHealth===9e3;this.pedestalImage=e.add.image(0,10,"pedestal").setScale(.8);const h=i.currentHealth<=i.maxHealth/2?"crystalDamaged":"crystalFull";this.crystalImage=e.add.image(0,-30,h).setScale(c?1:.8),this.blockedLOS=e.add.image(0,-10,"blockedLOS").setOrigin(.5).setName("blockedLOS").setVisible(!1);const d=this.belongsTo===1?3381759:10027008;this.crystalImage.setTint(d),this.singleCrystalDebuff=e.add.image(0,-30,"crystalDebuff_1").setVisible(!1),this.doubleCrystalDebuff=e.add.image(0,-30,"crystalDebuff_3").setVisible(!1),this.shieldImage=e.add.image(0,-30,"shield").setVisible(this.isShielded),this.annihilatorDebuffImage=e.add.image(0,-30,"annihilatorDebuff").setVisible(this.annihilatorDebuff);const u=(y,T,P)=>{let C=0;return this.scene.time.addEvent({delay:100,loop:!0,callback:()=>{C=1-C,y.setTexture(C===0?T:P)}})};this.debuffEventSingle=u(this.singleCrystalDebuff,"crystalDebuff_1","crystalDebuff_2"),this.debuffEventDouble=u(this.doubleCrystalDebuff,"crystalDebuff_3","crystalDebuff_4"),this.attackReticle=e.add.image(0,-10,"attackReticle").setOrigin(.5).setScale(.8).setName("attackReticle").setVisible(!1),(y=>{e.tweens.add({targets:y,angle:360,duration:7e3,repeat:-1,ease:"Linear",onRepeat:()=>{y.angle=0}})})(this.attackReticle),this.add([this.pedestalImage,this.crystalImage,this.singleCrystalDebuff,this.doubleCrystalDebuff,this.shieldImage,this.annihilatorDebuffImage,this.healthBar,this.attackReticle,this.blockedLOS,this.unitCard]).setSize(90,95).setInteractive({useHandCursor:!0}).setDepth(this.boardPosition+10),Ft(this,this.context),e.add.existing(this)}updateDebuffAnimation(e){switch(e===void 0&&(e=0),e){case 0:this.singleCrystalDebuff.setVisible(!1),this.doubleCrystalDebuff.setVisible(!1);break;case 1:this.singleCrystalDebuff.setVisible(!0),this.doubleCrystalDebuff.setVisible(!1);break;case 2:this.singleCrystalDebuff.setVisible(!1),this.doubleCrystalDebuff.setVisible(!0);break;default:console.error("updateDebuffAnimation() level and case dont match",e);break}this.debuffLevel=e}getTile(){var i,s;const e=(s=(i=this.context)==null?void 0:i.gameController)==null?void 0:s.board.getTileFromBoardPosition(this.boardPosition);if(!e)throw new Error("getTile() -> No tile found");return e}updateTileData(){const e=this.getTile();this.debuffLevel<0&&(this.debuffLevel=0,this.updateDebuffAnimation(this.debuffLevel)),this.debuffAmount<0&&(this.debuffAmount=0),e.crystal={belongsTo:this.belongsTo,maxHealth:this.maxHealth,currentHealth:this.currentHealth,isDestroyed:this.isDestroyed,isLastCrystal:this.isLastCrystal,boardPosition:this.boardPosition,row:this.row,col:this.col,debuffAmount:this.debuffAmount,debuffLevel:this.debuffLevel,annihilatorDebuff:this.annihilatorDebuff,isShielded:this.isShielded,paladinAura:this.paladinAura,physicalDamageResistance:this.physicalDamageResistance,magicalDamageResistance:this.magicalDamageResistance}}getsDamaged(e,i,s=1){var u,p;const n=i===z.PHYSICAL?this.physicalDamageResistance:this.magicalDamageResistance;if(this.isShielded)return this.isShielded=!1,this.shieldImage.setVisible(!1),f(this.context,m.ENGINEER_SHIELD_BREAK),0;this.annihilatorDebuff&&i===z.PHYSICAL&&(this.annihilatorDebuff=!1,this.physicalDamageResistance+=50,this.annihilatorDebuffImage.setVisible(!1));const r=e-e*n/100,c=this.debuffAmount*s,h=x(r+c),d=h>this.currentHealth?this.currentHealth:h;return this.currentHealth-=d,this.debuffAmount>0?f(this.scene,m.CRYSTAL_DAMAGE_BUFF):f(this.scene,m.CRYSTAL_DAMAGE),this.currentHealth<=this.maxHealth/2&&this.crystalImage.setTexture("crystalDamaged"),this.healthBar.setHealth(this.maxHealth,this.currentHealth),d>0&&new fe(this.context,this.x,this.y-50,d.toString()),this.unitCard.updateCardHealth(this.currentHealth,this.maxHealth),this.updateTileData(),this.belongsTo===1&&((u=this.context.gameController)==null||u.gameUI.banner.playerOneHpBar.setHealth()),this.belongsTo===2&&((p=this.context.gameController)==null||p.gameUI.banner.playerTwoHpBar.setHealth()),this.currentHealth<=0&&this.removeFromGame(),d}removeFromGame(){f(this.scene,m.CRYSTAL_DESTROY);const e=this.getTile();e.crystal=void 0,e.obstacle=!1,e.tileType=A.BASIC;const i=this.context.gameController.board.crystals,s=i.findIndex(n=>n.boardPosition===this.boardPosition);if(i.splice(s,1),this.isLastCrystal)this.context.gameController.gameOver={winCondition:He.CRYSTAL,winner:this.context.activePlayer};else{const n=i.filter(r=>r.belongsTo===this.belongsTo);if(!n.length)throw new Error("Crystal getsDestroyed() No other crystals found");n.length===1&&(n[0].isLastCrystal=!0,n[0].updateTileData())}this.scene.tweens.killTweensOf(this),this.list.forEach(n=>{this.scene.tweens.killTweensOf(n)}),this.debuffEventSingle.remove(!1),this.debuffEventDouble.remove(!1),this.destroy(!0)}exportData(){return{belongsTo:this.belongsTo,maxHealth:this.maxHealth,currentHealth:this.currentHealth,isDestroyed:this.isDestroyed,isLastCrystal:this.isLastCrystal,boardPosition:this.boardPosition,row:this.row,col:this.col,debuffAmount:this.debuffAmount,debuffLevel:this.debuffLevel,annihilatorDebuff:this.annihilatorDebuff,isShielded:this.isShielded,paladinAura:this.paladinAura,physicalDamageResistance:this.physicalDamageResistance,magicalDamageResistance:this.magicalDamageResistance}}}function _e(t,a,e,i){const r=a?1:2,c={[g.ARCHER]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.CLERIC]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.KNIGHT]:{1:{charImageX:5,charImageY:-15},2:{charImageX:0,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.NINJA]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.WIZARD]:{1:{charImageX:10,charImageY:-15},2:{charImageX:-10,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.PRIESTESS]:{1:{charImageX:20,charImageY:-20},2:{charImageX:-15,charImageY:-20},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.IMPALER]:{1:{charImageX:10,charImageY:-15},2:{charImageX:-15,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:15,charImageY:-25}},[g.NECROMANCER]:{1:{charImageX:20,charImageY:-20},2:{charImageX:-5,charImageY:-20},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:10,charImageY:-25}},[g.PHANTOM]:{1:{charImageX:0,charImageY:0},2:{charImageX:0,charImageY:0},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.VOIDMONK]:{1:{charImageX:0,charImageY:-20},2:{charImageX:0,charImageY:-20},KO:{1:{charImageX:0,charImageY:0},2:{charImageX:0,charImageY:0}},hand:{charImageX:5,charImageY:-25}},[g.WRAITH]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.PALADIN]:{1:{charImageX:15,charImageY:-15},2:{charImageX:-10,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:10,charImageY:-25}},[g.GUNNER]:{1:{charImageX:5,charImageY:-10},2:{charImageX:-5,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.GRENADIER]:{1:{charImageX:10,charImageY:-20},2:{charImageX:-10,charImageY:-20},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:5,charImageY:-25}},[g.ENGINEER]:{1:{charImageX:5,charImageY:-15},2:{charImageX:-5,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.ANNIHILATOR]:{1:{charImageX:20,charImageY:-25},2:{charImageX:-20,charImageY:-25},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:15,charImageY:-25}}};return e?c[t].hand:i?c[t].KO[r]:c[t][r]}class Ut extends Phaser.GameObjects.Container{constructor(e,i){const s=i.boardPosition>44?-200:0;super(e,0,s);o(this,"cardBackgroundImage");o(this,"unitPictureImage");o(this,"cardSeparatorImage");o(this,"hpBackgroundImage");o(this,"hpBarImage");o(this,"attackTypeImage");o(this,"magicalResistanceImage");o(this,"physicalResistanceImage");o(this,"movementRangeImage");o(this,"attackRangeImage");o(this,"movementSquareImages");o(this,"attackSquareImages");o(this,"hpIconImage");o(this,"context");o(this,"attackType");o(this,"unitType");o(this,"currentHpText");o(this,"powerText");o(this,"magicalResistanceText");o(this,"physicalResistanceText");o(this,"cardFlavorText");o(this,"cardTypeText");o(this,"cardNameText");o(this,"rangeText");this.context=e,this.attackType=i.attackType,this.unitType=i.unitType,this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,`${i.unitType}CardPic`).setOrigin(.5).setScale(.4),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3);const{cardText:n,cardType:r}=It(i.unitType);this.cardNameText=this.context.add.text(55,-170,ke(i.unitType),{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,ke(r),{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.hpBackgroundImage=e.add.image(-60,-60,"hpBackground").setOrigin(.5),this.hpBarImage=e.add.image(-118,-72,"hpBar").setOrigin(0),this.setHealthBar(i.currentHealth,i.maxHealth),this.currentHpText=this.context.add.text(80,-60,`${i.currentHealth}/${i.maxHealth}`,{fontFamily:"proLight",fontSize:35,color:i.maxHealth>i.baseHealth?"#00FF00":"#ffffff"}).setOrigin(.5),this.hpIconImage=e.add.image(-150,-60,"hpIcon").setOrigin(.5);const c=i.attackType===z.MAGICAL?"magicalDamage":"physicalDamage";this.attackTypeImage=e.add.image(-150,-15,c).setOrigin(.5),this.powerText=this.context.add.text(-40,-15,`${i.currentPower} ${i.attackType}`,{fontFamily:"proLight",fontSize:35,color:this.getTextColor(i.currentPower,i.basePower)}).setOrigin(.5),this.magicalResistanceImage=e.add.image(40,30,"magicalResistance").setOrigin(.5),this.magicalResistanceText=this.context.add.text(100,30,`${i.magicalDamageResistance} %`,{fontFamily:"proLight",fontSize:35,color:this.getTextColor(i.magicalDamageResistance,i.baseMagicalDamageResistance)}).setOrigin(.5),this.physicalResistanceImage=e.add.image(-150,30,"physicalResistance").setOrigin(.5),this.physicalResistanceText=this.context.add.text(-85,30,`${i.physicalDamageResistance} %`,{fontFamily:"proLight",fontSize:35,color:this.getTextColor(i.physicalDamageResistance,i.basePhysicalDamageResistance)}).setOrigin(.5),this.movementRangeImage=e.add.image(-10,120,"movementRange").setOrigin(.5),this.attackRangeImage=e.add.image(-10,80,"attackRange").setOrigin(.5),this.rangeText=this.context.add.text(-85,90,"Range:",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5);const h=(d,u,p,y)=>{const T=[];let P=0;for(let C=1;C<=d;C++){const D=e.add.image(u+P,p,y).setOrigin(.5);T.push(D),P+=25}return T};this.movementSquareImages=h(i.movement,20,120,"movementSquare"),this.attackSquareImages=h(i.attackRange,20,80,"attackSquare"),this.cardFlavorText=this.context.add.text(0,180,n,{fontFamily:"proLight",fontSize:25,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(.5),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.hpBackgroundImage,this.hpBarImage,this.attackTypeImage,this.magicalResistanceImage,this.physicalResistanceImage,this.movementRangeImage,this.attackRangeImage,this.hpIconImage,this.currentHpText,this.cardFlavorText,this.cardTypeText,this.cardNameText,this.powerText,this.physicalResistanceText,this.magicalResistanceText,this.rangeText,...this.movementSquareImages,...this.attackSquareImages])}getTextColor(e,i){return e>i?"#00FF00":e<i?"#ff0000":"#ffffff"}updateCardData(e){this.updateCardPower(e),this.updateCardPhysicalResistance(e),this.updateCardMagicalResistance(e),this.updateCardHealth(e)}updateCardPower(e){const i=e.getTotalPower();this.powerText.setText(`${x(i)} ${this.attackType}`);const s=e.unitType===g.WRAITH?250:e.basePower;e.priestessDebuff?this.powerText.setColor("#ff0000"):this.powerText.setColor(this.getTextColor(i,s))}updateCardPhysicalResistance(e){this.physicalResistanceText.setText(`${x(e.physicalDamageResistance)} %`),this.physicalResistanceText.setColor(this.getTextColor(e.physicalDamageResistance,e.basePhysicalDamageResistance))}updateCardMagicalResistance(e){this.magicalResistanceText.setText(`${x(e.magicalDamageResistance)} %`),this.magicalResistanceText.setColor(this.getTextColor(e.magicalDamageResistance,e.baseMagicalDamageResistance))}updateCardHealth(e){this.currentHpText.setText(`${x(e.currentHealth)}/${e.maxHealth}`),this.currentHpText.setColor(this.getTextColor(e.maxHealth,e.baseHealth)),this.setHealthBar(e.currentHealth,e.maxHealth)}setHealthBar(e,i){const s=this.hpBackgroundImage.width-10,n=e/i;this.hpBarImage.displayWidth=s*n}}class _ extends Phaser.GameObjects.Container{constructor(e,i,s){const{x:n,y:r}=e.centerPoints[i.boardPosition];super(e,n,r);o(this,"class",j.HERO);o(this,"faction");o(this,"unitType");o(this,"unitId");o(this,"boardPosition");o(this,"row");o(this,"col");o(this,"baseHealth");o(this,"maxHealth");o(this,"currentHealth");o(this,"isKO");o(this,"lastBreath");o(this,"movement");o(this,"attackRange");o(this,"healingRange");o(this,"attackType");o(this,"basePower");o(this,"physicalDamageResistance");o(this,"basePhysicalDamageResistance");o(this,"magicalDamageResistance");o(this,"baseMagicalDamageResistance");o(this,"factionBuff");o(this,"runeMetal");o(this,"shiningHelm");o(this,"superCharge");o(this,"attackTile");o(this,"isActiveValue");o(this,"belongsTo");o(this,"canHeal");o(this,"unitsConsumed");o(this,"priestessDebuff");o(this,"annihilatorDebuff");o(this,"isShielded");o(this,"isDrunk");o(this,"paladinAura");o(this,"manaVial");o(this,"speedTile");o(this,"context");o(this,"unitCard");o(this,"characterImage");o(this,"runeMetalImage");o(this,"shiningHelmImage");o(this,"factionBuffImage");o(this,"attackReticle");o(this,"healReticle");o(this,"allyReticle");o(this,"blockedLOS");o(this,"priestessDebuffImage");o(this,"annihilatorDebuffImage");o(this,"shieldImage");o(this,"crystalDebuffTileAnim");o(this,"powerTileAnim");o(this,"magicalResistanceTileAnim");o(this,"physicalResistanceTileAnim");o(this,"superChargeAnim");o(this,"reviveAnim");o(this,"smokeAnim");o(this,"crystalDebuffEvent");o(this,"powerTileEvent");o(this,"magicalResistanceTileEvent");o(this,"physicalResistanceTileEvent");o(this,"superChargeEvent");o(this,"reviveEvent");o(this,"smokeEvent");o(this,"spawnEvent");o(this,"healthBar");this.context=e,this.faction=i.faction,this.unitType=i.unitType,this.unitId=i.unitId,this.boardPosition=i.boardPosition,this.row=i.row,this.col=i.col,this.baseHealth=i.baseHealth,this.maxHealth=i.maxHealth,this.currentHealth=i.currentHealth,this.isKO=i.isKO,this.lastBreath=i.lastBreath,this.movement=i.movement,this.attackRange=i.attackRange,this.healingRange=i.healingRange,this.attackType=i.attackType,this.basePower=i.basePower,this.physicalDamageResistance=i.physicalDamageResistance,this.basePhysicalDamageResistance=i.basePhysicalDamageResistance,this.magicalDamageResistance=i.magicalDamageResistance,this.baseMagicalDamageResistance=i.baseMagicalDamageResistance,this.factionBuff=i.factionBuff,this.runeMetal=i.runeMetal,this.shiningHelm=i.shiningHelm,this.superCharge=i.superCharge,this.attackTile=i.attackTile,this.isActiveValue=!1,this.belongsTo=i.belongsTo??1,this.canHeal=i.canHeal??!1,this.unitsConsumed=i.unitsConsumed??0,this.priestessDebuff=i.priestessDebuff??!1,this.annihilatorDebuff=i.annihilatorDebuff??!1,this.isShielded=i.isShielded??!1,this.isDrunk=i.isDrunk??!1,this.paladinAura=i.paladinAura??0,this.manaVial=(i==null?void 0:i.manaVial)??void 0,this.speedTile=i.speedTile,this.unitCard=new Ut(e,{...i,currentPower:this.getTotalPower()}).setVisible(!1),this.healthBar=new ut(e,i,-38,-75),this.boardPosition>=45&&this.healthBar.setVisible(!1);const c=pt(this.boardPosition),{charImageX:h,charImageY:d}=_e(this.unitType,this.belongsTo===1,c,i.isKO);this.characterImage=e.add.image(h,d,this.updateCharacterImage()).setOrigin(.5).setName("body").setDepth(this.row+10),c&&this.characterImage.setScale(.8),this.belongsTo===2&&this.boardPosition<45&&this.characterImage.setFlipX(!0),this.runeMetalImage=e.add.image(33,25,"runeMetal").setOrigin(.5).setScale(.4).setName("runeMetal").setVisible(this.runeMetal),this.runeMetal||this.runeMetalImage.setVisible(!1),this.shiningHelmImage=e.add.image(-28,25,"shiningHelm").setOrigin(.5).setScale(.4).setName("shiningHelm"),this.shiningHelm||this.shiningHelmImage.setVisible(!1),this.faction===B.COUNCIL||B.DWARVES?this.factionBuffImage=e.add.image(5,25,"dragonScale").setOrigin(.5).setScale(.4).setName("dragonScale").setVisible(this.factionBuff):this.factionBuffImage=e.add.image(5,25,"soulStone").setOrigin(.5).setScale(.4).setName("soulStone").setVisible(this.factionBuff),this.faction===B.COUNCIL&&(this.smokeAnim=e.add.image(0,0,"smokeAnim_1").setOrigin(.5).setScale(2.5).setVisible(!1).setTint(3751239)),this.attackReticle=e.add.image(0,-10,"attackReticle").setOrigin(.5).setScale(.8).setName("attackReticle").setVisible(!1),this.healReticle=e.add.image(0,-10,"healReticle").setOrigin(.5).setScale(.8).setName("healReticle").setVisible(!1),this.allyReticle=e.add.image(0,-10,"allyReticle").setOrigin(.5).setScale(.6).setName("allyReticle").setVisible(!1),this.priestessDebuffImage=e.add.image(0,-10,"priestessDebuff").setOrigin(.5).setScale(2.5).setName("priesetessDebuff").setVisible(this.priestessDebuff),this.annihilatorDebuffImage=e.add.image(0,-10,"annihilatorDebuff").setOrigin(.5).setName("annihilatorDebuff").setVisible(this.annihilatorDebuff),this.shieldImage=e.add.image(0,-10,"shield").setOrigin(.5).setName("shield").setVisible(this.isShielded);const u=y=>{e.tweens.add({targets:y,angle:360,duration:7e3,repeat:-1,ease:"Linear",onRepeat:()=>{y.angle=0}})};u(this.attackReticle),u(this.healReticle),u(this.allyReticle),u(this.priestessDebuffImage),this.blockedLOS=e.add.image(0,-10,"blockedLOS").setOrigin(.5).setName("blockedLOS").setVisible(!1),e.tweens.add({targets:this.blockedLOS,scale:1.2,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.crystalDebuffTileAnim=e.add.image(0,30,"crystalDamageAnim_1").setOrigin(.5).setScale(.6).setVisible((s==null?void 0:s.tileType)===A.CRYSTAL_DAMAGE&&!this.isKO),this.crystalDebuffEvent=this.continuousEvent(this.crystalDebuffTileAnim,["crystalDamageAnim_1","crystalDamageAnim_2","crystalDamageAnim_3"]),this.powerTileAnim=e.add.image(0,27,"powerTileAnim_1").setOrigin(.5).setScale(.6).setVisible((s==null?void 0:s.tileType)===A.POWER&&!this.isKO),this.powerTileEvent=this.continuousEvent(this.powerTileAnim,["powerTileAnim_1","powerTileAnim_2","powerTileAnim_3"]),this.magicalResistanceTileAnim=e.add.image(0,30,"magicalResistanceAnim_1").setOrigin(.5).setScale(.6).setVisible(((s==null?void 0:s.tileType)===A.MAGICAL_RESISTANCE||(s==null?void 0:s.tileType)===A.SPEED)&&!this.isKO),this.magicalResistanceTileEvent=this.continuousEvent(this.magicalResistanceTileAnim,["magicalResistanceAnim_1","magicalResistanceAnim_2","magicalResistanceAnim_3"]),this.physicalResistanceTileAnim=e.add.image(0,30,"physicalResistanceAnim_1").setOrigin(.5).setScale(.6).setVisible((s==null?void 0:s.tileType)===A.PHYSICAL_RESISTANCE&&!this.isKO),this.physicalResistanceTileEvent=this.continuousEvent(this.physicalResistanceTileAnim,["physicalResistanceAnim_1","physicalResistanceAnim_2","physicalResistanceAnim_3"]),this.superChargeAnim=e.add.image(0,-18,"superChargeAnim_1").setOrigin(.5).setScale(.8).setVisible(this.superCharge),this.superChargeEvent=this.continuousEvent(this.superChargeAnim,["superChargeAnim_1","superChargeAnim_2","superChargeAnim_3"]),this.reviveAnim=e.add.image(0,-10,"reviveAnim_1").setOrigin(.5).setScale(.7).setVisible(!1);const p=new Phaser.Geom.Rectangle(-35,-50,75,85);this.add([this.priestessDebuffImage,this.annihilatorDebuffImage,this.shieldImage,this.superChargeAnim,this.reviveAnim,this.characterImage,this.runeMetalImage,this.factionBuffImage,this.shiningHelmImage,this.healthBar,this.crystalDebuffTileAnim,this.powerTileAnim,this.magicalResistanceTileAnim,this.physicalResistanceTileAnim,this.attackReticle,this.healReticle,this.allyReticle,...this.smokeAnim?[this.smokeAnim]:[],this.blockedLOS,this.unitCard]).setInteractive({hitArea:p,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}).setName(this.unitId).setDepth(this.row+10),this.boardPosition===51&&this.setVisible(!1),dt(this,e),e.add.existing(this)}get isActive(){return this.isActiveValue}set isActive(e){this.isActiveValue=e,e?this.onActivate():this.onDeactivate()}updatePosition(e){const{x:i,y:s}=this.context.centerPoints[e.boardPosition];this.x=i,this.y=s,this.boardPosition=e.boardPosition,this.row=e.row,this.col=e.col,this.setDepth(this.row+10)}exportData(){return{class:this.class,faction:this.faction,unitType:this.unitType,unitId:this.unitId,boardPosition:this.boardPosition,row:this.row,col:this.col,baseHealth:this.baseHealth,maxHealth:this.maxHealth,currentHealth:this.currentHealth,isKO:this.isKO,lastBreath:this.lastBreath,movement:this.movement,attackRange:this.attackRange,healingRange:this.healingRange,attackType:this.attackType,basePower:this.basePower,physicalDamageResistance:this.physicalDamageResistance,basePhysicalDamageResistance:this.basePhysicalDamageResistance,magicalDamageResistance:this.magicalDamageResistance,baseMagicalDamageResistance:this.baseMagicalDamageResistance,factionBuff:this.factionBuff,runeMetal:this.runeMetal,shiningHelm:this.shiningHelm,superCharge:this.superCharge,attackTile:this.attackTile,belongsTo:this.belongsTo,canHeal:this.canHeal,unitsConsumed:this.unitsConsumed,priestessDebuff:this.priestessDebuff,annihilatorDebuff:this.annihilatorDebuff,isShielded:this.isShielded,paladinAura:this.paladinAura,isDrunk:this.isDrunk,manaVial:this.manaVial,speedTile:this.speedTile}}continuousEvent(e,i){let s=0;return this.scene.time.addEvent({delay:100,loop:!0,callback:()=>{e.setTexture(i[s]),s=(s+1)%i.length}})}singleEvent(e,i,s){let n=0;e.setVisible(!0);const r=this.scene.time.addEvent({delay:s,repeat:i.length-1,callback:()=>{e.setTexture(i[n]),n++,n===i.length&&(e.setVisible(!1),r.remove())}});return r}singleTween(e,i){e.setVisible(!0),this.context.tweens.add({targets:e,scaleX:0,scaleY:0,duration:i,ease:"Cubic.easeIn",onComplete:()=>{e.setVisible(!1)}})}onActivate(){console.log(`${this.unitId} is now active`),this.setScale(1.2)}onDeactivate(){console.log(`${this.unitId} is now inactive`),this.setScale(1)}getsDamaged(e,i){this.characterImage.setTint(16711680),this.scene.time.delayedCall(500,()=>this.characterImage.clearTint());const s=x(this.getLifeLost(e,i));return this.currentHealth-=s,this.currentHealth<=0&&this.getsKnockedDown(),this.healthBar.setHealth(this.maxHealth,this.currentHealth),s>0&&new fe(this.context,this.x,this.y-50,s.toString()),this.unitCard.updateCardData(this),this.updateTileData(),this instanceof _&&this.isKO&&this.unitType===g.PHANTOM&&this.removeFromGame(),s}getTotalPower(e=1){e===0&&(e=1);const i=this.runeMetal?1.5:1,s=this.attackTile,n=this.superCharge?3:1,r=this.priestessDebuff?.5:1,c=this.paladinAura*.05+1;return(this.basePower+s)*c*e*n*r*i}getLifeLost(e,i){const s={[z.MAGICAL]:this.magicalDamageResistance,[z.PHYSICAL]:this.physicalDamageResistance};if(this.isShielded)return this.isShielded=!1,this.shieldImage.setVisible(!1),0;this.isDrunk&&(this.physicalDamageResistance-=50,this.magicalDamageResistance-=50,this.isDrunk=!1),this.annihilatorDebuff&&i===z.PHYSICAL&&(this.physicalDamageResistance+=50,this.annihilatorDebuff=!1,this.annihilatorDebuffImage.setVisible(!1));const n=s[i],r=s?e-e*n/100:e;return r>this.currentHealth?this.currentHealth:r}getTotalHealing(e){const i=this.runeMetal?1.5:1,s=this.attackTile,n=this.superCharge?3:1,r=this.priestessDebuff?.5:1;return(this.basePower+s)*e*n*r*i}getsHealed(e,i=!0){if(e<=0)return;let s;return this.currentHealth+e>=this.maxHealth?(s=this.maxHealth-this.currentHealth,this.currentHealth=this.maxHealth):(this.currentHealth+=e,s=e),this.healthBar.setHealth(this.maxHealth,this.currentHealth),s>0&&i&&new fe(this.context,this.x,this.y-50,s.toString(),!0),this.isKO&&this.getsRevived(),this.unitCard.updateCardData(this),this.updateTileData(),s}getsRevived(){this.reviveEvent=this.singleEvent(this.reviveAnim,["reviveAnim_1","reviveAnim_2","reviveAnim_3"],150),this.isKO=!1,this.lastBreath=!1,this.characterImage.setTexture(this.updateCharacterImage());const{charImageX:e,charImageY:i}=_e(this.unitType,this.belongsTo===1,!1,!1);this.specialTileCheck(this.getTile()),this.characterImage.x=e,this.characterImage.y=i}increaseMaxHealth(e,i=!0){if(e<=0)return;this.isKO&&this.getsRevived();const s=x(e);this.maxHealth+=s,this.currentHealth+=s,this.healthBar.setHealth(this.maxHealth,this.currentHealth),i&&new fe(this.context,this.x,this.y-50,e.toString(),!0),this.unitCard.updateCardData(this),this.updateTileData()}healAndIncreaseHealth(e,i){const s=this.getsHealed(e,!1);this.increaseMaxHealth(i,!1);const n=s?s+i:i;new fe(this.context,this.x,this.y-50,n.toString(),!0)}getsKnockedDown(){this.unitType!==g.PHANTOM&&ga(this.scene,this.unitType),this.removeSpecialTileOnKo(),this.currentHealth=0,this.isKO=!0;const e=this.getTile();e.hero=this.exportData(),this.characterImage.setTexture(this.updateCharacterImage());const{charImageX:i,charImageY:s}=_e(this.unitType,this.belongsTo===1,!1,!0);this.characterImage.x=i,this.characterImage.y=s,Qe(this.context,this)}getTile(){var i,s;const e=(s=(i=this.context)==null?void 0:i.gameController)==null?void 0:s.board.getTileFromBoardPosition(this.boardPosition);if(!e)throw new Error("getTile() -> No tile found");return e}updateTileData(){const e=this.getTile();e.hero=this.exportData()}shuffleInDeck(){this.boardPosition=51;const e=this.exportData();this.context.gameController.hand.removeFromHand(e),this.context.gameController.deck.addToDeck(e),this.removeFromGame(!1)}removeFromGame(e=!0){var i;this.scene.tweens.killTweensOf(this),this.list.forEach(s=>{this.scene.tweens.killTweensOf(s)}),this.crystalDebuffEvent.remove(!1),this.powerTileEvent.remove(!1),this.magicalResistanceTileEvent.remove(!1),this.physicalResistanceTileEvent.remove(!1),this.superChargeEvent.remove(!1),this.spawnEvent&&((i=this.spawnEvent)==null||i.remove(!1)),e&&this.removeFromBoard(),this.destroy(!0)}removeFromBoard(){this.getTile().removeHero();const i=this.context.gameController.board.units.findIndex(s=>s.unitId===this.unitId);i!==-1&&this.context.gameController.board.units.splice(i,1),Qe(this.context,this)}getDistanceToTarget(e){const i=this.context.gameController,s=i.board.getTileFromBoardPosition(this.boardPosition),n=i.board.getTileFromBoardPosition(e.boardPosition);return!s||!n?(console.error("Archer attack() No attacker or target tile found"),0):Tt(s.row,s.col,n.row,n.col)}async move(e){const i=this.context.gameController,s=i.board.getTileFromBoardPosition(this.boardPosition);if(s){if(await ma(this.context,this,e),e.hero&&e.hero.isKO){const n=i.board.units.find(r=>{var c;return r.unitId===((c=e.hero)==null?void 0:c.unitId)});n||console.error("move() Found heroData on targetTile, but no Hero to remove",e),f(this.context,m.HERO_STOMP),n==null||n.removeFromGame(!0)}this.specialTileCheck(e,s),this.updatePosition(e),e.hero=this.exportData(),s.removeHero(),i.afterAction(b.MOVE,s.boardPosition,e.boardPosition)}}spawn(e){const i=this.boardPosition,s=this.context.gameController;if(e.hero&&(e.hero.isKO||e.isEnemy(this.context.userId)&&e.hero.unitType===g.PHANTOM)){const c=s.board.units.find(h=>{var d;return h.unitId===((d=e.hero)==null?void 0:d.unitId)});c||console.error("spawn() Found heroData on tile, but no Hero to remove",e),f(this.context,m.HERO_STOMP),c==null||c.removeFromGame(!0)}s.hand.removeFromHand(this),s.board.units.push(this),this.characterImage.setScale(1);const{charImageX:n,charImageY:r}=_e(this.unitType,this.belongsTo===1,!1,!1);this.characterImage.x=n,this.characterImage.y=r,this.setDepth(this.row+10),this.belongsTo===2&&this.characterImage.setFlipX(!0),this.unitCard.y=0,this.specialTileCheck(e),this.updatePosition(e),this.updateTileData(),this.healthBar.setVisible(!0),f(this.context,m.HERO_SPAWN),s.afterAction(b.SPAWN,i,e.boardPosition)}isFullHP(){return this.maxHealth===this.currentHealth}isAlreadyEquipped(e){return!!{[S.DRAGON_SCALE]:this.factionBuff,[S.SOUL_STONE]:this.factionBuff,[S.RUNE_METAL]:this.runeMetal,[S.SHINING_HELM]:this.shiningHelm,[S.SUPERCHARGE]:this.superCharge}[e.itemType]}equipShiningHelm(e){const i=this.scene.add.image(this.x,this.y,"shiningHelm").setDepth(100);ee(i),this.shiningHelm=!0,this.magicalDamageResistance+=20,this.increaseMaxHealth(this.baseHealth*.1),this.shiningHelmImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.unitCard.updateCardData(this),this.updateTileData(),this.context.gameController.afterAction(b.USE,e,this.boardPosition)}equipRunemetal(e){const i=this.scene.add.image(this.x,this.y,"runeMetal").setDepth(100);ee(i),this.runeMetal=!0,this.runeMetalImage.setVisible(!0),this.runeMetalImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.unitCard.updateCardData(this),this.updateTileData(),this.context.gameController.afterAction(b.USE,e,this.boardPosition)}equipSuperCharge(e){this.superCharge=!0,this.unitCard.updateCardData(this),this.updateTileData(),this.superChargeAnim.setVisible(!0),this.context.gameController.afterAction(b.USE,e,this.boardPosition)}updateCrystals(e){this.context.gameController.board.crystals.forEach(i=>{if(i.belongsTo!==this.belongsTo){let s=i.debuffLevel;if(e>0)s+=1;else if(e<0)s-=1;else return;i.updateDebuffAnimation(s),i.debuffAmount+=e}})}specialTileCheck(e,i,s=!0){let n=1;this.faction===B.DWARVES&&(n=1.2,this.unitType===g.ENGINEER&&(n=1.4));const r=e.tileType;switch(i==null?void 0:i.tileType){case A.CRYSTAL_DAMAGE:this.updateCrystals(-300*n),this.crystalDebuffTileAnim.setVisible(!1);break;case A.POWER:this.attackTile=0,this.powerTileAnim.setVisible(!1);break;case A.MAGICAL_RESISTANCE:this.magicalDamageResistance-=20*n,this.magicalResistanceTileAnim.setVisible(!1);break;case A.PHYSICAL_RESISTANCE:this.physicalDamageResistance-=20*n,this.physicalResistanceTileAnim.setVisible(!1);break;case A.SPEED:this.speedTile=0,this.magicalResistanceTileAnim.setVisible(!1);break}switch(r){case A.CRYSTAL_DAMAGE:console.log("crystal"),this.updateCrystals(300*n),this.crystalDebuffTileAnim.setVisible(!0),s&&f(this.scene,m.CRYSTAL_TILE);break;case A.POWER:this.attackTile=100*n,this.powerTileAnim.setVisible(!0),s&&f(this.scene,m.SWORD_TILE);break;case A.MAGICAL_RESISTANCE:this.magicalDamageResistance+=20*n,this.magicalResistanceTileAnim.setVisible(!0),s&&f(this.scene,m.HELM_TILE);break;case A.PHYSICAL_RESISTANCE:this.physicalDamageResistance+=20*n,this.physicalResistanceTileAnim.setVisible(!0),s&&f(this.scene,m.SHIELD_TILE);break;case A.SPEED:this.speedTile=2,n<1&&(this.speedTile=3,n<1.2&&(this.speedTile=4)),this.magicalResistanceTileAnim.setVisible(!0),s&&f(this.scene,m.HELM_TILE);break}this.magicalDamageResistance-=this.paladinAura*5,this.physicalDamageResistance-=this.paladinAura*5,this.paladinAura=0,ie(this.context,this,e,!0).heroTiles.forEach(d=>{const u=this.context.gameController.board.units.find(p=>p.boardPosition===d.boardPosition);u&&!u.isKO&&u.unitType===g.PALADIN&&u!==this&&(this.magicalDamageResistance+=5,this.physicalDamageResistance+=5,this.paladinAura+=1)}),this.unitCard.updateCardData(this)}removeSpecialTileOnKo(){const e=this.getTile().tileType;let i=1;switch(this.faction===B.DWARVES&&(i=1.2,this.unitType===g.ENGINEER&&(i=1.4)),e){case A.CRYSTAL_DAMAGE:this.updateCrystals(-300*i),this.crystalDebuffTileAnim.setVisible(!1);break;case A.POWER:this.attackTile=0,this.powerTileAnim.setVisible(!1);break;case A.MAGICAL_RESISTANCE:this.magicalDamageResistance-=20*i,this.magicalResistanceTileAnim.setVisible(!1);break;case A.PHYSICAL_RESISTANCE:this.physicalDamageResistance-=20*i,this.physicalResistanceTileAnim.setVisible(!1);break;case A.SPEED:this.speedTile=0,this.magicalResistanceTileAnim.setVisible(!1);break}this.unitCard.updateCardData(this)}updateCharacterImage(){return this.unitType===g.PHANTOM?"phantom_1":this.isKO?`${this.unitType}_9`:this.runeMetal&&this.factionBuff&&this.shiningHelm?`${this.unitType}_8`:this.runeMetal&&this.shiningHelm?`${this.unitType}_7`:this.factionBuff&&this.shiningHelm?`${this.unitType}_6`:this.factionBuff&&this.runeMetal?`${this.unitType}_5`:this.factionBuff?`${this.unitType}_4`:this.shiningHelm?`${this.unitType}_3`:this.runeMetal?`${this.unitType}_2`:`${this.unitType}_1`}removeAttackModifiers(){this.priestessDebuff=!1,this.priestessDebuffImage.setVisible(!1),this.superCharge=!1,this.superChargeAnim.setVisible(!1),this.unitCard.updateCardData(this);const e=this.getTile();e.hero=this.exportData()}flashActingUnit(){this.characterImage.setTint(3381759),this.scene.time.delayedCall(800,()=>this.characterImage.clearTint())}}class Gt extends Phaser.GameObjects.Container{constructor(e,i){const s=i.boardPosition>44?-180:0;super(e,0,s);o(this,"cardBackgroundImage");o(this,"unitPictureImage");o(this,"cardSeparatorImage");o(this,"context");o(this,"cardFlavorText");o(this,"cardTypeText");o(this,"cardNameText");this.context=e,this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,`${i.itemType}CardPic`).setOrigin(.5).setScale(.4),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3);const{cardText:n,cardType:r,cardName:c}=It(i.itemType);this.cardNameText=this.context.add.text(55,-170,ke(c),{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,ke(r),{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cardFlavorText=this.context.add.text(-170,-80,n,{fontFamily:"proLight",fontSize:28,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(0),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.cardFlavorText,this.cardTypeText,this.cardNameText])}}class q extends Phaser.GameObjects.Container{constructor(e,i){const{x:s,y:n}=e.centerPoints[i.boardPosition];super(e,s,n-20);o(this,"class",j.ITEM);o(this,"faction");o(this,"unitId");o(this,"itemType");o(this,"boardPosition");o(this,"isActiveValue");o(this,"belongsTo");o(this,"canHeal");o(this,"dealsDamage");o(this,"itemImage");o(this,"context");o(this,"unitCard");o(this,"row",10);this.context=e,this.unitCard=new Gt(e,i).setVisible(!1),this.unitId=i.unitId,this.faction=i.faction,this.itemType=i.itemType,this.boardPosition=i.boardPosition,this.isActiveValue=!1,this.belongsTo=i.belongsTo??1,this.canHeal=i.canHeal??!1,this.dealsDamage=i.dealsDamage??!1,this.itemImage=e.add.image(0,0,this.itemType).setOrigin(.5).setName("itemImage"),dt(this,e),this.boardPosition===51&&this.setVisible(!1).disableInteractive(),this.itemImage.displayWidth=110,this.itemImage.displayHeight=110,this instanceof gt&&(this.itemImage.displayWidth=55,this.itemImage.displayHeight=55),this instanceof mt&&(this.itemImage.displayWidth=45,this.itemImage.displayHeight=65);const r=new Phaser.Geom.Rectangle(-35,-30,75,85);this.add([this.itemImage,this.unitCard]).setDepth(this.boardPosition).setInteractive({hitArea:r,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}).setName(this.unitId),e.add.existing(this)}get isActive(){return this.isActiveValue}set isActive(e){this.isActiveValue=e,e?this.onActivate():this.onDeactivate()}exportData(){return{class:this.class,faction:this.faction,unitId:this.unitId,itemType:this.itemType,boardPosition:this.boardPosition,belongsTo:this.belongsTo,canHeal:this.canHeal,dealsDamage:this.dealsDamage}}updatePosition(e){const{x:i,y:s}=this.context.centerPoints[e];this.x=i,this.y=s,this.boardPosition=e}onActivate(){console.log(`${this.unitId} is now active`),this.setScale(1.2)}onDeactivate(){console.log(`${this.unitId} is now inactive`),this.setScale(1)}shuffleInDeck(){this.boardPosition=51;const e=this.exportData();this.context.gameController.deck.addToDeck(e),this.removeFromGame()}removeFromGame(){var e;this.scene.tweens.killTweensOf(this),(e=this.context.gameController)==null||e.hand.removeFromHand(this),this.destroy(!0)}}class mt extends q{constructor(a,e){super(a,e)}use(a){a.equipShiningHelm(this.boardPosition),f(this.scene,m.ITEM_USE),this.removeFromGame()}}class xt extends q{constructor(a,e){super(a,e)}use(a){a.equipRunemetal(this.boardPosition),f(this.scene,m.RUNE_METAL_USE),this.removeFromGame()}}class gt extends q{constructor(a,e){super(a,e)}use(a){a.equipSuperCharge(this.boardPosition),f(this.scene,m.SCROLL_USE),this.removeFromGame()}}class Ie extends _{constructor(a,e,i){super(a,e,i)}equipFactionBuff(a){f(this.scene,m.DRAGON_SCALE_USE);const e=this.scene.add.image(this.x+10,this.y-10,"dragonScale").setOrigin(.5).setDepth(100);ee(e),this.factionBuff=!0,this.factionBuffImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.physicalDamageResistance+=20,this.increaseMaxHealth(this.baseHealth*.1),this.unitCard.updateCardData(this),this.updateTileData(),this.scene.sound.play(m.DRAGON_SCALE_USE),this.context.gameController.afterAction(b.USE,a,this.boardPosition)}}class Vt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit();const e=this.getDistanceToTarget(a);L(this.context,this,a),e===1?a instanceof _&&a.isKO&&$(this.context,a.getTile())?(f(this.scene,m.ARCHER_ATTACK_MELEE),a.removeFromGame()):(f(this.scene,m.ARCHER_ATTACK_MELEE),a.getsDamaged(this.getTotalPower(.5),this.attackType),this.removeAttackModifiers()):(this.superCharge&&f(this.scene,m.ARCHER_ATTACK_BIG),this.superCharge||f(this.scene,m.ARCHER_ATTACK),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Kt extends Ie{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit();const e=this.context.gameController;L(this.context,this,a),a instanceof _&&a.isKO&&$(this.context,a.getTile())?(f(this.scene,m.KNIGHT_ATTACK),a.removeFromGame()):(this.superCharge&&f(this.scene,m.KNIGHT_ATTACK_BIG),this.superCharge||f(this.scene,m.ARCHER_ATTACK_MELEE),a.getsDamaged(this.getTotalPower(),this.attackType),a instanceof _&&a.unitType!==g.PHANTOM&&e.pushEnemy(this,a),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Wt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit();const e=this.context.gameController;if(L(this.context,this,a),this.getDistanceToTarget(a)===1&&a instanceof _&&a.isKO&&$(this.context,a.getTile()))f(this.scene,m.WIZARD_ATTACK),a.removeFromGame();else{this.superCharge&&f(this.scene,m.WIZARD_ATTACK_BIG),this.superCharge||f(this.scene,m.WIZARD_ATTACK);const s=e.board.getAttackDirection(this.boardPosition,a.boardPosition),n=this.context.isPlayerOne?[2,3,4]:[6,7,8],r=this.getNextTarget(a,s,n,e.board,!1);let c;r&&(c=this.getNextTarget(r,s,n,e.board,!1,[a.boardPosition,r.boardPosition])),a.getsDamaged(this.getTotalPower(),this.attackType),r&&r.getsDamaged(this.getTotalPower()*.75,this.attackType,.75),c&&c.getsDamaged(this.getTotalPower()*.56,this.attackType,.56),a&&a instanceof _&&a.isKO&&a.unitType===g.PHANTOM&&a.removeFromGame(),r&&r instanceof _&&r.isKO&&r.unitType===g.PHANTOM&&r.removeFromGame(),c&&c instanceof _&&c.isKO&&c.unitType===g.PHANTOM&&c.removeFromGame(),this.removeAttackModifiers()}this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}getNextTarget(a,e,i,s,n,r){const c=r||[a.boardPosition],h=this.getAdjacentEnemyTiles(a.boardPosition,c);let d=-1,u;for(const p of h){const y=s.getAttackDirection(a.boardPosition,p.boardPosition);let T=0;if(y===e&&(T+=2),this.getGeneralDirections(e).includes(y)&&(T+=1.5),i.includes(y)&&(T+=1),[1,3,5,7].includes(y)&&(T+=1),n||this.getAdjacentEnemyTiles(p.boardPosition,[p.boardPosition]).length&&(T+=1.5),T>d&&(d=T,u=p),d===6)break}if(!u){console.log("getNextTarget() No suitable adjacent target found.");return}if(u.hero){const p=s.units.find(y=>y.unitId===u.hero.unitId);if(p)return p}if(u.crystal){const p=s.crystals.find(y=>y.boardPosition===u.crystal.boardPosition);if(p)return p}throw new Error("getNextTarget() Target found on tile, but not in board units or crystals")}getAdjacentEnemyTiles(a,e=[]){const i=[-10,-9,-8,-1,1,8,9,10],s=[-10,-1,8],n=[10,1,-8],r=[],c=9,h=a%c===0,d=(a+1)%c===0;for(const u of i){if(h&&s.includes(u)||d&&n.includes(u))continue;const p=a+u;if(yt(p)&&!e.includes(p)){const y=this.context.gameController.board.getTileFromBoardPosition(p);We(this,y)&&r.push(y)}}return r}getGeneralDirections(a){switch(a){case 1:return[1,2,8];case 2:return[[1,2,8],[2,3,4]].flat();case 3:return[2,3,4];case 4:return[[2,3,4],[4,5,6]].flat();case 5:return[4,5,6];case 6:return[[4,5,6],[6,7,8]].flat();case 7:return[6,7,8];case 8:return[[1,2,8],[6,7,8]].flat();default:return[]}}heal(a){}special(a){}}class Yt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit(),L(this.context,this,a);const e=this.getDistanceToTarget(a),i=()=>{this.superCharge&&f(this.scene,m.NINJA_ATTACK_BIG),this.superCharge||f(this.scene,m.NINJA_ATTACK)};e===1?a instanceof _&&a.isKO&&$(this.context,a.getTile())?(f(this.scene,m.NINJA_ATTACK),a.removeFromGame()):(i(),a.getsDamaged(this.getTotalPower(2),this.attackType),this.removeAttackModifiers()):(i(),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}special(a){f(this.scene,m.NINJA_SMOKE);const e=this.getTile(),i=a.getTile();this.singleTween(this.smokeAnim,500),a.singleTween(a.smokeAnim,500),a.specialTileCheck(e,i),a.updatePosition(e),e.hero=a.exportData(),this.specialTileCheck(i,e),this.updatePosition(i),i.hero=this.exportData(),this.context.gameController.afterAction(b.SPECIAL,e.boardPosition,i.boardPosition)}heal(a){}}class zt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit(),L(this.context,this,a),this.getDistanceToTarget(a)===1&&a instanceof _&&a.isKO&&$(this.context,a.getTile())?(this.superCharge||f(this.scene,m.CLERIC_ATTACK),a.removeFromGame()):(this.superCharge&&f(this.scene,m.CLERIC_ATTACK_BIG),this.superCharge||f(this.scene,m.CLERIC_ATTACK),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){var e;if(this.flashActingUnit(),this.superCharge||f(this.scene,m.HEAL),this.superCharge&&f(this.scene,m.HEAL_EXTRA),L(this.context,this,a),a.isKO){const i=this.getTotalHealing(2);a.getsHealed(i)}else{const i=this.getTotalHealing(3);a.getsHealed(i)}this.removeAttackModifiers(),(e=this.context.gameController)==null||e.afterAction(b.HEAL,this.boardPosition,a.boardPosition)}special(a){}}class jt extends q{constructor(a,e){super(a,e)}use(a){a.equipFactionBuff(this.boardPosition),this.removeFromGame()}}class Xt extends q{constructor(a,e){super(a,e)}use(a){f(this.scene,m.POTION_USE);const e=this.scene.add.image(a.x,a.y-10,"healingPotion").setDepth(100);ee(e);const i=a.isKO?100:1e3;a.getsHealed(i),this.removeFromGame(),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition)}}class qt extends q{constructor(a,e){super(a,e)}use(a){const e=this.scene.add.image(a.x,a.y,"infernoShockWave").setDepth(100);ee(e,3),f(this.scene,m.INFERNO_USE);const i=350,s=ie(this.context,this,a,!1),n=[...s.heroTiles,...s.crystalTiles];n==null||n.forEach(r=>{const c=this.context.gameController.board.units.find(h=>h.boardPosition===r.boardPosition)||this.context.gameController.board.crystals.find(h=>h.boardPosition===r.boardPosition);if(!c)throw new Error("Inferno use() hero not found");if(!(c instanceof De)&&c.isKO){c.removeFromGame(!0);return}c.getsDamaged(i,z.MAGICAL)}),this.removeFromGame(),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition)}}class Ae extends _{constructor(a,e,i){super(a,e,i)}equipFactionBuff(a){const e=this.scene.add.image(this.x,this.y-10,"soulStone").setOrigin(.5).setDepth(100);ee(e),this.factionBuff=!0,this.factionBuffImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.increaseMaxHealth(this.baseHealth*.1),this.unitCard.updateCardData(this),this.updateTileData(),f(this.scene,m.ITEM_USE),this.context.gameController.afterAction(b.USE,a,this.boardPosition)}lifeSteal(a){if(this.factionBuff){const e=x(a*.666);this.getsHealed(e)}else{const e=x(a*.333);this.getsHealed(e)}}}class Jt extends Ae{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit(),L(this.context,this,a);const e=this.getDistanceToTarget(a);if(e===1&&a instanceof _&&a.isKO&&$(this.context,a.getTile()))f(this.scene,m.IMPALER_ATTACK_MELEE),a.removeFromGame();else{this.superCharge?f(this.scene,m.IMPALER_ATTACK_BIG):(e===1&&f(this.scene,m.IMPALER_ATTACK_MELEE),e!==1&&f(this.scene,m.IMPALER_ATTACK));const i=a.getsDamaged(this.getTotalPower(),this.attackType);i!==void 0&&this.lifeSteal(i),this.removeAttackModifiers()}a instanceof _&&a.unitType!==g.PHANTOM&&this.context.gameController.pullEnemy(this,a),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Zt extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit(),L(this.context,this,a);const e=[];if(this.superCharge&&f(this.scene,m.VOIDMONK_ATTACK_BIG),this.superCharge||f(this.scene,m.VOIDMONK_ATTACK),a instanceof _&&a.isKO&&$(this.context,a.getTile()))a.removeFromGame();else{const i=this.context.gameController.board,s=i.getAttackDirection(this.boardPosition,a.boardPosition),n=this.getOffsetTiles(a.boardPosition,s);if(!n.length)throw new Error(`voidMonk attack() No offsetTiles: ${this.boardPosition}, ${a.boardPosition}`);for(const h of n){const d=a.boardPosition+h;if(!yt(d))continue;const u=i.getTileFromBoardPosition(d);if(!u)throw new Error("voidMonk attack() No tile found");if(We(this,u)){if(u.hero){const p=i.units.find(y=>y.unitId===u.hero.unitId);p&&e.push(p)}if(u.crystal){const p=i.crystals.find(y=>y.boardPosition===u.crystal.boardPosition);p&&e.push(p)}}}let r=0;const c=a.getsDamaged(this.getTotalPower(),this.attackType);if(c&&(r+=c),e.length){const h=this.getTotalPower()*.666;console.log(h),e.forEach(d=>{const u=d.getsDamaged(h,this.attackType,.666);u&&(r+=u)})}r&&this.lifeSteal(r),this.removeAttackModifiers()}e.forEach(i=>{i instanceof _&&i.unitType===g.PHANTOM&&i.isKO&&i.removeFromGame(!0)}),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}getOffsetTiles(a,e){switch(e){case 1:return[-1,1,-9];case 3:return[-9,1,9];case 5:return[-1,1,9];case 7:return[-9,-1,9];default:return[]}}heal(a){}special(a){}}class Qt extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){if(this.flashActingUnit(),L(this.context,this,a),a instanceof _&&a.isKO){this.special(a);return}else this.superCharge&&f(this.scene,m.NECROMANCER_ATTACK_BIG),this.superCharge||f(this.scene,m.NECROMANCER_ATTACK),this.removeAttackModifiers();const e=a.getsDamaged(this.getTotalPower(),this.attackType);e&&this.lifeSteal(e),a&&a instanceof _&&a.isKO&&a.unitType===g.PHANTOM&&a.removeFromGame(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){var s;f(this.scene,m.PHANTOM_SPAWN);const e=a.getTile(),i=new Ve(this.context,sa({unitId:`${this.context.userId}_phantom_${ya()}`,boardPosition:a.boardPosition,belongsTo:this.belongsTo,row:a.row,col:a.col}),e,!0);a.removeFromGame(!0),(s=this.context.gameController)==null||s.board.units.push(i),e.hero=i.exportData(),this.context.gameController.afterAction(b.SPECIAL,this.boardPosition,a.boardPosition)}}class ea extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){if(this.flashActingUnit(),L(this.context,this,a),this.getDistanceToTarget(a)===1&&a instanceof _&&a.isKO&&$(this.context,a.getTile()))f(this.scene,m.PRIESTESS_ATTACK),a.removeFromGame();else{f(this.scene,m.PRIESTESS_ATTACK);const i=a.getsDamaged(this.getTotalPower(),this.attackType);i&&this.lifeSteal(i),a instanceof _&&(a.priestessDebuff=!0,a.priestessDebuffImage.setVisible(!0),a.updateTileData(),a.unitCard.updateCardData(a)),this.removeAttackModifiers()}this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}async heal(a){var e;if(this.flashActingUnit(),L(this.context,this,a),this.superCharge||f(this.scene,m.HEAL),this.superCharge&&f(this.scene,m.HEAL_EXTRA),a.isKO){const i=this.getTotalHealing(.5);a.getsHealed(i)}else{const i=this.getTotalHealing(2);a.getsHealed(i)}this.removeAttackModifiers(),(e=this.context.gameController)==null||e.afterAction(b.HEAL,this.boardPosition,a.boardPosition)}special(a){}}class ta extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){if(this.flashActingUnit(),L(this.context,this,a),a instanceof _&&a.isKO)f(this.scene,m.WRAITH_CONSUME),a.removeFromGame(!0),this.unitsConsumed<3&&(this.basePower+=50,this.unitsConsumed++,this.increaseMaxHealth(100),this.updateTileData(),this.unitCard.updateCardData(this));else{this.superCharge&&f(this.scene,m.WRAITH_ATTACK_BIG),this.superCharge||f(this.scene,m.WRAITH_ATTACK);const e=a.getsDamaged(this.getTotalPower(),this.attackType);e&&this.lifeSteal(e),this.removeAttackModifiers()}this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Ve extends _{constructor(e,i,s,n=!1){super(e,i,s);o(this,"spawnAnim");n&&s&&(this.spawnAnim=e.add.image(0,-15,"phantomSpawnAnim_1").setOrigin(.5).setScale(.9),this.specialTileCheck(s),this.add([this.spawnAnim]),this.singleTween(this.spawnAnim,200))}async attack(e){this.flashActingUnit(),L(this.context,this,e),f(this.scene,m.WRAITH_ATTACK),e instanceof _&&e.isKO&&$(this.context,e.getTile())?e.removeFromGame():(e.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,e.boardPosition)}heal(e){}special(e){}equipFactionBuff(){}}class aa extends q{constructor(a,e){super(a,e)}use(a){a.equipFactionBuff(this.boardPosition),this.removeFromGame()}}class ft extends q{constructor(a,e){super(a,e)}use(a){f(this.scene,m.POTION_USE);const e=this.scene.add.image(a.x,a.y-10,"manaVial").setDepth(100);ee(e),!a.isKO&&(a.manaVial?a.getsHealed(1e3):(a.healAndIncreaseHealth(1e3,50),a.manaVial=!0,a.updateTileData()),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition),this.removeFromGame())}}class ia extends q{constructor(a,e){super(a,e)}use(a){const e=this.scene.add.image(a.x,a.y-20,"soulHarvestShockWave").setDepth(100);ee(e),f(this.scene,m.USE_HARVEST);const i=this.context.gameController;if(!i){console.error("SoulHarvest use() No gamecontroller");return}const s=100,n=ie(this.context,this,a,!1),r=[...n.heroTiles,...n.crystalTiles];let c=0;r.forEach(u=>{const p=this.context.gameController.board.units.find(y=>y.boardPosition===u.boardPosition)||this.context.gameController.board.crystals.find(y=>y.boardPosition===u.boardPosition);if(!p)throw new Error("SoulHarvest use() hero not found");if(p instanceof _){if(p.isKO)return;c+=p.getsDamaged(s,z.MAGICAL)}});const h=i.board.units.filter(u=>u.belongsTo===this.belongsTo),d=x(1/(h.length+3)*c);h.forEach(u=>u.increaseMaxHealth(d)),i.afterAction(b.USE,this.boardPosition,a.boardPosition),this.removeFromGame()}}function sa(t){return{unitType:g.PHANTOM,baseHealth:100,maxHealth:100,currentHealth:t.currentHealth??100,movement:3,attackRange:1,healingRange:0,attackType:z.MAGICAL,basePower:100,physicalDamageResistance:0,basePhysicalDamageResistance:0,magicalDamageResistance:0,baseMagicalDamageResistance:0,canHeal:!1,...na(t)}}function na(t){return{class:j.HERO,faction:B.DARK_ELVES,unitId:t.unitId,boardPosition:t.boardPosition??51,isKO:t.isKO??!1,lastBreath:t.lastBreath??!1,factionBuff:t.factionBuff??!1,runeMetal:t.runeMetal??!1,shiningHelm:t.shiningHelm??!1,superCharge:t.superCharge??!1,belongsTo:t.belongsTo??1,row:t.row??0,col:t.col??0,isShielded:t.priestessDebuff??!1,isDrunk:t.isDrunk??!1,paladinAura:t.paladinAura??1,priestessDebuff:t.priestessDebuff??!1,annihilatorDebuff:t.priestessDebuff??!1,attackTile:t.attackTile??0}}class Ce extends _{constructor(a,e,i){super(a,e,i)}special(a){}equipFactionBuff(a){f(this.scene,m.DRAGON_SCALE_USE);const e=this.scene.add.image(this.x+10,this.y-10,"dragonScale").setOrigin(.5).setDepth(100);ee(e),this.factionBuff=!0,this.factionBuffImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.physicalDamageResistance+=20,this.increaseMaxHealth(this.baseHealth*.1),this.unitCard.updateCardData(this),this.updateTileData(),this.scene.sound.play(m.DRAGON_SCALE_USE),this.context.gameController.afterAction(b.USE,a,this.boardPosition)}}class oa extends Ce{constructor(a,e,i){super(a,e,i)}onHealingDone(a){const e=x(a*.5);this.getsHealed(e)}async attack(a){this.flashActingUnit(),L(this.context,this,a),this.superCharge?f(this.scene,m.PALADIN_ATTACK):f(this.scene,m.PALADIN_ATTACK_BIG),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}async heal(a){this.flashActingUnit(),L(this.context,this,a),this.playHealSounds();let e;a.isKO?(e=this.getTotalHealing(.5),a.isKO=!1):e=this.getTotalHealing(2),a.getsHealed(e),e>0&&this.onHealingDone(e),this.removeAttackModifiers(),this.context.gameController.afterAction(b.HEAL,this.boardPosition,a.boardPosition)}playHealSounds(){this.context.sound.play(m.HEAL,{volume:.5})}async move(a){let e=ie(this.context,this,this.getTile(),!0),i=[...e.heroTiles,...e.crystalTiles];i.forEach(s=>{const n=this.context.gameController.board.units.find(r=>r.boardPosition===s.boardPosition)||this.context.gameController.board.crystals.find(r=>r.boardPosition===s.boardPosition);n&&n!==this&&(n.magicalDamageResistance-=5,n.physicalDamageResistance-=5,n.paladinAura-=1)}),e=ie(this.context,this,a,!0),i=[...e.heroTiles,...e.crystalTiles],i.forEach(s=>{const n=this.context.gameController.board.units.find(r=>r.boardPosition===s.boardPosition)||this.context.gameController.board.crystals.find(r=>r.boardPosition===s.boardPosition);n&&n!==this&&(n.magicalDamageResistance+=5,n.physicalDamageResistance+=5,n.paladinAura+=1,n.unitCard.updateCardData(n))}),super.move(a)}special(a){}}class ra extends Ce{constructor(a,e,i){super(a,e,i)}async attack(a){if(this.flashActingUnit(),L(this.context,this,a),this.getDistanceToTarget(a)===1)f(this.scene,m.GRENADIER_ATTACK_MELEE),a.getsDamaged(this.getTotalPower()*.5,this.attackType);else{this.superCharge?f(this.scene,m.GRENADIER_ATTACK_BIG):f(this.scene,m.GRENADIER_ATTACK);const i=this.getTotalPower(),s=i*.5;a.getsDamaged(i,this.attackType);const n=ie(this.context,this,a.getTile(),!1);[...n.heroTiles,...n.crystalTiles].forEach(c=>{const h=this.context.gameController.board.units.find(d=>d.boardPosition===c.boardPosition)||this.context.gameController.board.crystals.find(d=>d.boardPosition===c.boardPosition);h&&a!==h&&h.belongsTo!==this.belongsTo&&h.getsDamaged(s,this.attackType)})}this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class la extends Ce{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit(),L(this.context,this,a);const e=this.getDistanceToTarget(a),i=this.context.gameController.board;if(e===1)f(this.scene,m.GUNNER_ATTACK_ONLY),a.getsDamaged(this.getTotalPower(),this.attackType);else{f(this.scene,m.GUNNER_ATTACK);const s=this.getTotalPower()*.66,n=i.getAttackDirection(this.boardPosition,a.boardPosition),r=this.getConeTiles(this.boardPosition,n);a.getsDamaged(s,this.attackType);let c=0;r.forEach(h=>{c>=2||h&&We(this,h.getTile())&&h!==a&&(h.getsDamaged(s,this.attackType),c++)})}this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}getConeTiles(a,e){const i=[],s=this.context.gameController.board,n=h=>{var d;return h>0&&h<45&&((d=s.getUnitFromTile(s.getTileFromBoardPosition(h)))==null?void 0:d.belongsTo)!==this.belongsTo?s.getUnitFromTile(s.getTileFromBoardPosition(h)):void 0},c={1:[-10,-19,-8,-17],5:[10,19,8,17],2:[-9,-18,1,2],6:[9,18,-1,-2],3:[-8,-7,10,11],7:[8,7,-10,-11],4:[9,18,1,2],8:[-9,-18,-1,-2]}[e];if(c){const[h,d,u,p]=c,y=n(a+h)??n(a+d),T=n(a+u)??n(a+p);y&&i.push(y),T&&i.push(T)}return i}heal(a){}special(a){}}class ca extends Ce{constructor(e,i,s){super(e,i,s);o(this,"shieldedTarget",null)}async special(e){this.flashActingUnit(),f(this.scene,m.ENGINEER_SHIELD_MAKE),this.shieldedTarget&&(f(this.scene,m.ENGINEER_SHIELD_BREAK),this.shieldedTarget.shieldImage.setVisible(!1),this.shieldedTarget.isShielded=!1),this.shieldedTarget=e,e.isShielded=!0,e.shieldImage.setVisible(!0),this.context.gameController.afterAction(b.SPECIAL,this.boardPosition,e.boardPosition)}applyTilePassive(){const e=this.getTile();if(e){switch(e.tileType){case A.POWER:this.basePower+=240;break;case A.PHYSICAL_RESISTANCE:this.basePhysicalDamageResistance+=this.basePhysicalDamageResistance*.48;break;case A.MAGICAL_RESISTANCE:this.baseMagicalDamageResistance+=this.baseMagicalDamageResistance*.48;break;case A.CRYSTAL_DAMAGE:this.basePower+=720;break;case A.SPEED:this.movement+=4;break}this.unitCard.updateCardData(this),this.updateTileData()}}attack(e){this.flashActingUnit(),L(this.context,this,e),f(this.scene,m.ENGINEER_ATTACK),e.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,e.boardPosition)}heal(e){}}class ha extends Ce{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit(),L(this.context,this,a),f(this.scene,m.ANNIHILATOR_SHOOT);const e=this.getTotalPower(),i=e*.2;a.annihilatorDebuff||(a.physicalDamageResistance-=50),a.annihilatorDebuff=!0,a.annihilatorDebuffImage.setVisible(!0),a.unitCard.updateCardData(a),a.getsDamaged(e,this.attackType);const s=ie(this.context,this,a.getTile(),!1),n=[...s.heroTiles,...s.crystalTiles];let r=[];n.forEach(c=>{const h=this.context.gameController.board.units.find(d=>d.boardPosition===c.boardPosition)||this.context.gameController.board.crystals.find(d=>d.boardPosition===c.boardPosition);h&&h.belongsTo!==this.belongsTo&&h!==a&&(h.getsDamaged(i,this.attackType),h instanceof _&&r.push(h))}),r.forEach(c=>{this.context.gameController.pushEnemy(a,c)}),this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class da extends q{constructor(a,e){super(a,e)}use(a){a.getsHealed(1e3),a.isDrunk=!0,a.physicalDamageResistance+=50,a.magicalDamageResistance+=50,a.unitCard.updateCardData(a),a.updateTileData(),f(this.scene,m.BREW_USE),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition),this.removeFromGame()}}class ua extends q{constructor(a,e){super(a,e)}use(a){const e=this.context.gameController.board.getUnitFromTile(a),i=600;if(e){const s=e.getsDamaged(i,z.PHYSICAL);if(f(this.scene,m.DRILL_USE),e instanceof _&&e.factionBuff)e.factionBuff=!1,e.factionBuffImage.setVisible(!1),e.characterImage.setTexture(e.updateCharacterImage()),e.increaseMaxHealth(e.baseHealth*-.1),e.unitCard.updateCardData(e),e.updateTileData();else if(e instanceof De){const n=s*.333,r=ie(this.context,this,a,!1);[...r.heroTiles,...r.crystalTiles].forEach(h=>{const d=this.context.gameController.board.getUnitFromTile(h);d&&d!==e&&d.getsDamaged(n,z.PHYSICAL)})}this.context.gameController.afterAction(b.USE,this.boardPosition,e.boardPosition),this.removeFromGame()}}}function R(t){return t.class==="hero"}function ae(t){return t.class==="item"}function pt(t){return t>44&&t<51}function yt(t){return t>=0&&t<=44}function me(t,a){const e=t.isPlayerOne?1:2;return a.belongsTo===e}function x(t){return Math.round(t/5)*5}function Tt(t,a,e,i){return Math.abs(t-e)+Math.abs(a-i)}function bt(t,a){const i={[S.SHINING_HELM]:()=>new mt(t,a),[S.SUPERCHARGE]:()=>new gt(t,a),[S.RUNE_METAL]:()=>new xt(t,a),[S.DRAGON_SCALE]:()=>new jt(t,a),[S.HEALING_POTION]:()=>new Xt(t,a),[S.INFERNO]:()=>new qt(t,a),[S.MANA_VIAL]:()=>new ft(t,a),[S.SOUL_HARVEST]:()=>new ia(t,a),[S.SOUL_STONE]:()=>new aa(t,a),[S.DWARVERN_BREW]:()=>new da(t,a),[S.PULVERIZER]:()=>new ua(t,a)}[a.itemType];return i||console.error("Error creating item",a),i()}function Ke(t,a,e){const s={[g.ARCHER]:()=>new Vt(t,a,e),[g.CLERIC]:()=>new zt(t,a,e),[g.KNIGHT]:()=>new Kt(t,a,e),[g.NINJA]:()=>new Yt(t,a,e),[g.WIZARD]:()=>new Wt(t,a,e),[g.PRIESTESS]:()=>new ea(t,a,e),[g.IMPALER]:()=>new Jt(t,a,e),[g.NECROMANCER]:()=>new Qt(t,a,e),[g.PHANTOM]:()=>new Ve(t,a,e),[g.VOIDMONK]:()=>new Zt(t,a,e),[g.WRAITH]:()=>new ta(t,a,e),[g.PALADIN]:()=>new oa(t,a,e),[g.GUNNER]:()=>new la(t,a,e),[g.GRENADIER]:()=>new ra(t,a,e),[g.ENGINEER]:()=>new ca(t,a,e),[g.ANNIHILATOR]:()=>new ha(t,a,e)}[a.unitType];return s||console.error("Error creating hero",a),s()}async function ma(t,a,e){[g.NECROMANCER,g.WRAITH,g.PHANTOM].includes(a.unitType)?f(t,m.MOVE_FLY):f(t,m.MOVE_WALK),t.input.enabled=!1;const s=a.getByName("body");let n;a.belongsTo===1&&e.x<a.x&&(s.setFlipX(!0),n=!0),a.belongsTo===2&&e.x>a.x&&(s.setFlipX(!1),n=!0),await((c,h)=>new Promise(d=>{t.tweens.add({targets:c,x:h.x,y:h.y,duration:400,ease:"Linear",onComplete:()=>{t.input.enabled=!0,n&&s.setFlipX(!s.flipX),d()}})})).call(t,a,e)}async function qe(t,a,e){t.input.enabled=!1,await((s,n)=>new Promise(r=>{t.tweens.add({targets:s,x:n.x,y:n.y,duration:200,ease:"Linear",onComplete:()=>{t.input.enabled=!0,r()}})})).call(t,a,e)}function Je(t,a,e,i,s){let n=e-t,r=i-a;return n=Math.sign(n),r=Math.sign(r),s||(n*=-1,r*=-1),{row:e+n,col:i+r}}function f(t,a){t.sound.play(a)}function Ze(t,a){const i={[S.RUNE_METAL]:m.RUNE_METAL_SELECT,[S.SUPERCHARGE]:m.SCROLL_SELECT,[S.SHINING_HELM]:m.ITEM_SELECT,[S.DRAGON_SCALE]:m.SHIELD_SELECT,[S.HEALING_POTION]:m.POTION_SELECT,[S.INFERNO]:m.AOE_SPELL_SELECT,[S.SOUL_STONE]:m.ITEM_SELECT,[S.MANA_VIAL]:m.POTION_SELECT,[S.SOUL_HARVEST]:m.AOE_SPELL_SELECT,[S.DWARVERN_BREW]:m.BREW_SELECT,[S.PULVERIZER]:m.DRILL_SELECT}[a];i&&f(t,i)}function ga(t,a){const i={[g.ARCHER]:m.ARCHER_DEATH,[g.KNIGHT]:m.KNIGHT_DEATH,[g.CLERIC]:m.CLERIC_DEATH,[g.WIZARD]:m.WIZARD_DEATH,[g.NINJA]:m.NINJA_DEATH,[g.IMPALER]:m.IMPALER_DEATH,[g.VOIDMONK]:m.VOIDMONK_DEATH,[g.PRIESTESS]:m.PRIESTESS_DEATH,[g.NECROMANCER]:m.NECROMANCER_DEATH,[g.WRAITH]:m.WRAITH_DEATH,[g.PHANTOM]:m.PHANTOM_DEATH,[g.GRENADIER]:m.GRENADIER_DEATH,[g.GUNNER]:m.GUNNER_DEATH,[g.PALADIN]:void 0,[g.ENGINEER]:m.GUNNER_DEATH,[g.ANNIHILATOR]:m.GRENADIER_DEATH}[a];i&&f(t,i)}function fa(t){return[b.PASS,b.DRAW,b.REMOVE_UNITS].includes(t)?Te.AUTO:Te.USER}function ie(t,a,e,i=!1){var h;const s=(h=t.gameController)==null?void 0:h.board;if(!s)throw new Error("Inferno use() board not found");const n=s.getAreaOfEffectTiles(e);let r=[],c=[];return i===!0?(r=n==null?void 0:n.filter(d=>{var u;return d.hero&&((u=d.hero)==null?void 0:u.belongsTo)===a.belongsTo}),c=n==null?void 0:n.filter(d=>{var u;return d.crystal&&((u=d.crystal)==null?void 0:u.belongsTo)===a.belongsTo})):i===!1?(r=n==null?void 0:n.filter(d=>{var u;return d.hero&&((u=d.hero)==null?void 0:u.belongsTo)!==a.belongsTo}),c=n==null?void 0:n.filter(d=>{var u;return d.crystal&&((u=d.crystal)==null?void 0:u.belongsTo)!==a.belongsTo})):(r=n,c=n),{heroTiles:r,crystalTiles:c}}function We(t,a){let e=!1;return a.hero&&a.hero.belongsTo!==t.belongsTo&&!a.hero.isKO&&(e=!0),a.crystal&&a.crystal.belongsTo!==t.belongsTo&&(e=!0),e}function pa(t,a){var y,T;let e,i;if(a.unitId.includes(t.player1.playerId)?(e=t.player2,i=t.player1):(e=t.player1,i=t.player2),!e||!i)throw new Error("updateUnitsLeft() No player found");const s=(y=t.gameController)==null?void 0:y.board.units;if(!s)throw new Error("updateUnitsLeft() no units array found");const n=s.filter(P=>P.belongsTo===a.belongsTo).find(P=>!P.isKO);let r,c;i.playerId===t.activePlayer?(r=(T=t.gameController)==null?void 0:T.hand.getHand(),c=r.find(P=>P.belongsTo===a.belongsTo&&P.class===j.HERO)):(r=i.factionData.unitsInHand,c=r.find(P=>P.belongsTo===a.belongsTo&&P.class===j.HERO));const d=i.factionData.unitsInDeck.find(P=>P.belongsTo===a.belongsTo&&P.class===j.HERO),u=[S.HEALING_POTION,S.SOUL_HARVEST],p=r?r.find(P=>u.includes(P==null?void 0:P.itemType)):void 0;return!(n||c||d||p)}function Qe(t,a){if(!pa(t,a))return;const e=a.unitId.includes(t.player1.playerId)?t.player2:t.player1;t.gameController.gameOver={winCondition:He.UNITS,winner:e.playerId}}function et(t,a){const e=t.col<5?1:2;return t.tileType===A.SPAWN&&a.belongsTo!==e}function $(t,a){return a.tileType===A.SPAWN&&(t.isPlayerOne?a.col>5:a.col<5)}function L(t,a,e){const i=a.belongsTo===1,s=a.characterImage;i&&e.col>=a.col||!i&&e.col<=a.col||(i||s.setFlipX(!1),i&&s.setFlipX(!0),t.time.delayedCall(500,()=>{s.setFlipX(!a.characterImage.flipX)}))}function It(t){return{[g.ARCHER]:{cardType:v.SHOOTER,cardText:"Marksman who does high damage to enemies at range. Weak melee attack."},[g.CLERIC]:{cardType:v.SUPPORT,cardText:"Spellcaster who revives and heals allies. Attacks enemies at range."},[g.KNIGHT]:{cardType:v.FIGHTER,cardText:"Heavily armored and an excellent defender. His attacks knock back enemies."},[g.NINJA]:{cardType:v.SUPER,cardText:"Deals double damage in melee range. He can teleport to allies."},[g.WIZARD]:{cardType:v.CASTER,cardText:"Powerful spellcaster, damages groups of enemies with chain lightning."},[g.PRIESTESS]:{cardType:v.SUPPORT,cardText:"She can heal up to 3 tiles away, and weakens enemy attacks."},[g.IMPALER]:{cardType:v.SHOOTER,cardText:"Wields a powerful harpoon that can pull enemies close."},[g.NECROMANCER]:{cardType:v.CASTER,cardText:"Dark caster who can create Phantoms from fallen units."},[g.PHANTOM]:{cardType:v.SUMMONED,cardText:"A summoned phantom from beyond."},[g.VOIDMONK]:{cardType:v.FIGHTER,cardText:"Strong melee fighter whose hits do splash damage."},[g.WRAITH]:{cardType:v.SUPER,cardText:"A terror who gains max health and power by draining K.O.'d units."},[g.GUNNER]:{cardType:v.SHOOTER,cardText:"Fires a shotgun, hitting up to 3 targets at range for 66% damage or 1 target for 100% damage"},[g.PALADIN]:{cardType:v.SUPPORT,cardText:"Spellcaster who revives and heals allies. Provides 5% defense to nearby allys."},[g.GRENADIER]:{cardType:v.CASTER,cardText:"Lobs explosives dealing 50% damage to all enemys around target."},[g.ANNIHILATOR]:{cardType:v.SUPER,cardText:"Fragile rocketeer who temporarily removes 50% physical defense on targets."},[g.ENGINEER]:{cardType:v.SUPPORT,cardText:"Can create a shield to protect allys and crystals. Additionally, gains 140% bonus from special tiles."},[S.SHINING_HELM]:{cardName:"Shining Helm",cardType:v.EQUIPMENT,cardText:"Adds 20% magical defense, and 10% max health."},[S.SUPERCHARGE]:{cardName:"Scroll",cardType:v.BUFF,cardText:"Multiplies an ally's attack power by 3 for one attack."},[S.RUNE_METAL]:{cardName:"Runemetal",cardType:v.EQUIPMENT,cardText:"Permanently increases an ally's power by 50%."},[S.DRAGON_SCALE]:{cardName:"Dragonscale",cardType:v.EQUIPMENT,cardText:"Adds 20% physical defense, and 10% max health."},[S.HEALING_POTION]:{cardName:"Healing Potion",cardType:v.CONSUMABLE,cardText:"Heals an ally for 1000 HP, or revives an ally with 100 HP."},[S.INFERNO]:{cardName:"Inferno",cardType:v.SPELL,cardText:"Damages all enemies in a 3x3 area and destroys knocked-out units."},[S.MANA_VIAL]:{cardName:"Mana Vial",cardType:v.CONSUMABLE,cardText:"Heals an ally for 1000 HP and increases max health by 50 HP."},[S.SOUL_HARVEST]:{cardName:"Soul Harvest",cardType:v.SPELL,cardText:"Drains health from enemies in a 3x3 area. Increases max health for all allies and revives knocked-out units."},[S.SOUL_STONE]:{cardName:"Soulstone",cardType:v.EQUIPMENT,cardText:"Doubles the effect of a unit's life leech and increases max health by 10%."},[S.DWARVERN_BREW]:{cardName:"Dwarvern Brew",cardType:v.CONSUMABLE,cardText:"Heals an ally for 1000 HP and temporarily adds 50% resistance."},[S.PULVERIZER]:{cardName:"Pulverizer",cardType:v.SPELL,cardText:"Targets 1 enemy destroying armor in process, or does 33% spash damage if target is a crystal."}}[t]}function ke(t){return t.charAt(0).toUpperCase()+t.slice(1)}function be(t,a){return t.length>a?t.slice(0,a-3)+"...":t}function Ne(t){var a;t.visibleUnitCard&&(t.visibleUnitCard.setDepth(t.visibleUnitCard.row+10),(a=t.visibleUnitCard.unitCard)==null||a.setVisible(!1))}function ya(){return Math.floor(1e3+Math.random()*9e3)}function ee(t,a=2){t.scene.tweens.add({targets:t,scale:a,alpha:0,duration:1e3,onComplete:()=>{t.destroy()}})}function Ta(t,a=2){return new Promise(e=>{t.scene.tweens.add({targets:t,scale:a,alpha:50,duration:1e3,onComplete:()=>{t.destroy(),e()}})})}function Re(t,a=1e3){return new Promise(e=>{t.scene.tweens.add({targets:t,alpha:0,duration:a,ease:"Linear",onComplete:()=>{t.destroy(),e()}})})}function Ue(t,a,e,i){return t.add.text(a,e,i,{fontFamily:"proLight",fontSize:60,color:"#fffb00"}).setDepth(9999)}const tt={x:800,y:400};class Ye extends Phaser.GameObjects.Container{constructor(e){const{context:i,opponentId:s,challengeType:n,username:r,gameId:c}=e;super(i,tt.x,tt.y);o(this,"blockingLayer");o(this,"backgroundImage");o(this,"councilButtonImage");o(this,"elvesButtonImage");o(this,"cancelButtonImage");o(this,"popupText");o(this,"cancelButtonText");this.blockingLayer=i.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=i.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.councilButtonImage=i.add.image(-150,60,B.COUNCIL).setScale(.4).setInteractive({useHandCursor:!0}),this.elvesButtonImage=i.add.image(-10,60,B.DARK_ELVES).setScale(.4).setInteractive({useHandCursor:!0}),this.cancelButtonImage=i.add.image(130,60,"popupButton").setTint(10027008).setDisplaySize(110,60).setInteractive({useHandCursor:!0});const h=n===he.SEND?`Pick a faction to challenge ${be(r,20)}`:"Pick a faction to accept the challenge";this.popupText=i.add.text(0,-50,h,{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.cancelButtonText=i.add.text(130,60,"BACK",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5);const d=async u=>{i.sound.play(w.BUTTON_GENERIC),this.setVisible(!1),n===he.SEND&&(await Bt(i.userId,u,s)||Re(i.add.text(200,350,"A player has reached the max amount of open games",{fontFamily:"proLight",fontSize:60,color:"#fffb00"}).setDepth(999),3e3)),n===he.ACCEPT&&i instanceof St&&Da(i.lobbyRoom,c,i.userId,u)};this.councilButtonImage.on("pointerdown",async()=>{f(this.scene,w.BUTTON_PLAY),await d(B.COUNCIL)}),this.elvesButtonImage.on("pointerdown",async()=>{f(this.scene,w.BUTTON_PLAY),await d(B.DARK_ELVES)}),this.cancelButtonImage.on("pointerdown",()=>{this.scene.sound.play(w.BUTTON_FAILED),this.setVisible(!1),this.destroy()}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.councilButtonImage,this.elvesButtonImage,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),i.add.existing(this)}}const Ge={player1:"",player2:""};function At(t){const a=document.getElementById("chatmessages");if(!a)return;const{username:e,message:i}=t,s=document.createElement("div");s.innerHTML=`<span class="username">${e}</span>: <span class="message">${i}</span>`;const n=s.querySelector(".username");n.style.color=Ge.player1===t.username?"#4fc3f7":"#f44336",n.style.fontWeight="bold",a.appendChild(s),a.scrollTop=a.scrollHeight}function ba(t){Ge.player1=t.currentGame.players[0].userData.username,Ge.player2=t.currentGame.players[1].userData.username;const a=t.add.dom(495,800).createFromCache("chatComponent").setOrigin(.5),e=a.node;e.style.pointerEvents="auto";const i=a.getChildByID("chatcomponent"),s=a.getChildByID("chatinput"),n=a.getChildByID("chatmessages"),r=t.scale.width,c=t.scale.height;i.style.width=`${r*.705}px`,i.style.height=`${c*.19}px`,i.style.backgroundColor="#111",i.style.borderRadius="8px",i.style.padding="8px",i.style.boxShadow="0 0 10px rgba(0,0,0,0.5)",i.style.display="flex",i.style.flexDirection="column",i.style.gap="8px",n.style.flex="1",n.style.overflowY="auto",n.style.overflowX="hidden",n.style.whiteSpace="pre-wrap",n.style.backgroundColor="#222",n.style.color="#fff",n.style.fontFamily="proLight",n.style.fontSize="30px",n.style.padding="8px",n.style.borderRadius="4px",n.style.maxHeight=`${c*.25}px`,n.style.touchAction="manipulation",s.style.width="100%",s.style.height="25px",s.style.padding="6px",s.style.border="none",s.style.borderRadius="4px",s.style.fontSize="25px",s.style.fontFamily="proLight";const h=a.getChildByID("chatmessages");return h.style.maxHeight=`${c*.25}px`,s.addEventListener("keydown",u=>{u.key==="Enter"&&s.value.trim()&&(console.log("Message: ",s.value),Ca(t.currentRoom,s.value.trim()),s.value="")}),t.currentGame.chatLogs.messages.forEach(u=>At(u)),n.scrollTop=n.scrollHeight,a}async function Ia(t,a){const{colyseusClient:e,userId:i}=t,s=localStorage.getItem("jwt");if(!e||!i||!a||!s){console.error("createGame error: missing one of client / userId / faction / token");return}try{console.log("Checking for open games | creating a new game...");const n=await e.create("game_room",{userId:i,faction:a,token:s});t.currentRoom=n,Ct(n),console.log("Created and joined room:")}catch(n){console.error("Failed to create or join room:",n)}}async function Aa(t,a,e,i){const s=localStorage.getItem("jwt");if(!t||!a||!e||!s){console.error("joinGame, { client | userid | gameid | token } missing");return}let n;try{n=await t.joinOrCreate("game_room",{userId:a,roomId:e,token:s,mongoId:e}),console.log("Joined or created room:",n.roomId),i.currentRoom=n,Ct(n)}catch(r){console.error("Failed to join or create room",r);return}return n}function Ct(t){t.onMessage("chatMessageReceived",a=>{console.log("Received chat message:",a),At(a)}),t.onMessage("pong",()=>{}),t==null||t.onLeave(a=>{console.log("Left room with code:",a)})}function wt(t,a,e,i,s){const n=localStorage.getItem("jwt");if(!t||!a||!e||!n){console.error("Error sending turn, missing one or more params");return}t.send("turnSent",{_id:t.roomId,currentTurn:a,newActivePlayer:e,gameOver:s,turnNumber:i,token:n}),console.log("Turn message sent")}function Ca(t,a){const e=localStorage.getItem("jwt");t.send("chatMessage",{_id:t.roomId,message:a,token:e}),console.log("Chat message sent")}function wa(t){const a=new Date,e=new Date(t);let i=Math.floor((a.getTime()-e.getTime())/1e3);const s={year:31536e3,month:2592e3,day:86400,hour:3600,minute:60,second:1},n=[];for(const[r,c]of Object.entries(s)){const h=Math.floor(i/c);if(h>0&&(n.push(`${h} ${r}${h!==1?"s":""}`),i-=h*c,n.length===2))break}return n.length?n.join(" and ")+" ago":"just now"}async function Sa(t,a){t.currentRoom&&(console.log("Leaving game: ",t.currentRoom.roomId),await t.currentRoom.leave(),t.currentRoom=void 0,t.scene.stop("GameScene")),console.log("Accessing game: ",a._id);const e=await Aa(t.colyseusClient,t.userId,a._id,t);e&&(t.currentRoom=e,t.scene.launch("GameScene",{userId:t.userId,colyseusClient:t.colyseusClient,currentGame:a,currentRoom:e}))}async function ce(t){if(!t.gameList){console.error("createGameList() no gameList in context");return}t.gameListContainer&&t.gameListContainer.destroy(!0);const a=[],e=[],i=[],s=[],n=[],r=[];t.gameList.forEach(E=>{E.status===N.SEARCHING&&i.push(E),E.status===N.PLAYING&&E.activePlayer===t.userId&&a.push(E),E.status===N.PLAYING&&E.activePlayer!==t.userId&&e.push(E),E.status===N.CHALLENGE&&(E.players[0].userData._id===t.userId&&s.push(E),E.players[1].userData._id===t.userId&&n.push(E)),E.status===N.FINISHED&&r.push(E)}),t.activeGamesAmount=a.length+e.length+i.length+n.length+s.length,a.length||n.length?document.title=`(${a.length+n.length}) Fan Academy`:document.title="Fan Academy";const c=142,h=700,d=20,u=40,p=915,y=400;let T=0;const P=19,C=65,D=t.add.container(P,C);t.gameListContainer=D;const O=E=>{E.forEach((k,Q)=>{const oe=k.players.find(le=>t.userId===le.userData._id),de=k.players.find(le=>t.userId!==le.userData._id);if(!oe)return;T+=(Q===0?u:c)+d;const re=t.add.image(0,T,"gameListButton").setOrigin(0).setTint(12303291),ze=oe.faction?{faction:oe.faction,scale:.4}:{faction:"unknownFaction",scale:1.2},Pt=t.add.text(20,T+100,wa(k.lastPlayedAt),{fontFamily:"proLight",fontSize:38,color:"#ffffff"}).setOrigin(0),Et=t.add.image(90,T+c/2,ze.faction).setScale(ze.scale);let Be,Le,Me;const je=le=>t.add.text(200,T+c/2-33,be(le,13),{fontSize:50,fontFamily:"proLight"});de?(Be=t.add.image(510,T+c/2,de.faction).setScale(.4),Le=t.add.image(632,T+c/2,de.userData.picture).setFlipX(!0).setDisplaySize(256*.4,256*.4),Me=je(de.userData.username)):(Be=t.add.image(510,T+c/2,"unknownFaction"),Le=t.add.image(632,T+c/2,"unknownOpponent").setFlipX(!0).setScale(.4),Me=je("Searching..."));const Fe=t.add.image(h-30,T,"closeButton").setOrigin(0).setVisible(!1);(k.status===N.SEARCHING||k.status===N.CHALLENGE)&&(Fe.setVisible(!0).setInteractive({useHandCursor:!0}),Fe.on("pointerup",async()=>{ne||(va(t.lobbyRoom,k._id,t.userId),t.sound.play(w.GAME_DELETE),ce(t))}));const Ee=()=>{re.clearTint(),t.activeGameImage&&t.activeGameImage.setTint(12303291),t.activeGameImage=re,t.activeGameImageId=k._id};(k.status===N.PLAYING||k.status===N.FINISHED)&&(re.setInteractive({useHandCursor:!0}),t.activeGameImageId===k._id&&Ee(),re.on("pointerup",async()=>{ne||(Ee(),t.sound.play(w.BUTTON_GENERIC),await Sa(t,k))})),k.status===N.CHALLENGE&&n.find(le=>le._id===k._id)&&(re.setInteractive({useHandCursor:!0}),t.activeGameImageId===k._id&&Ee(),re.on("pointerup",async()=>{ne||(t.sound.play(w.GAME_DELETE),Ee(),t.currentRoom&&(console.log("Leaving game: ",t.currentRoom.roomId),await t.currentRoom.leave(),t.currentRoom=void 0,t.scene.stop("GameScene")),new Ye({context:t,opponentId:de.userData._id,challengeType:he.ACCEPT,gameId:k._id}))})),D.add([re,Et,Be,Me,Le,Fe,Pt])})},M=t.add.text(40,T+40,"Create a game",{fontSize:70,fontFamily:"proHeavy"}),J=t.add.image(0,T,"newGameButton").setOrigin(0),G=t.add.image(230,T,B.COUNCIL).setOrigin(0).setScale(.5).setInteractive({useHandCursor:!0}),I=t.add.image(380,T,B.DARK_ELVES).setOrigin(0).setScale(.5).setInteractive({useHandCursor:!0}),F=t.add.image(530,T,B.DWARVES).setOrigin(0).setScale(.5).setInteractive({useHandCursor:!0}),V=async E=>{var k;if(t.activeGamesAmount>=t.activeGamesAmountLimit){if(console.log("Reached game cap"),t.currentRoom)t.game.events.emit("messageToGameScene",{x:300,y:350,message:"You have reached the max amount of open games"});else{const Q=Ue(t,300,350,"You have reached the max amount of open games");Re(Q,3e3)}return}if(t.userId){t.sound.play(w.BUTTON_PLAY);const Q=t.currentRoom?t.currentRoom:void 0;if(await Ia(t,E),await((k=t.currentRoom)==null?void 0:k.leave()),t.currentRoom=void 0,Q&&(t.currentRoom=Q),t.currentRoom)t.game.events.emit("messageToGameScene",{x:700,y:350,message:"New game created"});else{const oe=Ue(t,700,350,"New game created");Re(oe,3e3)}}else console.error("No userId when creating a new game")};G.on("pointerdown",async()=>await V(B.COUNCIL)),I.on("pointerdown",async()=>await V(B.DARK_ELVES)),F.on("pointerdown",async()=>await V(B.DWARVES)),T+=150,D.add([J,M,G,I,F]);const te=E=>t.add.text(30,T,E,{fontSize:50,fontFamily:"proLight"}),H=(E,k)=>{if(!E.length)return;const Q=te(k);D.add(Q),O(E),T+=c+d};H(a,"Your turn"),H(n,"Challenges received"),H(e,"Opponent's turn"),H(s,"Challenges sent"),H(i,"Searching for players"),H(r,"Finished"),D.setScale(.51);const U=t.make.graphics();U.fillStyle(16777215),U.fillRect(19,65,y,p-15);const K=new Phaser.Display.Masks.GeometryMask(t,U);D.setMask(K);const W=E=>E.x>=19&&E.x<=19+y&&E.y>=C&&E.y<=C+p;let X=0;const we=0,Z=Math.min(p-T*.51-10,0);t.input.on("wheel",(E,k,Q,oe,de)=>{W(E)&&T>p&&(X-=oe,X=Phaser.Math.Clamp(X,Z,we),D.y=C+X)});let se=!1,Se=0,Pe=0,ne=!1;t.input.on("pointerdown",E=>{W(E)&&T>p?(se=!0,Se=E.y,Pe=X,ne=!1):(se=!1,Se=0,Pe=0,ne=!1)}),t.input.on("pointermove",E=>{if(!se)return;const k=E.y-Se;Math.abs(k)>5&&(ne=!0),X=Phaser.Math.Clamp(Pe+k,Z,0),D.y=65+X}),t.input.on("pointerup",()=>{se=!1,Se=0,Pe=0,ne=!1})}function Pa(){const t=document.getElementById("disconnect-warning");t&&(t.style.display="block")}function Ea(t){t.add.dom(700,400).createFromCache("disconnectWarning")}async function _a(t,a,e){let i;const s=localStorage.getItem("jwt");if(!s){console.error("Error connecting to game lobby: missing token");return}try{console.log("Connecting to game lobby..."),i=await t.joinOrCreate("lobby",{userId:a,token:s}),i.onMessage("newGameListUpdate",async n=>{var c,h;console.log("A game has been added"),e.gameList||console.error("newGameListUpdate - No context.gameList found");const r=e.gameList.findIndex(d=>d._id===n.game._id);r!==-1&&((c=e.gameList)==null||c.splice(r,1)),(h=e.gameList)==null||h.push(n.game),e.activeGamesAmount++,await ce(e)}),i.onMessage("gameListUpdate",async n=>{var h,d,u;console.log("A game has been updated");let r;const c=e.gameList.findIndex(p=>p._id===n.gameId);if(c!==-1&&(r=(h=e.gameList)==null?void 0:h.splice(c,1)[0]),!r)throw new Error("Colyseus lobby. No game found");r.previousTurn=n.previousTurn,r.activePlayer=n.newActivePlayer,r.turnNumber=n.turnNumber,r.lastPlayedAt=n.lastPlayedAt,(d=e.gameList)==null||d.push(r),await ce(e),n.gameId===((u=e.currentRoom)==null?void 0:u.roomId)&&e.scene.get("GameScene").scene.restart({userId:e.userId,colyseusClient:e.colyseusClient,currentGame:r,currentRoom:e.currentRoom,triggerReplay:n.newActivePlayer===e.userId})}),i.onMessage("gameOverUpdate",async n=>{var u;console.log("A game has ended, updating game list");const r=e.gameList;r||console.error("gameOverUpdate - No context.gameList found");const c=r==null?void 0:r.filter(p=>p.status!==N.FINISHED),h=r==null?void 0:r.filter(p=>p.status===N.FINISHED);h==null||h.sort((p,y)=>new Date(y.finishedAt).getTime()-new Date(p.finishedAt).getTime()),console.log("finished games",h),h&&h.length>4&&h.pop();const d=c==null?void 0:c.find(p=>p._id===n.gameId);if(!d)throw new Error("Colyseus lobby. No game found");d.previousTurn=n.previousTurn,d.turnNumber=n.turnNumber,d.status=N.FINISHED,d.lastPlayedAt=n.lastPlayedAt,d.gameOver=n.gameOver,e.gameList=[...c??[],...h??[]],e.activeGamesAmount--,await ce(e),n.gameId===((u=e.currentRoom)==null?void 0:u.roomId)&&e.scene.get("GameScene").scene.restart({userId:e.userId,colyseusClient:e.colyseusClient,currentGame:d,currentRoom:e.currentRoom})}),i.onMessage("gameDeletedUpdate",async n=>{var c;console.log("A game has been deleted, removing it from the game list"),e.gameList||console.error("gameDeletedUpdate - No context.gameList found");const r=e.gameList.findIndex(h=>h._id===n.gameId);r!==-1&&((c=e.gameList)==null||c.splice(r,1)),await ce(e),console.log("Game removed from list")}),i.onMessage("userDeletedUpdate",async n=>{console.log("A user has been deleted, removing affected games from the game list"),e.gameList||console.error("userDeletedUpdate - No context.gameList found"),n.gameIds.forEach(r=>{var h,d;const c=e.gameList.findIndex(u=>u._id===r);if(c!==-1){const u=(h=e.gameList)==null?void 0:h.splice(c,1);u!=null&&u.length&&((d=e.currentRoom)==null?void 0:d.roomId)===u[0]._id&&e.scene.get("GameScene").scene.stop()}}),e.activeGamesAmount--,await ce(e),console.log("Games removed from list")}),i.onMessage("pong",()=>{}),i.onLeave(n=>{console.log("Left room with code:",n),Pa()})}catch(n){console.error("Error joining lobby ->",n)}if(!i)throw new Error("connectToGameLobby() No lobby found");return i}function va(t,a,e){const i=localStorage.getItem("jwt");t.send("gameDeletedMessage",{gameId:a,userId:e,token:i})}function Da(t,a,e,i){const s=localStorage.getItem("jwt");t.send("challengeAcceptedMessage",{gameId:a,userId:e,faction:i,token:s})}const l="https://cdn.jsdelivr.net/gh/nochinator/sa-assets@58bee66d21c333c39eb001e86482163f849725f1";class ka extends Phaser.Scene{constructor(){super({key:"PreloaderScene"})}preload(){this.load.image("loadingScreen",`${l}/ui/loading.webp`),this.load.once("filecomplete-image-loadingScreen",()=>{this.add.image(0,0,"loadingScreen").setOrigin(0).setScale(2.8),this.loadRestOfAssets()})}loadRestOfAssets(){this.load.font("proHeavy","/fan-academy/fonts/BlambotFXProHeavyLowerCapsBB.woff","truetype"),this.load.font("proLight","/fan-academy/fonts/BlambotFXProLightBB.woff","truetype"),this.load.image("popupBackground",`${l}/images/gameItems/popup_button.webp`),this.load.image("popupButton",`${l}/images/gameItems/ColorSwatch_Color-hd.webp`),this.load.image("gameBackground",`${l}/ui/create_game.webp`)}create(){this.scene.start("MainMenuScene")}}const Oe=["archer_v1-hd","archer_v2-hd","archer_v3-hd","archer_v4-hd","cleric_v0-hd","cleric_v1-hd","cleric_v2-hd","cleric_v3-hd","cleric_v4-hd","impaler_v1-hd","impaler_v2-hd","impaler_v3-hd","impaler_v4-hd","knight_v0-hd","knight_v1-hd","knight_v2-hd","knight_v3-hd","knight_v4-hd","ninja_v1-hd","ninja_v2-hd","phantom_v1-hd","phantom_v2-hd","phantom_v3-hd","priestess_v0-hd","priestess_v1-hd","priestess_v2-hd","priestess_v3-hd","priestess_v4-hd","unknownAvatar-hd","wizard_v1-hd","wizard_v2-hd","wizard_v3-hd","wizard_v4-hd","wraith_v1-hd","wraith_v2-hd","voidmonk_v1-hd","voidmonk_v2-hd","voidmonk_v3-hd","voidmonk_v4-hd","necromancer_v0-hd","necromancer_v1-hd","necromancer_v2-hd","necromancer_v3-hd","necromancer_v4-hd","soulHarvestIcon","soulStoneIcon","shiningHelmIcon","superChargeIcon","runeMetalIcon","crystalIcon","manaVialIcon","infernoIcon","healingPotionIcon","dragonScaleIcon"];class St extends Phaser.Scene{constructor(){super({key:"UIScene"});o(this,"colyseusClient");o(this,"lobbyRoom");o(this,"userId");o(this,"gameListContainer");o(this,"gameList");o(this,"currentRoom");o(this,"gameScene");o(this,"activeGameImage");o(this,"activeGameImageId");o(this,"activeGamesAmountLimit",50);o(this,"activeGamesAmount",0);this.colyseusClient=new Ot.Client("https://scribble-academy-be.onrender.com")}init(e){this.userId=e.userId}preload(){this.load.image(B.COUNCIL,`${l}/ui/council_emblem.webp`),this.load.image(B.DARK_ELVES,`${l}/ui/elves_emblem.webp`),this.load.image(B.DWARVES,`${l}/ui/dwarves_emblem.png`),Oe.forEach(e=>{this.load.image(e,`${l}/images/profilePics/${e}.webp`)}),this.load.image("gameListButton",`${l}/ui/game_list_premade.webp`),this.load.image("newGameButton",`${l}/ui/new_game_btn.webp`),this.load.image("unknownFaction",`${l}/ui/unknown_faction.webp`),this.load.image("unknownOpponent",`${l}/images/profilePics/unknownAvatar-hd.webp`),this.load.image("closeButton",`${l}/ui/close_button.webp`),this.load.image("concedeButton",`${l}/ui/concede_button.webp`),this.load.html("disconnectWarning","html/disconnectWarning.html"),this.load.audio("deleteGameSound",`${l}/audio/ui/deleteGame.mp3`)}async create(){this.time.addEvent({delay:3e5,callback:()=>{this.lobbyRoom.send("ping")},loop:!0}),Ea(this),this.add.image(0,0,"loadingScreen").setOrigin(0).setScale(2.8),this.lobbyRoom=await _a(this.colyseusClient,this.userId,this),this.gameList=await Nt(this.userId),this.add.image(0,0,"uiBackground").setOrigin(0),await ce(this),new Ht(this),this.add.image(397,15,"gameBackground").setOrigin(0,0).setScale(1.06,1.2)}onShutdown(){this.sound.stopAll()}}async function Ra(t,a){try{const e=localStorage.getItem("jwt"),i=await fetch("https://scribble-academy-be.onrender.com/users/login",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({username:t,password:a})}),s=await i.json();return i.ok?(console.log("Successful login! :)"),localStorage.setItem("jwt",s.token),{success:!0,userData:s.userData}):(console.error("Server responded with an error:",s.message||"Unknown error"),{success:!1,error:s.message||"Unknown error"})}catch(e){return console.error("Error login in: ",e),{success:!1,error:"Network error. Please try again."}}}async function Oa(t,a,e){try{const i=localStorage.getItem("jwt"),s=await fetch("https://scribble-academy-be.onrender.com/users/signup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({email:t,username:a,password:e})}),n=await s.json();return s.ok?(console.log("Successful sign up! :)"),localStorage.setItem("jwt",n.token),{success:!0,userData:n.userData}):(console.log("Server responded with an error:",n.message||"Unknown error"),{success:!1,error:n.message||"Unknown error"})}catch(i){return console.error("Network error signing up:",i),{success:!1,error:"Network error. Please try again."}}}async function Ha(){console.log("Checking Authentication Status...");const t=localStorage.getItem("jwt"),a=await fetch("https://scribble-academy-be.onrender.com/auth-check",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(a.status!=200){console.error("User not authenticated...");return}const e=await a.json();return console.log("User authenticated...",e.userId),e}async function pe(t=1){console.log("Fetching leaderboard data...");const a=localStorage.getItem("jwt"),e=await fetch(`https://scribble-academy-be.onrender.com/users/leaderboard?page=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),i=await e.json();return e.status!==200?(console.error("Error getting leaderboard data..."),null):(console.log("Leaderboard data fetched"),i)}async function Na(){console.log("Fetching profile data...");const t=localStorage.getItem("jwt"),a=await fetch("https://scribble-academy-be.onrender.com/users/profile",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),e=await a.json();return a.status!==200?(console.error("Error getting profile data..."),null):(console.log("Profile data fetched"),e)}async function Ba(t){try{const a=localStorage.getItem("jwt"),e=await fetch("https://scribble-academy-be.onrender.com/users/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)}),i=await e.json();return e.ok?(console.log("Profile updated! :)"),{success:!0,user:i}):(console.log("Server responded with an error:",i.message||"Unknown error"),{success:!1,error:i.message||"Unknown error"})}catch(a){return console.error("Network error updating profile:",a),{success:!1,error:"Network error. Please try again."}}}async function La(){try{const t=localStorage.getItem("jwt"),a=await fetch("https://scribble-academy-be.onrender.com/users/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),e=await a.json();return a.ok?(console.log("Profile deleted :("),localStorage.removeItem("jwt"),e):(console.log("Server responded with an error:",e.message||"Unknown error"),{success:!1,error:e.message||"Unknown error"})}catch(t){return console.error("Network error while deleting account:",t),{success:!1,error:"Network error. Please try again."}}}function ue(t){const{thisParam:a,x:e,y:i,imageKey:s,text:n,font:r,tint:c,callback:h}=t,d=a.add.image(0,0,s).setOrigin(.5).setInteractive({useHandCursor:!0}),u=a.add.text(.5,.5,n,{font:r}).setOrigin(.5,.6);c&&d.setTint(10027008);const p=a.add.container(e,i,[d,u]);return d.on("pointerdown",()=>{h()}),p}class Ma extends Phaser.Scene{constructor(){super({key:"MainMenuScene"});o(this,"userId");o(this,"gameList");o(this,"userPreferences");o(this,"currentSubScene")}init(){}preload(){this.load.html("loginForm","html/loginForm.html"),this.load.html("signUpForm","html/signUpForm.html"),this.load.image("uiBackground",`${l}/ui/game_screen.webp`),this.load.image("mainMenuImage",`${l}/ui/main_menu_image.webp`),this.load.image("mainMenuBottom",`${l}/ui/main_menu_bottom.webp`),this.load.image("playButton",`${l}/ui/play_button.webp`),this.load.image("mainMenuButton",`${l}/ui/main_menu_button.webp`),this.load.font("proHeavy","/fan-academy/fonts/BlambotFXProHeavyLowerCapsBB.woff","truetype"),this.load.font("proLight","/fan-academy/fonts/BlambotFXProLightBB.woff","truetype"),this.load.audio("buttonFailedSound",`${l}/audio/ui/buttonFailed.mp3`),this.load.audio("battleButtonSound",`${l}/audio/ui/battleButton.mp3`),this.load.audio("buttonPressGenericSound",`${l}/audio/ui/buttonPressGeneric.mp3`)}async create(){const e=await Ha();e&&this.updateUserPreferences(e);const i=this.add.image(0,0,"uiBackground").setOrigin(0),s=this.add.image(0,0,"mainMenuImage").setOrigin(0),n=this.add.image(397,15,"gameBackground").setOrigin(0,0).setScale(1.06,1.2).setVisible(!1);s.x=i.width-s.width-14,s.y+=14;const r=this.add.image(0,0,"mainMenuBottom").setOrigin(0),c=this.add.text(.5,.5,"Welcome to the Hero Academy!",{font:"50px proLight",color:"#873600"}).setOrigin(-.4,-1.3);this.add.container(i.width-r.width-14,i.height-r.height-14,[r,c]),this.add.text(30,730,"This game is in beta state: Expect bugs and crashes. If you run into any issues, please let dadazbk know on Discord. Thanks!",{fontFamily:"proLight",fontSize:35,color:"#ffffff",wordWrap:{width:350,useAdvancedWrap:!0}});const h=this.textures.get("mainMenuButton").getSourceImage().height,d=200,u=20;ue({thisParam:this,x:d,y:h*4+u,imageKey:"mainMenuButton",text:"Profile",font:"70px proHeavy",callback:()=>{this.sound.play(w.BUTTON_GENERIC),n.setVisible(!0),s.setVisible(!1),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.launch("ProfileScene",{userId:this.userId}),this.currentSubScene="ProfileScene"}}),ue({thisParam:this,x:d,y:h*6-u,imageKey:"mainMenuButton",text:"Leaderboard",font:"70px proHeavy",callback:()=>{this.sound.play(w.BUTTON_GENERIC),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.launch("LeaderboardScene",{userId:this.userId}),this.currentSubScene="LeaderboardScene"}}),ue({thisParam:this,x:d,y:h*7+5,imageKey:"mainMenuButton",text:"About",font:"70px proHeavy",callback:()=>{this.sound.play(w.BUTTON_GENERIC),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.launch("AboutScene"),this.currentSubScene="AboutScene"}}),ue({thisParam:this,x:d,y:h*8.5,imageKey:"mainMenuButton",text:"Discord",font:"70px proHeavy",callback:()=>{this.sound.play(w.BUTTON_GENERIC),window.open("https://discord.gg/pkfwDvKyxX")}}),ue({thisParam:this,x:200,y:140,imageKey:"playButton",text:"Play!",font:"130px proHeavy",callback:()=>{this.sound.play(w.BUTTON_PLAY),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.start("UIScene",{userId:this.userId}),this.currentSubScene="UIScene"}}),ue({thisParam:this,x:d,y:h*14+40,imageKey:"mainMenuButton",text:"Logout",font:"70px proHeavy",tint:"0x990000",callback:async()=>{this.sound.play(w.BUTTON_GENERIC),localStorage.removeItem("jwt"),this.userId=void 0,document.title="Fan Academy",this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.restart()}}),this.createSignUpAndLoginForms(this.userId)}onShutdown(){this.sound.stopAll()}createSignUpAndLoginForms(e){const i=this.add.dom(800,400).createFromCache("loginForm"),s=this.add.dom(800,400).createFromCache("signUpForm");s.setVisible(!1);const n=this.add.rectangle(0,0,2900,2e3,0,.001).setOrigin(.5).setInteractive(),r=i.getChildByID("username"),c=i.getChildByID("password"),h=i.getChildByID("loginButton"),d=i.getChildByID("linkToSignUp"),u=i.getChildByID("loginError"),p=s.getChildByID("email"),y=s.getChildByID("username"),T=s.getChildByID("password"),P=s.getChildByID("passwordConfirm"),C=s.getChildByID("signUpButton"),D=s.getChildByID("linkToLogin"),O=s.getChildByID("signUpError"),M=(I,F)=>{I.innerText=F,I.style.display="block"},J=I=>{I.innerText="",I.style.display="none"};h.addEventListener("click",async()=>{if(r.value&&c.value){const I=await Ra(r.value,c.value);I.success?(I.userData&&this.updateUserPreferences(I.userData),i.setVisible(!1),n.setVisible(!1),this.sound.play(w.BUTTON_GENERIC),console.log("UserId after login:",this.userId)):(this.sound.play(w.BUTTON_FAILED),M(u,I.error))}else this.sound.play(w.BUTTON_FAILED),M(u,"Incorrect username or password.")}),C.addEventListener("click",async()=>{if(J(O),T.value!==P.value){this.sound.play(w.BUTTON_FAILED),M(O,"Passwords do not match");return}if(!ht(T.value)){this.sound.play(w.BUTTON_FAILED),M(O,"Password must be at least 8 characters long and contain a letter and a number");return}if(y.value.length>20){this.sound.play(w.BUTTON_FAILED),M(O,"Username must be 20 characters or shorter");return}if(p.value&&y.value&&T.value){const I=await Oa(p.value,y.value,T.value);I.success?(I.userData&&this.updateUserPreferences(I.userData),s.setVisible(!1),n.setVisible(!1),this.sound.play(w.BUTTON_GENERIC),console.log("UserId after sign up:",this.userId)):(this.sound.play(w.BUTTON_FAILED),M(O,I.error))}});const G=(I,F)=>{I.addEventListener("keydown",V=>{V.key==="Enter"&&F.click()})};return[r,c].forEach(I=>G(I,h)),[p,y,T,P].forEach(I=>G(I,C)),d.addEventListener("click",()=>{i.setVisible(!1),s.setVisible(!0)}),D.addEventListener("click",()=>{s.setVisible(!1),i.setVisible(!0)}),e&&(i.setVisible(!1),s.setVisible(!1),n.setVisible(!1)),{loginForm:i,signUpForm:s}}updateUserPreferences(e){this.userId=e.userId,this.registry.set("userPreferences",{chat:e.preferences.chat,sound:e.preferences.sound}),this.sound.mute=!e.preferences.sound}}function Fa(t){const a=t.add.image(460,70,"replayButton").setScale(1.3).setInteractive({useHandCursor:!0}).setVisible(!t.triggerReplay);return a.on("pointerdown",()=>{t.sound.play(w.BUTTON_GENERIC),t.scene.restart({userId:t.userId,colyseusClient:t.colyseusClient,currentGame:t.currentGame,currentRoom:t.currentRoom,triggerReplay:!0})}),a}const at={x:550,y:730};class $a extends Phaser.GameObjects.Container{constructor(e){super(e,at.x,at.y);o(this,"actionCircle");o(this,"actionPie1");o(this,"actionPie2");o(this,"actionPie3");o(this,"actionPie4");o(this,"actionPie5");o(this,"actionArrow");o(this,"context");this.context=e,this.actionCircle=e.add.image(0,0,"actionCircle").setOrigin(.5).setName("actionCircle"),this.actionPie1=e.add.image(12,-19,"actionPie").setOrigin(.5).setRotation(-.3).setName("actionPie1"),this.actionPie2=e.add.image(24,6,"actionPie").setOrigin(.5).setRotation(.9).setName("actionPie2"),this.actionPie3=e.add.image(4,25,"actionPie").setOrigin(.5).setRotation(2.2).setName("actionPie3"),this.actionPie4=e.add.image(-18,13,"actionPie").setOrigin(.5).setRotation(3.4).setName("actionPie4"),this.actionPie5=e.add.image(-15,-15,"actionPie").setOrigin(.5).setRotation(4.7).setName("actionPie5"),this.actionArrow=e.add.image(-35,0,"actionArrow").setOrigin(.5).setRotation(-.1).setName("actionArrow").setVisible(!1),e.turnNumber===0&&e.activePlayer===e.userId&&(this.actionPie1.setVisible(!1),this.actionPie2.setVisible(!1)),this.add([this.actionCircle,this.actionPie1,this.actionPie2,this.actionPie3,this.actionPie4,this.actionPie5,this.actionArrow]),e.add.existing(this)}resetActionPie(){this.context.turnNumber!==0&&(this.actionPie1.setVisible(!0),this.popAnimation(this.actionPie1,!0),this.actionPie2.setVisible(!0),this.popAnimation(this.actionPie2,!0)),this.actionPie3.setVisible(!0),this.popAnimation(this.actionPie3,!0),this.actionPie4.setVisible(!0),this.popAnimation(this.actionPie4,!0),this.actionPie5.setVisible(!0),this.popAnimation(this.actionPie5,!0),this.actionArrow.setVisible(!1),this.removeInteractive()}popAnimation(e,i=!1){if(!e)return;const s=this.getIndex(e);this.bringToTop(e),this.context.tweens.add({targets:e,scale:1.5,duration:100,yoyo:!0,ease:"Quad.easeInOut",onComplete:()=>{e.visible=i,this.moveTo(e,s)}})}hideActionSlice(e){switch(e){case 1:this.popAnimation(this.actionPie1),this.actionArrow.setVisible(!0);break;case 2:this.popAnimation(this.actionPie2);break;case 3:this.popAnimation(this.actionPie3),this.actionArrow.setVisible(!0);break;case 4:this.popAnimation(this.actionPie4);break;case 5:this.popAnimation(this.actionPie5);break}this.setSize(90,90).setInteractive({useHandCursor:!0}),this.on("pointerdown",()=>{this.context.gameController.resetTurn()})}}class Ua extends Phaser.GameObjects.Container{constructor(e,i){super(e,0,0);o(this,"cardBackgroundImage");o(this,"unitPictureImage");o(this,"cardSeparatorImage");o(this,"cardNameText");o(this,"cardTypeText");o(this,"cardFlavorText");o(this,"context");this.context=e;let s="",n="",r="";switch(i){case A.SPAWN:s="spawnTile",n="Spawn Tile",r="Units can be spawned here.";break;case A.POWER:s="powerTile",n="Power Boost",r="Adds 100 damage to the unit on this tile.";break;case A.PHYSICAL_RESISTANCE:s="shieldTile",n="Defense Boost",r="Grants 20% physical resistance to the unit on this tile.";break;case A.MAGICAL_RESISTANCE:s="helmetTile",n="Resist Boost",r="Grants 20% magical resistance to the unit on this tile.";break;case A.CRYSTAL_DAMAGE:s="crystalDamageTile",n="Assault Boost",r="Adds 300 damage to all hits to crystals by any unit in the board.";break;case A.TELEPORTER:s="teleporterTile",n="Teleporter",r="Units on this tile can teleport to any other unoccupied teleporter.";break;case A.SPEED:s="speedTile",n="Speed Boost",r="Grants 2 extra movement to the unit on this tile.";break;default:s="specialTile",n="Special Tile",r="A unique tile with special properties.";break}this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,s).setOrigin(.5).setScale(1.2),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3),this.cardNameText=this.context.add.text(55,-170,n,{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,v.SPECIAL_TILE,{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cardFlavorText=this.context.add.text(0,-55,r,{fontFamily:"proLight",fontSize:30,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(.5),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.cardNameText,this.cardTypeText,this.cardFlavorText])}}class Ga extends Phaser.GameObjects.Container{constructor(e,i){super(e,i.x,i.y);o(this,"baseRectangle");o(this,"row");o(this,"col");o(this,"x");o(this,"y");o(this,"boardPosition");o(this,"obstacle");o(this,"hero");o(this,"crystal");o(this,"tileSize",90);o(this,"tileType");o(this,"isHighlighted");o(this,"unitCard");o(this,"icon");this.row=i.row,this.col=i.col,this.x=i.x,this.y=i.y,this.tileType=i.tileType,this.obstacle=i.obstacle,this.hero=i.hero,this.crystal=i.crystal,this.boardPosition=i.boardPosition,this.baseRectangle=e.add.rectangle(0,0,this.tileSize,this.tileSize),this.add(this.baseRectangle),this.isHighlighted=this.baseRectangle.isFilled,this.tileType!==A.BASIC&&(this.unitCard=new Ua(e,this.tileType).setVisible(!1)),[A.BASIC,A.CRYSTAL,A.CRYSTAL_SMALL,A.CRYSTAL_BIG].includes(this.tileType)||(this.icon=e.add.image(0,0,this.tileType),this.col>4&&this.icon.setFlipX(!0),this.add(this.icon)),this.setSize(90,90).setInteractive({useHandCursor:!0}).setDepth(2),Mt(this,e),this.unitCard&&this.add(this.unitCard),e.add.existing(this)}getTileData(){return{row:this.row,col:this.col,x:this.x,y:this.y,tileType:this.tileType,boardPosition:this.boardPosition,obstacle:this.obstacle,hero:this.hero,crystal:this.crystal}}removeHero(){this.hero=void 0}isFriendly(e){return this.hero&&this.hero.unitId.includes(e)}isEnemy(e){return this.hero&&!this.hero.unitId.includes(e)}setHighlight(){this.baseRectangle.setFillStyle(33023,.3),this.isHighlighted=this.baseRectangle.isFilled}clearHighlight(){this.baseRectangle.setFillStyle(),this.isHighlighted=this.baseRectangle.isFilled}}class xa{constructor(a,e){o(this,"topLeft",{x:545,y:225});o(this,"tileSize",90);o(this,"context");o(this,"tiles");o(this,"units",[]);o(this,"crystals",[]);this.context=a,this.tiles=this.createTileGrid(e),this.crystals.forEach(i=>i.updateDebuffAnimation(i.debuffAmount))}createTileGrid(a){const e=[];return a.forEach(i=>{const s=new Ga(this.context,i);s.hero&&this.units.push(Ke(this.context,s.hero,s)),s.crystal&&this.crystals.push(new De(this.context,s.crystal,i)),e.push(s)}),e}getTileFromCoordinates(a,e){const i=this.tiles.find(s=>s.row===a&&s.col===e);if(!i)throw new Error("Board getTile() No tile found");return i}getTileFromBoardPosition(a){const e=this.tiles.find(i=>i.boardPosition===a);if(!e)throw new Error("Board getTile() No tile found");return e}getUnitFromTile(a){return this.units.find(i=>i.boardPosition===a.boardPosition)||this.crystals.find(i=>i.boardPosition===a.boardPosition)}getBoardState(){return this.tiles.map(a=>a.getTileData())}clearHighlights(){this.tiles.forEach(a=>a.clearHighlight())}highlightSpawns(a){const e=new Set;this.tiles.forEach(i=>{var n,r,c;const s=$(this.context,i);i.tileType===A.SPAWN&&!s&&(i.hero||e.add(i),(n=i.hero)!=null&&n.isKO&&e.add(i),((r=i.hero)==null?void 0:r.unitType)===g.PHANTOM&&e.add(i)),a===g.WRAITH&&((c=i.hero)!=null&&c.isKO)&&!$(this.context,i)&&e.add(i)}),this.highlightTiles([...e])}highlightEnemyTargets(a){const e=this.getHeroTilesInRange(a,Y.ATTACK);if(!e.length)return;const i=[];e.forEach(r=>{const c=r.hero?this.units.find(h=>h.unitId===r.hero.unitId):r.crystal?this.crystals.find(h=>{var d;return h.boardPosition===((d=r.crystal)==null?void 0:d.boardPosition)}):void 0;if(!c){console.error("No target found",r.hero);return}(c instanceof De&&c.belongsTo!==a.belongsTo||c instanceof _&&c.belongsTo!==a.belongsTo&&!c.isKO||(a.unitType===g.NECROMANCER||a.unitType===g.WRAITH)&&c instanceof _&&c.isKO||c instanceof _&&c.isKO&&this.isOrthogonalAdjacent(a,c)&&$(this.context,c.getTile())||a.unitType===g.GRENADIER)&&i.push(c)});const s=[],n=[];a.unitType===g.GRENADIER?i.forEach(r=>{s.push(r)}):i.forEach(r=>{this.hasLineOfSight(a,r)?s.push(r):n.push(r)}),s.forEach(r=>r.attackReticle.setVisible(!0)),n.forEach(r=>r.blockedLOS.setVisible(!0))}highlightFriendlyTargets(a){if(!a.canHeal&&a.unitType!==g.ENGINEER)return;const e=this.getHeroTilesInRange(a,Y.HEAL);e.length&&e.forEach(i=>{if(i.crystal)return;const s=this.units.find(h=>{var d;return h.unitId===((d=i.hero)==null?void 0:d.unitId)});if(!s){console.error("No healing target found",i);return}const n=this.context.userId,r=s.maxHealth,c=s.currentHealth;i.isFriendly(n)&&(c<r||a.unitType===g.ENGINEER)&&s.healReticle.setVisible(!0)})}highlightMovementArea(a){const e=this.getHeroTilesInRange(a,Y.MOVE);this.highlightTiles(e)}highlightTeleportOptions(a){if(a.getTile().tileType===A.TELEPORTER){const i=this.tiles.filter(s=>s.tileType===A.TELEPORTER&&(!s.hero||s.hero.isKO));this.highlightTiles(i)}if(a.unitType!==g.NINJA)return;const e=[];this.units.forEach(i=>{a.belongsTo===i.belongsTo&&!i.isKO&&e.push(i)}),!(e.length<=1)&&e.forEach(i=>{i.allyReticle.setVisible(!0)})}highlightEquipmentTargets(a){const e=[];this.units.forEach(i=>{i.belongsTo===a.belongsTo&&(i instanceof Ve||i.isAlreadyEquipped(a)||a.canHeal&&i.isFullHP()||a.canHeal&&a instanceof ft&&i.isKO||!a.canHeal&&i.isKO||e.push(i.getTile()))}),this.highlightTiles(e)}highlightAllBoard(){this.highlightTiles(this.tiles)}highlightTiles(a){a.forEach(e=>{e.setHighlight()})}removeReticles(){this.units.forEach(a=>{a.attackReticle.setVisible(!1),a.blockedLOS.setVisible(!1),a.healReticle.setVisible(!1),a.allyReticle.setVisible(!1)}),this.crystals.forEach(a=>{a.attackReticle.setVisible(!1),a.blockedLOS.setVisible(!1)})}getHeroTilesInRange(a,e){const i=this.getTileFromBoardPosition(a.boardPosition);let s;switch(e){case Y.MOVE:s=a.speedTile?a.movement+2:a.movement;break;case Y.ATTACK:s=a.attackRange;break;case Y.HEAL:s=a.healingRange;break}if(!i)return console.error("No tile found - getTilesInRange"),[];const n=new Set;return this.tiles.forEach(r=>{Tt(r.row,r.col,i.row,i.col)<=s&&(e===Y.MOVE&&!$(this.context,r)&&(!r.hero||r.hero.isKO)&&!r.crystal&&n.add(r),(e===Y.ATTACK||e===Y.HEAL)&&(r.crystal||r.hero&&r.hero.unitId!==a.unitId)&&n.add(r))}),[...n]}getAreaOfEffectTiles(a){const s=[];for(let n=-1;n<=1;n++)for(let r=-1;r<=1;r++){const c=a.row+n,h=a.col+r,d=c>=0&&c<=4,u=h>=0&&h<=8;if(d&&u){const p=this.getTileFromCoordinates(c,h);s.push(p)}else console.warn("Invalid tile coordinates skipped:",c,h)}return s}getAttackDirection(a,e){const i=e-a;let s;switch(i){case-27:case-18:case-9:s=1;break;case-8:s=2;break;case 1:case 2:case 3:s=3;break;case 10:s=4;break;case 9:case 18:case 27:s=5;break;case 8:s=6;break;case-1:case-2:case-3:s=7;break;case-10:s=8;break;default:s=0;break}return s===0&&console.error(`getAttackDirection() No direction found between: ${a} and ${e}`),s}hasLineOfSight(a,e){if(this.isAdjacent(a,e))return!0;if(a.row===e.row||a.col===e.col){const h=this.getAttackDirection(a.boardPosition,e.boardPosition),u={1:[-9,-18],3:[1,2],5:[9,18],7:[-1,-2]}[h];if(!u)return!0;for(const p of u){const y=a.boardPosition+p;if(y===e.boardPosition)return!0;const T=this.getTileFromBoardPosition(y);if(T.crystal&&!me(this.context,T.crystal)||T.hero&&!me(this.context,T.hero)&&!T.hero.isKO)return!1}}const i={"1, 2":[[0,1],[1,1]],"1, -2":[[0,-1],[1,-1]],"-1, 2":[[0,1],[-1,1]],"-1, -2":[[0,-1],[-1,-1]],"2, 1":[[1,0],[1,1]],"2, -1":[[1,0],[1,-1]],"-2, 1":[[-1,0],[-1,1]],"-2, -1":[[-1,0],[-1,-1]]},s={row:e.row-a.row,col:e.col-a.col},n=`${s.row}, ${s.col}`,r=i[n];let c;if(r&&r.length)for(const h of r){const d=a.row+h[0],u=a.col+h[1],p=d<0||d>4,y=u<0||u>8;if(p||y)continue;const T=this.getTileFromCoordinates(d,u);if(T.boardPosition===e.boardPosition)return!0;if(T.crystal&&!me(this.context,T.crystal)||T.hero&&!me(this.context,T.hero)&&!T.hero.isKO){c=!1;break}}return c!==!1}isAdjacent(a,e){const i=Math.abs(a.row-e.row),s=Math.abs(a.col-e.col);return s<=1&&i<=1&&!(i===0&&s===0)}isOrthogonalAdjacent(a,e){const i=Math.abs(a.row-e.row),s=Math.abs(a.col-e.col);return i===1&&s===0||i===0&&s===1}}const it={x:800,y:400};class Va extends Phaser.GameObjects.Container{constructor(e){super(e,it.x,it.y);o(this,"blockingLayer");o(this,"backgroundImage");o(this,"okButtonImage");o(this,"cancelButtonImage");o(this,"popupText");o(this,"okButtonText");o(this,"cancelButtonText");this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=e.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.okButtonImage=e.add.image(-90,60,"popupButton").setTint(10027008).setDisplaySize(120,60).setInteractive({useHandCursor:!0}),this.cancelButtonImage=e.add.image(90,60,"popupButton").setTint(31743).setDisplaySize(120,60).setInteractive({useHandCursor:!0}),this.popupText=e.add.text(0,-50,"You are about to concede this game. Are you sure?",{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.okButtonText=e.add.text(-90,60,"CONCEDE",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cancelButtonText=e.add.text(90,60,"CANCEL",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.okButtonImage.on("pointerdown",async()=>{var c,h;f(this.scene,w.RESIGN),this.setVisible(!1);const i=e.gameController,s=(c=e.currentGame.players.find(d=>d.userData._id.toString()!==e.userId))==null?void 0:c.userData._id;if(!s){console.error("concedePopup() no winnder found");return}const n={winCondition:He.CONCEDED,winner:s},r={...i.lastTurnState,action:{action:b.CONCEDE,actionClass:Te.USER}};i.currentTurn=[r],e.activePlayer=e.opponentId,e.turnNumber++,wt(e.currentRoom,i.currentTurn,e.opponentId,e.turnNumber,n),i.gameOver&&console.log("GAME ENDS! THE WINNER IS",(h=i.gameOver)==null?void 0:h.winner)}),this.cancelButtonImage.on("pointerdown",()=>{f(this.scene,w.BUTTON_FAILED),this.setVisible(!1)}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.okButtonImage,this.okButtonText,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}}class Ka{constructor(a){o(this,"context");o(this,"deck");this.context=a,this.deck=[...xe(a).factionData.unitsInDeck]}getDeckSize(){return this.deck.length}getDeck(){return this.deck}removeFromDeck(a){return this.deck.splice(0,a)}addToDeck(a){return this.deck.push(a),this.deck}}class Wa extends Phaser.GameObjects.Container{constructor(e){super(e,450,715);o(this,"doorClosed");o(this,"doorOpen");o(this,"doorBanner");o(this,"bannerText");o(this,"context");this.context=e,this.doorClosed=e.add.image(50,-15,"doorClosed").setScale(.9),this.doorOpen=e.add.image(55,-15,"doorOpen").setVisible(!1),this.doorBanner=e.add.image(0,45,"doorBanner");const i=xe(e).factionData.unitsInDeck.length??99;this.bannerText=this.context.add.text(0,47,i.toString(),{fontFamily:"proLight",fontSize:30,color:"#000000"}).setOrigin(.5),this.add([this.doorClosed,this.doorOpen,this.doorBanner,this.bannerText]),this.setSize(70,100).setInteractive({useHandCursor:!0}),this.on("pointerdown",s=>{var n;if(s.button===0&&e.activeUnit&&pt(e.activeUnit.boardPosition)){f(this.scene,m.SHUFFLE);const r=e.activeUnit.boardPosition;e.activeUnit.shuffleInDeck(),(n=e.gameController)==null||n.afterAction(b.SHUFFLE,r,51),this.updateBannerText()}s.button===2&&console.log("Add list of items in Deck here")}),this.on("pointerover",s=>{s.rightButtonDown()}),this.on("pointerout",()=>{}),e.add.existing(this)}updateBannerText(){var i;const e=((i=this.context.gameController)==null?void 0:i.deck.getDeckSize())??0;this.bannerText.setText(e.toString())}openDoor(){this.doorOpen.setVisible(!0),this.doorClosed.setVisible(!1),this.scene.time.delayedCall(1e3,()=>{this.doorOpen.setVisible(!1),this.doorClosed.setVisible(!0)})}}class Ya extends ct.GameObjects.Container{constructor(e){super(e,0,0);o(this,"gameOverImage");o(this,"gameOverEffect");o(this,"context");this.context=e,e.add.existing(this).setDepth(999)}async init(){var s;await this.loadImages();let e,i;((s=this.context.currentGame.gameOver)==null?void 0:s.winner)===this.context.userId?(e="gameOverVictoryEffect",i="gameOverVictoryText"):(e="gameOverDefeatEffect",i="gameOverDefeatText"),this.gameOverEffect=this.context.add.image(880,400,e).setOrigin(.5).setName("gameOverEffect").setScale(1.5),this.gameOverImage=this.context.add.image(900,400,i).setOrigin(.5).setName("gameOverImage"),this.context.tweens.add({targets:this.gameOverEffect,angle:360,duration:1e4,repeat:-1,ease:"Linear"}),this.add([this.gameOverEffect,this.gameOverImage])}loadImages(){return new Promise(e=>{var i;((i=this.context.currentGame.gameOver)==null?void 0:i.winner)===this.context.userId?(this.context.load.image("gameOverVictoryText",`${l}/images/gameItems/gameOverVictoryText.webp`),this.context.load.image("gameOverVictoryEffect",`${l}/images/gameItems/gameOverVictoryEffect.webp`)):(this.context.load.image("gameOverDefeatText",`${l}/images/gameItems/gameOverDefeatText.webp`),this.context.load.image("gameOverDefeatEffect",`${l}/images/gameItems/gameOverDefeatEffect.webp`)),this.context.load.once("complete",()=>e()),this.context.load.start()})}}const st={x:800,y:400};class za extends Phaser.GameObjects.Container{constructor(e){super(e,st.x,st.y);o(this,"blockingLayer");o(this,"backgroundRectangle");o(this,"cardImages",[]);o(this,"context");this.context=e,this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.blockingLayer.on("pointerdown",()=>{f(this.scene,w.BUTTON_GENERIC),this.setVisible(!1)}),this.backgroundRectangle=e.add.rectangle(50,0,700,700,2236962,.5).setStrokeStyle(2,16777215),this.add([this.blockingLayer,this.backgroundRectangle]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}showDeckContents(e){this.cardImages.forEach(C=>C.destroy()),this.cardImages=[];const i={[j.HERO]:0,[j.ITEM]:1},s=[...e].sort((C,D)=>{const O=i[C.class]-i[D.class];return O!==0?O:C.unitId.localeCompare(D.unitId)}),n=-150,r=-250,c=100,h=100,d=5,u=s.length,p=Math.ceil(u/d),y=100,T=p*h,P=T+y;this.backgroundRectangle.setSize(this.backgroundRectangle.width,P),this.backgroundRectangle.setOrigin(.5),s.forEach((C,D)=>{const O=Math.floor(D/d),M=D%d,J=n+M*c,G=r+O*h;let I;C.class===j.HERO?I=`${C.unitType}CardPic`:I=`${C.itemType}CardPic`;const F=this.context.add.image(J,G,I).setDisplaySize(90,90).setOrigin(.5);this.add(F),this.cardImages.push(F)}),this.backgroundRectangle.y=r+T/2-h/2,this.setVisible(!0)}}class nt extends Phaser.GameObjects.Container{constructor(e,i,s){super(e,0,0);o(this,"context");o(this,"board");o(this,"background");o(this,"healthBar");o(this,"maxHealth",9e3);o(this,"currentHealth",0);o(this,"player");o(this,"fullWidth");this.context=e,this.board=i,this.player=s;const n={1:{x:640,y:65},2:{x:930,y:65}};this.background=e.add.image(n[s].x,n[s].y,"HpBackground").setScale(3).setOrigin(0),this.healthBar=e.add.image(n[s].x,n[s].y,"HpAlly").setScale(3).setOrigin(0),this.fullWidth=this.healthBar.displayWidth,this.setHealth(),this.add([this.background,this.healthBar])}setHealth(){this.currentHealth=0,this.board.crystals.forEach(i=>{i.belongsTo===this.player&&(this.currentHealth+=i.currentHealth)});const e=this.currentHealth/this.maxHealth;this.healthBar.displayWidth=this.fullWidth*e,this.player===1&&(this.healthBar.x=this.background.x+(this.fullWidth-this.healthBar.displayWidth))}}class ja extends Phaser.GameObjects.Container{constructor(e,i,s){super(e,0,0);o(this,"playerOneHpBar");o(this,"playerTwoHpBar");o(this,"playerOneBanner");o(this,"playerTwoBanner");o(this,"playerOnePortrait");o(this,"playerTwoPortrait");o(this,"playerOneName");o(this,"playerTwoName");o(this,"deckPopup");o(this,"vsBanner");this.playerOneBanner=e.add.image(0,0,"playerBanner").setOrigin(.5).setPosition(705,80).setFlipX(!0).setTint(3381759),this.playerTwoBanner=e.add.image(0,0,"playerBanner").setOrigin(.5).setPosition(1095,80).setTint(10027008),this.playerOnePortrait=e.add.image(0,0,s[0].picture).setOrigin(.5).setPosition(600,73).setDisplaySize(256*.3,256*.3).setDepth(1).setInteractive({useHandCursor:!0}),this.playerTwoPortrait=e.add.image(0,0,s[1].picture).setOrigin(.5).setPosition(1200,73).setDisplaySize(256*.3,256*.3).setFlipX(!0).setDepth(1).setInteractive({useHandCursor:!0}),this.deckPopup=new za(e);const n=r=>{if(r._id===e.userId)this.deckPopup.showDeckContents(e.gameController.deck.getDeck());else{const{opponent:c}=$e(e),h=[...e[c].factionData.unitsInDeck,...e[c].factionData.unitsInHand];this.deckPopup.showDeckContents(h)}};this.playerOnePortrait.on("pointerdown",()=>{n(s[0])}),this.playerTwoPortrait.on("pointerdown",()=>{n(s[1])}),this.playerOneHpBar=new nt(e,i,1),this.playerTwoHpBar=new nt(e,i,2),this.playerOneName=e.add.text(645,35,be(s[0].username,14),{fontFamily:"proLight",color:"#ffffff",fontSize:40}),this.playerTwoName=e.add.text(950,35,be(s[1].username,14),{fontFamily:"proLight",color:"#ffffff",fontSize:40}),this.vsBanner=e.add.image(0,0,"vsBanner").setOrigin(.5).setPosition(900,75),this.add([this.playerOneBanner,this.playerTwoBanner,this.playerOneHpBar,this.playerTwoHpBar,this.playerOneName,this.playerTwoName,this.playerOnePortrait,this.playerTwoPortrait,this.vsBanner]),e.add.existing(this)}}class Xa{constructor(a,e,i){o(this,"itemRack");o(this,"banner");const s=a.add.image(0,0,"gameBoard").setOrigin(0).setInteractive();s.x=1434-s.width-14,s.y+=14,this.itemRack=a.add.image(0,0,"itemRack").setOrigin(.5).setPosition(900,736).setScale(.9),this.banner=new ja(a,e,i)}}class qa{constructor(a){o(this,"context");o(this,"handData");o(this,"hand");var e;this.context=a,this.handData=xe(a).factionData.unitsInHand??[],this.hand=((e=this.handData)==null?void 0:e.map(i=>this.renderUnit(i)))??[]}getHandSize(){return this.hand.length}getHand(){return this.hand}renderUnit(a){if(R(a))return Ke(this.context,a);if(ae(a))return bt(this.context,a);throw new Error("Unit passed to renderUnit is not a recognized type")}addToHand(a){const e=[45,46,47,48,49,50];let i=-1;e.forEach(s=>{const n=this.hand.findIndex(r=>r.boardPosition===s);if(n!==-1)i=n;else{const r=a.shift();if(r){r.boardPosition=s;const c=this.renderUnit(r);this.hand.splice(++i,0,c)}}})}removeFromHand(a){const e=this.hand.findIndex(i=>i.unitId===a.unitId);e!==-1&&this.hand.splice(e,1)}exportHandData(){return this.hand.length===0?[]:this.hand.map(a=>a.exportData())}}class Ja extends Phaser.GameObjects.Container{constructor(e){super(e,1300,725);o(this,"buttonImage");o(this,"buttonText");o(this,"context");this.context=e,this.buttonImage=e.add.image(0,0,"popupBackground").setOrigin(.5).setScale(1.1).setInteractive({useHandCursor:!0}),this.buttonText=e.add.text(0,-5,"Again!",{fontFamily:"proHeavy",fontSize:55,color:"#ffffff"}).setOrigin(.5),this.buttonImage.on("pointerdown",async()=>{var i;new Ye({context:e,opponentId:e.opponentId,challengeType:he.SEND,username:(i=e.gameController.playerData.find(s=>s._id===e.opponentId))==null?void 0:i.username})}),this.add([this.buttonImage,this.buttonText]),e.add.existing(this)}}class Za{constructor(a){o(this,"context");o(this,"buttonImage");this.context=a,this.buttonImage=a.add.image(1300,725,"turnButton").setOrigin(.5).setScale(1.1).setInteractive({useHandCursor:!0}),this.buttonImage.on("pointerdown",async()=>{if(a.currentGame&&a.activePlayer===a.userId){if(a.sound.play(w.BUTTON_PLAY),console.log("Clicked on send turn"),a.gameController.hasActionsLeft()){a.gameController.turnPopup.setVisible(!0);return}await this.handleSendingTurn()}})}async handleSendingTurn(){const a=this.context.gameController;this.context.currentTurnAction===1&&a.addActionToState(b.PASS),await a.removeKOUnits(),await a.endOfTurnActions()}}const ot={x:800,y:400};class Qa extends Phaser.GameObjects.Container{constructor(e){super(e,ot.x,ot.y);o(this,"blockingLayer");o(this,"backgroundImage");o(this,"okButtonImage");o(this,"cancelButtonImage");o(this,"popupText");o(this,"okButtonText");o(this,"cancelButtonText");this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=e.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.okButtonImage=e.add.image(-90,60,"popupButton").setTint(31743).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.cancelButtonImage=e.add.image(90,60,"popupButton").setTint(10027008).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.popupText=e.add.text(0,-50,"You still have actions left. Send turn?",{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.okButtonText=e.add.text(-90,60,"SEND",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cancelButtonText=e.add.text(90,60,"BACK",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.okButtonImage.on("pointerdown",()=>{this.scene.sound.play(w.BUTTON_GENERIC),this.setVisible(!1),e.gameController.turnButton.handleSendingTurn()}),this.cancelButtonImage.on("pointerdown",()=>{this.scene.sound.play(w.BUTTON_FAILED),this.setVisible(!1)}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.okButtonImage,this.okButtonText,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}}class ei{constructor(a){o(this,"context");o(this,"game");o(this,"gameUI");o(this,"board");o(this,"hand");o(this,"deck");o(this,"actionPie");o(this,"door");o(this,"turnButton");o(this,"turnPopup");o(this,"rematchButton");o(this,"lastTurnState");o(this,"currentTurn");o(this,"blockingLayer");o(this,"replayButton");o(this,"playerData");o(this,"gameOver");o(this,"gameOverScreen");o(this,"concedeButton");o(this,"concedePopup");a.triggerReplay&&a.chatComponent&&(a.chatComponent.pointerEvents="none"),a.currentGame.status===N.FINISHED&&!a.triggerReplay&&new Ya(a).init(),this.context=a,this.game=a.currentGame,this.lastTurnState=a.currentGame.previousTurn[a.triggerReplay?0:a.currentGame.previousTurn.length-1],this.board=new xa(a,this.lastTurnState.boardState),this.playerData=a.currentGame.players.map(e=>e.userData),this.gameUI=new Xa(a,this.board,this.playerData),a.player1=this.lastTurnState.player1,a.player2=this.lastTurnState.player2,this.deck=new Ka(a),this.hand=new qa(a),this.actionPie=new $a(a),this.turnButton=new Za(a),this.turnPopup=new Qa(a),this.rematchButton=new Ja(a).setVisible(!1),this.concedeButton=this.addConcedeButton(a),this.concedePopup=new Va(a),a.triggerReplay?(this.rematchButton.setVisible(!1),this.turnButton.buttonImage.setVisible(!1)):this.game.status===N.FINISHED&&(this.rematchButton.setVisible(!0),this.turnButton.buttonImage.setVisible(!1),this.gameOverEffects()),a.activePlayer!==a.userId&&this.turnButton.buttonImage.setVisible(!1),this.door=new Wa(a),this.blockingLayer=a.add.rectangle(910,0,1040,1650,0,.3).setOrigin(.5).setInteractive().setDepth(999).setVisible(this.context.triggerReplay),this.blockingLayer.on("pointerdown",()=>{a.scene.restart({userId:a.userId,colyseusClient:a.colyseusClient,currentGame:a.currentGame,currentRoom:a.currentRoom,triggerReplay:!1})}),this.replayButton=Fa(a),this.currentTurn=[],a.input.on("gameobjectdown",()=>Ne(a))}addConcedeButton(a){const e=a.add.image(1350,70,"concedeButton").setScale(.9).setInteractive({useHandCursor:!0});return e.on("pointerdown",()=>{f(this.context,w.BUTTON_GENERIC),this.concedePopup.setVisible(!0)}),e}async replayTurn(){var e;const a=[];if(this.context.activePlayer===this.context.userId){const i=this.context.isPlayerOne?this.lastTurnState.player2:this.lastTurnState.player1;i==null||i.factionData.unitsInHand.forEach(s=>{R(s)&&a.push(Ke(this.context,s).setVisible(!1).setInteractive(!1)),ae(s)&&a.push(bt(this.context,s).setVisible(!1).setInteractive(!1))})}for(let i=1;i<this.context.currentGame.previousTurn.length;i++){const s=this.context.currentGame.previousTurn[i],n=[b.DRAW,b.PASS],r=(e=s.action)==null?void 0:e.action;!r||n.includes(r)||await new Promise(c=>{this.context.time.delayedCall(1e3,async()=>{(r===b.SPAWN||r===b.MOVE)&&this.replaySpawnOrMove(s.action,a),(r===b.ATTACK||r===b.HEAL||r===b.SPECIAL)&&await this.replayAttackHealSpecial(s.action),r===b.SHUFFLE&&await this.replayShuffle(),r===b.USE&&await this.replayUse(s.action,a),r===b.REMOVE_UNITS&&await this.removeKOUnits(),c()})})}this.context.scene.restart({userId:this.context.userId,colyseusClient:this.context.colyseusClient,currentGame:this.context.currentGame,currentRoom:this.context.currentRoom,triggerReplay:!1,gameOver:void 0})}replaySpawnOrMove(a,e){const i=a.action,s=e.length?e:this.hand.hand,n=i===b.SPAWN?s.find(c=>c.boardPosition===a.actorPosition):this.board.units.find(c=>c.boardPosition===a.actorPosition),r=this.board.getTileFromBoardPosition(a.targetPosition);if(!n||!r)throw new Error("Missing hero or tile in spawn or move action");i===b.MOVE&&n.move(r),i===b.SPAWN&&n.setVisible(!0).spawn(r)}async replayAttackHealSpecial(a){const e=this.board.units.find(s=>s.boardPosition===a.actorPosition),i=this.board.crystals.find(s=>s.boardPosition===a.targetPosition)??this.board.units.find(s=>s.boardPosition===a.targetPosition);if(!e||!i)throw new Error("Missing hero or target in attack or heal action");a.action===b.HEAL&&await e.heal(i),a.action===b.SPECIAL&&await e.special(i)}async replayUse(a,e){const s=(e.length?e:this.hand.hand).find(n=>n.boardPosition===a.actorPosition);if(!s)throw new Error("Missing item in use action");if(s.dealsDamage){const n=this.board.getTileFromBoardPosition(a.targetPosition);if(!s)throw new Error("Missing tile in use action");await s.use(n)}if(!s.dealsDamage){const n=this.board.units.find(r=>r.boardPosition===a.targetPosition);if(!n)throw new Error("Missing target in use action");await s.use(n)}}async replayShuffle(){const a=this.context.add.text(600,350,"OPPONENT SWAPPED AN ITEM!",{fontFamily:"proLight",fontSize:50,color:"#fffb00"}).setDepth(999);f(this.context,m.SHUFFLE),await Ta(a,1.3)}async resetTurn(){ye(this.context),this.context.longPressStart=void 0,this.context.visibleUnitCard=void 0,f(this.context,m.RESET_TURN),this.context.scene.restart()}getDeck(){return this.deck.getDeck()}drawUnits(){f(this.context,m.DRAW);const a=6-this.hand.getHandSize();if(this.deck.getDeckSize()===0||a===0)return;this.door.openDoor();const e=this.deck.removeFromDeck(a);this.hand.addToHand(e);const{player:i,opponent:s}=$e(this.context),n={...this.context[i],factionData:{...this.context[i].factionData,unitsInHand:this.hand.exportHandData(),unitsInDeck:this.deck.getDeck()}},r=this.context[s];this.currentTurn.push({player1:this.context.isPlayerOne?n:r,player2:this.context.isPlayerOne?r:n,action:{actionClass:Te.AUTO,action:b.DRAW},boardState:this.board.getBoardState()})}async removeKOUnits(){const a=[];if(this.board.units.forEach(e=>{e.isKO&&(e.lastBreath&&a.push(e),e.lastBreath||(e.lastBreath=!0,e.updateTileData()))}),a.length){f(this.context,m.VANISH);const e=i=>new Promise(s=>{this.context.tweens.add({targets:i,alpha:0,duration:500,ease:"Linear",onComplete:()=>{i.removeFromGame(!0),s()}})});await Promise.all(a.map(i=>e.call(this.context,i)))}this.addActionToState(b.REMOVE_UNITS)}hasActionsLeft(){return this.context.turnNumber===0&&this.context.currentTurnAction<4||this.context.currentTurnAction<6}async endOfTurnActions(){this.context.activeUnit&&ye(this.context),this.actionPie.resetActionPie(),this.drawUnits(),this.door.updateBannerText(),this.currentTurn.unshift(this.lastTurnState),this.context.activePlayer=this.context.opponentId,this.context.turnNumber++,wt(this.context.currentRoom,this.currentTurn,this.context.opponentId,this.context.turnNumber,this.gameOver),this.gameOver&&this.gameOverEffects()}async gameOverEffects(){var a;((a=this.gameOver)==null?void 0:a.winner)===this.context.activePlayer?f(this.context,w.WIN_SFX):f(this.context,w.LOSE_SFX)}onHeroClicked(a){console.log(`A hero in position ${a.boardPosition} has been clicked`),a.boardPosition>44&&this.board.highlightSpawns(a.unitType),a.boardPosition<45&&(this.board.highlightEnemyTargets(a),this.board.highlightFriendlyTargets(a),this.board.highlightMovementArea(a),(a.unitType===g.NINJA||a.getTile().tileType===A.TELEPORTER)&&this.board.highlightTeleportOptions(a))}onItemClicked(a){console.log(`An item ${a.unitId} has been clicked`),a.dealsDamage?this.board.highlightAllBoard():this.board.highlightEquipmentTargets(a)}onTileClicked(a){console.log(`A tile ${a.tileType} has been clicked`)}afterAction(a,e,i){this.context.triggerReplay||(this.addActionToState(a,e,i),this.actionPie.hideActionSlice(this.context.currentTurnAction++),this.context.activeUnit&&ye(this.context))}addActionToState(a,e,i){const{player:s,opponent:n}=$e(this.context),r=fa(a),c={...this.context[s],factionData:{...this.context[s].factionData,unitsInHand:this.hand.exportHandData(),unitsInDeck:this.deck.getDeck()}},h=this.context[n];this.currentTurn.push({player1:this.context.isPlayerOne?c:h,player2:this.context.isPlayerOne?h:c,action:{actorPosition:e,targetPosition:i??e,action:a,actionClass:r},boardState:this.board.getBoardState()})}async pushEnemy(a,e){const i=this.board.getTileFromBoardPosition(a.boardPosition),s=this.board.getTileFromBoardPosition(e.boardPosition);if(!i||!s){console.error("pushEnemy() no attacker or target board position");return}console.log("this logs");const n=Je(i.row,i.col,s.row,s.col,!0),r=n.row<0||n.row>4,c=n.col<0||n.col>8;if(r||c){console.error("pushEnemy() Cant push enemy out of the map");return}const h=this.board.getTileFromCoordinates(n.row,n.col);if(!h){console.error("pushEnemy() No destination tile found");return}if(h.crystal||h.hero){console.error("pushEnemy() Destination tile is occupied");return}if(h.tileType==A.SPAWN&&et(h,e)&&!e.isKO){console.error("pushEnemy() Can't push a non-KO'd enemy onto a friendly spawn");return}e.isKO||e.specialTileCheck(h,s),await qe(this.context,e,h),e.updatePosition(h),h.hero=e.exportData(),s.removeHero()}async pullEnemy(a,e){const i=this.board.getTileFromBoardPosition(a.boardPosition),s=this.board.getTileFromBoardPosition(e.boardPosition);if(!i||!s){console.error("pullEnemy() no attacker or target board position");return}const n=Je(i.row,i.col,s.row,s.col,!1),r=this.board.getTileFromCoordinates(n.row,n.col);if(!r){console.error("pullEnemy() No destination tile found");return}if(r.crystal||r.hero){console.error("pullEnemy() Destination tile is occupied");return}if(r.tileType==A.SPAWN&&et(r,a)&&!e.isKO){console.error("pushEnemy() Can't pull a non-KO'd enemy onto a friendly spawn");return}e.isKO||e.specialTileCheck(r,s),await qe(this.context,e,r),e.updatePosition(r),r.hero=e.exportData(),s.removeHero()}}function ti(){const t={x:545,y:225},a=[];let e=0;for(let i=0;i<5;i++)for(let s=0;s<9;s++){const n=t.x+s*90,r=t.y+i*90;a.push({x:n,y:r,row:i,col:s,boardPosition:e}),e++}return a}function ai(){const t=ti(),a={x:700,y:745};for(let e=0;e<6;e++)t.push({x:a.x,y:a.y}),a.x+=80;return t.push({x:435,y:720}),t}function ii(t){t.load.image("gameBoard",`${l}/images/maps/game_board.webp`),t.load.image("itemRack",`${l}/images/gameItems/item_rack.webp`),t.load.image("doorClosed",`${l}/images/gameItems/door_closed.webp`),t.load.image("doorOpen",`${l}/images/gameItems/door_open.webp`),t.load.image("doorBanner",`${l}/images/gameItems/door_banner.webp`),t.load.image("actionArrow",`${l}/images/gameItems/action_arrow.webp`),t.load.image("actionPie",`${l}/images/gameItems/action_pie.webp`),t.load.image("actionCircle",`${l}/images/gameItems/action_circle.webp`),t.load.image("turnButton",`${l}/ui/turn_button.webp`),t.load.image("playerBanner",`${l}/images/gameItems/player_banner.webp`),t.load.image("vsBanner",`${l}/images/gameItems/vs_banner.webp`),t.load.image("replayButton",`${l}/ui/replay.webp`)}function si(t){t.load.image("spawnTile",`${l}/images/gameItems/DeployZone01-hd.webp`),t.load.image("helmetTile",`${l}/images/gameItems/PremiumTile_Resist-hd.webp`),t.load.image("powerTile",`${l}/images/gameItems/PremiumTile_Sword-hd.webp`),t.load.image("shieldTile",`${l}/images/gameItems/PremiumTile_Shield-hd.webp`),t.load.image("speedTile",`${l}/images/gameItems/PremiumTile_Speed-hd.webp`),t.load.image("crystalDamageTile",`${l}/images/gameItems/PremiumTile_VictoryDamageMultiplier-hd.webp`),t.load.image("teleporterTile",`${l}/images/gameItems/PremiumTile_Teleport-hd.webp`),t.load.image("crystalDamageAnim_1",`${l}/images/gameItems/animations/CrystalPremiumTile_BottomSplash01-hd.webp`),t.load.image("crystalDamageAnim_2",`${l}/images/gameItems/animations/CrystalPremiumTile_BottomSplash02-hd.webp`),t.load.image("crystalDamageAnim_3",`${l}/images/gameItems/animations/CrystalPremiumTile_BottomSplash03-hd.webp`),t.load.image("magicalResistanceAnim_1",`${l}/images/gameItems/animations/ResistPremiumTile_BottomSplash01-hd.webp`),t.load.image("magicalResistanceAnim_2",`${l}/images/gameItems/animations/ResistPremiumTile_BottomSplash02-hd.webp`),t.load.image("magicalResistanceAnim_3",`${l}/images/gameItems/animations/ResistPremiumTile_BottomSplash03-hd.webp`),t.load.image("physicalResistanceAnim_1",`${l}/images/gameItems/animations/ShieldPremiumTile_BottomSplash01-hd.webp`),t.load.image("physicalResistanceAnim_2",`${l}/images/gameItems/animations/ShieldPremiumTile_BottomSplash02-hd.webp`),t.load.image("physicalResistanceAnim_3",`${l}/images/gameItems/animations/ShieldPremiumTile_BottomSplash03-hd.webp`),t.load.image("powerTileAnim_1",`${l}/images/gameItems/animations/SwordPremiumTile_BottomSplash01-hd.webp`),t.load.image("powerTileAnim_2",`${l}/images/gameItems/animations/SwordPremiumTile_BottomSplash02-hd.webp`),t.load.image("powerTileAnim_3",`${l}/images/gameItems/animations/SwordPremiumTile_BottomSplash03-hd.webp`),t.load.image("superChargeAnim_1",`${l}/images/gameItems/animations/Scroll_Backspash01-hd.webp`),t.load.image("superChargeAnim_2",`${l}/images/gameItems/animations/Scroll_Backspash02-hd.webp`),t.load.image("superChargeAnim_3",`${l}/images/gameItems/animations/Scroll_Backspash03-hd.webp`),t.load.image("soulHarvestAnim_1",`${l}/images/gameItems/animations/SoulHarvest_Explosion01-hd.webp`),t.load.image("soulHarvestAnim_2",`${l}/images/gameItems/animations/SoulHarvest_Explosion02-hd.webp`),t.load.image("soulHarvestAnim_3",`${l}/images/gameItems/animations/SoulHarvest_Explosion03-hd.webp`),t.load.image("infernoAnim_1",`${l}/images/gameItems/animations/Inferno_Fireball01-hd.webp`),t.load.image("infernoAnim_2",`${l}/images/gameItems/animations/Inferno_Fireball02-hd.webp`),t.load.image("infernoAnim_3",`${l}/images/gameItems/animations/Inferno_Fireball03-hd.webp`),t.load.image("infernoAnim_4",`${l}/images/gameItems/animations/Inferno_Fireball04-hd.webp`),t.load.image("infernoAnim_5",`${l}/images/gameItems/animations/Inferno_Fireball05-hd.webp`),t.load.image("infernoAnim_6",`${l}/images/gameItems/animations/Inferno_Fireball06-hd.webp`),t.load.image("infernoShockWave",`${l}/images/factions/council/Inferno_Shockwave01-hd.webp`),t.load.image("soulHarvestShockWave",`${l}/images/factions/darkElves/SoulHarvest_Shockwave01-hd.webp`),t.load.image("smokeAnim_1",`${l}/images/gameItems/animations/NinjaSmoke_Puff01-hd.webp`),t.load.image("smokeAnim_2",`${l}/images/gameItems/animations/NinjaSmoke_Puff02-hd.webp`),t.load.image("smokeAnim_3",`${l}/images/gameItems/animations/NinjaSmoke_Puff03-hd.webp`),t.load.image("reviveAnim_1",`${l}/images/gameItems/animations/Revive_Backsplash01-hd.webp`),t.load.image("reviveAnim_2",`${l}/images/gameItems/animations/Revive_Backsplash02-hd.webp`),t.load.image("reviveAnim_3",`${l}/images/gameItems/animations/Revive_Backsplash03-hd.webp`),t.load.image("phantomSpawnAnim_1",`${l}/images/gameItems/animations/PhantomSpawn_Explosion01-hd.webp`),t.load.image("phantomSpawnAnim_2",`${l}/images/gameItems/animations/PhantomSpawn_Explosion02-hd.webp`),t.load.image("priestessDebuff",`${l}/images/gameItems/animations/MoveDebuff_PurpleGlow-hd.webp`),t.load.image("annihilatorDebuff",`${l}/images/factions/dwarves/ArmorDebuff2_ShieldBroken1-hd.png`),t.load.image("shield",`${l}/images/factions/dwarves/EngineerShield_Color-hd.png`),t.load.image("crystalFull",`${l}/images/gameItems/crystal_full.webp`),t.load.image("pedestal",`${l}/images/gameItems/crystal_pedestal.webp`),t.load.image("crystalDamaged",`${l}/images/gameItems/crystal_damaged.webp`),t.load.image("crystalDebuff_1",`${l}/images/gameItems/animations/CrystalDebuff1_BgFlames01-hd.webp`),t.load.image("crystalDebuff_2",`${l}/images/gameItems/animations/CrystalDebuff1_BgFlames02-hd.webp`),t.load.image("crystalDebuff_3",`${l}/images/gameItems/animations/CrystalDebuff2_BgFlames01-hd.webp`),t.load.image("crystalDebuff_4",`${l}/images/gameItems/animations/CrystalDebuff2_BgFlames02-hd.webp`),t.load.image("crystalCardPic",`${l}/images/profilePics/crystalIcon.webp`);const a=["archer","cleric","knight","ninja","wizard"],e=["priestess","impaler","necromancer","phantom","voidmonk","wraith"],i=["paladin","engineer","gunner","grenadier","annihilator"];a.forEach(s=>{for(let n=1;n<=9;n++)t.load.image(`${s}_${n}`,`${l}/images/factions/council/${s}/${s}_${n}.webp`);t.load.image(`${s}CardPic`,`${l}/images/profilePics/${s}_v1-hd.webp`)}),e.forEach(s=>{if(s!==g.PHANTOM)for(let n=1;n<=9;n++)t.load.image(`${s}_${n}`,`${l}/images/factions/darkElves/${s}/${s}_${n}.webp`);else t.load.image(`${s}_1`,`${l}/images/factions/darkElves/${s}/${s}_1.webp`);t.load.image(`${s}CardPic`,`${l}/images/profilePics/${s}_v1-hd.webp`)}),i.forEach(s=>{for(let n=1;n<=9;n++)t.load.image(`${s}_${n}`,`${l}/images/factions/dwarves/${s}/${s}_${n}.webp`);t.load.image(`${s}CardPic`,`${l}/images/profilePics/${s}_v1-hd.webp`)}),Object.entries(S).forEach(([s,n])=>{t.load.image(`${n}CardPic`,`${l}/images/profilePics/${n}Icon.webp`)}),t.load.image("dragonScale",`${l}/images/factions/council/dragon_scale.webp`),t.load.image("inferno",`${l}/images/factions/council/inferno.webp`),t.load.image("healingPotion",`${l}/images/factions/council/healing_potion.webp`),t.load.image("soulStone",`${l}/images/factions/darkElves/soul_stone.webp`),t.load.image("soulHarvest",`${l}/images/factions/darkElves/soul_harvest.webp`),t.load.image("manaVial",`${l}/images/factions/darkElves/mana_vial.webp`),t.load.image("dwarvernBrew",`${l}/images/factions/dwarves/Ale-hd.png`),t.load.image("pulverizer",`${l}/images/factions/dwarves/ShatterDrill_Icon-hd.png`),t.load.image("superCharge",`${l}/images/factions/common/super_charge.webp`),t.load.image("runeMetal",`${l}/images/factions/common/rune_metal.webp`),t.load.image("shiningHelm",`${l}/images/factions/common/shining_helm.webp`),t.load.image("attackReticle",`${l}/images/gameItems/attack_reticle.webp`),t.load.image("healReticle",`${l}/images/gameItems/heal_reticle.webp`),t.load.image("allyReticle",`${l}/images/gameItems/ally_reticle.webp`),t.load.image("blockedLOS",`${l}/images/gameItems/blocked_los.webp`),t.load.image("HpBackground",`${l}/images/gameItems/hp_background.webp`),t.load.image("HpAlly",`${l}/images/gameItems/hp_green.webp`),t.load.image("HpEnemy",`${l}/images/gameItems/hp_red.webp`),t.load.atlas("greenFont",`${l}/fonts/green_font.png`,`${l}/fonts/green_font.json`),t.load.atlas("redFont",`${l}/fonts/red_font.png`,`${l}/fonts/red_font.json`),t.load.image("cardBackground",`${l}/images/gameItems/card/HelpTooltip_BG-hd.webp`),t.load.image("cardSeparator",`${l}/images/gameItems/card/HelpTooltip_Separator.webp`),t.load.image("hpBackground",`${l}/images/gameItems/card/HelpTooltip_InsetHP-hd.webp`),t.load.image("hpBar",`${l}/images/gameItems/card/HelpTooltip_HPBar-hd.webp`),t.load.image("magicalDamage",`${l}/images/gameItems/card/TooltipIcon_MagicDmg-hd.webp`),t.load.image("physicalDamage",`${l}/images/gameItems/card/TooltipIcon_PhysDmg-hd.webp`),t.load.image("magicalResistance",`${l}/images/gameItems/card/TooltipIcon_MagicRes-hd.webp`),t.load.image("physicalResistance",`${l}/images/gameItems/card/TooltipIcon_PhysDef-hd.webp`),t.load.image("movementRange",`${l}/images/gameItems/card/TooltipIcon_Movement-hd.webp`),t.load.image("attackRange",`${l}/images/gameItems/card/TooltipIcon_Range-hd.webp`),t.load.image("movementSquare",`${l}/images/gameItems/card/TooltipIcon_MovementTile-hd.webp`),t.load.image("attackSquare",`${l}/images/gameItems/card/TooltipIcon_RangeTile-hd.webp`),t.load.image("hpIcon",`${l}/images/gameItems/card/HelpTooltip_HP-hd.webp`),t.load.audio("resignSound",`${l}/audio/ui/resignGame.mp3`),t.load.audio("resetTurnSound",`${l}/audio/ui/turnReset.mp3`),t.load.audio("selectHeroFromHandSound",`${l}/audio/game/Game_Pickup_CharacterTile_Generic.mp3`),t.load.audio("selectHeroFromBoardSound",`${l}/audio/game/Game_Select_Character.mp3`),t.load.audio("spawnHeroSound",`${l}/audio/game/Game_Place_CharacterTile.mp3`),t.load.audio("moveHeroSound",`${l}/audio/game/Game_Release_ToMove_Character.mp3`),t.load.audio("moveFlySound",`${l}/audio/game/Character_Movement_Flying.mp3`),t.load.audio("moveWalkSound",`${l}/audio/game/Character_Movement_Steps.mp3`),t.load.audio("stompSound",`${l}/audio/game/KO_Player_Stomp.mp3`),t.load.audio("vanishSound",`${l}/audio/game/KO_Player_Vanish.mp3`),t.load.audio("reviveHeroSound",`${l}/audio/game/Game_Revive.mp3`),t.load.audio("healSound",`${l}/audio/game/Civ_Cleric_Heal.mp3`),t.load.audio("healExtraSound",`${l}/audio/game/Game_Heal.mp3`),t.load.audio("selectScrollSound",`${l}/audio/game/Game_Touch_Scroll.mp3`),t.load.audio("selectRuneMetalSound",`${l}/audio/game/Touch_Sword.mp3`),t.load.audio("selectDragonScaleSound",`${l}/audio/game/Touch_Shield.mp3`),t.load.audio("selectItemGenericSound",`${l}/audio/game/Touch_Generic.mp3`),t.load.audio("selectPotionSound",`${l}/audio/game/Touch_Potion.mp3`),t.load.audio("useScrollSound",`${l}/audio/game/Game_Use_Scroll.mp3`),t.load.audio("useRuneMetalSound",`${l}/audio/game/Game_Equip_Sword.mp3`),t.load.audio("useDragonScaleSound",`${l}/audio/game/Deploy_Shield.mp3`),t.load.audio("useItemGenericSound",`${l}/audio/game/Deploy_Generic.mp3`),t.load.audio("usePotionSound",`${l}/audio/game/Deploy_Potion.mp3`),t.load.audio("useInfernoSound",`${l}/audio/game/Game_FireBomb_Activate.mp3`),t.load.audio("swordTileSound",`${l}/audio/game/Game_Land_Sword.mp3`),t.load.audio("shieldTileSound",`${l}/audio/game/Game_Land_Shield.mp3`),t.load.audio("helmTileSound",`${l}/audio/game/Tile_Resist_Magic.mp3`),t.load.audio("crystalTileSound",`${l}/audio/game/Game_Land_X.mp3`),t.load.audio("newItemsSound",`${l}/audio/game/UI_Door_KickOpenClose.mp3`),t.load.audio("returnItemSound",`${l}/audio/game/UI_Game_Chest_Tap.mp3`),t.load.audio("damageCrystal1Sound",`${l}/audio/game/Game_Crystal_Damage_1.mp3`),t.load.audio("damageCrystal2Sound",`${l}/audio/game/Game_Crystal_Damage_2.mp3`),t.load.audio("destroyCrystalSound",`${l}/audio/game/Game_Crystal_Destroy.mp3`),t.load.audio("winSFXSound",`${l}/audio/game/Game_Win_SFX_01.mp3`),t.load.audio("loseSFXSound",`${l}/audio/game/Game_Lose_SFX_01.mp3`),t.load.audio("archerAttackSound",`${l}/audio/council/Civ_Archer_Attack_Arrow.mp3`),t.load.audio("archerAttackBigSound",`${l}/audio/council/Civ_Human_Archer_BigAttack.mp3`),t.load.audio("archerAttackMeleeSound",`${l}/audio/council/Civ_Human_Archer_Attack_CloseRange.mp3`),t.load.audio("archerDeathSound",`${l}/audio/council/Civ_Death_Archer_Element.mp3`),t.load.audio("clericAttackSound",`${l}/audio/council/Civ_Human_Cleric_Attack_CloseRange.mp3`),t.load.audio("clericAttackBigSound",`${l}/audio/council/Civ_Human_Cleric_AttackBig.mp3`),t.load.audio("clericDeathSound",`${l}/audio/council/Civ_Death_Cleric_Element.mp3`),t.load.audio("knightAttackSound",`${l}/audio/council/Civ_Knight_Attack.mp3`),t.load.audio("knightAttackBigSound",`${l}/audio/council/Civ_Human_Fighter_BigAttack.mp3`),t.load.audio("knightDeathSound",`${l}/audio/council/Civ_Death_Knight_Element.mp3`),t.load.audio("ninjaAttackSound",`${l}/audio/council/Civ_Human_Ninja_Attack_CloseRange.mp3`),t.load.audio("ninjaAttackBigSound",`${l}/audio/council/Civ_Human_Ninja_AttackBig.mp3`),t.load.audio("ninjaAttackRangedSound",`${l}/audio/council/Civ_Ninja_ThrowingStar_Attack.mp3`),t.load.audio("ninjaDeathSound",`${l}/audio/council/Civ_Death_Ninja_Element.mp3`),t.load.audio("ninjaSmokeSound",`${l}/audio/council/Civ_Ninja_Deploy_SmokeBomb.mp3`),t.load.audio("wizardAttackSound",`${l}/audio/council/Civ_Wizard_Attack.mp3`),t.load.audio("wizardAttackBigSound",`${l}/audio/council/Civ_Human_Wizard_BigAttack.mp3`),t.load.audio("wizardDeathSound",`${l}/audio/council/Civ_Death_Wizard_Element.mp3`),t.load.audio("selectInfernoSound",`${l}/audio/council/Game_FireBomb_Grab_Tile.mp3`),t.load.audio("priestessAttackSound",`${l}/audio/elves/DE-Heretic_Attack_Curse.mp3`),t.load.audio("priestessDeathSound",`${l}/audio/elves/DE-Heretic_Death.mp3`),t.load.audio("impalerAttackSound",`${l}/audio/elves/DE-Impaler_Attack_Throw_Spear.mp3`),t.load.audio("impalerAttackBigSound",`${l}/audio/elves/DE-Impaler_BigAttack.mp3`),t.load.audio("impalerAttackMeleeSound",`${l}/audio/elves/DE-Impaler_Melee_Attack.mp3`),t.load.audio("impalerDeathSound",`${l}/audio/elves/DE-Impaler_Death.mp3`),t.load.audio("necroAttackSound",`${l}/audio/elves/DE-Necro_Attack.mp3`),t.load.audio("necroAttackBigSound",`${l}/audio/elves/DE-Necro_AttackBig.mp3`),t.load.audio("necromancerDeathSound",`${l}/audio/elves/DE-Heretic_Death.mp3`),t.load.audio("phantomSpawnSound",`${l}/audio/elves/DE-Phantom_Spawn.mp3`),t.load.audio("phantomDeathSound",`${l}/audio/elves/DE-Phantom_Death.mp3`),t.load.audio("voidmonkAttackSound",`${l}/audio/elves/DE-VoidMonk_Attack_Punch.mp3`),t.load.audio("voidmonkAttackBigSound",`${l}/audio/elves/DE-VoidMonk_AttackBig.mp3`),t.load.audio("voidmonkDeathSound",`${l}/audio/elves/DE-VoidMonk_Death.mp3`),t.load.audio("wraithSpawnSound",`${l}/audio/elves/DE-Wraith_Birth.mp3`),t.load.audio("wraithAttackSound",`${l}/audio/elves/Civ_DarkElf_Attack_Spell_1.mp3`),t.load.audio("wraithAttackBigSound",`${l}/audio/elves/DE-Wraith_BigAttack.mp3`),t.load.audio("wraithDeathSound",`${l}/audio/elves/DE-Wraith_Death.mp3`),t.load.audio("wraithConsumeSound",`${l}/audio/elves/DE-Wraith_Consume.mp3`),t.load.audio("useHarvestSound",`${l}/audio/elves/Civ_DarkElf_Inferno_Explosion.mp3`),t.load.audio("paladinHealSound",`${l}/audio/dwarves/DWF_Paladin_Heal.mp3`),t.load.audio("paladinAttackSound",`${l}/audio/dwarves/DWF_Paladin_Melee.mp3`),t.load.audio("paladinAttackBigSound",`${l}/audio/dwarves/DWF_Paladin_Special.mp3`),t.load.audio("engineerAttackSound",`${l}/audio/dwarves/DWF_Engineer_Attack_Melee.mp3`),t.load.audio("engineerAttackBigSound",`${l}/audio/dwarves/DWF_Engineer_BigAttack.mp3`),t.load.audio("engineerShieldMake",`${l}/audio/dwarves/DWF_Engineer_Cast_Shield_Buff.mp3`),t.load.audio("engineerShieldBreak",`${l}/audio/dwarves/DWF_Engineer_Shield_Shatter.mp3`),t.load.audio("grenadierAttack",`${l}/audio/dwarves/DWF_Grenadier_Attack_Throw_01.mp3`),t.load.audio("grenadierAttackBig",`${l}/audio/dwarves/DWF_Grenadier_Attack_Throw_01.mp3`),t.load.audio("grenadierAttackMelee",`${l}/audio/dwarves/DWF_Grenadier_Melee.mp3`),t.load.audio("grenadierDeath",`${l}/audio/dwarves/DWF_Grenadier_Bomb_Catch.mp3`),t.load.audio("gunnerAttack",`${l}/audio/dwarves/DWF_Gunner_Attack_Rifle_rev1.mp3`),t.load.audio("gunnerJump",`${l}/audio/dwarves/DWF_Gunner_Jump.mp3`),t.load.audio("gunnerAttackGunOnly",`${l}/audio/dwarves/DWF_Gunner_Attack_Rifle_01.mp3`),t.load.audio("gunnerDeath",`${l}/audio/dwarves/DWF_Gunner_KO.mp3`),t.load.audio("annihilatorShoot",`${l}/audio/dwarves/DWF_Bazooka_Fire.mp3`),t.load.audio("annihilatorHit",`${l}/audio/dwarves/DWF_Bazooka_Fire.mp3`),t.load.audio("annihilatorWindup",`${l}/audio/dwarves/DWF_Bazooka_Fire.mp3`),t.load.audio("brewSelect",`${l}/audio/dwarves/DWF_Item_Pickup_Beer.mp3`),t.load.audio("brewUse",`${l}/audio/dwarves/DWF_Item_Beer_Use.mp3`),t.load.audio("drillSelect",`${l}/audio/dwarves/DWF_Item_Pickup_Drill.mp3`),t.load.audio("drillUse",`${l}/audio/dwarves/DWF_Item_Drill.mp3`)}class ni extends Phaser.Scene{constructor(){super({key:"GameScene"});o(this,"userId");o(this,"colyseusClient");o(this,"centerPoints");o(this,"currentRoom");o(this,"currentGame");o(this,"currentTurnAction");o(this,"turnNumber");o(this,"activeUnit");o(this,"gameController");o(this,"activePlayer");o(this,"isPlayerOne");o(this,"opponentId");o(this,"player1");o(this,"player2");o(this,"longPressStart");o(this,"visibleUnitCard");o(this,"triggerReplay",!0);o(this,"chatComponent");this.centerPoints=ai()}init(e){var s;this.userId=e.userId,this.colyseusClient=e.colyseusClient,this.turnNumber=e.currentGame.turnNumber,this.currentGame=e.currentGame,this.currentRoom=e.currentRoom;const i=e.currentGame.players.find(n=>e.userId!==n.userData._id);this.opponentId=i.userData._id,this.triggerReplay=e.triggerReplay??!0,this.activePlayer=this.currentGame.activePlayer.toString(),this.isPlayerOne=((s=this.currentGame)==null?void 0:s.players[0].userData._id)===this.userId,this.currentTurnAction=this.turnNumber===0?3:1}preload(){this.load.html("chatComponent","html/chat.html"),si(this),ii(this)}create(){this.time.addEvent({delay:3e5,callback:()=>{this.currentRoom.send("ping")},loop:!0}),this.registry.get("userPreferences").chat&&(this.chatComponent=ba(this)),this.input.mouse.disableContextMenu(),this.gameController=new ei(this),this.triggerReplay&&this.gameController.replayTurn(),this.game.events.on("messageToGameScene",i=>{const{x:s,y:n,message:r}=i,c=Ue(this,s,n,r);Re(c,3e3)})}onShutdown(){this.sound.stopAll()}}class ge extends Phaser.GameObjects.Container{constructor(e,i){const s={x:350,y:50};super(e,0,0);o(this,"header");o(this,"rows");o(this,"paginationBar");o(this,"context");this.context=e;const n={fontFamily:"proLight",color:"#ffffff",wordWrap:{width:190,useAdvancedWrap:!0}},r={...n,fontSize:45},c={...n,fontSize:35};this.header=e.add.container(s.x,s.y);const h=e.add.text(100,0,"Username",r),d=e.add.text(320,0,"Games",r),u=e.add.text(520,0,"Wins",r),p=e.add.text(720,0,"Council",r),y=e.add.text(920,0,"Elves",r);this.header.add([h,d,u,p,y]),s.y+=20,this.rows=i.players.map(I=>{s.y+=50;const F=e.add.container(s.x,s.y),V=e.add.text(100,0,be(I.username,13),c),te=e.add.text(350,0,`${I.stats.totalGames}`,c),H=e.add.text(550,0,`${I.stats.totalWins}`,c),U=e.add.text(750,0,`${I.stats.councilWins}`,c),K=e.add.text(950,0,`${I.stats.elvesWins}`,c),W=e.add.image(1030,15,"challengeIcon").setInteractive({useHandCursor:!0});return W.on("pointerdown",()=>{f(this.scene,w.BUTTON_GENERIC),new Ye({context:e,username:I.username,challengeType:he.SEND,opponentId:I._id})}),I._id===e.userId&&W.setVisible(!1).disableInteractive(),F.add([V,te,H,U,K,W]),F});let T=i.currentPage;const P=730,C=900;this.paginationBar=e.add.container(C,P+10);const D=e.add.text(0,0,`${T} / ${i.totalPages}`,r).setOrigin(.5),O=e.add.image(-180,0,"arrowButton").setFlipX(!0).setScale(.7).setVisible(T>1),M=e.add.image(-120,0,"curvedArrowButton").setScale(.7).setVisible(T>1),J=e.add.image(120,0,"curvedArrowButton").setFlipX(!0).setScale(.7).setVisible(T!==i.totalPages),G=e.add.image(180,0,"arrowButton").setScale(.7).setVisible(T!==i.totalPages);O.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{if(this.scene.sound.play(w.BUTTON_GENERIC),T>1){const I=await pe(1);I&&(new ge(this.context,I),this.destroy())}}),M.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{if(this.scene.sound.play(w.BUTTON_GENERIC),T>1){const I=await pe(--T);I&&(new ge(this.context,I),this.destroy())}}),J.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{this.scene.sound.play(w.BUTTON_GENERIC);const I=await pe(++T);I&&(new ge(this.context,I),this.destroy())}),G.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{if(this.scene.sound.play(w.BUTTON_GENERIC),T!==i.totalPages){const I=await pe(i.totalPages);I&&(new ge(this.context,I),this.destroy())}}),this.paginationBar.add([O,M,D,J,G]),this.add([this.header,...this.rows,this.paginationBar]),this.context.add.existing(this)}}function oi(t){t.load.image("challengeIcon",`${l}/images/gameItems/card/TooltipIcon_PhysDmg-hd.webp`),t.load.image("arrowButton",`${l}/ui/arrow_button.webp`),t.load.image("curvedArrowButton",`${l}/ui/curved_arrow_button.webp`),t.load.image(B.COUNCIL,`${l}/ui/council_emblem.webp`),t.load.image(B.DARK_ELVES,`${l}/ui/elves_emblem.webp`)}class ri extends Phaser.Scene{constructor(){super({key:"LeaderboardScene"});o(this,"userId")}init(e){this.userId=e.userId}preload(){oi(this)}async create(){this.add.image(396,14,"gameBackground").setOrigin(0,0).setScale(1.07,1.2);const e=await pe();e&&new ge(this,e)}onShutdown(){this.sound.stopAll()}}const rt={x:800,y:400};class li extends Phaser.GameObjects.Container{constructor(e,i){super(e,rt.x,rt.y);o(this,"blockingLayer");o(this,"backgroundImage");o(this,"okButtonImage");o(this,"cancelButtonImage");o(this,"popupText");o(this,"okButtonText");o(this,"cancelButtonText");this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=e.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.okButtonImage=e.add.image(-90,60,"popupButton").setTint(10027008).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.cancelButtonImage=e.add.image(90,60,"popupButton").setTint(31743).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.popupText=e.add.text(0,-50,"Delete account? All data will be lost",{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.okButtonText=e.add.text(-90,60,"DELETE",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cancelButtonText=e.add.text(90,60,"CANCEL",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.okButtonImage.on("pointerdown",async()=>{f(this.scene,w.BUTTON_GENERIC),this.setVisible(!1),await i.handleDelete()}),this.cancelButtonImage.on("pointerdown",()=>{this.scene.sound.play(w.BUTTON_FAILED),this.setVisible(!1),i.toggleFormVisibility(!0)}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.okButtonImage,this.okButtonText,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}}class ci extends Phaser.GameObjects.Container{constructor(e,i){super(e,900,400);o(this,"visibleFlag");const s=new Phaser.GameObjects.Container(e,0,0),n=e.add.rectangle(0,0,3e3,2e3,0,.001).setOrigin(.5).setInteractive(),r=600,c=500,h=256*.4,d=10,u=4,p=e.add.rectangle(0,0,r,c,2236962,1).setStrokeStyle(2,16777215);s.add(p);const y=new Phaser.GameObjects.Container(e,-600/2+d,-500/2+d);s.add(y);const T=[],P=()=>{const H=-250+d+25,U=H+(c-60);T.forEach(K=>{var Z;const W=K.y+y.y;W+K.displayHeight>H&&W<U?(Z=K.input)!=null&&Z.enabled||K.setInteractive({useHandCursor:!0}):K.disableInteractive()})};Oe.forEach((H,U)=>{const K=Math.floor(U/u),X=U%u*(h+d),we=K*(h+d),Z=e.add.image(X+120,we-160,H).setInteractive({useHandCursor:!0}).setDisplaySize(h,h).setData("key",H);Z.on("pointerup",()=>{var se;te||!this.visibleFlag||(e.userData.picture=H,i.setTexture(H).setDisplaySize(256*.5,256*.5),this.setVisible(!1),(se=e.profile)==null||se.toggleFormVisibility(!0))}),T.push(Z),y.add(Z)});const C=this.x+y.x,D=this.y+y.y,O=e.make.graphics({});O.fillStyle(16777215),O.fillRect(C,D+25,r-2*d,c-60);const M=new Phaser.Display.Masks.GeometryMask(e,O);y.setMask(M);const I=-(Math.ceil(Oe.length/u)*(h+d))+c-2*d-100;y.y=0,P(),e.input.on("wheel",(H,U,K,W,X)=>{this.visible&&(y.y-=W*1,y.y=Phaser.Math.Clamp(y.y,I,0),P())});let F=!1,V=0,te=!1;e.input.on("pointerdown",H=>{this.visible&&(F=!0,V=H.y,te=!1)}),e.input.on("pointermove",H=>{if(!F)return;const U=H.y-V;Math.abs(U)>5&&(te=!0),y.y+=U*.7,y.y=Phaser.Math.Clamp(y.y,I,0),P(),V=H.y}),e.input.on("gameobjectup",()=>{F=!1,V=0,te=!1}),this.add([n,s]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this),this.visibleFlag=!0}}class hi extends Phaser.GameObjects.Container{constructor(e){var s,n,r,c;super(e,0,0);o(this,"context");o(this,"profilePicturePopup");o(this,"emailInput");o(this,"passwordInput");o(this,"passwordConfirmInput");o(this,"profileUpdateError");o(this,"profileUpdateSuccess");o(this,"notificationsCheckBox");o(this,"chatCheckBox");o(this,"soundCheckBox");o(this,"saveButtonImage");o(this,"saveButtonText");o(this,"deleteAccountButtonImage");o(this,"deleteAccountButtonText");o(this,"deletePopup");o(this,"profilePicture");o(this,"previousPicture");this.context=e,this.context.add.image(396,14,"gameBackground").setOrigin(0,0).setScale(1.07,1.2),this.context.add.text(800,40,"PROFILE",{fontFamily:"proHeavy",fontSize:80,color:"#ffffff"}),this.context.add.text(1e3,150,"PREFERENCES",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff"}),this.context.add.text(550,150,"DATA",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff"}),this.previousPicture=this.context.userData.picture,this.profilePicture=this.context.add.image(580,550,this.context.userData.picture).setDisplaySize(256*.5,256*.5).setInteractive({useHandCursor:!0}),this.profilePicture.on("pointerdown",()=>{this.profilePicturePopup.setVisible(!0),this.toggleFormVisibility(!1),this.bringToTop(this.profilePicturePopup)}),this.profilePicturePopup=new ci(this.context,this.profilePicture),this.emailInput=this.createInputField(600,230,"email","Email"),this.passwordInput=this.createInputField(600,290,"New password","password"),this.passwordConfirmInput=this.createInputField(600,350,"Confirm Password","password"),this.profileUpdateError=this.context.add.dom(450,380).createFromHTML(`
  <div id="profileError" class="proLightFont" style="color: white; font-size: 30px; margin-bottom: 10px; display: none; max-width: 500px; background-color: #8e0000; padding: 10px"></div>`),this.profileUpdateSuccess=this.context.add.dom(450,380).createFromHTML(`
  <div id="profileSuccess" class="proLightFont" style="color: white; font-size: 30px; margin-bottom: 10px; display: none; max-width: 500px; background-color: #14452f; padding: 10px"></div>`);const i=e.userData.preferences;this.notificationsCheckBox=this.createCheckbox(1150,230,"Email notifications",i.emailNotifications),this.chatCheckBox=this.createCheckbox(1087,290,"Enable chat",i.chat),this.soundCheckBox=this.createCheckbox(1103,350,"Enable sound",i.sound),e.add.text(1e3,390,"STATS",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff"}),e.add.text(1e3,440,`Games: ${(s=e.userData)==null?void 0:s.stats.totalGames}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),e.add.text(1e3,490,`Wins: ${(n=e.userData)==null?void 0:n.stats.totalWins}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),e.add.text(1e3,540,`Council wins: ${(r=e.userData)==null?void 0:r.stats.councilWins}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),e.add.text(1e3,590,`Elves wins: ${(c=e.userData)==null?void 0:c.stats.elvesWins}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),this.saveButtonImage=this.context.add.image(895,700,"popupButton").setTint(3381759).setDisplaySize(230,100).setInteractive({useHandCursor:!0}),this.saveButtonText=this.context.add.text(830,655,"SAVE CHANGES",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff",align:"center",wordWrap:{width:150,useAdvancedWrap:!0}}),this.saveButtonImage.on("pointerdown",async()=>{f(this.scene,w.BUTTON_GENERIC),await this.handleSubmit()}),this.loadUserData(),this.deletePopup=new li(e,this),this.deleteAccountButtonImage=this.context.add.image(1265,700,"popupButton").setTint(10027008).setDisplaySize(230,100).setInteractive({useHandCursor:!0}),this.deleteAccountButtonText=this.context.add.text(1200,655,"DELETE ACCOUNT",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff",align:"center",wordWrap:{width:150,useAdvancedWrap:!0}}),this.deleteAccountButtonImage.on("pointerdown",()=>{f(this.scene,w.BUTTON_GENERIC),console.log("Clicked on delete account"),this.toggleFormVisibility(!1),this.deletePopup.setVisible(!0)}),this.add([this.emailInput,this.passwordInput,this.passwordConfirmInput,this.profileUpdateError,this.profileUpdateSuccess,this.notificationsCheckBox,this.chatCheckBox,this.soundCheckBox,this.saveButtonImage,this.saveButtonText,this.deleteAccountButtonImage,this.deleteAccountButtonText,this.profilePicturePopup]),this.bringToTop(this.profilePicturePopup),this.context.add.existing(this)}createInputField(e,i,s,n,r=""){const c=`
    <input
      type="${n}"
      placeholder="${s}"
      value="${r}"
      style="font-size:25px; width: 300px; height: 30px; font-family: proLight"
    />
  `;return this.context.add.dom(e,i).createFromHTML(c)}createCheckbox(e,i,s,n){return this.context.add.dom(e,i).createFromHTML(`
      <label style="color:white; font-size: 50px; font-family: proLight">
        <input type="checkbox" ${n?"checked":""} style="width: 35px; height: 35px;"/> ${s}
      </label>
    `)}loadUserData(){this.emailInput.getChildByName("").value=this.context.userData.email,this.notificationsCheckBox.getChildByName("").checked=this.context.userData.preferences.emailNotifications,this.chatCheckBox.getChildByName("").checked=this.context.userData.preferences.chat,this.soundCheckBox.getChildByName("").checked=this.context.userData.preferences.sound}async handleSubmit(){var p,y,T,P,C;this.profileUpdateError.setVisible(!1),this.profileUpdateSuccess.setVisible(!1);const e=this.emailInput.getChildByName("").value,i=this.passwordInput.getChildByName("").value,s=this.passwordConfirmInput.getChildByName("").value,n=this.notificationsCheckBox.getChildByName("").checked,r=this.chatCheckBox.getChildByName("").checked,c=this.soundCheckBox.getChildByName("").checked;if(!this.emailInput.node.querySelector("input").checkValidity()){this.showForm(this.profileUpdateError,"profileError","Incorrect email format");return}if(i.trim()!==""){if(i!==s){this.showForm(this.profileUpdateError,"profileError","Passwords do not match");return}if(!ht(i)){this.showForm(this.profileUpdateError,"profileError","Password must be at least 8 characters long and contain a letter and a number");return}}const d={};if(e&&e!==((p=this.context.userData)==null?void 0:p.email)&&(d.email=e),i&&i.trim()!==""&&(d.password=i),n!==void 0&&n!==((y=this.context.userData)==null?void 0:y.preferences.emailNotifications)&&(d.emailNotifications=n),r!==void 0&&r!==((T=this.context.userData)==null?void 0:T.preferences.chat)&&(d.chat=r),c!==void 0&&c!==((P=this.context.userData)==null?void 0:P.preferences.sound)&&(d.sound=c),((C=this.context.userData)==null?void 0:C.picture)!==this.previousPicture&&(d.picture=this.context.userData.picture),Object.keys(d).length===0)return;const u=await Ba(d);u.success?(console.log("Profile updated"),this.showForm(this.profileUpdateSuccess,"profileSuccess","Profile successfully updated"),this.context.userData=u.user,this.scene.registry.set("userPreferences",{chat:u.user.preferences.chat,sound:u.user.preferences.sound}),this.scene.sound.mute=!u.user.preferences.sound):(this.loadUserData(),this.profilePicture.setTexture(this.previousPicture),this.showForm(this.profileUpdateError,"profileError",u.error))}async handleDelete(){(await La()).success&&this.context.scene.start("MainMenuScene")}toggleFormVisibility(e){this.emailInput.setVisible(e),this.passwordInput.setVisible(e),this.passwordConfirmInput.setVisible(e),this.notificationsCheckBox.setVisible(e),this.chatCheckBox.setVisible(e),this.soundCheckBox.setVisible(e),this.profileUpdateError.setVisible(e),this.profileUpdateSuccess.setVisible(e)}showForm(e,i,s){var r;e.setVisible(!0);const n=(r=e.getChildByID)==null?void 0:r.call(e,i);n&&(n.innerText=s,n.style.display="block")}hideForm(e,i){var n;const s=(n=e.getChildByID)==null?void 0:n.call(e,i);s&&(s.innerText="",s.style.display="none")}}class di extends Phaser.Scene{constructor(){super({key:"ProfileScene"});o(this,"userId");o(this,"profile");o(this,"userData")}init(e){this.userId=e.userId}preload(){Oe.forEach(e=>{this.load.image(e,`${l}/images/profilePics/${e}.webp`)})}async create(){this.userData=await Na(),this.profile=new hi(this)}onShutdown(){console.log("Profile scene shutdown logs, remove"),this.sound.stopAll()}}const ui=`Fan Academy is a fan-made revival of the game Hero Academy, a turn-based tactics game developed by Robot Entertainment. This project aims to bring back the joy of the original game, offering a way for fans to rediscover it.

This is not a reverse engineering of the game. The game logic is being implemented from scratch while using the original assets to try to preserve the game's aesthetic as much as possible.`,mi="Hero Academy is a player-versus-player turn-based tactics game where players choose a team of heroes and use their units and items to defeat their opponents. Unfortunately, the game is currently deadf, delisted from all stores and its online servers shut down. It is no longer possible for people who purchased the game to play it.",gi="This project includes proprietary assets from Hero Academy, which are the property of Robot Entertainment. These assets are used for educational and non-commercial purposes under the assumption of fair use for a fan project. This license applies only to the code in this repository and not to the assets. All rights to the proprietary assets remain with their respective owners.",fi=`You can create a game by clicking on the icon of the faction you want to play as. Matchmaking happens automatically: if there is already a game looking for players, you will be paired immediately. If not, you will see your game under the "Looking for games" section.

Games in the game list are organized on sections based on their status. Here's the order in which they appear in the game list:

-Your turn: You should probably click on these and play your turn.

-Challenges received: Click on these games to select a faction and start playing against the player who challenged you. You can also decline by clicking the X button on the top-right corner of the game.

-Opponent's turn. Your opponent should probably click on those and play their turn.

-Searching for players: As mentioned earlier, these are open games created by you. When another player looks for a game they will be paired with you. If you don't want to search for a game anymore, you can click the X button on the top-right corner of the game to delete it.

-Challenges sent: These games are waiting for the player you challenged to pick a faction or decline the challenge. You can remove the challenge by, you guessed it, clicking on the X button on the top-right corner of the game.

-Finished: Here you will find your 5 more recent finished games. You can click on a game to see the final game state and challenge your opponent to a rematch.

Please note that one ore more of these categories may not be present in your game if you don't have any games that qualify. E.g., you won't see a "Challenges sent" category if you have not sent any challenges.

You can come back to the main menu by clicking on the "Home" button.`,pi=`Here you can update your email, password, profile pics and communication preferences. No changes are saved until you click on the "Save changes" button.

-Email preferences: The game sends an email when it's your turn to play, when a game ends and when you receive a challenge. If you don't wish to receive emails, leave the checkbox blank. Note: An email confirmation email was sent to you when you created the account. If you have not confirmed your email, you will not receive email notifications, even if the checkbox is ticked.

-Enable chat: Having this option checked allows people to message you in the in-game chat. Or it will, once I add an in-game chat to the game.

-Delete account: Clicking on this button will open a confirmation popup. Deleting your account is irreversible, I have no way to recover your data.`,yi=`Shows a list of all players, sorted by number of victories. If two or more players have the same amount of wins, the player with the fewer played games appears above.

You can send a challenge to a player from the leaderboard by clicking the sword icon on the right hand side of the screen. You will be prompted to pick a faction before sending the challenge.`,Ti=`If you are new to Hero Academy, here you will find resources to learn how to play. Fan Academy plays exactly the same than Hero Academy. And if it doesn't, please let me know.

The information below is taken from a guide written by Hamlet on his defunct site, iam.yellingontheinternet.com, thanks to the magic of the Internet Archive. I have edited some parts for clarification.`,bi=`Basic:

    • 5 action points (AP) per turn (3 AP for the first player on their first turn to balance first player advantage).

    • 1 AP can be used to:
    	- deploy a unit to deploy square
    	- move a unit
    	- attack an enemy unit or crystal
    	- heal or revive a friendly unit
    	- use a unit special ability
    	- equip a unit with an upgrade
    	- use a one-time item
    	- return a unit or item from your hand back into the deck (the door icon) to draw a random one next turn

    • A unit that reaches 0 HP is knocked out, but can be revived by an ally. It vanishes from the board permanently if:
    	- any player moves a unit onto it (“stomps” it)
    	- destroys it with certain spells
    	- its owner takes a full turn without reviving it

    • A player loses upon having all of his crystals destroyed, or by having all of the units in his deck stomped or knocked out (the game will end even if he has an item left that can revive a KO'd unit).

    • Units are drawn in random order throughout the game, except that your starting hand always has at least 3 units.

Map features:

    • Crystals. There are two per faction, each one with 4500 hp. Destroy both of your opponent's crystals to win the game.

    • Deploy square. Enemy units cannot move onto it, even to stomp. An enemy unit adjacent to a deploy square can attack a corpse that's on the square (which destroys it), without moving onto it. A Necromancer or Inferno can also destroy a KO'd unit on a deploy square.

    • Attack square (red sword). A unit on the square has +100 attack power, applied before all %-based bonuses.

    • Defense square (blue shield). A unit on the square has +20% physical resist.

    • Magic Defense square (dark blue helm). A unit on the square has +20% magical resist.

    • Assault square (purple gem). While a friendly unit is standing on this square, all attacks against enemy crystals do an extra 300 damage. Multiple assault bonuses stack. The bonus is reduced accordingly if the crystal takes AoE or chain damage. The bonus damage has no type and is not affected by any resist.

    • Teleport square (light blue dot). A unit on the square can use 1 AP to teleport to the other teleport square, if it is open.

Advanced:

    • Range is counted orthogonally only, not diagonally (e.g. a unit one square diagonally from another is at range 2).

    • Each unit has an attack power, and a damage type (physical or magical). • Ordinary attacks hit for damage equal to the unit's attack power, but some multiply by certain percentage or add other bonuses. The attack power is what's shown in the unit's info window.

    • Each target also has a physical and magical resist, which reduce incoming damage of the appropriate type by a fixed percentage.

    • Ranged attacks (but not ranged friendly actions) require line of sight to the target. Enemy units and crystals block line of sight, but friendly ones do not. An attack to an immediately diagonal square can't be blocked.

    • A unit that can act on a corpse (healer reviving a friendly corpse, or Necromancer/Wraith destroying an enemy one) can't choose to move and stomp the corpse instead. Clicking on the corpse causes the unit to act on it. However, if the unit does not have line of sight to the enemy corpse, it will move and stomp instead.

    • Knockbacks only occur if the target square is open, otherwise the unit simply doesn't move. If a unit is KO'd by the knockback, it still moves. A unit can't be knocked onto an enemy start tile, unless it's also KO'd (in which case an enemy spawning there will stomp it).

    • A unit can wind up on an enemy deploy square if it's KO'd onto it and then revived, or if it's a Wraith that spawned from a corpse on that square. It will block the enemy from deploying units there so long as it remains.
    • A corpse on its own deploy square will be stomped automatically if a friendly unit deploys there.

    • Units cannot target themselves with heals or other buffs.`,Ii=`Knight (3):
1000 HP
20% P resist
200 attack (P), range 1
Attack knocks target back one square.
Move 2

Archer (3):
800 HP
300 attack (P), range 3
50% damage in melee, 100% damage at range.
Move 2

Wizard (3):
800 HP
10% M resist
200 attack (M), range 2
Attack can hit up to 3 enemy units or crystals if they are adjacent. Main target takes 100% damage, first jump does 75%, second jump 56%.
Move 2

Cleric (3):
800 HP
200 attack (M), range 2
Heals for 300% attack, revives for 200% attack, range 2
Move 2

Ninja (1):
800 HP
200 attack (P), range 2.
200% damage in melee, 100% damage at range.
Can use 1 AP to swap places with any friendly unit.
Move 3`,Ai=`Upgrades:
-Sword (3): +50% attack
-Armor (3): +20% physical resist, +10% HP
-Helm (3): +20% magical resist, +10% HP

Consumables:
-Scroll (2): Targets one friendly. Unit has 300% attack power for one attack/heal.

-Inferno (2): Targets a 3×3 area. KO'd enemies are destroyed, and other enemies take 350 M.

-Potion (2): Targets one friendly. Heals for 1000. In addition, can revive a KO'd unit for 100.

Faction passive: None`,Ci=`Void Monk (3):
800 HP
20% P resist, 20% M resist
200 attack (P), range 1
100% damage to target, splashes for 66% damage to any enemies adjacent (not diagonal) to target.
Move 3

Impaler (3):
800 HP
300 attack (P), range 2
If target is at range 2 in a straight line, pulled one square towards Impaler.
Move 2

Necromancer (3):
800 HP
200 attack (M), range 3
Can use 1 AP to turn any KO'd unit into a Phantom at range 3, including on an enemy start tile.
Move 2

Priestess (3):
800 HP
200 attack (M), range 2
Heals for 200% attack, revives for 50% attack, range 3
An unit damaged by the Priestess has 50% attack power for its next attack/heal (doesn't affect Barbed Crystals).
Move 2

Wraith (1):
800 HP
250 attack (M), range 1.
Can use 1 AP to consume a KO'd unit at range 1. Increases current and max HP by 100 and attack power by 50 (bonus can only be obtained 3 times per game although you can continue to consume).
Can deploy onto any KO'd unit (stomping it) instead of a deploy tile, unless the KO'd unit is on an enemy deploy tile.
Move 3

Phantom:
100 HP
100 attack (M), range 1
Does not leave a corpse when killed.
If spawned on an enemy deploy tile, will be automatically destroyed if an enemy deploys there.
Move 3`,wi=`Upgrades:
-Sword (3): +50% attack
-Soulstone (3): Passive life leech increased to 66%, +10% HP (bonus applied to base -HP only)
-Helm (3): +20% magical resist, +10% HP (bonus applied to base HP only)

Consumables:
-Scroll (2): Targets one friendly. Unit has 300% attack power for one attack/heal.

-Soul Harvest (2): Targets a 3×3 area. Enemies take 100 M. All friendly units in play gain D/(N+3) current and max HP (reviving KO'd units in the process), where D is the total damage dealt to non-Crystal units by the spell, and N is the number of friendly units in play.

-Mana Vial (2): Targets one friendly. Heals for 1000 and increases max HP by 50.

Faction passive:
Units are healed for 33% of any damage they deal to enemy units (not crystals).`;function Si(t){const a=new Phaser.GameObjects.Container(t,420,25),e={fontFamily:"proLight",fontSize:35,color:"#ffffff",wordWrap:{width:1e3,useAdvancedWrap:!0}};return a.add(t.add.text(0,0,"Index",{...e,fontSize:50})),a.add(t.add.text(0,220,"What is Fan Academy?",{...e,fontSize:50})),a.add(t.add.text(0,280,ui,e)),a.add(t.add.text(0,540,"What is Hero Academy?",{...e,fontSize:50})),a.add(t.add.text(0,600,mi,e)),a.add(t.add.text(0,790,"Disclaimer for third-party assets",{...e,fontSize:50})),a.add(t.add.text(0,850,gi,e)),a.add(t.add.text(0,1030,"Menu guide",{...e,fontSize:50})),a.add(t.add.text(0,2050,fi,e)),a.add(t.add.text(0,4100,pi,e)),a.add(t.add.text(0,5e3,yi,e)),a.add(t.add.text(0,5250,"Game guide",{...e,fontSize:60})),a.add(t.add.text(0,5320,Ti,e)),a.add(t.add.text(0,5570,"General mechanics",{...e,fontSize:50})),a.add(t.add.text(0,5630,bi,e)),a.add(t.add.text(0,8660,"Factions",{...e,fontSize:60})),a.add(t.add.image(450,8890,"councilAbout")),a.add(t.add.text(0,9040,Ii,{...e,wordWrap:{width:700,useAdvancedWrap:!0}})),a.add(t.add.text(0,10230,Ai,e)),a.add(t.add.image(450,10950,"elvesAbout")),a.add(t.add.text(0,11110,Ci,{...e,wordWrap:{width:750,useAdvancedWrap:!0}})),a.add(t.add.text(0,12770,wi,e)),a}function Pi(t){let a=0;return t.iterate(e=>{const i=e.y+(e.height??0);i>a&&(a=i)}),a}function Ei(t,a,e,i,s){[{title:"Menu guide",y:1030},{title:"Game guide",y:5240},{title:"Factions",y:8660}].forEach((c,h)=>{const d=lt(t,c,h,60,a,e,i,s);a.add(d)}),[{title:"Play!",y:1210},{title:"Profile",y:3200},{title:"Leaderboard",y:4620}].forEach((c,h)=>{const d=lt(t,c,h,1090,a,e,i,s);a.add(d)})}function lt(t,a,e,i,s,n,r,c){const h=t.add.text(0,i+e*50,a.title,{fontFamily:"proLight",color:"#ffffff",fontSize:35,backgroundColor:"#00f",padding:{x:10}});return h.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{s.y=n-a.y;const d=n+(r-c);s.y=Phaser.Math.Clamp(s.y,d,n)}),h}function _i(t,a){a.add(t.add.image(87,1280,"aboutPlayButton").setScale(.5)),a.add(t.add.image(490,1690,"aboutPlayPage").setScale(.7)),a.add(t.add.image(170,3270,"aboutProfileButton")),a.add(t.add.image(490,3700,"aboutProfilePage")),a.add(t.add.image(170,4670,"aboutLeaderboardButton")),a.add(t.add.image(490,4860,"aboutLeaderboardPage"));const e=840;a.add(t.add.image(e,9130,"knightAbout").setScale(1.5)),a.add(t.add.image(e,9360,"archerAbout").setScale(1.5)),a.add(t.add.image(e,9560,"wizardAbout").setScale(1.5)),a.add(t.add.image(e,9845,"clericAbout").setScale(1.5)),a.add(t.add.image(e,10070,"ninjaAbout").setScale(1.5)),a.add(t.add.image(e,11210,"voidmonkAbout").setScale(1.5)),a.add(t.add.image(e,11460,"impalerAbout").setScale(1.5)),a.add(t.add.image(e,11680,"necromancerAbout").setScale(1.5)),a.add(t.add.image(e,11930,"priestessAbout").setScale(1.5)),a.add(t.add.image(e,12230,"wraithAbout").setScale(1.5)),a.add(t.add.image(e,12580,"phantomAbout").setScale(1.5))}function vi(t){t.load.image("archerAbout",`${l}/images/aboutImages/Archer_tile.webp`),t.load.image("clericAbout",`${l}/images/aboutImages/Cleric_tile.webp`),t.load.image("councilAbout",`${l}/images/aboutImages/Council_SplashScreen1.webp`),t.load.image("elvesAbout",`${l}/images/aboutImages/DarkElves_SplashScreen.webp`),t.load.image("impalerAbout",`${l}/images/aboutImages/Impaler_tile.webp`),t.load.image("knightAbout",`${l}/images/aboutImages/Knight_tile.webp`),t.load.image("necromancerAbout",`${l}/images/aboutImages/Necromancer_tile.webp`),t.load.image("ninjaAbout",`${l}/images/aboutImages/Ninja_tile.webp`),t.load.image("phantomAbout",`${l}/images/aboutImages/Phantom_tile.webp`),t.load.image("priestessAbout",`${l}/images/aboutImages/Priestess_tile.webp`),t.load.image("voidmonkAbout",`${l}/images/aboutImages/VoidMonk_tile.webp`),t.load.image("wizardAbout",`${l}/images/aboutImages/Wizard_tile.webp`),t.load.image("wraithAbout",`${l}/images/aboutImages/Wraith_tile.webp`),t.load.image("arrowAbout",`${l}/images/aboutImages/AvatarArrow-hd.webp`),t.load.image("aboutPlayButton",`${l}/images/aboutImages/play_button.webp`),t.load.image("aboutProfileButton",`${l}/images/aboutImages/profile_button.webp`),t.load.image("aboutLeaderboardButton",`${l}/images/aboutImages/leaderboard_button.webp`),t.load.image("aboutPlayPage",`${l}/images/aboutImages/play_page.webp`),t.load.image("aboutProfilePage",`${l}/images/aboutImages/profile_page.webp`),t.load.image("aboutLeaderboardPage",`${l}/images/aboutImages/leaderboard_page.webp`)}class Di extends Phaser.Scene{constructor(){super({key:"AboutScene"})}preload(){vi(this)}async create(){this.add.image(396,14,"gameBackground").setOrigin(0,0).setScale(1.07,1.2).setTint(10066329);const a=Si(this),e=396,i=2e3,s=20,n=750,r=this.make.graphics();r.fillRect(e,s,i,n);const c=new Phaser.Display.Masks.GeometryMask(this,r);a.setMask(c);const h=C=>C.x>=e&&C.x<=i&&C.y>=s&&C.y<=n,d=Pi(a),u=n;Ei(this,a,s,n,d),_i(this,a),this.input.on("wheel",(C,D,O,M,J)=>{if(h(C)&&d>u){a.y-=M*1;const G=s+(u-d);a.y=Phaser.Math.Clamp(a.y,G,s)}});let p=!1,y=0,T=0;this.input.on("pointerdown",C=>{h(C)&&d>u?(p=!0,y=C.y,T=a.y):(p=!1,y=0,T=0)}),this.input.on("pointermove",C=>{if(!p)return;const D=C.y-y,O=s+(u-d);a.y=Phaser.Math.Clamp(T+D,O,s)}),this.input.on("pointerup",()=>{p=!1,y=0,T=0}),this.add.image(1350,60,"arrowAbout").setScale(2).setInteractive({useHandCursor:!0}).setScrollFactor(0).setDepth(999).on("pointerdown",()=>{a.y=s;const C=s+(u-d);a.y=Phaser.Math.Clamp(a.y,C,s)}),this.add.existing(a)}}const ki={backgroundColor:"#808080",type:ve.AUTO,scene:[ka,Ma,St,ni,ri,di,Di],scale:{mode:ve.Scale.FIT,autoCenter:ve.Scale.CENTER_BOTH,width:1434,height:990},dom:{createContainer:!0},parent:"app"};new ve.Game(ki);
