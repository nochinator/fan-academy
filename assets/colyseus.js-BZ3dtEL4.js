import{c as Gs,g as dn}from"./phaser-LhFSXt8Z.js";var Jt={},Yn={},Gn;function Zs(){return Gn||(Gn=1,ArrayBuffer.isView||(ArrayBuffer.isView=i=>i!==null&&typeof i=="object"&&i.buffer instanceof ArrayBuffer),typeof FormData>"u"&&(Gs.FormData=class{}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window)),Yn}var Tt={},fn=function(i,n){return fn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,f){r.__proto__=f}||function(r,f){for(var o in f)Object.prototype.hasOwnProperty.call(f,o)&&(r[o]=f[o])},fn(i,n)};function vr(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");fn(i,n);function r(){this.constructor=i}i.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}var Dt=function(){return Dt=Object.assign||function(n){for(var r,f=1,o=arguments.length;f<o;f++){r=arguments[f];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(n[l]=r[l])}return n},Dt.apply(this,arguments)};function $r(i,n){var r={};for(var f in i)Object.prototype.hasOwnProperty.call(i,f)&&n.indexOf(f)<0&&(r[f]=i[f]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,f=Object.getOwnPropertySymbols(i);o<f.length;o++)n.indexOf(f[o])<0&&Object.prototype.propertyIsEnumerable.call(i,f[o])&&(r[f[o]]=i[f[o]]);return r}function Pr(i,n,r,f){var o=arguments.length,l=o<3?n:f===null?f=Object.getOwnPropertyDescriptor(n,r):f,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(i,n,r,f);else for(var w=i.length-1;w>=0;w--)(h=i[w])&&(l=(o<3?h(l):o>3?h(n,r,l):h(n,r))||l);return o>3&&l&&Object.defineProperty(n,r,l),l}function Dr(i,n){return function(r,f){n(r,f,i)}}function Nr(i,n,r,f,o,l){function h(H){if(H!==void 0&&typeof H!="function")throw new TypeError("Function expected");return H}for(var w=f.kind,v=w==="getter"?"get":w==="setter"?"set":"value",I=!n&&i?f.static?i:i.prototype:null,$=n||(I?Object.getOwnPropertyDescriptor(I,f.name):{}),d,x=!1,S=r.length-1;S>=0;S--){var N={};for(var j in f)N[j]=j==="access"?{}:f[j];for(var j in f.access)N.access[j]=f.access[j];N.addInitializer=function(H){if(x)throw new TypeError("Cannot add initializers after decoration has completed");l.push(h(H||null))};var V=(0,r[S])(w==="accessor"?{get:$.get,set:$.set}:$[v],N);if(w==="accessor"){if(V===void 0)continue;if(V===null||typeof V!="object")throw new TypeError("Object expected");(d=h(V.get))&&($.get=d),(d=h(V.set))&&($.set=d),(d=h(V.init))&&o.unshift(d)}else(d=h(V))&&(w==="field"?o.unshift(d):$[v]=d)}I&&Object.defineProperty(I,f.name,$),x=!0}function kr(i,n,r){for(var f=arguments.length>2,o=0;o<n.length;o++)r=f?n[o].call(i,r):n[o].call(i);return f?r:void 0}function Mr(i){return typeof i=="symbol"?i:"".concat(i)}function Br(i,n,r){return typeof n=="symbol"&&(n=n.description?"[".concat(n.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:r?"".concat(r," ",n):n})}function Lr(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)}function jr(i,n,r,f){function o(l){return l instanceof r?l:new r(function(h){h(l)})}return new(r||(r=Promise))(function(l,h){function w($){try{I(f.next($))}catch(d){h(d)}}function v($){try{I(f.throw($))}catch(d){h(d)}}function I($){$.done?l($.value):o($.value).then(w,v)}I((f=f.apply(i,n||[])).next())})}function Fr(i,n){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},f,o,l,h=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return h.next=w(0),h.throw=w(1),h.return=w(2),typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function w(I){return function($){return v([I,$])}}function v(I){if(f)throw new TypeError("Generator is already executing.");for(;h&&(h=0,I[0]&&(r=0)),r;)try{if(f=1,o&&(l=I[0]&2?o.return:I[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,I[1])).done)return l;switch(o=0,l&&(I=[I[0]&2,l.value]),I[0]){case 0:case 1:l=I;break;case 4:return r.label++,{value:I[1],done:!1};case 5:r.label++,o=I[1],I=[0];continue;case 7:I=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(I[0]===6||I[0]===2)){r=0;continue}if(I[0]===3&&(!l||I[1]>l[0]&&I[1]<l[3])){r.label=I[1];break}if(I[0]===6&&r.label<l[1]){r.label=l[1],l=I;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(I);break}l[2]&&r.ops.pop(),r.trys.pop();continue}I=n.call(i,r)}catch($){I=[6,$],o=0}finally{f=l=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}var Bt=Object.create?function(i,n,r,f){f===void 0&&(f=r);var o=Object.getOwnPropertyDescriptor(n,r);(!o||("get"in o?!n.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(i,f,o)}:function(i,n,r,f){f===void 0&&(f=r),i[f]=n[r]};function Ur(i,n){for(var r in i)r!=="default"&&!Object.prototype.hasOwnProperty.call(n,r)&&Bt(n,i,r)}function Nt(i){var n=typeof Symbol=="function"&&Symbol.iterator,r=n&&i[n],f=0;if(r)return r.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&f>=i.length&&(i=void 0),{value:i&&i[f++],done:!i}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function hn(i,n){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var f=r.call(i),o,l=[],h;try{for(;(n===void 0||n-- >0)&&!(o=f.next()).done;)l.push(o.value)}catch(w){h={error:w}}finally{try{o&&!o.done&&(r=f.return)&&r.call(f)}finally{if(h)throw h.error}}return l}function zr(){for(var i=[],n=0;n<arguments.length;n++)i=i.concat(hn(arguments[n]));return i}function Vr(){for(var i=0,n=0,r=arguments.length;n<r;n++)i+=arguments[n].length;for(var f=Array(i),o=0,n=0;n<r;n++)for(var l=arguments[n],h=0,w=l.length;h<w;h++,o++)f[o]=l[h];return f}function qr(i,n,r){if(r||arguments.length===2)for(var f=0,o=n.length,l;f<o;f++)(l||!(f in n))&&(l||(l=Array.prototype.slice.call(n,0,f)),l[f]=n[f]);return i.concat(l||Array.prototype.slice.call(n))}function rt(i){return this instanceof rt?(this.v=i,this):new rt(i)}function Hr(i,n,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f=r.apply(i,n||[]),o,l=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),w("next"),w("throw"),w("return",h),o[Symbol.asyncIterator]=function(){return this},o;function h(S){return function(N){return Promise.resolve(N).then(S,d)}}function w(S,N){f[S]&&(o[S]=function(j){return new Promise(function(V,H){l.push([S,j,V,H])>1||v(S,j)})},N&&(o[S]=N(o[S])))}function v(S,N){try{I(f[S](N))}catch(j){x(l[0][3],j)}}function I(S){S.value instanceof rt?Promise.resolve(S.value.v).then($,d):x(l[0][2],S)}function $(S){v("next",S)}function d(S){v("throw",S)}function x(S,N){S(N),l.shift(),l.length&&v(l[0][0],l[0][1])}}function Wr(i){var n,r;return n={},f("next"),f("throw",function(o){throw o}),f("return"),n[Symbol.iterator]=function(){return this},n;function f(o,l){n[o]=i[o]?function(h){return(r=!r)?{value:rt(i[o](h)),done:!1}:l?l(h):h}:l}}function Jr(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=i[Symbol.asyncIterator],r;return n?n.call(i):(i=typeof Nt=="function"?Nt(i):i[Symbol.iterator](),r={},f("next"),f("throw"),f("return"),r[Symbol.asyncIterator]=function(){return this},r);function f(l){r[l]=i[l]&&function(h){return new Promise(function(w,v){h=i[l](h),o(w,v,h.done,h.value)})}}function o(l,h,w,v){Promise.resolve(v).then(function(I){l({value:I,done:w})},h)}}function Kr(i,n){return Object.defineProperty?Object.defineProperty(i,"raw",{value:n}):i.raw=n,i}var Xs=Object.create?function(i,n){Object.defineProperty(i,"default",{enumerable:!0,value:n})}:function(i,n){i.default=n},cn=function(i){return cn=Object.getOwnPropertyNames||function(n){var r=[];for(var f in n)Object.prototype.hasOwnProperty.call(n,f)&&(r[r.length]=f);return r},cn(i)};function Yr(i){if(i&&i.__esModule)return i;var n={};if(i!=null)for(var r=cn(i),f=0;f<r.length;f++)r[f]!=="default"&&Bt(n,i,r[f]);return Xs(n,i),n}function Gr(i){return i&&i.__esModule?i:{default:i}}function Zr(i,n,r,f){if(r==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?i!==n||!f:!n.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?f:r==="a"?f.call(i):f?f.value:n.get(i)}function Xr(i,n,r,f,o){if(f==="m")throw new TypeError("Private method is not writable");if(f==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?i!==n||!o:!n.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return f==="a"?o.call(i,r):o?o.value=r:n.set(i,r),r}function Qr(i,n){if(n===null||typeof n!="object"&&typeof n!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof i=="function"?n===i:i.has(n)}function es(i,n,r){if(n!=null){if(typeof n!="object"&&typeof n!="function")throw new TypeError("Object expected.");var f,o;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");f=n[Symbol.asyncDispose]}if(f===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");f=n[Symbol.dispose],r&&(o=f)}if(typeof f!="function")throw new TypeError("Object not disposable.");o&&(f=function(){try{o.call(this)}catch(l){return Promise.reject(l)}}),i.stack.push({value:n,dispose:f,async:r})}else r&&i.stack.push({async:!0});return n}var Qs=typeof SuppressedError=="function"?SuppressedError:function(i,n,r){var f=new Error(r);return f.name="SuppressedError",f.error=i,f.suppressed=n,f};function ts(i){function n(l){i.error=i.hasError?new Qs(l,i.error,"An error was suppressed during disposal."):l,i.hasError=!0}var r,f=0;function o(){for(;r=i.stack.pop();)try{if(!r.async&&f===1)return f=0,i.stack.push(r),Promise.resolve().then(o);if(r.dispose){var l=r.dispose.call(r.value);if(r.async)return f|=2,Promise.resolve(l).then(o,function(h){return n(h),o()})}else f|=1}catch(h){n(h)}if(f===1)return i.hasError?Promise.reject(i.error):Promise.resolve();if(i.hasError)throw i.error}return o()}function ns(i,n){return typeof i=="string"&&/^\.\.?\//.test(i)?i.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,f,o,l,h){return f?n?".jsx":".js":o&&(!l||!h)?r:o+l+"."+h.toLowerCase()+"js"}):i}const ei={__extends:vr,__assign:Dt,__rest:$r,__decorate:Pr,__param:Dr,__esDecorate:Nr,__runInitializers:kr,__propKey:Mr,__setFunctionName:Br,__metadata:Lr,__awaiter:jr,__generator:Fr,__createBinding:Bt,__exportStar:Ur,__values:Nt,__read:hn,__spread:zr,__spreadArrays:Vr,__spreadArray:qr,__await:rt,__asyncGenerator:Hr,__asyncDelegator:Wr,__asyncValues:Jr,__makeTemplateObject:Kr,__importStar:Yr,__importDefault:Gr,__classPrivateFieldGet:Zr,__classPrivateFieldSet:Xr,__classPrivateFieldIn:Qr,__addDisposableResource:es,__disposeResources:ts,__rewriteRelativeImportExtension:ns},ti=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:es,get __assign(){return Dt},__asyncDelegator:Wr,__asyncGenerator:Hr,__asyncValues:Jr,__await:rt,__awaiter:jr,__classPrivateFieldGet:Zr,__classPrivateFieldIn:Qr,__classPrivateFieldSet:Xr,__createBinding:Bt,__decorate:Pr,__disposeResources:ts,__esDecorate:Nr,__exportStar:Ur,__extends:vr,__generator:Fr,__importDefault:Gr,__importStar:Yr,__makeTemplateObject:Kr,__metadata:Lr,__param:Dr,__propKey:Mr,__read:hn,__rest:$r,__rewriteRelativeImportExtension:ns,__runInitializers:kr,__setFunctionName:Br,__spread:zr,__spreadArray:qr,__spreadArrays:Vr,__values:Nt,default:ei},Symbol.toStringTag,{value:"Module"})),Lt=dn(ti);var Kt={},Zn;function jt(){return Zn||(Zn=1,function(i){i.CloseCode=void 0,function(r){r[r.CONSENTED=4e3]="CONSENTED",r[r.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(i.CloseCode||(i.CloseCode={}));class n extends Error{constructor(f,o){super(o),this.name="ServerError",this.code=f}}i.ServerError=n}(Kt)),Kt}var Yt={},Gt={},Zt={},ht={exports:{}},ni=ht.exports,Xn;function gn(){return Xn||(Xn=1,function(i,n){(function(r,f){f(n)})(ni,function(r){r.OPERATION=void 0,function(c){c[c.ADD=128]="ADD",c[c.REPLACE=0]="REPLACE",c[c.DELETE=64]="DELETE",c[c.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",c[c.MOVE_AND_ADD=160]="MOVE_AND_ADD",c[c.DELETE_AND_ADD=192]="DELETE_AND_ADD",c[c.CLEAR=10]="CLEAR",c[c.REVERSE=15]="REVERSE",c[c.MOVE=32]="MOVE",c[c.DELETE_BY_REFID=33]="DELETE_BY_REFID",c[c.ADD_BY_REFID=129]="ADD_BY_REFID"}(r.OPERATION||(r.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const l=Symbol("$track"),h=Symbol("$encoder"),w=Symbol("$decoder"),v=Symbol("$filter"),I=Symbol("$getByIndex"),$=Symbol("$deleteByIndex"),d=Symbol("$changes"),x=Symbol("$childType"),S=Symbol("$onEncodeEnd"),N=Symbol("$onDecodeEnd"),j=Symbol("$descriptors"),V="$__numFields",H="$__refTypeFieldIndexes",G="$__viewFieldIndexes",oe="$__fieldIndexesByViewTag";let Q;try{Q=new TextEncoder}catch{}const pe=new ArrayBuffer(8),Ie=new Int32Array(pe),ye=new Float32Array(pe),Ke=new Float64Array(pe),Se=new BigInt64Array(pe),st=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(c,e){for(var t=0,s=0,a=0,u=c.length;a<u;a++)t=c.charCodeAt(a),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(a++,s+=4);return s};function yt(c,e,t){for(var s=0,a=0,u=e.length;a<u;a++)s=e.charCodeAt(a),s<128?c[t.offset++]=s:s<2048?(c[t.offset]=192|s>>6,c[t.offset+1]=128|s&63,t.offset+=2):s<55296||s>=57344?(c[t.offset]=224|s>>12,c[t.offset+1]=128|s>>6&63,c[t.offset+2]=128|s&63,t.offset+=3):(a++,s=65536+((s&1023)<<10|e.charCodeAt(a)&1023),c[t.offset]=240|s>>18,c[t.offset+1]=128|s>>12&63,c[t.offset+2]=128|s>>6&63,c[t.offset+3]=128|s&63,t.offset+=4)}function O(c,e,t){c[t.offset++]=e&255}function L(c,e,t){c[t.offset++]=e&255}function D(c,e,t){c[t.offset++]=e&255,c[t.offset++]=e>>8&255}function C(c,e,t){c[t.offset++]=e&255,c[t.offset++]=e>>8&255}function P(c,e,t){c[t.offset++]=e&255,c[t.offset++]=e>>8&255,c[t.offset++]=e>>16&255,c[t.offset++]=e>>24&255}function q(c,e,t){const s=e>>24,a=e>>16,u=e>>8,g=e;c[t.offset++]=g&255,c[t.offset++]=u&255,c[t.offset++]=a&255,c[t.offset++]=s&255}function J(c,e,t){const s=Math.floor(e/Math.pow(2,32)),a=e>>>0;q(c,a,t),q(c,s,t)}function W(c,e,t){const s=e/Math.pow(2,32)>>0,a=e>>>0;q(c,a,t),q(c,s,t)}function Z(c,e,t){Se[0]=BigInt.asIntN(64,e),P(c,Ie[0],t),P(c,Ie[1],t)}function X(c,e,t){Se[0]=BigInt.asIntN(64,e),P(c,Ie[0],t),P(c,Ie[1],t)}function we(c,e,t){ye[0]=e,P(c,Ie[0],t)}function Ae(c,e,t){Ke[0]=e,P(c,Ie[0],t),P(c,Ie[1],t)}function He(c,e,t){c[t.offset++]=e?1:0}function As(c,e,t){e||(e="");let s=st(e,"utf8"),a=0;if(s<32)c[t.offset++]=s|160,a=1;else if(s<256)c[t.offset++]=217,c[t.offset++]=s%255,a=2;else if(s<65536)c[t.offset++]=218,C(c,s,t),a=3;else if(s<4294967296)c[t.offset++]=219,q(c,s,t),a=5;else throw new Error("String too long");return yt(c,e,t),a+s}function Vt(c,e,t){if(isNaN(e))return Vt(c,0,t);if(isFinite(e)){if(e!==(e|0))return Math.abs(e)<=34028235e31&&(ye[0]=e,Math.abs(Math.abs(ye[0])-Math.abs(e))<1e-4)?(c[t.offset++]=202,we(c,e,t),5):(c[t.offset++]=203,Ae(c,e,t),9)}else return Vt(c,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,t);return e>=0?e<128?(c[t.offset++]=e&255,1):e<256?(c[t.offset++]=204,c[t.offset++]=e&255,2):e<65536?(c[t.offset++]=205,C(c,e,t),3):e<4294967296?(c[t.offset++]=206,q(c,e,t),5):(c[t.offset++]=207,W(c,e,t),9):e>=-32?(c[t.offset++]=224|e+32,1):e>=-128?(c[t.offset++]=208,O(c,e,t),2):e>=-32768?(c[t.offset++]=209,D(c,e,t),3):e>=-2147483648?(c[t.offset++]=210,P(c,e,t),5):(c[t.offset++]=211,J(c,e,t),9)}const Ee={int8:O,uint8:L,int16:D,uint16:C,int32:P,uint32:q,int64:J,uint64:W,bigint64:Z,biguint64:X,float32:we,float64:Ae,boolean:He,string:As,number:Vt,utf8Write:yt,utf8Length:st},it=new ArrayBuffer(8),We=new Int32Array(it),Ts=new Float32Array(it),_s=new Float64Array(it),Rs=new BigUint64Array(it),Cs=new BigInt64Array(it);function En(c,e,t){for(var s="",a=0,u=e.offset,g=e.offset+t;u<g;u++){var y=c[u];if(!(y&128)){s+=String.fromCharCode(y);continue}if((y&224)===192){s+=String.fromCharCode((y&31)<<6|c[++u]&63);continue}if((y&240)===224){s+=String.fromCharCode((y&15)<<12|(c[++u]&63)<<6|(c[++u]&63)<<0);continue}if((y&248)===240){a=(y&7)<<18|(c[++u]&63)<<12|(c[++u]&63)<<6|(c[++u]&63)<<0,a>=65536?(a-=65536,s+=String.fromCharCode((a>>>10)+55296,(a&1023)+56320)):s+=String.fromCharCode(a);continue}console.error("Invalid byte "+y.toString(16))}return e.offset+=t,s}function bn(c,e){return ot(c,e)<<24>>24}function ot(c,e){return c[e.offset++]}function On(c,e){return wt(c,e)<<16>>16}function wt(c,e){return c[e.offset++]|c[e.offset++]<<8}function Te(c,e){return c[e.offset++]|c[e.offset++]<<8|c[e.offset++]<<16|c[e.offset++]<<24}function Ye(c,e){return Te(c,e)>>>0}function In(c,e){return We[0]=Te(c,e),Ts[0]}function xn(c,e){return We[0]=Te(c,e),We[1]=Te(c,e),_s[0]}function Sn(c,e){const t=Ye(c,e);return Te(c,e)*Math.pow(2,32)+t}function An(c,e){const t=Ye(c,e);return Ye(c,e)*Math.pow(2,32)+t}function vs(c,e){return We[0]=Te(c,e),We[1]=Te(c,e),Cs[0]}function $s(c,e){return We[0]=Te(c,e),We[1]=Te(c,e),Rs[0]}function Ps(c,e){return ot(c,e)>0}function Ds(c,e){const t=c[e.offset++];let s;return t<192?s=t&31:t===217?s=ot(c,e):t===218?s=wt(c,e):t===219&&(s=Ye(c,e)),En(c,e,s)}function Ns(c,e){const t=c[e.offset++];if(t<128)return t;if(t===202)return In(c,e);if(t===203)return xn(c,e);if(t===204)return ot(c,e);if(t===205)return wt(c,e);if(t===206)return Ye(c,e);if(t===207)return An(c,e);if(t===208)return bn(c,e);if(t===209)return On(c,e);if(t===210)return Te(c,e);if(t===211)return Sn(c,e);if(t>223)return(255-t+1)*-1}function ks(c,e){const t=c[e.offset];return t<192&&t>160||t===217||t===218||t===219}const be={utf8Read:En,int8:bn,uint8:ot,int16:On,uint16:wt,int32:Te,uint32:Ye,float32:In,float64:xn,int64:Sn,uint64:An,bigint64:vs,biguint64:$s,boolean:Ps,string:Ds,number:Ns,stringCheck:ks},Tn={},Ms=new Map;function ve(c,e){e.constructor&&(Ms.set(e.constructor,c),Tn[c]=e),e.encode&&(Ee[c]=e.encode),e.decode&&(be[c]=e.decode)}function at(c){return Tn[c]}function Bs(c){for(const e in c)ve(e,c[e]);return e=>_e(e)}const De=class De{static register(e){const t=Object.getPrototypeOf(e);if(t!==ae){let s=De.inheritedTypes.get(t);s||(s=new Set,De.inheritedTypes.set(t,s)),s.add(e)}}static cache(e){let t=De.cachedContexts.get(e);return t||(t=new De(e),De.cachedContexts.set(e,t)),t}constructor(e){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},e&&this.discoverTypes(e)}has(e){return this.schemas.has(e)}get(e){return this.types[e]}add(e,t=this.schemas.size){return this.schemas.has(e)?!1:(this.types[t]=e,e[Symbol.metadata]===void 0&&fe.initialize(e),this.schemas.set(e,t),!0)}getTypeId(e){return this.schemas.get(e)}discoverTypes(e,t,s,a){var y,E;if(a&&this.registerFilteredByParent(e,t,s),!this.add(e))return;(y=De.inheritedTypes.get(e))==null||y.forEach(A=>{this.discoverTypes(A,t,s,a)});let u=e;for(;(u=Object.getPrototypeOf(u))&&u!==ae&&u!==Function.prototype;)this.discoverTypes(u);const g=e[E=Symbol.metadata]??(e[E]={});g[G]&&(this.hasFilters=!0);for(const A in g){const T=A,k=g[T].type,_=g[T].tag!==void 0;if(typeof k!="string")if(Array.isArray(k)){const z=k[0];if(z==="string")continue;this.discoverTypes(z,e,T,a||_)}else if(typeof k=="function")this.discoverTypes(k,e,T,a||_);else{const z=Object.values(k)[0];if(typeof z=="string")continue;this.discoverTypes(z,e,T,a||_)}}}registerFilteredByParent(e,t,s){let u=`${this.schemas.get(e)??this.schemas.size}`;t&&(u+=`-${this.schemas.get(t)}`),u+=`-${s}`,this.parentFiltered[u]=!0}debug(){let e="";for(const t in this.parentFiltered){const s=t.split("-").map(Number),a=s.pop();e+=`
		`,e+=`${t}: ${s.reverse().map((u,g)=>{const y=this.types[u],E=y[Symbol.metadata];let A=y.name;return g===0&&(A+=`[${E[a].name}]`),`${A}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${e}`}};De.inheritedTypes=new Map,De.cachedContexts=new Map;let $e=De;function _n(c){return Array.isArray(c)?{array:c[0]}:typeof c.type<"u"?c.type:c}const fe={addField(c,e,t,s,a){if(e>64)throw new Error(`Can't define field '${t}'.
Schema instances may only have up to 64 fields.`);c[e]=Object.assign(c[e]||{},{type:_n(s),index:e,name:t}),Object.defineProperty(c,j,{value:c[j]||{},enumerable:!1,configurable:!0}),a?(c[j][t]=a,c[j][`_${t}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):c[j][t]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(c,V,{value:e,enumerable:!1,configurable:!0}),Object.defineProperty(c,t,{value:e,enumerable:!1,configurable:!0}),typeof c[e].type!="string"&&(c[H]===void 0&&Object.defineProperty(c,H,{value:[],enumerable:!1,configurable:!0}),c[H].push(e))},setTag(c,e,t){const s=c[e],a=c[s];a.tag=t,c[G]||(Object.defineProperty(c,G,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(c,oe,{value:{},enumerable:!1,configurable:!0})),c[G].push(s),c[oe][t]||(c[oe][t]=[]),c[oe][t].push(s)},setFields(c,e){const t=c.prototype.constructor;$e.register(t);const s=Object.getPrototypeOf(t),a=s&&s[Symbol.metadata],u=fe.initialize(t);t[l]||(t[l]=ae[l]),t[h]||(t[h]=ae[h]),t[w]||(t[w]=ae[w]),t.prototype.toJSON||(t.prototype.toJSON=ae.prototype.toJSON);let g=u[V]??(a&&a[V])??-1;g++;for(const y in e){const E=e[y],A=Array.isArray(E)?at("array"):typeof Object.keys(E)[0]=="string"&&at(Object.keys(E)[0]),T=A?Object.values(E)[0]:_n(E);fe.addField(u,g,y,E,jn(`_${y}`,g,T,A)),g++}return c},isDeprecated(c,e){return c[e].deprecated===!0},init(c){const e={};c[Symbol.metadata]=e,Object.defineProperty(e,V,{value:0,enumerable:!1,configurable:!0})},initialize(c){const e=Object.getPrototypeOf(c),t=e[Symbol.metadata];let s=c[Symbol.metadata]??Object.create(null);return e!==ae&&s===t&&(s=Object.create(null),t&&(Object.setPrototypeOf(s,t),Object.defineProperty(s,V,{value:t[V],enumerable:!1,configurable:!0,writable:!0}),t[G]!==void 0&&(Object.defineProperty(s,G,{value:[...t[G]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(s,oe,{value:{...t[oe]},enumerable:!1,configurable:!0,writable:!0})),t[H]!==void 0&&Object.defineProperty(s,H,{value:[...t[H]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(s,j,{value:{...t[j]},enumerable:!1,configurable:!0,writable:!0}))),c[Symbol.metadata]=s,s},isValidInstance(c){return c.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(c.constructor[Symbol.metadata],V)},getFields(c){const e=c[Symbol.metadata],t={};for(let s=0;s<=e[V];s++)t[e[s].name]=e[s].type;return t},hasViewTagAtIndex(c,e){var t;return(t=c==null?void 0:c[G])==null?void 0:t.includes(e)}};function Et(){return{indexes:{},operations:[]}}function Oe(c,e){const t=c.indexes[e];t===void 0?c.indexes[e]=c.operations.push(e)-1:c.operations[t]=e}function Rn(c,e){var s;let t=c.indexes[e];t===void 0&&(t=Object.values(c.indexes).at(-1),e=(s=Object.entries(c.indexes).find(([a,u])=>u===t))==null?void 0:s[0]),c.operations[t]=void 0,delete c.indexes[e]}function ge(c,e,t,s=e[t].queueRootIndex){if(c)c[t][s]!==e&&(e[t].queueRootIndex=c[t].push(e)-1);else return}class Ge{constructor(e){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=e;const t=e.constructor[Symbol.metadata];t!=null&&t[G]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(e){var s;this.root=e,this.checkIsFiltered(this.parent,this.parentIndex);const t=this.ref.constructor[Symbol.metadata];t?(s=t[H])==null||s.forEach(a=>{const u=t[a],g=this.ref[u.name];g==null||g[d].setRoot(e)}):this.ref[x]&&typeof this.ref[x]!="string"&&this.ref.forEach((a,u)=>{a[d].setRoot(e)})}setParent(e,t,s){var u;if(this.parent=e,this.parentIndex=s,!t)return;t!==this.root?(this.root=t,this.checkIsFiltered(e,s)):t.add(this);const a=this.ref.constructor[Symbol.metadata];a?(u=a[H])==null||u.forEach(g=>{const y=a[g],E=this.ref[y.name];E==null||E[d].setParent(this.ref,t,g)}):this.ref[x]&&typeof this.ref[x]!="string"&&this.ref.forEach((g,y)=>{g[d].setParent(this.ref,t,this.indexes[y]??y)})}forEachChild(e){var s;const t=this.ref.constructor[Symbol.metadata];t?(s=t[H])==null||s.forEach(a=>{const u=t[a],g=this.ref[u.name];g&&e(g[d],a)}):this.ref[x]&&typeof this.ref[x]!="string"&&this.ref.forEach((a,u)=>{e(a[d],this.indexes[u]??u)})}operation(e){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-e),ge(this.root,this,"filteredChanges")):(this.changes.operations.push(-e),ge(this.root,this,"changes"))}change(e,t=r.OPERATION.ADD){var y;const s=this.ref.constructor[Symbol.metadata],a=this.isFiltered||((y=s==null?void 0:s[e])==null?void 0:y.tag)!==void 0,u=a?this.filteredChanges:this.changes,g=this.indexedOperations[e];if(!g||g===r.OPERATION.DELETE){const E=g&&g===r.OPERATION.DELETE?r.OPERATION.DELETE_AND_ADD:t;this.indexedOperations[e]=E}Oe(u,e),a?(Oe(this.allFilteredChanges,e),this.root&&(ge(this.root,this,"filteredChanges"),ge(this.root,this,"allFilteredChanges"))):(Oe(this.allChanges,e),ge(this.root,this,"changes"))}shiftChangeIndexes(e){const t=this.isFiltered?this.filteredChanges:this.changes,s={},a={};for(const u in this.indexedOperations)s[Number(u)+e]=this.indexedOperations[u],a[Number(u)+e]=t.indexes[u];this.indexedOperations=s,t.indexes=a,t.operations=t.operations.map(u=>u+e)}shiftAllChangeIndexes(e,t=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(e,t,this.allFilteredChanges),this._shiftAllChangeIndexes(e,t,this.allChanges)):this._shiftAllChangeIndexes(e,t,this.allChanges)}_shiftAllChangeIndexes(e,t=0,s){const a={};let u=0;for(const g in s.indexes)a[u++]=s.indexes[g];s.indexes=a;for(let g=0;g<s.operations.length;g++){const y=s.operations[g];y>t&&(s.operations[g]=y+e)}}indexedOperation(e,t,s=e){this.indexedOperations[e]=t,this.filteredChanges!==void 0?(Oe(this.allFilteredChanges,s),Oe(this.filteredChanges,e),ge(this.root,this,"filteredChanges")):(Oe(this.allChanges,s),Oe(this.changes,e),ge(this.root,this,"changes"))}getType(e){return fe.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][e].type:this.ref[x]}getChange(e){return this.indexedOperations[e]}getValue(e,t=!1){return this.ref[I](e,t)}delete(e,t,s=e){var g;if(e===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${e}'`)}catch(y){console.warn(y)}return}const a=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[e]=t??r.OPERATION.DELETE,Oe(a,e),Rn(this.allChanges,s);const u=this.getValue(e);return u&&u[d]&&((g=this.root)==null||g.remove(u[d])),this.filteredChanges!==void 0?(Rn(this.allFilteredChanges,s),ge(this.root,this,"filteredChanges")):ge(this.root,this,"changes"),u}endEncode(e){var t,s;this.indexedOperations={},this[e].indexes={},this[e].operations.length=0,this[e].queueRootIndex=void 0,(s=(t=this.ref)[S])==null||s.call(t),this.isNew=!1}discard(e=!1){var t,s;(s=(t=this.ref)[S])==null||s.call(t),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),e&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((a,u)=>{var g;return(g=this.root)==null?void 0:g.remove(a)}))}discardAll(){const e=Object.keys(this.indexedOperations);for(let t=0,s=e.length;t<s;t++){const a=this.getValue(Number(e[t]));a&&a[d]&&a[d].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(e,t){const s=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(e,t),this.filteredChanges!==void 0&&(ge(this.root,this,"filteredChanges"),s&&this.root.allFilteredChanges.push(this))),this.isFiltered||(ge(this.root,this,"changes"),s&&this.root.allChanges.push(this))}_checkFilteredByParent(e,t){if(!e)return;const s=fe.isValidInstance(this.ref)?this.ref.constructor:this.ref[x];let a,u=!fe.isValidInstance(e);u?(a=e[d],e=a.parent,t=a.parentIndex):a=e[d];const g=e.constructor;let y=`${this.root.types.getTypeId(s)}`;g&&(y+=`-${this.root.types.schemas.get(g)}`),y+=`-${t}`;const E=fe.hasViewTagAtIndex(g==null?void 0:g[Symbol.metadata],t);this.isFiltered=e[d].isFiltered||this.root.types.parentFiltered[y]||E,this.isFiltered&&(this.isVisibilitySharedWithParent=a.isFiltered&&typeof s!="string"&&!E&&u,this.filteredChanges||(this.filteredChanges=Et(),this.allFilteredChanges=Et()),this.changes.operations.length>0&&(this.changes.operations.forEach(A=>Oe(this.filteredChanges,A)),this.allChanges.operations.forEach(A=>Oe(this.allFilteredChanges,A)),this.changes=Et(),this.allChanges=Et()))}}function qt(c,e,t,s,a,u){var g;typeof t=="string"?(g=Ee[t])==null||g.call(Ee,e,s,u):t[Symbol.metadata]!==void 0?(Ee.number(e,s[d].refId,u),(a&r.OPERATION.ADD)===r.OPERATION.ADD&&c.tryEncodeTypeId(e,t,s.constructor,u)):Ee.number(e,s[d].refId,u)}const Cn=function(c,e,t,s,a,u,g,y,E){if(e[u.offset++]=(s|a)&255,a===r.OPERATION.DELETE)return;const A=t.ref,T=E[s];qt(c,e,E[s].type,A[T.name],a,u)},bt=function(c,e,t,s,a,u){if(e[u.offset++]=a&255,a===r.OPERATION.CLEAR||(Ee.number(e,s,u),a===r.OPERATION.DELETE))return;const g=t.ref;if((a&r.OPERATION.ADD)===r.OPERATION.ADD&&typeof g.set=="function"){const A=t.ref.$indexes.get(s);Ee.string(e,A,u)}const y=g[x],E=g[I](s);qt(c,e,y,E,a,u)},vn=function(c,e,t,s,a,u,g,y){const E=t.ref,A=y&&t.isFiltered&&typeof t.getType(s)!="string";let T;if(A?(T=E.tmpItems[s][d].refId,a===r.OPERATION.DELETE?a=r.OPERATION.DELETE_BY_REFID:a===r.OPERATION.ADD&&(a=r.OPERATION.ADD_BY_REFID)):T=s,e[u.offset++]=a&255,a===r.OPERATION.CLEAR||a===r.OPERATION.REVERSE||(Ee.number(e,T,u),a===r.OPERATION.DELETE||a===r.OPERATION.DELETE_BY_REFID))return;const k=t.getType(s),_=t.getValue(s,g);qt(c,e,k,_,a,u)},$n=-1;function Ht(c,e,t,s,a,u,g,y){const E=c.root,A=t[I](s);let T;if((e&r.OPERATION.DELETE)===r.OPERATION.DELETE){const k=E.refIds.get(A);k!==void 0&&E.removeRef(k),e!==r.OPERATION.DELETE_AND_ADD&&t[$](s),T=void 0}if(e!==r.OPERATION.DELETE)if(ae.is(a)){const k=be.number(u,g);if(T=E.refs.get(k),(e&r.OPERATION.ADD)===r.OPERATION.ADD){const _=c.getInstanceType(u,g,a);T||(T=c.createInstanceOfType(_)),E.addRef(k,T,T!==A||e===r.OPERATION.DELETE_AND_ADD&&T===A)}}else if(typeof a=="string")T=be[a](u,g);else{const k=at(Object.keys(a)[0]),_=be.number(u,g),z=E.refs.has(_)?A||E.refs.get(_):new k.constructor;if(T=z.clone(!0),T[x]=Object.values(a)[0],A){let F=E.refIds.get(A);if(F!==void 0&&_!==F){const M=A.entries();let R;for(;(R=M.next())&&!R.done;){const[U,ee]=R.value;typeof ee=="object"&&(F=E.refIds.get(ee),E.removeRef(F)),y.push({ref:A,refId:F,op:r.OPERATION.DELETE,field:U,value:void 0,previousValue:ee})}}}E.addRef(_,T,z!==A||e===r.OPERATION.DELETE_AND_ADD&&z===A)}return{value:T,previousValue:A}}const Pn=function(c,e,t,s,a){const u=e[t.offset++],g=s.constructor[Symbol.metadata],y=u>>6<<6,E=u%(y||255),A=g[E];if(A===void 0)return console.warn("@colyseus/schema: field not defined at",{index:E,ref:s.constructor.name,metadata:g}),$n;const{value:T,previousValue:k}=Ht(c,y,s,E,A.type,e,t,a);T!=null&&(s[A.name]=T),k!==T&&a.push({ref:s,refId:c.currentRefId,op:y,field:A.name,value:T,previousValue:k})},Ot=function(c,e,t,s,a){const u=e[t.offset++];if(u===r.OPERATION.CLEAR){c.removeChildRefs(s,a),s.clear();return}const g=be.number(e,t),y=s[x];let E;(u&r.OPERATION.ADD)===r.OPERATION.ADD?typeof s.set=="function"?(E=be.string(e,t),s.setIndex(g,E)):E=g:E=s.getIndex(g);const{value:A,previousValue:T}=Ht(c,u,s,g,y,e,t,a);if(A!=null){if(typeof s.set=="function")s.$items.set(E,A);else if(typeof s.$setAt=="function")s.$setAt(g,A,u);else if(typeof s.add=="function"){const k=s.add(A);typeof k=="number"&&s.setIndex(k,k)}}T!==A&&a.push({ref:s,refId:c.currentRefId,op:u,field:"",dynamicIndex:E,value:A,previousValue:T})},Ls=function(c,e,t,s,a){let u=e[t.offset++],g;if(u===r.OPERATION.CLEAR){c.removeChildRefs(s,a),s.clear();return}else if(u===r.OPERATION.REVERSE){s.reverse();return}else if(u===r.OPERATION.DELETE_BY_REFID){const k=be.number(e,t),_=c.root.refs.get(k);g=s.findIndex(z=>z===_),s[$](g),a.push({ref:s,refId:c.currentRefId,op:r.OPERATION.DELETE,field:"",dynamicIndex:g,value:void 0,previousValue:_});return}else if(u===r.OPERATION.ADD_BY_REFID){const k=be.number(e,t),_=c.root.refs.get(k);_&&(g=s.findIndex(z=>z===_)),(g===-1||g===void 0)&&(g=s.length)}else g=be.number(e,t);const y=s[x];let E=g;const{value:A,previousValue:T}=Ht(c,u,s,g,y,e,t,a);A!=null&&A!==T&&s.$setAt(g,A,u),T!==A&&a.push({ref:s,refId:c.currentRefId,op:u,field:"",dynamicIndex:E,value:A,previousValue:T})};class Dn extends Error{}function js(c,e,t,s){let a,u=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":a="number",isNaN(c)&&console.log(`trying to encode "NaN" in ${t.constructor.name}#${s}`);break;case"bigint64":case"biguint64":a="bigint";break;case"string":a="string",u=!0;break;case"boolean":return;default:return}if(typeof c!==a&&(!u||u&&c!==null)){let g=`'${JSON.stringify(c)}'${c&&c.constructor&&` (${c.constructor.name})`||""}`;throw new Dn(`a '${a}' was expected, but ${g} was provided in ${t.constructor.name}#${s}`)}}function It(c,e,t,s){if(!(c instanceof e))throw new Dn(`a '${e.name}' was expected, but '${c&&c.constructor.name}' was provided in ${t.constructor.name}#${s}`)}var Nn,kn;const Fs=(c,e)=>{const t=c.toString(),s=e.toString();return t<s?-1:t>s?1:0},Re=class Re{static[(Nn=h,kn=w,v)](e,t,s){var a;return!s||typeof e[x]=="string"||s.isChangeTreeVisible((a=e.tmpItems[t])==null?void 0:a[d])}static is(e){return Array.isArray(e)||e.array!==void 0}static from(e){return new Re(...Array.from(e))}constructor(...e){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,x,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const t=new Proxy(this,{get:(s,a)=>typeof a!="symbol"&&!isNaN(a)?this.items[a]:Reflect.get(s,a),set:(s,a,u)=>{var g;if(typeof a!="symbol"&&!isNaN(a)){if(u==null)s.$deleteAt(a);else{if(u[d]){It(u,s[x],s,a);const y=s.items[a];s.isMovingItems?(y!==void 0?u[d].isNew?s[d].indexedOperation(Number(a),r.OPERATION.MOVE_AND_ADD):(s[d].getChange(Number(a))&r.OPERATION.DELETE)===r.OPERATION.DELETE?s[d].indexedOperation(Number(a),r.OPERATION.DELETE_AND_MOVE):s[d].indexedOperation(Number(a),r.OPERATION.MOVE):u[d].isNew&&s[d].indexedOperation(Number(a),r.OPERATION.ADD),u[d].setParent(this,s[d].root,a)):s.$changeAt(Number(a),u),y!==void 0&&((g=y[d].root)==null||g.remove(y[d]))}else s.$changeAt(Number(a),u);s.items[a]=u,s.tmpItems[a]=u}return!0}else return Reflect.set(s,a,u)},deleteProperty:(s,a)=>(typeof a=="number"?s.$deleteAt(a):delete s[a],!0),has:(s,a)=>typeof a!="symbol"&&!isNaN(Number(a))?Reflect.has(this.items,a):Reflect.has(s,a)});return this[d]=new Ge(t),this[d].indexes={},e.length>0&&this.push(...e),t}set length(e){e===0?this.clear():e<this.items.length?this.splice(e,this.length-e):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...e){var a;let t=this.tmpItems.length;const s=this[d];for(let u=0,g=e.length;u<e.length;u++,t++){const y=e[u];if(y==null)return;typeof y=="object"&&this[x]&&It(y,this[x],this,u),s.indexedOperation(t,r.OPERATION.ADD,this.items.length),this.items.push(y),this.tmpItems.push(y),(a=y[d])==null||a.setParent(this,s.root,t)}return t}pop(){let e=-1;for(let t=this.tmpItems.length-1;t>=0;t--)if(this.deletedIndexes[t]!==!0){e=t;break}if(!(e<0))return this[d].delete(e,void 0,this.items.length-1),this.deletedIndexes[e]=!0,this.items.pop()}at(e){return e<0&&(e+=this.length),this.items[e]}$changeAt(e,t){var u;if(t==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[e]===t)return;const s=this.items[e]!==void 0?typeof t=="object"?r.OPERATION.DELETE_AND_ADD:r.OPERATION.REPLACE:r.OPERATION.ADD,a=this[d];a.change(e,s),(u=t[d])==null||u.setParent(this,a.root,e)}$deleteAt(e,t){this[d].delete(e,t)}$setAt(e,t,s){e===0&&s===r.OPERATION.ADD&&this.items[e]!==void 0?this.items.unshift(t):s===r.OPERATION.DELETE_AND_MOVE?(this.items.splice(e,1),this.items[e]=t):this.items[e]=t}clear(){if(this.items.length===0)return;const e=this[d];e.forEachChild((t,s)=>{t.discard(!0);const a=t.root;a!==void 0&&(a.removeChangeFromChangeSet("changes",t),a.removeChangeFromChangeSet("allChanges",t),a.removeChangeFromChangeSet("allFilteredChanges",t))}),e.discard(!0),e.operation(r.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...e){return new Re(...this.items.concat(...e))}join(e){return this.items.join(e)}reverse(){return this[d].operation(r.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const e=this[d],t=this.tmpItems.findIndex(a=>a===this.items[0]),s=this.items.findIndex(a=>a===this.items[0]);return e.delete(t,r.OPERATION.DELETE,s),e.shiftAllChangeIndexes(-1,s),this.items.shift()}slice(e,t){const s=new Re;return s.push(...this.items.slice(e,t)),s}sort(e=Fs){this.isMovingItems=!0;const t=this[d];return this.items.sort(e).forEach((a,u)=>t.change(u,r.OPERATION.REPLACE)),this.tmpItems.sort(e),this.isMovingItems=!1,this}splice(e,t,...s){var A;const a=this[d],u=this.items.length,g=this.tmpItems.length,y=s.length,E=[];for(let T=0;T<g;T++)this.deletedIndexes[T]!==!0&&E.push(T);if(u>e){t===void 0&&(t=u-e);for(let T=e;T<e+t;T++){const k=E[T];a.delete(k,r.OPERATION.DELETE),this.deletedIndexes[k]=!0}}else t=0;if(y>0){if(y>t)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let T=0;T<y;T++){const k=(E[e]??u)+T;a.indexedOperation(k,this.deletedIndexes[k]?r.OPERATION.DELETE_AND_ADD:r.OPERATION.ADD),(A=s[T][d])==null||A.setParent(this,a.root,k)}}return t>y&&a.shiftAllChangeIndexes(-(t-y),E[e+y]),a.filteredChanges!==void 0?ge(a.root,a,"filteredChanges"):ge(a.root,a,"changes"),this.items.splice(e,t,...s)}unshift(...e){const t=this[d];return t.shiftChangeIndexes(e.length),t.isFiltered?Oe(t.filteredChanges,this.items.length):Oe(t.allChanges,this.items.length),e.forEach((s,a)=>{t.change(a,r.OPERATION.ADD)}),this.tmpItems.unshift(...e),this.items.unshift(...e)}indexOf(e,t){return this.items.indexOf(e,t)}lastIndexOf(e,t=this.length-1){return this.items.lastIndexOf(e,t)}every(e,t){return this.items.every(e,t)}some(e,t){return this.items.some(e,t)}forEach(e,t){return this.items.forEach(e,t)}map(e,t){return this.items.map(e,t)}filter(e,t){return this.items.filter(e,t)}reduce(e,t){return this.items.reduce(e,t)}reduceRight(e,t){return this.items.reduceRight(e,t)}find(e,t){return this.items.find(e,t)}findIndex(e,t){return this.items.findIndex(e,t)}fill(e,t,s){throw new Error("ArraySchema#fill() not implemented")}copyWithin(e,t,s){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return Re}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(e,t){return this.items.includes(e,t)}flatMap(e,t){throw new Error("ArraySchema#flatMap() is not supported.")}flat(e){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...e){return this.items.findLastIndex.apply(this.items,arguments)}with(e,t){const s=this.items.slice();return e<0&&(e+=this.length),s[e]=t,new Re(...s)}toReversed(){return this.items.slice().reverse()}toSorted(e){return this.items.slice().sort(e)}toSpliced(e,t,...s){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(e=>{let t=this.items.length;for(;t!=0;){let s=Math.floor(Math.random()*t);t--,[this[t],this[s]]=[this[s],this[t]]}})}move(e){return this.isMovingItems=!0,e(this),this.isMovingItems=!1,this}[I](e,t=!1){return t?this.items[e]:this.deletedIndexes[e]?this.items[e]:this.tmpItems[e]||this.items[e]}[$](e){this.items[e]=void 0,this.tmpItems[e]=void 0}[S](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[N](){this.items=this.items.filter(e=>e!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(e=>typeof e.toJSON=="function"?e.toJSON():e)}clone(e){let t;return e?(t=new Re,t.push(...this.items)):t=new Re(...this.map(s=>s[d]?s.clone():s)),t}};Re[Nn]=vn,Re[kn]=Ls;let Pe=Re;ve("array",{constructor:Pe});var Mn,Bn;const Fe=class Fe{static[(Mn=h,Bn=w,v)](e,t,s){return!s||typeof e[x]=="string"||s.isChangeTreeVisible((e[I](t)??e.deletedItems[t])[d])}static is(e){return e.map!==void 0}constructor(e){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[d]=new Ge(this),this[d].indexes={},e)if(e instanceof Map||e instanceof Fe)e.forEach((t,s)=>this.set(s,t));else for(const t in e)this.set(t,e[t]);Object.defineProperty(this,x,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return Fe}set(e,t){var y;if(t==null)throw new Error(`MapSchema#set('${e}', ${t}): trying to set ${t} value on '${e}'.`);typeof t=="object"&&this[x]&&It(t,this[x],this,e),e=e.toString();const s=this[d],a=t[d]!==void 0;let u,g;if(typeof s.indexes[e]<"u"){u=s.indexes[e],g=r.OPERATION.REPLACE;const E=this.$items.get(e);if(E===t)return;a&&(g=r.OPERATION.DELETE_AND_ADD,E!==void 0&&((y=E[d].root)==null||y.remove(E[d])))}else u=s.indexes[V]??0,g=r.OPERATION.ADD,this.$indexes.set(u,e),s.indexes[e]=u,s.indexes[V]=u+1;return this.$items.set(e,t),s.change(u,g),a&&t[d].setParent(this,s.root,u),this}get(e){return this.$items.get(e)}delete(e){const t=this[d].indexes[e];return this.deletedItems[t]=this[d].delete(t),this.$items.delete(e)}clear(){const e=this[d];e.discard(!0),e.indexes={},this.$indexes.clear(),this.$items.clear(),e.operation(r.OPERATION.CLEAR)}has(e){return this.$items.has(e)}forEach(e){this.$items.forEach(e)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(e,t){this.$indexes.set(e,t)}getIndex(e){return this.$indexes.get(e)}[I](e){return this.$items.get(this.$indexes.get(e))}[$](e){const t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)}[S](){this.deletedItems={}}toJSON(){const e={};return this.forEach((t,s)=>{e[s]=typeof t.toJSON=="function"?t.toJSON():t}),e}clone(e){let t;return e?t=Object.assign(new Fe,this):(t=new Fe,this.forEach((s,a)=>{s[d]?t.set(a,s.clone()):t.set(a,s)})),t}};Fe[Mn]=bt,Fe[Bn]=Ot;let Le=Fe;ve("map",{constructor:Le});const Me=-1;function Us(c){return $e.register(c),c}function Ln(c=Me){return function(e,t){var y;const s=e.constructor,u=Object.getPrototypeOf(s)[Symbol.metadata],g=s[y=Symbol.metadata]??(s[y]=Object.assign({},s[Symbol.metadata],u??Object.create(null)));fe.setTag(g,t,c)}}function _e(c,e){return function(t,s){const a=t.constructor;if(!c)throw new Error(`${a.name}: @type() reference provided for "${s}" is undefined. Make sure you don't have any circular dependencies.`);$e.register(a);const g=Object.getPrototypeOf(a)[Symbol.metadata],y=fe.initialize(a);let E=y[s];if(y[E]!==void 0){if(y[E].deprecated)return;if(y[E].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${s}' definition on '${a.name}'.
Check @type() annotation`)}catch(A){const T=A.stack.split(`
`)[4].trim();throw new Error(`${A.message} ${T}`)}}else E=y[V]??(g&&g[V])??-1,E++;if(e&&e.manual)fe.addField(y,E,s,c,{enumerable:!0,configurable:!0,writable:!0});else{const A=Array.isArray(c)?at("array"):typeof Object.keys(c)[0]=="string"&&at(Object.keys(c)[0]),T=A?Object.values(c)[0]:c;fe.addField(y,E,s,c,jn(`_${s}`,E,T,A))}}}function jn(c,e,t,s){return{get:function(){return this[c]},set:function(a){var g,y;const u=this[c]??void 0;if(a!==u){if(a!=null){s?(s.constructor===Pe&&!(a instanceof Pe)&&(a=new Pe(...a)),s.constructor===Le&&!(a instanceof Le)&&(a=new Le(a)),a[x]=t):typeof t!="string"?It(a,t,this,c.substring(1)):js(a,t,this,c.substring(1));const E=this[d];u!==void 0&&u[d]?((g=E.root)==null||g.remove(u[d]),this.constructor[l](E,e,r.OPERATION.DELETE_AND_ADD)):this.constructor[l](E,e,r.OPERATION.ADD),(y=a[d])==null||y.setParent(this,E.root,e)}else u!==void 0&&this[d].delete(e);this[c]=a}},enumerable:!0,configurable:!0}}function zs(c=!0){return function(e,t){var E;const s=e.constructor,u=Object.getPrototypeOf(s)[Symbol.metadata],g=s[E=Symbol.metadata]??(s[E]=Object.assign({},s[Symbol.metadata],u??Object.create(null))),y=g[t];g[y].deprecated=!0,c&&(g[j]??(g[j]={}),g[j][t]={get:function(){throw new Error(`${t} is deprecated.`)},set:function(A){},enumerable:!1,configurable:!0}),Object.defineProperty(g,y,{value:g[y],enumerable:!1,configurable:!0})}}function Vs(c,e,t){for(let s in e)_e(e[s],t)(c.prototype,s);return c}function Fn(c,e,t=ae){const s={},a={};for(let g in c){const y=c[g];typeof y=="object"&&(y.default!==void 0&&(s[g]=y.default),y.view!==void 0&&(a[g]=typeof y.view=="boolean"?Me:y.view))}const u=fe.setFields(class extends t{constructor(...g){g[0]=Object.assign({},s,g[0]),super(...g)}},c);for(let g in a)Ln(a[g])(u.prototype,g);return e&&Object.defineProperty(u,"name",{value:e}),u.extends=(g,y)=>Fn(g,y,u),u}function xt(c){return new Array(c).fill(0).map((e,t)=>t===c-1?"└─ ":"   ").join("")}function qs(c){const e=c[d].root,t={ops:{},refs:[]};return e.changes.forEach(s=>{if(s===void 0)return;const a=s.indexedOperations;t.refs.push(`refId#${s.refId}`);for(const u in a){const g=a[u],y=r.OPERATION[g];t.ops[y]||(t.ops[y]=0),t.ops[r.OPERATION[g]]++}}),t}var Un,zn;const lt=class lt{static initialize(e){var t;Object.defineProperty(e,d,{value:new Ge(e),enumerable:!1,writable:!0}),Object.defineProperties(e,((t=e.constructor[Symbol.metadata])==null?void 0:t[j])||{})}static is(e){return typeof e[Symbol.metadata]=="object"}static[(Un=h,zn=w,l)](e,t,s=r.OPERATION.ADD){e.change(t,s)}static[v](e,t,s){var g,y;const u=(g=e.constructor[Symbol.metadata][t])==null?void 0:g.tag;if(s===void 0)return u===void 0;if(u===void 0)return!0;if(u===Me)return s.isChangeTreeVisible(e[d]);{const E=(y=s.tags)==null?void 0:y.get(e[d]);return E&&E.has(u)}}constructor(...e){lt.initialize(this),e[0]&&Object.assign(this,e[0])}assign(e){return Object.assign(this,e),this}setDirty(e,t){const s=this.constructor[Symbol.metadata];this[d].change(s[s[e]].index,t)}clone(){var s;const e=new this.constructor,t=this.constructor[Symbol.metadata];for(const a in t){const u=t[a].name;typeof this[u]=="object"&&typeof((s=this[u])==null?void 0:s.clone)=="function"?e[u]=this[u].clone():e[u]=this[u]}return e}toJSON(){const e={},t=this.constructor[Symbol.metadata];for(const s in t){const a=t[s],u=a.name;!a.deprecated&&this[u]!==null&&typeof this[u]<"u"&&(e[u]=typeof this[u].toJSON=="function"?this[u].toJSON():this[u])}return e}discardAllChanges(){this[d].discardAll()}[I](e){const t=this.constructor[Symbol.metadata];return this[t[e].name]}[$](e){const t=this.constructor[Symbol.metadata];this[t[e].name]=void 0}static debugRefIds(e,t=!1,s=0){const a=t?` - ${JSON.stringify(e.toJSON())}`:"",u=e[d],g=u.refId;let y="";return y+=`${xt(s)}${e.constructor.name} (refId: ${g})${a}
`,u.forEachChild(E=>y+=this.debugRefIds(E.ref,t,s+1)),y}static debugChanges(e,t=!1){const s=e[d],a=t?s.allChanges:s.changes,u=t?"allChanges":"changes";let g=`${e.constructor.name} (${s.refId}) -> .${u}:
`;function y(E){E.operations.filter(A=>A).forEach(A=>{const T=s.indexedOperations[A];console.log({index:A,operation:T}),g+=`- [${A}]: ${r.OPERATION[T]} (${JSON.stringify(s.getValue(Number(A),t))})
`})}return y(a),!t&&s.filteredChanges&&s.filteredChanges.operations.filter(E=>E).length>0&&(g+=`${e.constructor.name} (${s.refId}) -> .filteredChanges:
`,y(s.filteredChanges)),t&&s.allFilteredChanges&&s.allFilteredChanges.operations.filter(E=>E).length>0&&(g+=`${e.constructor.name} (${s.refId}) -> .allFilteredChanges:
`,y(s.allFilteredChanges)),g}static debugChangesDeep(e,t="changes"){var T,k;let s="";const a=e[d],u=a.root,g=new Map,y=[];let E=0;for(const[_,z]of Object.entries(u[t])){const F=u.changeTrees[_];let M=!1,R=[],U=(T=F.parent)==null?void 0:T[d];if(F===a)M=!0;else for(;U!==void 0;){if(R.push(U),U.ref===e){M=!0;break}U=(k=U.parent)==null?void 0:k[d]}M&&(y.push(F.refId),E+=Object.keys(z).length,g.set(F,R.reverse()))}s+=`---
`,s+=`root refId: ${a.refId}
`,s+=`Total instances: ${y.length} (refIds: ${y.join(", ")})
`,s+=`Total changes: ${E}
`,s+=`---
`;const A=new WeakSet;for(const[_,z]of g.entries()){z.forEach((ee,se)=>{A.has(ee)||(s+=`${xt(se)}${ee.ref.constructor.name} (refId: ${ee.refId})
`,A.add(ee))});const F=_.indexedOperations,M=z.length,R=xt(M),U=M>0?`(${_.parentIndex}) `:"";s+=`${R}${U}${_.ref.constructor.name} (refId: ${_.refId}) - changes: ${Object.keys(F).length}
`;for(const ee in F){const se=F[ee];s+=`${xt(M+1)}${r.OPERATION[se]}: ${ee}
`}}return`${s}`}};lt[Un]=Cn,lt[zn]=Pn;let ae=lt;var Vn,qn;const et=class et{static[(Vn=h,qn=w,v)](e,t,s){return!s||typeof e[x]=="string"||s.isChangeTreeVisible((e[I](t)??e.deletedItems[t])[d])}static is(e){return e.collection!==void 0}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[d]=new Ge(this),this[d].indexes={},e&&e.forEach(t=>this.add(t)),Object.defineProperty(this,x,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(e){const t=this.$refId++;return e[d]!==void 0&&e[d].setParent(this,this[d].root,t),this[d].indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this[d].change(t),t}at(e){const t=Array.from(this.$items.keys())[e];return this.$items.get(t)}entries(){return this.$items.entries()}delete(e){const t=this.$items.entries();let s,a;for(;(a=t.next())&&!a.done;)if(e===a.value[1]){s=a.value[0];break}return s===void 0?!1:(this.deletedItems[s]=this[d].delete(s),this.$indexes.delete(s),this.$items.delete(s))}clear(){const e=this[d];e.discard(!0),e.indexes={},this.$indexes.clear(),this.$items.clear(),e.operation(r.OPERATION.CLEAR)}has(e){return Array.from(this.$items.values()).some(t=>t===e)}forEach(e){this.$items.forEach((t,s,a)=>e(t,s,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,t){this.$indexes.set(e,t)}getIndex(e){return this.$indexes.get(e)}[I](e){return this.$items.get(this.$indexes.get(e))}[$](e){const t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)}[S](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach((t,s)=>{e.push(typeof t.toJSON=="function"?t.toJSON():t)}),e}clone(e){let t;return e?t=Object.assign(new et,this):(t=new et,this.forEach(s=>{s[d]?t.add(s.clone()):t.add(s)})),t}};et[Vn]=bt,et[qn]=Ot;let ft=et;ve("collection",{constructor:ft});var Hn,Wn;const tt=class tt{static[(Hn=h,Wn=w,v)](e,t,s){return!s||typeof e[x]=="string"||s.visible.has((e[I](t)??e.deletedItems[t])[d])}static is(e){return e.set!==void 0}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[d]=new Ge(this),this[d].indexes={},e&&e.forEach(t=>this.add(t)),Object.defineProperty(this,x,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(e){var a;if(this.has(e))return!1;const t=this.$refId++;e[d]!==void 0&&e[d].setParent(this,this[d].root,t);const s=((a=this[d].indexes[t])==null?void 0:a.op)??r.OPERATION.ADD;return this[d].indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this[d].change(t,s),t}entries(){return this.$items.entries()}delete(e){const t=this.$items.entries();let s,a;for(;(a=t.next())&&!a.done;)if(e===a.value[1]){s=a.value[0];break}return s===void 0?!1:(this.deletedItems[s]=this[d].delete(s),this.$indexes.delete(s),this.$items.delete(s))}clear(){const e=this[d];e.discard(!0),e.indexes={},this.$indexes.clear(),this.$items.clear(),e.operation(r.OPERATION.CLEAR)}has(e){const t=this.$items.values();let s=!1,a;for(;(a=t.next())&&!a.done;)if(e===a.value){s=!0;break}return s}forEach(e){this.$items.forEach((t,s,a)=>e(t,s,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,t){this.$indexes.set(e,t)}getIndex(e){return this.$indexes.get(e)}[I](e){return this.$items.get(this.$indexes.get(e))}[$](e){const t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)}[S](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach((t,s)=>{e.push(typeof t.toJSON=="function"?t.toJSON():t)}),e}clone(e){let t;return e?t=Object.assign(new tt,this):(t=new tt,this.forEach(s=>{s[d]?t.add(s.clone()):t.add(s)})),t}};tt[Hn]=bt,tt[Wn]=Ot;let ct=tt;ve("set",{constructor:ct});function je(c,e,t,s){var a=arguments.length,u=a<3?e:s,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(c,e,t,s);else for(var y=c.length-1;y>=0;y--)(g=c[y])&&(u=(a<3?g(u):a>3?g(e,t,u):g(e,t))||u);return a>3&&u&&Object.defineProperty(e,t,u),u}typeof SuppressedError=="function"&&SuppressedError;class Hs{constructor(e){this.types=e,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(e){e.ensureRefId();const t=this.changeTrees[e.refId]===void 0;t&&(this.changeTrees[e.refId]=e);const s=this.refCount[e.refId];if(s===0){const a=e.allChanges.operations;let u=a.length;for(;u--;)e.indexedOperations[a[u]]=r.OPERATION.ADD,Oe(e.changes,u)}return this.refCount[e.refId]=(s||0)+1,t}remove(e){const t=this.refCount[e.refId]-1;return t<=0?(e.root=void 0,delete this.changeTrees[e.refId],this.removeChangeFromChangeSet("allChanges",e),this.removeChangeFromChangeSet("changes",e),e.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",e),this.removeChangeFromChangeSet("filteredChanges",e)),this.refCount[e.refId]=0):(this.refCount[e.refId]=t,e.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",e),ge(this,e,"filteredChanges")):(this.removeChangeFromChangeSet("changes",e),ge(this,e,"changes"))),e.forEachChild((s,a)=>this.remove(s)),t}removeChangeFromChangeSet(e,t){const s=this[e],a=s.indexOf(t);if(a!==-1)return t[e].queueRootIndex=-1,s[a]=void 0,!0}clear(){this.changes.length=0}}const At=class At{constructor(e){this.sharedBuffer=Buffer.allocUnsafe(At.BUFFER_SIZE),this.context=$e.cache(e.constructor),this.root=new Hs(this.context),this.setState(e)}setState(e){this.state=e,this.state[d].setRoot(this.root)}encode(e={offset:0},t,s=this.sharedBuffer,a="changes",u=a==="allChanges",g=e.offset){const y=t!==void 0,E=this.state[d],A=this.root[a];for(let T=0,k=A.length;T<k;T++){const _=A[T];if(!_)continue;if(y){if(!t.isChangeTreeVisible(_)){t.invisible.add(_);continue}t.invisible.delete(_)}const z=_[a],F=_.ref,M=z.operations.length;if(M===0)continue;const R=F.constructor,U=R[h],ee=R[v],se=R[Symbol.metadata];(y||e.offset>g||_!==E)&&(s[e.offset++]=255,Ee.number(s,_.refId,e));for(let de=0;de<M;de++){const ue=z.operations[de],Ue=ue<0?Math.abs(ue):u?r.OPERATION.ADD:_.indexedOperations[ue];ue===void 0||Ue===void 0||ee&&!ee(F,ue,t)||U(this,s,_,ue,Ue,e,u,y,se)}}if(e.offset>s.byteLength){const T=Math.ceil(e.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(T/1024)} * 1024; // ${Math.round(T/1024)} KB
`),s=Buffer.alloc(T,s),s===this.sharedBuffer&&(this.sharedBuffer=s),this.encode({offset:g},t,s,a,u)}else return s.subarray(0,e.offset)}encodeAll(e={offset:0},t=this.sharedBuffer){return this.encode(e,void 0,t,"allChanges",!0)}encodeAllView(e,t,s,a=this.sharedBuffer){const u=s.offset;return this.encode(s,e,a,"allFilteredChanges",!0,u),Buffer.concat([a.subarray(0,t),a.subarray(u,s.offset)])}debugChanges(e){(typeof e=="string"?this.root[e]:e).forEach(s=>{const a=s[e],u=s.ref.constructor[Symbol.metadata];console.log("->",{ref:s.ref.constructor.name,refId:s.refId,changes:Object.keys(a).length});for(const g in a){const y=a[g];console.log("  ->",{index:g,field:u==null?void 0:u[g],op:r.OPERATION[y]})}})}encodeView(e,t,s,a=this.sharedBuffer){const u=s.offset;for(const[g,y]of e.changes){const E=this.root.changeTrees[g];if(E===void 0){e.changes.delete(g);continue}const A=Object.keys(y);if(A.length===0)continue;const k=E.ref.constructor,_=k[h],z=k[Symbol.metadata];a[s.offset++]=255,Ee.number(a,E.refId,s);for(let F=0,M=A.length;F<M;F++){const R=Number(A[F]),ee=E.ref[I](R)!==void 0&&y[R]||r.OPERATION.DELETE;_(this,a,E,R,ee,s,!1,!0,z)}}return e.changes.clear(),this.encode(s,e,a,"filteredChanges",!1,u),Buffer.concat([a.subarray(0,t),a.subarray(u,s.offset)])}discardChanges(){var t,s;let e=this.root.changes.length;if(e>0){for(;e--;)(t=this.root.changes[e])==null||t.endEncode("changes");this.root.changes.length=0}if(e=this.root.filteredChanges.length,e>0){for(;e--;)(s=this.root.filteredChanges[e])==null||s.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(e,t,s,a){const u=this.context.getTypeId(t),g=this.context.getTypeId(s);if(g===void 0){console.warn(`@colyseus/schema WARNING: Class "${s.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}u!==g&&(e[a.offset++]=213,Ee.number(e,g,a))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};At.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let St=At;function Jn(c,e){if(e===-1||e>=c.length)return!1;const t=c.length-1;for(let s=e;s<t;s++)c[s]=c[s+1];return c.length=t,!0}class Kn extends Error{constructor(e){super(e),this.name="DecodingWarning"}}class Ws{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(e,t,s=!0){this.refs.set(e,t),this.refIds.set(t,e),s&&(this.refCounts[e]=(this.refCounts[e]||0)+1),this.deletedRefs.has(e)&&this.deletedRefs.delete(e)}removeRef(e){const t=this.refCounts[e];if(t===void 0){try{throw new Kn("trying to remove refId that doesn't exist: "+e)}catch(s){console.warn(s)}return}if(t===0){try{const s=this.refs.get(e);throw new Kn(`trying to remove refId '${e}' with 0 refCount (${s.constructor.name}: ${JSON.stringify(s)})`)}catch(s){console.warn(s)}return}(this.refCounts[e]=t-1)<=0&&this.deletedRefs.add(e)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(e=>{if(this.refCounts[e]>0)return;const t=this.refs.get(e);if(t.constructor[Symbol.metadata]!==void 0){const s=t.constructor[Symbol.metadata];for(const a in s){const u=s[a].name,g=typeof t[u]=="object"&&this.refIds.get(t[u]);g&&!this.deletedRefs.has(g)&&this.removeRef(g)}}else typeof t[x]=="function"&&Array.from(t.values()).forEach(s=>{const a=this.refIds.get(s);this.deletedRefs.has(a)||this.removeRef(a)});this.refs.delete(e),delete this.refCounts[e],delete this.callbacks[e]}),this.deletedRefs.clear()}addCallback(e,t,s){if(e===void 0){const a=typeof t=="number"?r.OPERATION[t]:t;throw new Error(`Can't addCallback on '${a}' (refId is undefined)`)}return this.callbacks[e]||(this.callbacks[e]={}),this.callbacks[e][t]||(this.callbacks[e][t]=[]),this.callbacks[e][t].push(s),()=>this.removeCallback(e,t,s)}removeCallback(e,t,s){var u,g,y;const a=(y=(g=(u=this.callbacks)==null?void 0:u[e])==null?void 0:g[t])==null?void 0:y.indexOf(s);a!==-1&&Jn(this.callbacks[e][t],a)}}class Wt{constructor(e,t){this.currentRefId=0,this.setState(e),this.context=t||new $e(e.constructor)}setState(e){this.state=e,this.root=new Ws,this.root.addRef(0,e)}decode(e,t={offset:0},s=this.state){var E,A,T;const a=[],u=this.root,g=e.byteLength;let y=s.constructor[w];for(this.currentRefId=0;t.offset<g;){if(e[t.offset]==255){t.offset++,this.currentRefId=be.number(e,t);const _=u.refs.get(this.currentRefId);if(!_)throw new Error(`"refId" not found: ${this.currentRefId}`);(E=s[N])==null||E.call(s),s=_,y=s.constructor[w];continue}if(y(this,e,t,s,a)===$n){console.warn("@colyseus/schema: definition mismatch");const _={offset:t.offset};for(;t.offset<g&&!(e[t.offset]===255&&(_.offset=t.offset+1,u.refs.has(be.number(e,_))));)t.offset++;continue}}return(A=s[N])==null||A.call(s),(T=this.triggerChanges)==null||T.call(this,a),u.garbageCollectDeletedRefs(),a}getInstanceType(e,t,s){let a;if(e[t.offset]===213){t.offset++;const u=be.number(e,t);a=this.context.get(u)}return a||s}createInstanceOfType(e){return new e}removeChildRefs(e,t){const s=typeof e[x]!="string",a=this.root.refIds.get(e);e.forEach((u,g)=>{t.push({ref:e,refId:a,op:r.OPERATION.DELETE,field:g,value:void 0,previousValue:u}),s&&this.root.removeRef(this.root.refIds.get(u))})}}class Ze extends ae{}je([_e("string")],Ze.prototype,"name",void 0),je([_e("string")],Ze.prototype,"type",void 0),je([_e("number")],Ze.prototype,"referencedType",void 0);class Xe extends ae{constructor(){super(...arguments),this.fields=new Pe}}je([_e("number")],Xe.prototype,"id",void 0),je([_e("number")],Xe.prototype,"extendsId",void 0),je([_e([Ze])],Xe.prototype,"fields",void 0);class Qe extends ae{constructor(){super(...arguments),this.types=new Pe}static encode(e,t={offset:0}){const s=e.context,a=new Qe,u=new St(a),g=s.schemas.get(e.state.constructor);g>0&&(a.rootType=g);const y=new Set,E={},A=k=>{if(k.extendsId===void 0||y.has(k.extendsId)){y.add(k.id),a.types.push(k);const _=E[k.id];_!==void 0&&(delete E[k.id],_.forEach(z=>A(z)))}else E[k.extendsId]===void 0&&(E[k.extendsId]=[]),E[k.extendsId].push(k)};s.schemas.forEach((k,_)=>{const z=new Xe;z.id=Number(k);const F=Object.getPrototypeOf(_);F!==ae&&(z.extendsId=s.schemas.get(F));const M=_[Symbol.metadata];if(M!==F[Symbol.metadata])for(const R in M){const U=Number(R),ee=M[U].name;if(!Object.prototype.hasOwnProperty.call(M,ee))continue;const se=new Ze;se.name=ee;let de;const ue=M[U];if(typeof ue.type=="string")de=ue.type;else{let Ue;ae.is(ue.type)?(de="ref",Ue=ue.type):(de=Object.keys(ue.type)[0],typeof ue.type[de]=="string"?de+=":"+ue.type[de]:Ue=ue.type[de]),se.referencedType=Ue?s.getTypeId(Ue):-1}se.type=de,z.fields.push(se)}A(z)});for(const k in E)E[k].forEach(_=>a.types.push(_));const T=u.encodeAll(t);return Buffer.from(T,0,t.offset)}static decode(e,t){const s=new Qe;new Wt(s).decode(e,t);const u=new $e;s.types.forEach(E=>{const A=u.get(E.extendsId)??ae,T=class extends A{};$e.register(T),u.add(T,E.id)},{});const g=(E,A,T)=>{A.fields.forEach((k,_)=>{const z=T+_;if(k.referencedType!==void 0){let F=k.type,M=u.get(k.referencedType);if(!M){const R=k.type.split(":");F=R[0],M=R[1]}F==="ref"?fe.addField(E,z,k.name,M):fe.addField(E,z,k.name,{[F]:M})}else fe.addField(E,z,k.name,k.type)})};s.types.forEach(E=>{const A=u.get(E.id),T=fe.initialize(A),k=[];let _=E;do k.push(_),_=s.types.find(F=>F.id===_.extendsId);while(_);let z=0;k.reverse().forEach(F=>{g(T,F,z),z+=F.fields.length})});const y=new(u.get(s.rootType||0));return new Wt(y,u)}}je([_e([Xe])],Qe.prototype,"types",void 0),je([_e("number")],Qe.prototype,"rootType",void 0);function Js(c){const e=c.root,t=e.callbacks,s=new WeakMap;let a;c.triggerChanges=function(y){var A;const E=new Set;for(let T=0,k=y.length;T<k;T++){const _=y[T],z=_.refId,F=_.ref,M=t[z];if(M){if((_.op&r.OPERATION.DELETE)===r.OPERATION.DELETE&&_.previousValue instanceof ae){const R=(A=t[e.refIds.get(_.previousValue)])==null?void 0:A[r.OPERATION.DELETE];for(let U=(R==null?void 0:R.length)-1;U>=0;U--)R[U]()}if(F instanceof ae){if(!E.has(z)){const R=M==null?void 0:M[r.OPERATION.REPLACE];for(let U=(R==null?void 0:R.length)-1;U>=0;U--)R[U]()}if(M.hasOwnProperty(_.field)){const R=M[_.field];for(let U=(R==null?void 0:R.length)-1;U>=0;U--)R[U](_.value,_.previousValue)}}else{if((_.op&r.OPERATION.DELETE)===r.OPERATION.DELETE){if(_.previousValue!==void 0){const R=M[r.OPERATION.DELETE];for(let U=(R==null?void 0:R.length)-1;U>=0;U--)R[U](_.previousValue,_.dynamicIndex??_.field)}if((_.op&r.OPERATION.ADD)===r.OPERATION.ADD){const R=M[r.OPERATION.ADD];for(let U=(R==null?void 0:R.length)-1;U>=0;U--)R[U](_.value,_.dynamicIndex??_.field)}}else if((_.op&r.OPERATION.ADD)===r.OPERATION.ADD&&_.previousValue===void 0){const R=M[r.OPERATION.ADD];for(let U=(R==null?void 0:R.length)-1;U>=0;U--)R[U](_.value,_.dynamicIndex??_.field)}if(_.value!==_.previousValue&&(_.value!==void 0||_.previousValue!==void 0)){const R=M[r.OPERATION.REPLACE];for(let U=(R==null?void 0:R.length)-1;U>=0;U--)R[U](_.value,_.dynamicIndex??_.field)}}E.add(z)}}};function u(y,E){var k;let A=((k=E.instance)==null?void 0:k.constructor[Symbol.metadata])||y,T=E.instance&&typeof E.instance.forEach=="function"||y&&typeof y[Symbol.metadata]>"u";if(A&&!T){const _=function(z,F,M,R){return R&&E.instance[F]!==void 0&&!s.has(a)&&M(E.instance[F],void 0),e.addCallback(e.refIds.get(z),F,M)};return new Proxy({listen:function(F,M,R=!0){if(E.instance)return _(E.instance,F,M,R);{let U=()=>{};return E.onInstanceAvailable((ee,se)=>{U=_(ee,F,M,R&&se&&!s.has(a))}),()=>U()}},onChange:function(F){return e.addCallback(e.refIds.get(E.instance),r.OPERATION.REPLACE,F)},bindTo:function(F,M){return M||(M=Object.keys(A).map(R=>A[R].name)),e.addCallback(e.refIds.get(E.instance),r.OPERATION.REPLACE,()=>{M.forEach(R=>F[R]=E.instance[R])})}},{get(z,F){var R;const M=A[A[F]];if(M){const U=(R=E.instance)==null?void 0:R[F],ee=se=>{const de=g(E.instance).listen(F,(ue,Ue)=>{se(ue,!1),de==null||de()},!1);e.refIds.get(U)!==void 0&&se(U,!0)};return u(M.type,{instance:e.refIds.get(U)&&U,parentInstance:E.instance,onInstanceAvailable:ee})}else return z[F]},has(z,F){return A[F]!==void 0},set(z,F,M){throw new Error("not allowed")},deleteProperty(z,F){throw new Error("not allowed")}})}else{const _=function(M,R,U){return U&&M.forEach((ee,se)=>R(ee,se)),e.addCallback(e.refIds.get(M),r.OPERATION.ADD,(ee,se)=>{s.set(R,!0),a=R,R(ee,se),s.delete(R),a=void 0})},z=function(M,R){return e.addCallback(e.refIds.get(M),r.OPERATION.DELETE,R)},F=function(M,R){return e.addCallback(e.refIds.get(M),r.OPERATION.REPLACE,R)};return new Proxy({onAdd:function(M,R=!0){if(E.instance)return _(E.instance,M,R&&!s.has(a));if(E.onInstanceAvailable){let U=()=>{};return E.onInstanceAvailable((ee,se)=>{U=_(ee,M,R&&se&&!s.has(a))}),()=>U()}},onRemove:function(M){if(E.instance)return z(E.instance,M);if(E.onInstanceAvailable){let R=()=>{};return E.onInstanceAvailable(U=>{R=z(U,M)}),()=>R()}},onChange:function(M){if(E.instance)return F(E.instance,M);if(E.onInstanceAvailable){let R=()=>{};return E.onInstanceAvailable(U=>{R=F(U,M)}),()=>R()}}},{get(M,R){if(!M[R])throw new Error(`Can't access '${R}' through callback proxy. access the instance directly.`);return M[R]},has(M,R){return M[R]!==void 0},set(M,R,U){throw new Error("not allowed")},deleteProperty(M,R){throw new Error("not allowed")}})}}function g(y){return u(void 0,{instance:y})}return g}function Ks(c,e){c.triggerChanges=e}class Ys{constructor(e=!1){this.iterable=e,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,e&&(this.items=[])}add(e,t=Me,s=!0){var y,E;const a=e==null?void 0:e[d];if(a){if(!a.parent&&a.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${a.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",e),this;const u=e.constructor[Symbol.metadata];this.visible.add(a),this.iterable&&s&&this.items.push(e),s&&a.parent&&this.addParentOf(a,t);let g=this.changes.get(a.refId);if(g===void 0&&(g={},this.changes.set(a.refId,g)),t!==Me){this.tags||(this.tags=new WeakMap);let A;this.tags.has(a)?A=this.tags.get(a):(A=new Set,this.tags.set(a,A)),A.add(t),(E=(y=u==null?void 0:u[oe])==null?void 0:y[t])==null||E.forEach(T=>{a.getChange(T)!==r.OPERATION.DELETE&&(g[T]=r.OPERATION.ADD)})}else{const A=this.invisible.has(a),T=a.filteredChanges!==void 0?a.allFilteredChanges:a.allChanges;for(let k=0,_=T.operations.length;k<_;k++){const z=T.operations[k];if(z===void 0)continue;const F=a.indexedOperations[z]??r.OPERATION.ADD,M=u==null?void 0:u[z].tag;!a.isNew&&(A||M===void 0||M===t)&&F!==r.OPERATION.DELETE&&(g[z]=F)}}return a.forEachChild((A,T)=>{u&&u[T].tag!==void 0&&u[T].tag!==t||this.add(A.ref,t,!1)}),this}addParentOf(e,t){var u;const s=e.parent[d],a=e.parentIndex;if(!this.visible.has(s)){this.visible.add(s);const g=(u=s.parent)==null?void 0:u[d];g&&g.filteredChanges!==void 0&&this.addParentOf(s,t)}if(s.getChange(a)!==r.OPERATION.DELETE){let g=this.changes.get(s.refId);g===void 0&&(g={},this.changes.set(s.refId,g)),this.tags||(this.tags=new WeakMap);let y;this.tags.has(s)?y=this.tags.get(s):(y=new Set,this.tags.set(s,y)),y.add(t),g[a]=r.OPERATION.ADD}}remove(e,t=Me,s=!1){const a=e[d];if(!a)return console.warn("StateView#remove(), invalid object:",e),this;this.visible.delete(a),this.iterable&&!s&&Jn(this.items,this.items.indexOf(e));const g=a.ref.constructor[Symbol.metadata];let y=this.changes.get(a.refId);if(y===void 0&&(y={},this.changes.set(a.refId,y)),t===Me){const E=a.parent;if(fe.isValidInstance(E))g==null||g[G].forEach(A=>y[A]=r.OPERATION.DELETE);else{const A=E[d];let T=this.changes.get(A.refId);T===void 0&&(T={},this.changes.set(A.refId,T)),T[a.parentIndex]=r.OPERATION.DELETE}}else g==null||g[oe][t].forEach(E=>y[E]=r.OPERATION.DELETE);if(this.tags&&this.tags.has(a)){const E=this.tags.get(a);t===void 0?this.tags.delete(a):(E.delete(t),E.size===0&&this.tags.delete(a))}return this}has(e){return this.visible.has(e[d])}hasTag(e,t=Me){var a;const s=(a=this.tags)==null?void 0:a.get(e[d]);return(s==null?void 0:s.has(t))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let e=0,t=this.items.length;e<t;e++)this.remove(this.items[e],Me,!0);this.items.length=0}isChangeTreeVisible(e){let t=this.visible.has(e);return!t&&e.isVisibilitySharedWithParent&&this.visible.has(e.parent[d])&&(this.visible.add(e),t=!0),t}}ve("map",{constructor:Le}),ve("array",{constructor:Pe}),ve("set",{constructor:ct}),ve("collection",{constructor:ft}),r.$changes=d,r.$childType=x,r.$decoder=w,r.$deleteByIndex=$,r.$encoder=h,r.$filter=v,r.$getByIndex=I,r.$track=l,r.ArraySchema=Pe,r.ChangeTree=Ge,r.CollectionSchema=ft,r.Decoder=Wt,r.Encoder=St,r.MapSchema=Le,r.Metadata=fe,r.Reflection=Qe,r.ReflectionField=Ze,r.ReflectionType=Xe,r.Schema=ae,r.SetSchema=ct,r.StateView=Ys,r.TypeContext=$e,r.decode=be,r.decodeKeyValueOperation=Ot,r.decodeSchemaOperation=Pn,r.defineCustomTypes=Bs,r.defineTypes=Vs,r.deprecated=zs,r.dumpChanges=qs,r.encode=Ee,r.encodeArray=vn,r.encodeKeyValueOperation=bt,r.encodeSchemaOperation=Cn,r.entity=Us,r.getDecoderStateCallbacks=Js,r.getRawChangesCallback=Ks,r.registerType=ve,r.schema=Fn,r.type=_e,r.view=Ln})}(ht,ht.exports)),ht.exports}var Qn;function ri(){if(Qn)return Zt;Qn=1;var i=Lt,n=gn();class r{constructor(o){this.events=o,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(o,l={}){const h=l.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(l.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(o,h),this.wt.ready.then(w=>{console.log("WebTransport ready!",w),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(I=>{this.reader=I.value.readable.getReader(),this.writer=I.value.writable.getWriter(),this.sendSeatReservation(l.room.roomId,l.sessionId,l.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(I=>{console.error("failed to read incoming stream",I),console.error("TODO: close the connection")})}).catch(w=>{console.log("WebTransport not ready!",w),this._close()}),this.wt.closed.then(w=>{console.log("WebTransport closed w/ success",w),this.events.onclose({code:w.closeCode,reason:w.reason})}).catch(w=>{console.log("WebTransport closed w/ error",w),this.events.onerror(w),this.events.onclose({code:w.closeCode,reason:w.reason})}).finally(()=>{this._close()})}send(o){const l=n.encode.number(this.lengthPrefixBuffer,o.length,{offset:0}),h=new Uint8Array(l+o.length);h.set(this.lengthPrefixBuffer.subarray(0,l),0),h.set(o,l),this.writer.write(h)}sendUnreliable(o){const l=n.encode.number(this.lengthPrefixBuffer,o.length,{offset:0}),h=new Uint8Array(l+o.length);h.set(this.lengthPrefixBuffer.subarray(0,l),0),h.set(o,l),this.unreliableWriter.write(h)}close(o,l){try{this.wt.close({closeCode:o,reason:l})}catch(h){console.error(h)}}readIncomingData(){return i.__awaiter(this,void 0,void 0,function*(){let o;for(;this.isOpen;){try{o=yield this.reader.read();const l=o.value,h={offset:0};do{const w=n.decode.number(l,h);this.events.onmessage({data:l.subarray(h.offset,h.offset+w)}),h.offset+=w}while(h.offset<l.length)}catch(l){l.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",l);break}if(o.done)break}})}readIncomingUnreliableData(){return i.__awaiter(this,void 0,void 0,function*(){let o;for(;this.isOpen;){try{o=yield this.unreliableReader.read();const l=o.value,h={offset:0};do{const w=n.decode.number(l,h);this.events.onmessage({data:l.subarray(h.offset,h.offset+w)}),h.offset+=w}while(h.offset<l.length)}catch(l){l.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",l);break}if(o.done)break}})}sendSeatReservation(o,l,h){const w={offset:0},v=[];n.encode.string(v,o,w),n.encode.string(v,l,w),h&&n.encode.string(v,h,w),this.writer.write(new Uint8Array(v).buffer)}_close(){this.isOpen=!1}}return Zt.H3TransportTransport=r,Zt}var Xt={},Qt,er;function si(){return er||(er=1,Qt=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),Qt}var tr;function ii(){if(tr)return Xt;tr=1;var i=si();const n=globalThis.WebSocket||i;let r=class{constructor(o){this.events=o}send(o){this.ws.send(o)}sendUnreliable(o){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(o,l){try{this.ws=new n(o,{headers:l,protocols:this.protocols})}catch{this.ws=new n(o,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(o,l){this.ws.close(o,l)}get isOpen(){return this.ws.readyState===n.OPEN}};return Xt.WebSocketTransport=r,Xt}var nr;function oi(){if(nr)return Gt;nr=1;var i=ri(),n=ii();let r=class{constructor(o){switch(this.events={},o){case"h3":this.transport=new i.H3TransportTransport(this.events);break;default:this.transport=new n.WebSocketTransport(this.events);break}}connect(o,l){this.transport.connect.call(this.transport,o,l)}send(o){this.transport.send(o)}sendUnreliable(o){this.transport.sendUnreliable(o)}close(o,l){this.transport.close(o,l)}get isOpen(){return this.transport.isOpen}};return Gt.Connection=r,Gt}var en={},rr;function rs(){return rr||(rr=1,function(i){i.Protocol=void 0,function(n){n[n.HANDSHAKE=9]="HANDSHAKE",n[n.JOIN_ROOM=10]="JOIN_ROOM",n[n.ERROR=11]="ERROR",n[n.LEAVE_ROOM=12]="LEAVE_ROOM",n[n.ROOM_DATA=13]="ROOM_DATA",n[n.ROOM_STATE=14]="ROOM_STATE",n[n.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",n[n.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",n[n.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(i.Protocol||(i.Protocol={})),i.ErrorCode=void 0,function(n){n[n.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",n[n.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",n[n.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",n[n.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",n[n.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",n[n.AUTH_FAILED=4215]="AUTH_FAILED",n[n.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(i.ErrorCode||(i.ErrorCode={}))}(en)),en}var _t={},sr;function ss(){if(sr)return _t;sr=1;const i={};function n(f,o){i[f]=o}function r(f){const o=i[f];if(!o)throw new Error("missing serializer: "+f);return o}return _t.getSerializer=r,_t.registerSerializer=n,_t}var tn={},ir;function is(){if(ir)return tn;ir=1;const i=()=>({emit(n,...r){let f=this.events[n]||[];for(let o=0,l=f.length;o<l;o++)f[o](...r)},events:{},on(n,r){var f;return!((f=this.events[n])===null||f===void 0)&&f.push(r)||(this.events[n]=[r]),()=>{var o;this.events[n]=(o=this.events[n])===null||o===void 0?void 0:o.filter(l=>r!==l)}}});return tn.createNanoEvents=i,tn}var Rt={},or;function ai(){if(or)return Rt;or=1;class i{constructor(){this.handlers=[]}register(f,o=!1){return this.handlers.push(f),this}invoke(...f){this.handlers.forEach(o=>o.apply(this,f))}invokeAsync(...f){return Promise.all(this.handlers.map(o=>o.apply(this,f)))}remove(f){const o=this.handlers.indexOf(f);this.handlers[o]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function n(){const r=new i;function f(o){return r.register(o,this===null)}return f.once=o=>{const l=function(...h){o.apply(this,h),r.remove(l)};r.register(l)},f.remove=o=>r.remove(o),f.invoke=(...o)=>r.invoke(...o),f.invokeAsync=(...o)=>r.invokeAsync(...o),f.clear=()=>r.clear(),f}return Rt.EventEmitter=i,Rt.createSignal=n,Rt}var Ct={},ar;function os(){if(ar)return Ct;ar=1;var i=gn();function n(f){try{return i.getDecoderStateCallbacks(f.serializer.decoder)}catch{return}}let r=class{setState(o,l){this.decoder.decode(o,l)}getState(){return this.state}patch(o,l){return this.decoder.decode(o,l)}teardown(){this.decoder.root.clearRefs()}handshake(o,l){this.state?(i.Reflection.decode(o,l),this.decoder=new i.Decoder(this.state)):(this.decoder=i.Reflection.decode(o,l),this.state=this.decoder.state)}};return Ct.SchemaSerializer=r,Ct.getStateCallbacks=n,Ct}var ln;try{ln=new TextDecoder}catch{}var B,ke,m=0,ne={},Y,ze,xe=0,Ne=0,le,Be,he=[],K,fr={useRecords:!1,mapsAsObjects:!0};class as{}const mn=new as;mn.name="MessagePack 0xC1";var Ve=!1,fs=2,fi;try{new Function("")}catch{fs=1/0}class qe{constructor(n){n&&(n.useRecords===!1&&n.mapsAsObjects===void 0&&(n.mapsAsObjects=!0),n.sequential&&n.trusted!==!1&&(n.trusted=!0,!n.structures&&n.useRecords!=!1&&(n.structures=[],n.maxSharedStructures||(n.maxSharedStructures=0))),n.structures?n.structures.sharedLength=n.structures.length:n.getStructures&&((n.structures=[]).uninitialized=!0,n.structures.sharedLength=0),n.int64AsNumber&&(n.int64AsType="number")),Object.assign(this,n)}unpack(n,r){if(B)return gs(()=>(kt(),this?this.unpack(n,r):qe.prototype.unpack.call(fr,n,r)));!n.buffer&&n.constructor===ArrayBuffer&&(n=typeof Buffer<"u"?Buffer.from(n):new Uint8Array(n)),typeof r=="object"?(ke=r.end||n.length,m=r.start||0):(m=0,ke=r>-1?r:n.length),Ne=0,ze=null,le=null,B=n;try{K=n.dataView||(n.dataView=new DataView(n.buffer,n.byteOffset,n.byteLength))}catch(f){throw B=null,n instanceof Uint8Array?f:new Error("Source must be a Uint8Array or Buffer but was a "+(n&&typeof n=="object"?n.constructor.name:typeof n))}if(this instanceof qe){if(ne=this,this.structures)return Y=this.structures,vt(r);(!Y||Y.length>0)&&(Y=[])}else ne=fr,(!Y||Y.length>0)&&(Y=[]);return vt(r)}unpackMultiple(n,r){let f,o=0;try{Ve=!0;let l=n.length,h=this?this.unpack(n,l):Ut.unpack(n,l);if(r){if(r(h,o,m)===!1)return;for(;m<l;)if(o=m,r(vt(),o,m)===!1)return}else{for(f=[h];m<l;)o=m,f.push(vt());return f}}catch(l){throw l.lastPosition=o,l.values=f,l}finally{Ve=!1,kt()}}_mergeStructures(n,r){n=n||[],Object.isFrozen(n)&&(n=n.map(f=>f.slice(0)));for(let f=0,o=n.length;f<o;f++){let l=n[f];l&&(l.isShared=!0,f>=32&&(l.highByte=f-32>>5))}n.sharedLength=n.length;for(let f in r||[])if(f>=0){let o=n[f],l=r[f];l&&(o&&((n.restoreStructures||(n.restoreStructures=[]))[f]=o),n[f]=l)}return this.structures=n}decode(n,r){return this.unpack(n,r)}}function vt(i){try{if(!ne.trusted&&!Ve){let r=Y.sharedLength||0;r<Y.length&&(Y.length=r)}let n;if(ne.randomAccessStructure&&B[m]<64&&B[m]>=32&&fi||(n=ie()),le&&(m=le.postBundlePosition,le=null),Ve&&(Y.restoreStructures=null),m==ke)Y&&Y.restoreStructures&&cr(),Y=null,B=null,Be&&(Be=null);else{if(m>ke)throw new Error("Unexpected end of MessagePack data");if(!Ve){let r;try{r=JSON.stringify(n,(f,o)=>typeof o=="bigint"?`${o}n`:o).slice(0,100)}catch(f){r="(JSON view not available "+f+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return n}catch(n){throw Y&&Y.restoreStructures&&cr(),kt(),(n instanceof RangeError||n.message.startsWith("Unexpected end of buffer")||m>ke)&&(n.incomplete=!0),n}}function cr(){for(let i in Y.restoreStructures)Y[i]=Y.restoreStructures[i];Y.restoreStructures=null}function ie(){let i=B[m++];if(i<160)if(i<128){if(i<64)return i;{let n=Y[i&63]||ne.getStructures&&cs()[i&63];return n?(n.read||(n.read=pn(n,i&63)),n.read()):i}}else if(i<144)if(i-=128,ne.mapsAsObjects){let n={};for(let r=0;r<i;r++){let f=us();f==="__proto__"&&(f="__proto_"),n[f]=ie()}return n}else{let n=new Map;for(let r=0;r<i;r++)n.set(ie(),ie());return n}else{i-=144;let n=new Array(i);for(let r=0;r<i;r++)n[r]=ie();return ne.freezeData?Object.freeze(n):n}else if(i<192){let n=i-160;if(Ne>=m)return ze.slice(m-xe,(m+=n)-xe);if(Ne==0&&ke<140){let r=n<16?yn(n):ls(n);if(r!=null)return r}return un(n)}else{let n;switch(i){case 192:return null;case 193:return le?(n=ie(),n>0?le[1].slice(le.position1,le.position1+=n):le[0].slice(le.position0,le.position0-=n)):mn;case 194:return!1;case 195:return!0;case 196:if(n=B[m++],n===void 0)throw new Error("Unexpected end of buffer");return nn(n);case 197:return n=K.getUint16(m),m+=2,nn(n);case 198:return n=K.getUint32(m),m+=4,nn(n);case 199:return Je(B[m++]);case 200:return n=K.getUint16(m),m+=2,Je(n);case 201:return n=K.getUint32(m),m+=4,Je(n);case 202:if(n=K.getFloat32(m),ne.useFloat32>2){let r=Ft[(B[m]&127)<<1|B[m+1]>>7];return m+=4,(r*n+(n>0?.5:-.5)>>0)/r}return m+=4,n;case 203:return n=K.getFloat64(m),m+=8,n;case 204:return B[m++];case 205:return n=K.getUint16(m),m+=2,n;case 206:return n=K.getUint32(m),m+=4,n;case 207:return ne.int64AsType==="number"?(n=K.getUint32(m)*4294967296,n+=K.getUint32(m+4)):ne.int64AsType==="string"?n=K.getBigUint64(m).toString():ne.int64AsType==="auto"?(n=K.getBigUint64(m),n<=BigInt(2)<<BigInt(52)&&(n=Number(n))):n=K.getBigUint64(m),m+=8,n;case 208:return K.getInt8(m++);case 209:return n=K.getInt16(m),m+=2,n;case 210:return n=K.getInt32(m),m+=4,n;case 211:return ne.int64AsType==="number"?(n=K.getInt32(m)*4294967296,n+=K.getUint32(m+4)):ne.int64AsType==="string"?n=K.getBigInt64(m).toString():ne.int64AsType==="auto"?(n=K.getBigInt64(m),n>=BigInt(-2)<<BigInt(52)&&n<=BigInt(2)<<BigInt(52)&&(n=Number(n))):n=K.getBigInt64(m),m+=8,n;case 212:if(n=B[m++],n==114)return mr(B[m++]&63);{let r=he[n];if(r)return r.read?(m++,r.read(ie())):r.noBuffer?(m++,r()):r(B.subarray(m,++m));throw new Error("Unknown extension "+n)}case 213:return n=B[m],n==114?(m++,mr(B[m++]&63,B[m++])):Je(2);case 214:return Je(4);case 215:return Je(8);case 216:return Je(16);case 217:return n=B[m++],Ne>=m?ze.slice(m-xe,(m+=n)-xe):li(n);case 218:return n=K.getUint16(m),m+=2,Ne>=m?ze.slice(m-xe,(m+=n)-xe):ui(n);case 219:return n=K.getUint32(m),m+=4,Ne>=m?ze.slice(m-xe,(m+=n)-xe):di(n);case 220:return n=K.getUint16(m),m+=2,ur(n);case 221:return n=K.getUint32(m),m+=4,ur(n);case 222:return n=K.getUint16(m),m+=2,dr(n);case 223:return n=K.getUint32(m),m+=4,dr(n);default:if(i>=224)return i-256;if(i===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+i)}}}const ci=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function pn(i,n){function r(){if(r.count++>fs){let o=i.read=new Function("r","return function(){return "+(ne.freezeData?"Object.freeze":"")+"({"+i.map(l=>l==="__proto__"?"__proto_:r()":ci.test(l)?l+":r()":"["+JSON.stringify(l)+"]:r()").join(",")+"})}")(ie);return i.highByte===0&&(i.read=lr(n,i.read)),o()}let f={};for(let o=0,l=i.length;o<l;o++){let h=i[o];h==="__proto__"&&(h="__proto_"),f[h]=ie()}return ne.freezeData?Object.freeze(f):f}return r.count=0,i.highByte===0?lr(n,r):r}const lr=(i,n)=>function(){let r=B[m++];if(r===0)return n();let f=i<32?-(i+(r<<5)):i+(r<<5),o=Y[f]||cs()[f];if(!o)throw new Error("Record id is not defined for "+f);return o.read||(o.read=pn(o,i)),o.read()};function cs(){let i=gs(()=>(B=null,ne.getStructures()));return Y=ne._mergeStructures(i,Y)}var un=gt,li=gt,ui=gt,di=gt;let hi=!1;function gt(i){let n;if(i<16&&(n=yn(i)))return n;if(i>64&&ln)return ln.decode(B.subarray(m,m+=i));const r=m+i,f=[];for(n="";m<r;){const o=B[m++];if(!(o&128))f.push(o);else if((o&224)===192){const l=B[m++]&63;f.push((o&31)<<6|l)}else if((o&240)===224){const l=B[m++]&63,h=B[m++]&63;f.push((o&31)<<12|l<<6|h)}else if((o&248)===240){const l=B[m++]&63,h=B[m++]&63,w=B[m++]&63;let v=(o&7)<<18|l<<12|h<<6|w;v>65535&&(v-=65536,f.push(v>>>10&1023|55296),v=56320|v&1023),f.push(v)}else f.push(o);f.length>=4096&&(n+=ce.apply(String,f),f.length=0)}return f.length>0&&(n+=ce.apply(String,f)),n}function ur(i){let n=new Array(i);for(let r=0;r<i;r++)n[r]=ie();return ne.freezeData?Object.freeze(n):n}function dr(i){if(ne.mapsAsObjects){let n={};for(let r=0;r<i;r++){let f=us();f==="__proto__"&&(f="__proto_"),n[f]=ie()}return n}else{let n=new Map;for(let r=0;r<i;r++)n.set(ie(),ie());return n}}var ce=String.fromCharCode;function ls(i){let n=m,r=new Array(i);for(let f=0;f<i;f++){const o=B[m++];if((o&128)>0){m=n;return}r[f]=o}return ce.apply(String,r)}function yn(i){if(i<4)if(i<2){if(i===0)return"";{let n=B[m++];if((n&128)>1){m-=1;return}return ce(n)}}else{let n=B[m++],r=B[m++];if((n&128)>0||(r&128)>0){m-=2;return}if(i<3)return ce(n,r);let f=B[m++];if((f&128)>0){m-=3;return}return ce(n,r,f)}else{let n=B[m++],r=B[m++],f=B[m++],o=B[m++];if((n&128)>0||(r&128)>0||(f&128)>0||(o&128)>0){m-=4;return}if(i<6){if(i===4)return ce(n,r,f,o);{let l=B[m++];if((l&128)>0){m-=5;return}return ce(n,r,f,o,l)}}else if(i<8){let l=B[m++],h=B[m++];if((l&128)>0||(h&128)>0){m-=6;return}if(i<7)return ce(n,r,f,o,l,h);let w=B[m++];if((w&128)>0){m-=7;return}return ce(n,r,f,o,l,h,w)}else{let l=B[m++],h=B[m++],w=B[m++],v=B[m++];if((l&128)>0||(h&128)>0||(w&128)>0||(v&128)>0){m-=8;return}if(i<10){if(i===8)return ce(n,r,f,o,l,h,w,v);{let I=B[m++];if((I&128)>0){m-=9;return}return ce(n,r,f,o,l,h,w,v,I)}}else if(i<12){let I=B[m++],$=B[m++];if((I&128)>0||($&128)>0){m-=10;return}if(i<11)return ce(n,r,f,o,l,h,w,v,I,$);let d=B[m++];if((d&128)>0){m-=11;return}return ce(n,r,f,o,l,h,w,v,I,$,d)}else{let I=B[m++],$=B[m++],d=B[m++],x=B[m++];if((I&128)>0||($&128)>0||(d&128)>0||(x&128)>0){m-=12;return}if(i<14){if(i===12)return ce(n,r,f,o,l,h,w,v,I,$,d,x);{let S=B[m++];if((S&128)>0){m-=13;return}return ce(n,r,f,o,l,h,w,v,I,$,d,x,S)}}else{let S=B[m++],N=B[m++];if((S&128)>0||(N&128)>0){m-=14;return}if(i<15)return ce(n,r,f,o,l,h,w,v,I,$,d,x,S,N);let j=B[m++];if((j&128)>0){m-=15;return}return ce(n,r,f,o,l,h,w,v,I,$,d,x,S,N,j)}}}}}function hr(){let i=B[m++],n;if(i<192)n=i-160;else switch(i){case 217:n=B[m++];break;case 218:n=K.getUint16(m),m+=2;break;case 219:n=K.getUint32(m),m+=4;break;default:throw new Error("Expected string")}return gt(n)}function nn(i){return ne.copyBuffers?Uint8Array.prototype.slice.call(B,m,m+=i):B.subarray(m,m+=i)}function Je(i){let n=B[m++];if(he[n]){let r;return he[n](B.subarray(m,r=m+=i),f=>{m=f;try{return ie()}finally{m=r}})}else throw new Error("Unknown extension type "+n)}var gr=new Array(4096);function us(){let i=B[m++];if(i>=160&&i<192){if(i=i-160,Ne>=m)return ze.slice(m-xe,(m+=i)-xe);if(!(Ne==0&&ke<180))return un(i)}else return m--,ds(ie());let n=(i<<5^(i>1?K.getUint16(m):i>0?B[m]:0))&4095,r=gr[n],f=m,o=m+i-3,l,h=0;if(r&&r.bytes==i){for(;f<o;){if(l=K.getUint32(f),l!=r[h++]){f=1879048192;break}f+=4}for(o+=3;f<o;)if(l=B[f++],l!=r[h++]){f=1879048192;break}if(f===o)return m=f,r.string;o-=3,f=m}for(r=[],gr[n]=r,r.bytes=i;f<o;)l=K.getUint32(f),r.push(l),f+=4;for(o+=3;f<o;)l=B[f++],r.push(l);let w=i<16?yn(i):ls(i);return w!=null?r.string=w:r.string=un(i)}function ds(i){if(typeof i=="string")return i;if(typeof i=="number"||typeof i=="boolean"||typeof i=="bigint")return i.toString();if(i==null)return i+"";if(ne.allowArraysInMapKeys&&Array.isArray(i)&&i.flat().every(n=>["string","number","boolean","bigint"].includes(typeof n)))return i.flat().toString();throw new Error(`Invalid property type for record: ${typeof i}`)}const mr=(i,n)=>{let r=ie().map(ds),f=i;n!==void 0&&(i=i<32?-((n<<5)+i):(n<<5)+i,r.highByte=n);let o=Y[i];return o&&(o.isShared||Ve)&&((Y.restoreStructures||(Y.restoreStructures=[]))[i]=o),Y[i]=r,r.read=pn(r,f),r.read()};he[0]=()=>{};he[0].noBuffer=!0;he[66]=i=>{let n=i.length,r=BigInt(i[0]&128?i[0]-256:i[0]);for(let f=1;f<n;f++)r<<=BigInt(8),r+=BigInt(i[f]);return r};let gi={Error,TypeError,ReferenceError};he[101]=()=>{let i=ie();return(gi[i[0]]||Error)(i[1],{cause:i[2]})};he[105]=i=>{if(ne.structuredClone===!1)throw new Error("Structured clone extension is disabled");let n=K.getUint32(m-4);Be||(Be=new Map);let r=B[m],f;r>=144&&r<160||r==220||r==221?f=[]:f={};let o={target:f};Be.set(n,o);let l=ie();return o.used?Object.assign(f,l):(o.target=l,l)};he[112]=i=>{if(ne.structuredClone===!1)throw new Error("Structured clone extension is disabled");let n=K.getUint32(m-4),r=Be.get(n);return r.used=!0,r.target};he[115]=()=>new Set(ie());const hs=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(i=>i+"Array");let mi=typeof globalThis=="object"?globalThis:window;he[116]=i=>{let n=i[0],r=hs[n];if(!r){if(n===16){let f=new ArrayBuffer(i.length-1);return new Uint8Array(f).set(i.subarray(1)),f}throw new Error("Could not find typed array for code "+n)}return new mi[r](Uint8Array.prototype.slice.call(i,1).buffer)};he[120]=()=>{let i=ie();return new RegExp(i[0],i[1])};const pi=[];he[98]=i=>{let n=(i[0]<<24)+(i[1]<<16)+(i[2]<<8)+i[3],r=m;return m+=n-i.length,le=pi,le=[hr(),hr()],le.position0=0,le.position1=0,le.postBundlePosition=m,m=r,ie()};he[255]=i=>i.length==4?new Date((i[0]*16777216+(i[1]<<16)+(i[2]<<8)+i[3])*1e3):i.length==8?new Date(((i[0]<<22)+(i[1]<<14)+(i[2]<<6)+(i[3]>>2))/1e6+((i[3]&3)*4294967296+i[4]*16777216+(i[5]<<16)+(i[6]<<8)+i[7])*1e3):i.length==12?new Date(((i[0]<<24)+(i[1]<<16)+(i[2]<<8)+i[3])/1e6+((i[4]&128?-281474976710656:0)+i[6]*1099511627776+i[7]*4294967296+i[8]*16777216+(i[9]<<16)+(i[10]<<8)+i[11])*1e3):new Date("invalid");function gs(i){let n=ke,r=m,f=xe,o=Ne,l=ze,h=Be,w=le,v=new Uint8Array(B.slice(0,ke)),I=Y,$=Y.slice(0,Y.length),d=ne,x=Ve,S=i();return ke=n,m=r,xe=f,Ne=o,ze=l,Be=h,le=w,B=v,Ve=x,Y=I,Y.splice(0,Y.length,...$),ne=d,K=new DataView(B.buffer,B.byteOffset,B.byteLength),S}function kt(){B=null,Be=null,Y=null}function yi(i){i.unpack?he[i.type]=i.unpack:he[i.type]=i}const Ft=new Array(147);for(let i=0;i<256;i++)Ft[i]=+("1e"+Math.floor(45.15-i*.30103));const wi=qe;var Ut=new qe({useRecords:!1});const Ei=Ut.unpack,bi=Ut.unpackMultiple,Oi=Ut.unpack,ms={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let ps=new Float32Array(1),pr=new Uint8Array(ps.buffer,0,4);function Ii(i){ps[0]=i;let n=Ft[(pr[3]&127)<<1|pr[2]>>7];return(n*i+(i>0?.5:-.5)>>0)/n}let Pt;try{Pt=new TextEncoder}catch{}let Mt,wn;const zt=typeof Buffer<"u",$t=zt?function(i){return Buffer.allocUnsafeSlow(i)}:Uint8Array,ys=zt?Buffer:Uint8Array,yr=zt?4294967296:2144337920;let b,ut,te,p=0,me,re=null,xi;const Si=21760,Ai=/[\u0080-\uFFFF]/,nt=Symbol("record-id");class mt extends qe{constructor(n){super(n),this.offset=0;let r,f,o,l,h=ys.prototype.utf8Write?function(O,L){return b.utf8Write(O,L,b.byteLength-L)}:Pt&&Pt.encodeInto?function(O,L){return Pt.encodeInto(O,b.subarray(L)).written}:!1,w=this;n||(n={});let v=n&&n.sequential,I=n.structures||n.saveStructures,$=n.maxSharedStructures;if($==null&&($=I?32:0),$>8160)throw new Error("Maximum maxSharedStructure is 8160");n.structuredClone&&n.moreTypes==null&&(this.moreTypes=!0);let d=n.maxOwnStructures;d==null&&(d=I?32:64),!this.structures&&n.useRecords!=!1&&(this.structures=[]);let x=$>32||d+$>64,S=$+64,N=$+d+64;if(N>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let j=[],V=0,H=0;this.pack=this.encode=function(O,L){if(b||(b=new $t(8192),te=b.dataView||(b.dataView=new DataView(b.buffer,0,8192)),p=0),me=b.length-10,me-p<2048?(b=new $t(b.length),te=b.dataView||(b.dataView=new DataView(b.buffer,0,b.length)),me=b.length-10,p=0):p=p+7&2147483640,r=p,L&Os&&(p+=L&255),l=w.structuredClone?new Map:null,w.bundleStrings&&typeof O!="string"?(re=[],re.size=1/0):re=null,o=w.structures,o){o.uninitialized&&(o=w._mergeStructures(w.getStructures()));let C=o.sharedLength||0;if(C>$)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+o.sharedLength);if(!o.transitions){o.transitions=Object.create(null);for(let P=0;P<C;P++){let q=o[P];if(!q)continue;let J,W=o.transitions;for(let Z=0,X=q.length;Z<X;Z++){let we=q[Z];J=W[we],J||(J=W[we]=Object.create(null)),W=J}W[nt]=P+64}this.lastNamedStructuresLength=C}v||(o.nextId=C+64)}f&&(f=!1);let D;try{w.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?yt(O):Q(O);let C=re;if(re&&br(r,Q,0),l&&l.idsToInsert){let P=l.idsToInsert.sort((Z,X)=>Z.offset>X.offset?1:-1),q=P.length,J=-1;for(;C&&q>0;){let Z=P[--q].offset+r;Z<C.stringsPosition+r&&J===-1&&(J=0),Z>C.position+r?J>=0&&(J+=6):(J>=0&&(te.setUint32(C.position+r,te.getUint32(C.position+r)+J),J=-1),C=C.previous,q++)}J>=0&&C&&te.setUint32(C.position+r,te.getUint32(C.position+r)+J),p+=P.length*6,p>me&&Se(p),w.offset=p;let W=_i(b.subarray(r,p),P);return l=null,W}return w.offset=p,L&Es?(b.start=r,b.end=p,b):b.subarray(r,p)}catch(C){throw D=C,C}finally{if(o&&(G(),f&&w.saveStructures)){let C=o.sharedLength||0,P=b.subarray(r,p),q=Ci(o,w);if(!D)return w.saveStructures(q,q.isCompatible)===!1?w.pack(O,L):(w.lastNamedStructuresLength=C,b.length>1073741824&&(b=null),P)}b.length>1073741824&&(b=null),L&bs&&(p=r)}};const G=()=>{H<10&&H++;let O=o.sharedLength||0;if(o.length>O&&!v&&(o.length=O),V>1e4)o.transitions=null,H=0,V=0,j.length>0&&(j=[]);else if(j.length>0&&!v){for(let L=0,D=j.length;L<D;L++)j[L][nt]=0;j=[]}},oe=O=>{var L=O.length;L<16?b[p++]=144|L:L<65536?(b[p++]=220,b[p++]=L>>8,b[p++]=L&255):(b[p++]=221,te.setUint32(p,L),p+=4);for(let D=0;D<L;D++)Q(O[D])},Q=O=>{p>me&&(b=Se(p));var L=typeof O,D;if(L==="string"){let C=O.length;if(re&&C>=4&&C<4096){if((re.size+=C)>Si){let W,Z=(re[0]?re[0].length*3+re[1].length:0)+10;p+Z>me&&(b=Se(p+Z));let X;re.position?(X=re,b[p]=200,p+=3,b[p++]=98,W=p-r,p+=4,br(r,Q,0),te.setUint16(W+r-3,p-r-W)):(b[p++]=214,b[p++]=98,W=p-r,p+=4),re=["",""],re.previous=X,re.size=0,re.position=W}let J=Ai.test(O);re[J?0:1]+=O,b[p++]=193,Q(J?-C:C);return}let P;C<32?P=1:C<256?P=2:C<65536?P=3:P=5;let q=C*3;if(p+q>me&&(b=Se(p+q)),C<64||!h){let J,W,Z,X=p+P;for(J=0;J<C;J++)W=O.charCodeAt(J),W<128?b[X++]=W:W<2048?(b[X++]=W>>6|192,b[X++]=W&63|128):(W&64512)===55296&&((Z=O.charCodeAt(J+1))&64512)===56320?(W=65536+((W&1023)<<10)+(Z&1023),J++,b[X++]=W>>18|240,b[X++]=W>>12&63|128,b[X++]=W>>6&63|128,b[X++]=W&63|128):(b[X++]=W>>12|224,b[X++]=W>>6&63|128,b[X++]=W&63|128);D=X-p-P}else D=h(O,p+P);D<32?b[p++]=160|D:D<256?(P<2&&b.copyWithin(p+2,p+1,p+1+D),b[p++]=217,b[p++]=D):D<65536?(P<3&&b.copyWithin(p+3,p+2,p+2+D),b[p++]=218,b[p++]=D>>8,b[p++]=D&255):(P<5&&b.copyWithin(p+5,p+3,p+3+D),b[p++]=219,te.setUint32(p,D),p+=4),p+=D}else if(L==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?b[p++]=O:O<256?(b[p++]=204,b[p++]=O):O<65536?(b[p++]=205,b[p++]=O>>8,b[p++]=O&255):(b[p++]=206,te.setUint32(p,O),p+=4);else if(O>>0===O)O>=-32?b[p++]=256+O:O>=-128?(b[p++]=208,b[p++]=O+256):O>=-32768?(b[p++]=209,te.setInt16(p,O),p+=2):(b[p++]=210,te.setInt32(p,O),p+=4);else{let C;if((C=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){b[p++]=202,te.setFloat32(p,O);let P;if(C<4||(P=O*Ft[(b[p]&127)<<1|b[p+1]>>7])>>0===P){p+=4;return}else p--}b[p++]=203,te.setFloat64(p,O),p+=8}else if(L==="object"||L==="function")if(!O)b[p++]=192;else{if(l){let P=l.get(O);if(P){if(!P.id){let q=l.idsToInsert||(l.idsToInsert=[]);P.id=q.push(P)}b[p++]=214,b[p++]=112,te.setUint32(p,P.id),p+=4;return}else l.set(O,{offset:p-r})}let C=O.constructor;if(C===Object)Ke(O);else if(C===Array)oe(O);else if(C===Map)if(this.mapAsEmptyObject)b[p++]=128;else{D=O.size,D<16?b[p++]=128|D:D<65536?(b[p++]=222,b[p++]=D>>8,b[p++]=D&255):(b[p++]=223,te.setUint32(p,D),p+=4);for(let[P,q]of O)Q(P),Q(q)}else{for(let P=0,q=Mt.length;P<q;P++){let J=wn[P];if(O instanceof J){let W=Mt[P];if(W.write){W.type&&(b[p++]=212,b[p++]=W.type,b[p++]=0);let He=W.write.call(this,O);He===O?Array.isArray(O)?oe(O):Ke(O):Q(He);return}let Z=b,X=te,we=p;b=null;let Ae;try{Ae=W.pack.call(this,O,He=>(b=Z,Z=null,p+=He,p>me&&Se(p),{target:b,targetView:te,position:p-He}),Q)}finally{Z&&(b=Z,te=X,p=we,me=b.length-10)}Ae&&(Ae.length+p>me&&Se(Ae.length+p),p=Ti(Ae,b,p,W.type));return}}if(Array.isArray(O))oe(O);else{if(O.toJSON){const P=O.toJSON();if(P!==O)return Q(P)}if(L==="function")return Q(this.writeFunction&&this.writeFunction(O));Ke(O)}}}else if(L==="boolean")b[p++]=O?195:194;else if(L==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))b[p++]=211,te.setBigInt64(p,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)b[p++]=207,te.setBigUint64(p,O);else if(this.largeBigIntToFloat)b[p++]=203,te.setFloat64(p,Number(O));else{if(this.largeBigIntToString)return Q(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){b[p++]=199,p++,b[p++]=66;let C=[],P;do{let q=O&BigInt(255);P=(q&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),C.push(q),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&P));b[p-2]=C.length;for(let q=C.length;q>0;)b[p++]=Number(C[--q]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}p+=8}else if(L==="undefined")this.encodeUndefinedAsNil?b[p++]=192:(b[p++]=212,b[p++]=0,b[p++]=0);else throw new Error("Unknown type: "+L)},pe=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let L;if(this.skipValues){L=[];for(let P in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(P))&&!this.skipValues.includes(O[P])&&L.push(P)}else L=Object.keys(O);let D=L.length;D<16?b[p++]=128|D:D<65536?(b[p++]=222,b[p++]=D>>8,b[p++]=D&255):(b[p++]=223,te.setUint32(p,D),p+=4);let C;if(this.coercibleKeyAsNumber)for(let P=0;P<D;P++){C=L[P];let q=Number(C);Q(isNaN(q)?C:q),Q(O[C])}else for(let P=0;P<D;P++)Q(C=L[P]),Q(O[C])}:O=>{b[p++]=222;let L=p-r;p+=2;let D=0;for(let C in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(C))&&(Q(C),Q(O[C]),D++);if(D>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');b[L+++r]=D>>8,b[L+r]=D&255},Ie=this.useRecords===!1?pe:n.progressiveRecords&&!x?O=>{let L,D=o.transitions||(o.transitions=Object.create(null)),C=p++-r,P;for(let q in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(q)){if(L=D[q],L)D=L;else{let J=Object.keys(O),W=D;D=o.transitions;let Z=0;for(let X=0,we=J.length;X<we;X++){let Ae=J[X];L=D[Ae],L||(L=D[Ae]=Object.create(null),Z++),D=L}C+r+1==p?(p--,pt(D,J,Z)):st(D,J,C,Z),P=!0,D=W[q]}Q(O[q])}if(!P){let q=D[nt];q?b[C+r]=q:st(D,Object.keys(O),C,0)}}:O=>{let L,D=o.transitions||(o.transitions=Object.create(null)),C=0;for(let q in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(q))&&(L=D[q],L||(L=D[q]=Object.create(null),C++),D=L);let P=D[nt];P?P>=96&&x?(b[p++]=((P-=96)&31)+96,b[p++]=P>>5):b[p++]=P:pt(D,D.__keys__||Object.keys(O),C);for(let q in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(q))&&Q(O[q])},ye=typeof this.useRecords=="function"&&this.useRecords,Ke=ye?O=>{ye(O)?Ie(O):pe(O)}:Ie,Se=O=>{let L;if(O>16777216){if(O-r>yr)throw new Error("Packed buffer would be larger than maximum buffer size");L=Math.min(yr,Math.round(Math.max((O-r)*(O>67108864?1.25:2),4194304)/4096)*4096)}else L=(Math.max(O-r<<2,b.length-1)>>12)+1<<12;let D=new $t(L);return te=D.dataView||(D.dataView=new DataView(D.buffer,0,L)),O=Math.min(O,b.length),b.copy?b.copy(D,0,r,O):D.set(b.slice(r,O)),p-=r,r=0,me=D.length-10,b=D},pt=(O,L,D)=>{let C=o.nextId;C||(C=64),C<S&&this.shouldShareStructure&&!this.shouldShareStructure(L)?(C=o.nextOwnId,C<N||(C=S),o.nextOwnId=C+1):(C>=N&&(C=S),o.nextId=C+1);let P=L.highByte=C>=96&&x?C-96>>5:-1;O[nt]=C,O.__keys__=L,o[C-64]=L,C<S?(L.isShared=!0,o.sharedLength=C-63,f=!0,P>=0?(b[p++]=(C&31)+96,b[p++]=P):b[p++]=C):(P>=0?(b[p++]=213,b[p++]=114,b[p++]=(C&31)+96,b[p++]=P):(b[p++]=212,b[p++]=114,b[p++]=C),D&&(V+=H*D),j.length>=d&&(j.shift()[nt]=0),j.push(O),Q(L))},st=(O,L,D,C)=>{let P=b,q=p,J=me,W=r;b=ut,p=0,r=0,b||(ut=b=new $t(8192)),me=b.length-10,pt(O,L,C),ut=b;let Z=p;if(b=P,p=q,me=J,r=W,Z>1){let X=p+Z-1;X>me&&Se(X);let we=D+r;b.copyWithin(we+Z,we+1,p),b.set(ut.slice(0,Z),we),p=X}else b[D+r]=ut[0]},yt=O=>{let L=xi(O,b,r,p,o,Se,(D,C,P)=>{if(P)return f=!0;p=C;let q=b;return Q(D),G(),q!==b?{position:p,targetView:te,target:b}:p},this);if(L===0)return Ke(O);p=L}}useBuffer(n){b=n,b.dataView||(b.dataView=new DataView(b.buffer,b.byteOffset,b.byteLength)),p=0}set position(n){p=n}get position(){return p}set buffer(n){b=n}get buffer(){return b}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}wn=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,as];Mt=[{pack(i,n,r){let f=i.getTime()/1e3;if((this.useTimestamp32||i.getMilliseconds()===0)&&f>=0&&f<4294967296){let{target:o,targetView:l,position:h}=n(6);o[h++]=214,o[h++]=255,l.setUint32(h,f)}else if(f>0&&f<4294967296){let{target:o,targetView:l,position:h}=n(10);o[h++]=215,o[h++]=255,l.setUint32(h,i.getMilliseconds()*4e6+(f/1e3/4294967296>>0)),l.setUint32(h+4,f)}else if(isNaN(f)){if(this.onInvalidDate)return n(0),r(this.onInvalidDate());let{target:o,targetView:l,position:h}=n(3);o[h++]=212,o[h++]=255,o[h++]=255}else{let{target:o,targetView:l,position:h}=n(15);o[h++]=199,o[h++]=12,o[h++]=255,l.setUint32(h,i.getMilliseconds()*1e6),l.setBigInt64(h+4,BigInt(Math.floor(f)))}}},{pack(i,n,r){if(this.setAsEmptyObject)return n(0),r({});let f=Array.from(i),{target:o,position:l}=n(this.moreTypes?3:0);this.moreTypes&&(o[l++]=212,o[l++]=115,o[l++]=0),r(f)}},{pack(i,n,r){let{target:f,position:o}=n(this.moreTypes?3:0);this.moreTypes&&(f[o++]=212,f[o++]=101,f[o++]=0),r([i.name,i.message,i.cause])}},{pack(i,n,r){let{target:f,position:o}=n(this.moreTypes?3:0);this.moreTypes&&(f[o++]=212,f[o++]=120,f[o++]=0),r([i.source,i.flags])}},{pack(i,n){this.moreTypes?wr(i,16,n):Er(zt?Buffer.from(i):new Uint8Array(i),n)}},{pack(i,n){let r=i.constructor;r!==ys&&this.moreTypes?wr(i,hs.indexOf(r.name),n):Er(i,n)}},{pack(i,n){let{target:r,position:f}=n(1);r[f]=193}}];function wr(i,n,r,f){let o=i.byteLength;if(o+1<256){var{target:l,position:h}=r(4+o);l[h++]=199,l[h++]=o+1}else if(o+1<65536){var{target:l,position:h}=r(5+o);l[h++]=200,l[h++]=o+1>>8,l[h++]=o+1&255}else{var{target:l,position:h,targetView:w}=r(7+o);l[h++]=201,w.setUint32(h,o+1),h+=4}l[h++]=116,l[h++]=n,i.buffer||(i=new Uint8Array(i)),l.set(new Uint8Array(i.buffer,i.byteOffset,i.byteLength),h)}function Er(i,n){let r=i.byteLength;var f,o;if(r<256){var{target:f,position:o}=n(r+2);f[o++]=196,f[o++]=r}else if(r<65536){var{target:f,position:o}=n(r+3);f[o++]=197,f[o++]=r>>8,f[o++]=r&255}else{var{target:f,position:o,targetView:l}=n(r+5);f[o++]=198,l.setUint32(o,r),o+=4}f.set(i,o)}function Ti(i,n,r,f){let o=i.length;switch(o){case 1:n[r++]=212;break;case 2:n[r++]=213;break;case 4:n[r++]=214;break;case 8:n[r++]=215;break;case 16:n[r++]=216;break;default:o<256?(n[r++]=199,n[r++]=o):o<65536?(n[r++]=200,n[r++]=o>>8,n[r++]=o&255):(n[r++]=201,n[r++]=o>>24,n[r++]=o>>16&255,n[r++]=o>>8&255,n[r++]=o&255)}return n[r++]=f,n.set(i,r),r+=o,r}function _i(i,n){let r,f=n.length*6,o=i.length-f;for(;r=n.pop();){let l=r.offset,h=r.id;i.copyWithin(l+f,l,o),f-=6;let w=l+f;i[w++]=214,i[w++]=105,i[w++]=h>>24,i[w++]=h>>16&255,i[w++]=h>>8&255,i[w++]=h&255,o=l}return i}function br(i,n,r){if(re.length>0){te.setUint32(re.position+i,p+r-re.position-i),re.stringsPosition=p-i;let f=re;re=null,n(f[0]),n(f[1])}}function Ri(i){if(i.Class){if(!i.pack&&!i.write)throw new Error("Extension has no pack or write function");if(i.pack&&!i.type)throw new Error("Extension has no type (numeric code to identify the extension)");wn.unshift(i.Class),Mt.unshift(i)}yi(i)}function Ci(i,n){return i.isCompatible=r=>{let f=!r||(n.lastNamedStructuresLength||0)===r.length;return f||n._mergeStructures(r),f},i}let ws=new mt({useRecords:!1});const vi=ws.pack,$i=ws.pack,Pi=mt,{NEVER:Di,ALWAYS:Ni,DECIMAL_ROUND:ki,DECIMAL_FIT:Mi}=ms,Es=512,bs=1024,Os=2048;function Bi(i,n={}){if(!i||typeof i!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof i[Symbol.iterator]=="function")return Li(i,n);if(typeof i.then=="function"||typeof i[Symbol.asyncIterator]=="function")return ji(i,n);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Li(i,n){const r=new mt(n);for(const f of i)yield r.pack(f)}async function*ji(i,n){const r=new mt(n);for await(const f of i)yield r.pack(f)}function Fi(i,n={}){if(!i||typeof i!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const r=new qe(n);let f;const o=l=>{let h;f&&(l=Buffer.concat([f,l]),f=void 0);try{h=r.unpackMultiple(l)}catch(w){if(w.incomplete)f=l.slice(w.lastPosition),h=w.values;else throw w}return h};if(typeof i[Symbol.iterator]=="function")return function*(){for(const h of i)yield*o(h)}();if(typeof i[Symbol.asyncIterator]=="function")return async function*(){for await(const h of i)yield*o(h)}()}const Ui=Fi,zi=Bi,Vi=!1,qi=!0,Hi=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:Ni,C1:mn,DECIMAL_FIT:Mi,DECIMAL_ROUND:ki,Decoder:wi,Encoder:Pi,FLOAT32_OPTIONS:ms,NEVER:Di,Packr:mt,RESERVE_START_SPACE:Os,RESET_BUFFER_MODE:bs,REUSE_BUFFER_MODE:Es,Unpackr:qe,addExtension:Ri,clearSource:kt,decode:Oi,decodeIter:Ui,encode:$i,encodeIter:zi,isNativeAccelerationEnabled:hi,mapsAsObjects:qi,pack:vi,roundFloat32:Ii,unpack:Ei,unpackMultiple:bi,useRecords:Vi},Symbol.toStringTag,{value:"Module"})),Wi=dn(Hi);var Or;function xs(){if(Or)return Yt;Or=1;var i=oi(),n=rs(),r=ss(),f=is(),o=ai(),l=gn(),h=os(),w=jt(),v=Wi;let I=class Is{constructor(d,x){this.onStateChange=o.createSignal(),this.onError=o.createSignal(),this.onLeave=o.createSignal(),this.onJoin=o.createSignal(),this.hasJoined=!1,this.onMessageHandlers=f.createNanoEvents(),this.roomId=null,this.name=d,this.packr=new v.Packr,this.packr.encode(void 0),x&&(this.serializer=new(r.getSerializer("schema")),this.rootSchema=x,this.serializer.state=new x),this.onError((S,N)=>{var j;return(j=console.warn)===null||j===void 0?void 0:j.call(console,`colyseus.js - onError => (${S}) ${N}`)}),this.onLeave(()=>this.removeAllListeners())}connect(d,x,S=this,N,j){const V=new i.Connection(N.protocol);if(S.connection=V,V.events.onmessage=Is.prototype.onMessageCallback.bind(S),V.events.onclose=function(H){var G;if(!S.hasJoined){(G=console.warn)===null||G===void 0||G.call(console,`Room connection was closed unexpectedly (${H.code}): ${H.reason}`),S.onError.invoke(H.code,H.reason);return}H.code===w.CloseCode.DEVMODE_RESTART&&x?x():(S.onLeave.invoke(H.code,H.reason),S.destroy())},V.events.onerror=function(H){var G;(G=console.warn)===null||G===void 0||G.call(console,`Room, onError (${H.code}): ${H.reason}`),S.onError.invoke(H.code,H.reason)},N.protocol==="h3"){const H=new URL(d);V.connect(H.origin,N)}else V.connect(d,j)}leave(d=!0){return new Promise(x=>{this.onLeave(S=>x(S)),this.connection?d?(this.packr.buffer[0]=n.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(w.CloseCode.CONSENTED)})}onMessage(d,x){return this.onMessageHandlers.on(this.getMessageHandlerKey(d),x)}send(d,x){const S={offset:1};this.packr.buffer[0]=n.Protocol.ROOM_DATA,typeof d=="string"?l.encode.string(this.packr.buffer,d,S):l.encode.number(this.packr.buffer,d,S),this.packr.position=0;const N=x!==void 0?this.packr.pack(x,2048+S.offset):this.packr.buffer.subarray(0,S.offset);this.connection.send(N)}sendUnreliable(d,x){const S={offset:1};this.packr.buffer[0]=n.Protocol.ROOM_DATA,typeof d=="string"?l.encode.string(this.packr.buffer,d,S):l.encode.number(this.packr.buffer,d,S),this.packr.position=0;const N=x!==void 0?this.packr.pack(x,2048+S.offset):this.packr.buffer.subarray(0,S.offset);this.connection.sendUnreliable(N)}sendBytes(d,x){const S={offset:1};if(this.packr.buffer[0]=n.Protocol.ROOM_DATA_BYTES,typeof d=="string"?l.encode.string(this.packr.buffer,d,S):l.encode.number(this.packr.buffer,d,S),x.byteLength+S.offset>this.packr.buffer.byteLength){const N=new Uint8Array(S.offset+x.byteLength);N.set(this.packr.buffer),this.packr.useBuffer(N)}this.packr.buffer.set(x,S.offset),this.connection.send(this.packr.buffer.subarray(0,S.offset+x.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof h.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(d){const x=new Uint8Array(d.data),S={offset:1},N=x[0];if(N===n.Protocol.JOIN_ROOM){const j=l.decode.utf8Read(x,S,x[S.offset++]);if(this.serializerId=l.decode.utf8Read(x,S,x[S.offset++]),!this.serializer){const V=r.getSerializer(this.serializerId);this.serializer=new V}x.byteLength>S.offset&&this.serializer.handshake&&this.serializer.handshake(x,S),this.reconnectionToken=`${this.roomId}:${j}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=n.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(N===n.Protocol.ERROR){const j=l.decode.number(x,S),V=l.decode.string(x,S);this.onError.invoke(j,V)}else if(N===n.Protocol.LEAVE_ROOM)this.leave();else if(N===n.Protocol.ROOM_STATE)this.serializer.setState(x,S),this.onStateChange.invoke(this.serializer.getState());else if(N===n.Protocol.ROOM_STATE_PATCH)this.serializer.patch(x,S),this.onStateChange.invoke(this.serializer.getState());else if(N===n.Protocol.ROOM_DATA){const j=l.decode.stringCheck(x,S)?l.decode.string(x,S):l.decode.number(x,S),V=x.byteLength>S.offset?v.unpack(x,{start:S.offset}):void 0;this.dispatchMessage(j,V)}else if(N===n.Protocol.ROOM_DATA_BYTES){const j=l.decode.stringCheck(x,S)?l.decode.string(x,S):l.decode.number(x,S);this.dispatchMessage(j,x.subarray(S.offset))}}dispatchMessage(d,x){var S;const N=this.getMessageHandlerKey(d);this.onMessageHandlers.events[N]?this.onMessageHandlers.emit(N,x):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",d,x):(S=console.warn)===null||S===void 0||S.call(console,`colyseus.js: onMessage() not registered for type '${d}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(d){switch(typeof d){case"string":return d;case"number":return`i${d}`;default:throw new Error("invalid message type.")}}};return Yt.Room=I,Yt}var rn={};function Ir(i,n){n.headers=i.headers||{},n.statusMessage=i.statusText,n.statusCode=i.status,n.data=i.response}function Ce(i,n,r){return new Promise(function(f,o){r=r||{};var l=new XMLHttpRequest,h,w,v,I=r.body,$=r.headers||{};r.timeout&&(l.timeout=r.timeout),l.ontimeout=l.onerror=function(d){d.timeout=d.type=="timeout",o(d)},l.open(i,n.href||n),l.onload=function(){for(v=l.getAllResponseHeaders().trim().split(/[\r\n]+/),Ir(l,l);w=v.shift();)w=w.split(": "),l.headers[w.shift().toLowerCase()]=w.join(": ");if(w=l.headers["content-type"],w&&~w.indexOf("application/json"))try{l.data=JSON.parse(l.data,r.reviver)}catch(d){return Ir(l,d),o(d)}(l.status>=400?o:f)(l)},typeof FormData<"u"&&I instanceof FormData||I&&typeof I=="object"&&($["content-type"]="application/json",I=JSON.stringify(I)),l.withCredentials=!!r.withCredentials;for(h in $)l.setRequestHeader(h,$[h]);l.send(I)})}var Ji=Ce.bind(Ce,"GET"),Ki=Ce.bind(Ce,"POST"),Yi=Ce.bind(Ce,"PATCH"),Gi=Ce.bind(Ce,"DELETE"),Zi=Ce.bind(Ce,"PUT");const Xi=Object.freeze(Object.defineProperty({__proto__:null,del:Gi,get:Ji,patch:Yi,post:Ki,put:Zi,send:Ce},Symbol.toStringTag,{value:"Module"})),Qi=dn(Xi);var xr;function eo(){if(xr)return rn;xr=1;var i=jt(),n=Qi;function r(l){var h=Object.create(null);return l&&Object.keys(l).forEach(function(w){if(w!=="default"){var v=Object.getOwnPropertyDescriptor(l,w);Object.defineProperty(h,w,v.get?v:{enumerable:!0,get:function(){return l[w]}})}}),h.default=l,Object.freeze(h)}var f=r(n);let o=class{constructor(h,w={}){this.client=h,this.headers=w}get(h,w={}){return this.request("get",h,w)}post(h,w={}){return this.request("post",h,w)}del(h,w={}){return this.request("del",h,w)}put(h,w={}){return this.request("put",h,w)}request(h,w,v={}){return f[h](this.client.getHttpEndpoint(w),this.getOptions(v)).catch(I=>{var $;const d=I.statusCode,x=(($=I.data)===null||$===void 0?void 0:$.error)||I.statusMessage||I.message;throw!d&&!x?I:new i.ServerError(d,x)})}getOptions(h){return h.headers=Object.assign({},this.headers,h.headers),this.authToken&&(h.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(h.withCredentials=!0),h}};return rn.HTTP=o,rn}var sn={},dt={},Sr;function to(){if(Sr)return dt;Sr=1;var i=Lt;let n;function r(){if(!n)try{n=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!n&&typeof globalThis.indexedDB<"u"&&(n=new h),n||(n={cache:{},setItem:function(w,v){this.cache[w]=v},getItem:function(w){this.cache[w]},removeItem:function(w){delete this.cache[w]}}),n}function f(w,v){r().setItem(w,v)}function o(w){r().removeItem(w)}function l(w,v){const I=r().getItem(w);typeof Promise>"u"||!(I instanceof Promise)?v(I):I.then($=>v($))}class h{constructor(){this.dbPromise=new Promise(v=>{const I=indexedDB.open("_colyseus_storage",1);I.onupgradeneeded=()=>I.result.createObjectStore("store"),I.onsuccess=()=>v(I.result)})}tx(v,I){return i.__awaiter(this,void 0,void 0,function*(){const d=(yield this.dbPromise).transaction("store",v).objectStore("store");return I(d)})}setItem(v,I){return this.tx("readwrite",$=>$.put(I,v)).then()}getItem(v){return i.__awaiter(this,void 0,void 0,function*(){const I=yield this.tx("readonly",$=>$.get(v));return new Promise($=>{I.onsuccess=()=>$(I.result)})})}removeItem(v){return this.tx("readwrite",I=>I.delete(v)).then()}}return dt.getItem=l,dt.removeItem=o,dt.setItem=f,dt}var Ar;function Ss(){if(Ar)return sn;Ar=1;var i=Lt,n=to(),r=is(),f,o,l,h;let w=class{constructor(I){this.http=I,this.settings={path:"/auth",key:"colyseus-auth-token"},f.set(this,!1),o.set(this,void 0),l.set(this,void 0),h.set(this,r.createNanoEvents()),n.getItem(this.settings.key,$=>this.token=$)}set token(I){this.http.authToken=I}get token(){return this.http.authToken}onChange(I){const $=i.__classPrivateFieldGet(this,h,"f").on("change",I);return i.__classPrivateFieldGet(this,f,"f")||i.__classPrivateFieldSet(this,o,new Promise((d,x)=>{this.getUserData().then(S=>{this.emitChange(Object.assign(Object.assign({},S),{token:this.token}))}).catch(S=>{this.emitChange({user:null,token:void 0})}).finally(()=>{d()})}),"f"),i.__classPrivateFieldSet(this,f,!0,"f"),$}getUserData(){return i.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(I,$,d){return i.__awaiter(this,void 0,void 0,function*(){const x=(yield this.http.post(`${this.settings.path}/register`,{body:{email:I,password:$,options:d}})).data;return this.emitChange(x),x})}signInWithEmailAndPassword(I,$){return i.__awaiter(this,void 0,void 0,function*(){const d=(yield this.http.post(`${this.settings.path}/login`,{body:{email:I,password:$}})).data;return this.emitChange(d),d})}signInAnonymously(I){return i.__awaiter(this,void 0,void 0,function*(){const $=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:I}})).data;return this.emitChange($),$})}sendPasswordResetEmail(I){return i.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:I}})).data})}signInWithProvider(I){return i.__awaiter(this,arguments,void 0,function*($,d={}){return new Promise((x,S)=>{const N=d.width||480,j=d.height||768,V=this.token?`?token=${this.token}`:"",H=`Login with ${$[0].toUpperCase()+$.substring(1)}`,G=this.http.client.getHttpEndpoint(`${d.prefix||`${this.settings.path}/provider`}/${$}${V}`),oe=screen.width/2-N/2,Q=screen.height/2-j/2;i.__classPrivateFieldSet(this,l,window.open(G,H,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+N+", height="+j+", top="+Q+", left="+oe),"f");const pe=ye=>{ye.data.user===void 0&&ye.data.token===void 0||(clearInterval(Ie),i.__classPrivateFieldGet(this,l,"f").close(),i.__classPrivateFieldSet(this,l,void 0,"f"),window.removeEventListener("message",pe),ye.data.error!==void 0?S(ye.data.error):(x(ye.data),this.emitChange(ye.data)))},Ie=setInterval(()=>{(!i.__classPrivateFieldGet(this,l,"f")||i.__classPrivateFieldGet(this,l,"f").closed)&&(i.__classPrivateFieldSet(this,l,void 0,"f"),S("cancelled"),window.removeEventListener("message",pe))},200);window.addEventListener("message",pe)})})}signOut(){return i.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(I){I.token!==void 0&&(this.token=I.token,I.token===null?n.removeItem(this.settings.key):n.setItem(this.settings.key,I.token)),i.__classPrivateFieldGet(this,h,"f").emit("change",I)}};return f=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,sn.Auth=w,sn}var on={},Tr;function no(){if(Tr)return on;Tr=1;function i(n){var r;const f=((r=window==null?void 0:window.location)===null||r===void 0?void 0:r.hostname)||"localhost",o=n.hostname.split("."),l=!n.hostname.includes("trycloudflare.com")&&!n.hostname.includes("discordsays.com")&&o.length>2?`/${o[0]}`:"";return n.pathname.startsWith("/.proxy")?`${n.protocol}//${f}${l}${n.pathname}${n.search}`:`${n.protocol}//${f}/.proxy/colyseus${l}${n.pathname}${n.search}`}return on.discordURLBuilder=i,on}var _r;function ro(){if(_r)return Tt;_r=1;var i=Lt,n=jt(),r=xs(),f=eo(),o=Ss(),l=no(),h;class w extends Error{constructor(d,x){super(d),this.code=x,this.name="MatchMakeError",Object.setPrototypeOf(this,w.prototype)}}const v=typeof window<"u"&&typeof((h=window==null?void 0:window.location)===null||h===void 0?void 0:h.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";let I=class{constructor(d=v,x){var S,N;if(typeof d=="string"){const j=d.startsWith("/")?new URL(d,v):new URL(d),V=j.protocol==="https:"||j.protocol==="wss:",H=Number(j.port||(V?443:80));this.settings={hostname:j.hostname,pathname:j.pathname,port:H,secure:V}}else d.port===void 0&&(d.port=d.secure?443:80),d.pathname===void 0&&(d.pathname=""),this.settings=d;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new f.HTTP(this,(x==null?void 0:x.headers)||{}),this.auth=new o.Auth(this.http),this.urlBuilder=x==null?void 0:x.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((N=(S=window==null?void 0:window.location)===null||S===void 0?void 0:S.hostname)===null||N===void 0)&&N.includes("discordsays.com"))&&(this.urlBuilder=l.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(d){return i.__awaiter(this,arguments,void 0,function*(x,S={},N){return yield this.createMatchMakeRequest("joinOrCreate",x,S,N)})}create(d){return i.__awaiter(this,arguments,void 0,function*(x,S={},N){return yield this.createMatchMakeRequest("create",x,S,N)})}join(d){return i.__awaiter(this,arguments,void 0,function*(x,S={},N){return yield this.createMatchMakeRequest("join",x,S,N)})}joinById(d){return i.__awaiter(this,arguments,void 0,function*(x,S={},N){return yield this.createMatchMakeRequest("joinById",x,S,N)})}reconnect(d,x){return i.__awaiter(this,void 0,void 0,function*(){if(typeof d=="string"&&typeof x=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[S,N]=d.split(":");if(!S||!N)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",S,{reconnectionToken:N},x)})}consumeSeatReservation(d,x,S){return i.__awaiter(this,void 0,void 0,function*(){const N=this.createRoom(d.room.name,x);N.roomId=d.room.roomId,N.sessionId=d.sessionId;const j={sessionId:N.sessionId};d.reconnectionToken&&(j.reconnectionToken=d.reconnectionToken);const V=S||N;return N.connect(this.buildEndpoint(d.room,j,d.protocol),d.devMode&&(()=>i.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${N.roomId}'...`);let H=0,G=8;const oe=()=>i.__awaiter(this,void 0,void 0,function*(){H++;try{yield this.consumeSeatReservation(d,x,V),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${N.roomId}'`)}catch{H<G?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${H} out of ${G})`),setTimeout(oe,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(oe,2e3)})),V,d,this.http.headers),new Promise((H,G)=>{const oe=(Q,pe)=>G(new n.ServerError(Q,pe));V.onError.once(oe),V.onJoin.once(()=>{V.onError.remove(oe),H(V)})})})}createMatchMakeRequest(d,x){return i.__awaiter(this,arguments,void 0,function*(S,N,j={},V,H){const G=(yield this.http.post(`matchmake/${S}/${N}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(j)})).data;if(G.error)throw new w(G.error,G.code);return S==="reconnect"&&(G.reconnectionToken=j.reconnectionToken),yield this.consumeSeatReservation(G,V,H)})}createRoom(d,x){return new r.Room(d,x)}buildEndpoint(d,x={},S="ws"){const N=[];for(const H in x)x.hasOwnProperty(H)&&N.push(`${H}=${x[H]}`);S==="h3"&&(S="http");let j=this.settings.secure?`${S}s://`:`${S}://`;d.publicAddress?j+=`${d.publicAddress}`:j+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const V=`${j}/${d.processId}/${d.roomId}?${N.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(V)):V}getHttpEndpoint(d=""){const x=d.startsWith("/")?d:`/${d}`,S=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${x}`;return this.urlBuilder?this.urlBuilder(new URL(S)):S}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}};return I.VERSION="0.16.15",Tt.Client=I,Tt.MatchMakeError=w,Tt}var an={},Rr;function so(){if(Rr)return an;Rr=1;let i=class{setState(r){}getState(){return null}patch(r){}teardown(){}handshake(r){}};return an.NoneSerializer=i,an}var Cr;function mo(){return Cr||(Cr=1,function(i){Zs();var n=ro(),r=rs(),f=xs(),o=Ss(),l=jt(),h=os(),w=so(),v=ss();v.registerSerializer("schema",h.SchemaSerializer),v.registerSerializer("none",w.NoneSerializer),i.Client=n.Client,i.MatchMakeError=n.MatchMakeError,Object.defineProperty(i,"ErrorCode",{enumerable:!0,get:function(){return r.ErrorCode}}),Object.defineProperty(i,"Protocol",{enumerable:!0,get:function(){return r.Protocol}}),i.Room=f.Room,i.Auth=o.Auth,i.ServerError=l.ServerError,i.SchemaSerializer=h.SchemaSerializer,i.getStateCallbacks=h.getStateCallbacks,i.registerSerializer=v.registerSerializer}(Jt)),Jt}export{mo as r};
