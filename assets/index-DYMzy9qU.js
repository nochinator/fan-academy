var _t=Object.defineProperty;var vt=(t,a,e)=>a in t?_t(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e;var n=(t,a,e)=>vt(t,typeof a!="symbol"?a+"":a,e);import{r as Dt,a as kt}from"./phaser-LhFSXt8Z.js";import{r as Rt}from"./colyseus.js-BZ3dtEL4.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();var ht=Dt();const ve=kt(ht);var Ot=Rt(),z=(t=>(t.PHYSICAL="physical",t.MAGICAL="magical",t))(z||{}),N=(t=>(t.SEARCHING="searching",t.PLAYING="playing",t.FINISHED="finished",t.CHALLENGE="challenge",t))(N||{}),He=(t=>(t.CRYSTAL="Crystal victory",t.UNITS="Hero victory",t.TIME="Timeout",t.CONCEDED="Game conceded",t))(He||{}),B=(t=>(t.COUNCIL="Council",t.DARK_ELVES="Dark Elves",t.DWARVES="Dwarves",t))(B||{}),b=(t=>(t.MOVE="move",t.ATTACK="attack",t.HEAL="heal",t.SPAWN="spawn",t.SPAWN_PHANTOM="phantom",t.USE="use",t.SHUFFLE="shuffle",t.SPECIAL="special",t.CONCEDE="concede",t.DRAW="draw",t.PASS="pass",t.REMOVE_UNITS="removeUnits",t))(b||{}),Te=(t=>(t.USER="user",t.AUTO="automatic",t))(Te||{}),S=(t=>(t.SHINING_HELM="shiningHelm",t.RUNE_METAL="runeMetal",t.SUPERCHARGE="superCharge",t.DRAGON_SCALE="dragonScale",t.HEALING_POTION="healingPotion",t.INFERNO="inferno",t.SOUL_STONE="soulStone",t.SOUL_HARVEST="soulHarvest",t.MANA_VIAL="manaVial",t.DWARVERN_BREW="dwarvernBrew",t.PULVERIZER="pulverizer",t))(S||{}),j=(t=>(t.HERO="hero",t.ITEM="item",t))(j||{}),g=(t=>(t.ARCHER="archer",t.CLERIC="cleric",t.KNIGHT="knight",t.NINJA="ninja",t.WIZARD="wizard",t.PRIESTESS="priestess",t.IMPALER="impaler",t.NECROMANCER="necromancer",t.PHANTOM="phantom",t.VOIDMONK="voidmonk",t.WRAITH="wraith",t.PALADIN="paladin",t.GRENADIER="grenadier",t.GUNNER="gunner",t.ENGINEER="engineer",t.ANNIHILATOR="annihilator",t))(g||{}),A=(t=>(t.BASIC="basic",t.POWER="powerTile",t.PHYSICAL_RESISTANCE="shieldTile",t.MAGICAL_RESISTANCE="helmetTile",t.CRYSTAL_DAMAGE="crystalDamageTile",t.TELEPORTER="teleporterTile",t.CRYSTAL="crystal",t.CRYSTAL_BIG="crystalBig",t.CRYSTAL_SMALL="crystalSmall",t.SPAWN="spawnTile",t.SPEED="speedTile",t.PALADIN_AURA="paladinAura",t))(A||{}),Y=(t=>(t.MOVE="move",t.ATTACK="attack",t.HEAL="healing",t))(Y||{}),v=(t=>(t.SHOOTER="Shooter",t.FIGHTER="Fighter",t.CASTER="Caster",t.SUPPORT="Support",t.EQUIPMENT="Equipment",t.BUFF="Buff",t.VICTORY="Victory Unit",t.SUPER="Super Unit",t.SUMMONED="Summoned",t.SPELL="Spell",t.CONSUMABLE="Consumable",t.SPECIAL_TILE="Special Tile",t))(v||{}),he=(t=>(t.SEND="send",t.ACCEPT="accept",t))(he||{}),C=(t=>(t.BUTTON_PLAY="battleButtonSound",t.BUTTON_GENERIC="buttonPressGenericSound",t.BUTTON_FAILED="buttonFailedSound",t.GAME_DELETE="deleteGameSound",t.RESIGN="resignSound",t.WIN_SFX="winSFXSound",t.LOSE_SFX="loseSFXSound",t))(C||{}),m=(t=>(t.HERO_HAND_SELECT="selectHeroFromHandSound",t.HERO_BOARD_SELECT="selectHeroFromBoardSound",t.HERO_SPAWN="spawnHeroSound",t.HERO_MOVE="moveHeroSound",t.MOVE_FLY="moveFlySound",t.MOVE_WALK="moveWalkSound",t.HEAL="healSound",t.HEAL_EXTRA="healExtraSound",t.HERO_STOMP="stompSound",t.VANISH="vanishSound",t.HERO_REVIVE="reviveHeroSound",t.SCROLL_SELECT="selectScrollSound",t.RUNE_METAL_SELECT="selectRuneMetalSound",t.SHIELD_SELECT="selectDragonScaleSound",t.ITEM_SELECT="selectItemGenericSound",t.POTION_SELECT="selectPotionSound",t.AOE_SPELL_SELECT="selectInfernoSound",t.SCROLL_USE="useScrollSound",t.RUNE_METAL_USE="useRuneMetalSound",t.DRAGON_SCALE_USE="useDragonScaleSound",t.ITEM_USE="useItemGenericSound",t.POTION_USE="usePotionSound",t.SWORD_TILE="swordTileSound",t.SHIELD_TILE="shieldTileSound",t.HELM_TILE="helmTileSound",t.CRYSTAL_TILE="crystalTileSound",t.RESET_TURN="resetTurnSound",t.DRAW="newItemsSound",t.SHUFFLE="returnItemSound",t.CRYSTAL_DAMAGE="damageCrystal1Sound",t.CRYSTAL_DAMAGE_BUFF="damageCrystal2Sound",t.CRYSTAL_DESTROY="destroyCrystalSound",t.ARCHER_ATTACK="archerAttackSound",t.ARCHER_ATTACK_BIG="archerAttackBigSound",t.ARCHER_ATTACK_MELEE="archerAttackMeleeSound",t.ARCHER_DEATH="archerDeathSound",t.CLERIC_ATTACK="clericAttackSound",t.CLERIC_ATTACK_BIG="clericAttackBigSound",t.CLERIC_DEATH="clericDeathSound",t.KNIGHT_ATTACK="knightAttackSound",t.KNIGHT_ATTACK_BIG="knightAttackBigSound",t.KNIGHT_DEATH="knightDeathSound",t.NINJA_ATTACK="ninjaAttackSound",t.NINJA_ATTACK_BIG="ninjaAttackBigSound",t.NINJA_ATTACK_RANGED="ninjaAttackRangedSound",t.NINJA_DEATH="ninjaDeathSound",t.NINJA_SMOKE="ninjaSmokeSound",t.WIZARD_ATTACK="wizardAttackSound",t.WIZARD_ATTACK_BIG="wizardAttackBigSound",t.WIZARD_DEATH="wizardDeathSound",t.INFERNO_USE="useInfernoSound",t.PRIESTESS_ATTACK="priestessAttackSound",t.PRIESTESS_DEATH="priestessDeathSound",t.IMPALER_ATTACK="impalerAttackSound",t.IMPALER_ATTACK_BIG="impalerAttackBigSound",t.IMPALER_ATTACK_MELEE="impalerAttackMeleeSound",t.IMPALER_DEATH="impalerDeathSound",t.NECROMANCER_ATTACK="necroAttackSound",t.NECROMANCER_ATTACK_BIG="necroAttackBigSound",t.NECROMANCER_DEATH="necromancerDeathSound",t.PHANTOM_SPAWN="phantomSpawnSound",t.PHANTOM_DEATH="phantomDeathSound",t.VOIDMONK_ATTACK="voidmonkAttackSound",t.VOIDMONK_ATTACK_BIG="voidmonkAttackBigSound",t.VOIDMONK_DEATH="voidmonkDeathSound",t.WRAITH_ATTACK="wraithAttackSound",t.WRAITH_ATTACK_BIG="wraithAttackBigSound",t.WRAITH_DEATH="wraithDeathSound",t.WRAITH_CONSUME="wraithConsumeSound",t.USE_HARVEST="useHarvestSound",t.PALADIN_HEAL="paladinHealSound",t.PALADIN_ATTACK="paladinAttackSound",t.PALADIN_ATTACK_BIG="paladinAttackBigSound",t.PALADIN_DEATH="paladinDeath",t.ENGINEER_ATTACK="engineerAttackSound",t.ENGINEER_ATTACK_BIG="engineerAttackBigSound",t.ENGINEER_SHIELD_MAKE="engineerShieldMake",t.ENGINEER_SHIELD_BREAK="engineerShieldBreak",t.GRENADIER_ATTACK="grenadierAttack",t.GRENADIER_ATTACK_BIG="grenadierAttackBig",t.GRENADIER_ATTACK_MELEE="grenadierAttackMelee",t.GRENADIER_DEATH="grenadierDeath",t.GUNNER_ATTACK="gunnerAttack",t.GUNNER_JUMP="gunnerJump",t.GUNNER_ATTACK_ONLY="gunnerAttackGunOnly",t.GUNNER_DEATH="gunnerDeath",t.ANNIHILATOR_SHOOT="annihilatorShoot",t.ANNIHILATOR_HIT="annihilatorHit",t.ANNIHILATOR_WINDUP="annihilatorWindup",t.BREW_SELECT="brewSelect",t.BREW_USE="brewUse",t.DRILL_SELECT="drillSelect",t.DRILL_USE="drillUse",t))(m||{});class Ht extends Phaser.GameObjects.Container{constructor(e){super(e,50,50);n(this,"button");n(this,"buttonText");this.button=e.add.image(10,-25,"playButton").setDisplaySize(100,50).setOrigin(.5).setInteractive({useHandCursor:!0}),this.buttonText=e.add.text(10,-25,"Home",{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.add([this.button,this.buttonText]).setScale(.8),this.button.on("pointerdown",async()=>{var o,r;this.scene.sound.play(C.BUTTON_GENERIC),await((o=e.lobbyRoom)==null?void 0:o.leave()),await((r=e.currentRoom)==null?void 0:r.leave()),e.currentRoom=void 0,e.scene.stop("GameScene"),e.scene.start("MainMenuScene")}),e.add.existing(this)}}async function Nt(t){console.log("Fetching game list...");const a=localStorage.getItem("jwt"),e=`https://scribble-academy-be.onrender.com/games/playing?userId=${encodeURIComponent(t)}`,i=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),s=await i.json();return i.status!==200?(console.log("Error fetching the game list..."),[]):(console.log("Game list fetched..."),s)}async function Bt(t,a,e){const i=localStorage.getItem("jwt");console.log("Sending challenge to player... ");const s=`https://scribble-academy-be.onrender.com/games/newGame?userId=${encodeURIComponent(t)}&faction=${encodeURIComponent(a)}&opponentId=${encodeURIComponent(e)}`,o=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}}),r=await o.json();return o.status!==200?(console.error("Error sending challenge...",r.message),null):(console.log("Challenge sent",r),r)}function Fe(t){var a;return((a=t.player1)==null?void 0:a.playerId)===t.userId?{player:"player1",opponent:"player2"}:{player:"player2",opponent:"player1"}}function xe(t){return t.isPlayerOne?t.player1:t.player2}function dt(t){const e=/[a-zA-Z]/.test(t),i=/\d/.test(t);return t.length>=8&&e&&i}function qe(t,a){var e,i;a.isActive=!0,t.activeUnit=a,a.class===j.HERO&&((e=t.gameController)==null||e.onHeroClicked(a)),a.class===j.ITEM&&((i=t.gameController)==null||i.onItemClicked(a))}function ye(t){var a,e;t.activeUnit&&(t.activeUnit.isActive=!1,t.activeUnit=void 0,(a=t.gameController)==null||a.board.clearHighlights(),(e=t.gameController)==null||e.board.removeReticles())}function ut(t,a){t.on("pointerdown",(e,i,s,o)=>{a.currentGame.status!==N.FINISHED&&(Ne(a),e.button===2&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t,o.stopPropagation()),a.longPressStart=a.time.now,e.button===0&&Lt(t,a))}),t.on("pointerup",e=>{a.currentGame.status!==N.FINISHED&&e.button!==2&&a.longPressStart&&a.time.now-a.longPressStart>500&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t)})}function Lt(t,a){if(console.log(`Unit in ${t.boardPosition}`,t),a.activePlayer!==a.userId||a.currentTurnAction>5)return;const e=a.activeUnit,i=me(a,t),s=R(t)&&!i,o=(e==null?void 0:e.unitId)===t.unitId,r=R(t)?t.getByName("healReticle"):void 0,c=R(t)?t.getByName("attackReticle"):void 0,d=R(t)?t.getByName("allyReticle"):void 0;if(!e&&i){if(R(t)&&t.isKO)return;t.boardPosition>=45?(R(t)&&f(a,m.HERO_HAND_SELECT),ae(t)&&Qe(a,t.itemType)):f(a,m.HERO_BOARD_SELECT),qe(a,t);return}if(o){if(R(e)&&e.canHeal&&(r!=null&&r.visible)&&R(t)){e.heal(t);return}else ye(a);return}if(e&&!o){if(R(t)&&t.isKO&&R(e)&&e.unitType===g.WRAITH&&e.boardPosition>=45&&!F(a,t.getTile())){e.spawn(t.getTile());return}if(s){const h=a.gameController.board.getTileFromBoardPosition(t.boardPosition);if(R(e)&&(c!=null&&c.visible)){e.attack(t);return}if(R(e)&&e.boardPosition<45){const p=a.gameController.board.getHeroTilesInRange(e,Y.MOVE).find(y=>y.boardPosition===t.boardPosition);if(t.isKO&&e.unitType!==g.NECROMANCER&&(p||h.isHighlighted)){e.move(h);return}if(t.isKO&&e.unitType===g.NECROMANCER&&t.blockedLOS.visible&&(p||h.isHighlighted)){e.move(h);return}}if(R(e)&&e.boardPosition>=45&&(t.isKO||t.unitType===g.PHANTOM)&&!F(a,h)&&h.isHighlighted){e.spawn(t.getTile());return}if(R(e)&&e.boardPosition>=45&&t.unitType===g.PHANTOM&&!F(a,h)){e.spawn(t.getTile());return}if(ae(e)&&e.dealsDamage){e.use(t.getTile());return}}if(R(t)&&i&&t.boardPosition<45){if(R(e)&&[g.NECROMANCER,g.WRAITH].includes(e.unitType)&&t.isKO&&(c!=null&&c.visible)){e.attack(t);return}if(R(e)){const h=t.getTile();if(t.isKO&&h.tileType===A.SPAWN&&h.isHighlighted&&e.boardPosition>=45){e.spawn(h);return}if(e.canHeal&&(r!=null&&r.visible)){e.heal(t);return}if(e.unitType===g.NINJA&&(d!=null&&d.visible)&&!t.isKO){e.special(t);return}if(e.unitType===g.ENGINEER&&(r!=null&&r.visible)&&!t.isKO){e.special(t);return}if(e.boardPosition<45){const p=a.gameController.board.getHeroTilesInRange(e,Y.MOVE).find(y=>y.boardPosition===t.boardPosition);if(t.isKO&&e.unitType!==g.NECROMANCER&&(p||h.isHighlighted)){const y=a.gameController.board.getTileFromBoardPosition(t.boardPosition);e.move(y);return}}}if(ae(e)){if(t.isAlreadyEquipped(e)||t.unitType===g.PHANTOM)return;e.dealsDamage&&e.use(t.getTile()),!e.dealsDamage&&(!t.isKO||e.itemType===S.HEALING_POTION)&&e.use(t);return}}if(i){if(R(t)&&t.isKO)return;ye(a),t.boardPosition>=45?(R(t)&&f(a,m.HERO_HAND_SELECT),ae(t)&&Qe(a,t.itemType)):f(a,m.HERO_BOARD_SELECT),qe(a,t);return}}}function Mt(t,a){t.on("pointerdown",(e,i,s,o)=>{if(a.currentGame.status===N.FINISHED)return;if(Ne(a),a.longPressStart=a.time.now,e.button===2){const d=t.tileType!==A.BASIC&&t.tileType!==A.CRYSTAL,h=!t.hero&&!t.crystal;d&&h&&(t.setDepth(1001),t.unitCard&&t.unitCard.setVisible(!0),a.visibleUnitCard=t,o.stopPropagation())}if(a.activePlayer!==a.userId||a.currentTurnAction>5)return;const r=a.activeUnit,c=a.gameController;!r||!c||(r.boardPosition<45&&t.isHighlighted&&R(r)&&(r.move(t),f(a,m.HERO_MOVE)),r.boardPosition>44&&t.isHighlighted&&(R(r)&&r.spawn(t),ae(r)&&r.dealsDamage&&r.use(t)))}),a.input.on("pointerdown",()=>{t.icon&&t.icon.setDepth(2)}),t.on("pointerup",()=>{a.currentGame.status!==N.FINISHED&&a.longPressStart&&a.time.now-a.longPressStart>500&&(t.setDepth(1001),t.unitCard&&t.unitCard.setVisible(!0),a.visibleUnitCard=t)}),t.on("pointerout",()=>{a.visibleUnitCard||(t.icon&&t.icon.setDepth(2),t.unitCard&&t.unitCard.setVisible(!1))})}function $t(t,a){t.on("pointerdown",(e,i,s,o)=>{if(a.currentGame.status!==N.FINISHED&&(console.log(`Crystal on ${t.boardPosition}`,t),Ne(a),e.button===2&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t,o.stopPropagation()),a.longPressStart=a.time.now,e.button===0)){const r=t.attackReticle,c=a.activeUnit;if(c){if(R(c)&&r.visible){c.attack(t);return}if(ae(c)&&(c!=null&&c.dealsDamage)){c.use(t.getTile());return}}}}),t.on("pointerup",()=>{a.currentGame.status!==N.FINISHED&&a.longPressStart&&a.time.now-a.longPressStart>500&&(t.setDepth(1001),t.unitCard.setVisible(!0),a.visibleUnitCard=t)}),t.on("pointerout",()=>{a.visibleUnitCard||(t.setDepth(t.row+10),t.unitCard.setVisible(!1))})}class Ft extends Phaser.GameObjects.Container{constructor(e,i){super(e,0,0);n(this,"cardBackgroundImage");n(this,"unitPictureImage");n(this,"cardSeparatorImage");n(this,"hpBackgroundImage");n(this,"hpBarImage");n(this,"magicalResistanceImage");n(this,"physicalResistanceImage");n(this,"hpIconImage");n(this,"context");n(this,"currentHpText");n(this,"magicalResistanceText");n(this,"physicalResistanceText");n(this,"cardFlavorText");n(this,"cardTypeText");n(this,"cardNameText");this.context=e,this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,"crystalCardPic").setOrigin(.5).setScale(.4),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3),this.cardNameText=this.context.add.text(55,-170,"Crystal",{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,"Victory Unit",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.hpBackgroundImage=e.add.image(-60,-60,"hpBackground").setOrigin(.5),this.hpBarImage=e.add.image(-118,-72,"hpBar").setOrigin(0),this.setHealthBar(i.currentHealth,i.maxHealth),this.currentHpText=this.context.add.text(100,-60,`${i.currentHealth}/${i.maxHealth}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.hpIconImage=e.add.image(-150,-60,"hpIcon").setOrigin(.5),this.magicalResistanceImage=e.add.image(40,-10,"magicalResistance").setOrigin(.5),this.magicalResistanceText=this.context.add.text(100,-10,`${i.magicalDamageResistance}%`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.physicalResistanceImage=e.add.image(-150,-10,"physicalResistance").setOrigin(.5),this.physicalResistanceText=this.context.add.text(-85,-10,`${i.physicalDamageResistance}%`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}).setOrigin(.5),this.cardFlavorText=this.context.add.text(0,50,"Destroy all crystals to win the game!",{fontFamily:"proLight",fontSize:30,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(.5),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.hpBackgroundImage,this.hpBarImage,this.magicalResistanceImage,this.physicalResistanceImage,this.hpIconImage,this.currentHpText,this.cardFlavorText,this.cardTypeText,this.cardNameText,this.physicalResistanceText,this.magicalResistanceText])}getTextColor(e,i){return e>i?"#00FF00":e<i?"#ff0000":"#ffffff"}updateCardHealth(e,i){this.currentHpText.setText(`${e}/${i}`),this.setHealthBar(e,i)}updateCardPhysicalResistance(e){this.physicalResistanceText.setText(`${x(e.physicalDamageResistance)} %`),this.physicalResistanceText.setColor(this.getTextColor(e.physicalDamageResistance,0))}updateCardMagicalResistance(e){this.magicalResistanceText.setText(`${x(e.magicalDamageResistance)} %`),this.magicalResistanceText.setColor(this.getTextColor(e.magicalDamageResistance,0))}updateCardData(e){this.updateCardPhysicalResistance(e),this.updateCardMagicalResistance(e),this.updateCardHealth(e.currentHealth,e.maxHealth)}setHealthBar(e,i){const s=this.hpBackgroundImage.width-10,o=e/i;this.hpBarImage.displayWidth=s*o}}class pe extends Phaser.GameObjects.Container{constructor(a,e,i,s,o=!1){super(a,e,i);const r=o?"greenFont":"redFont",c=o?.7:.5;let d=0;for(const u of s){const p=a.textures.get(r).get(u);p&&(d+=p.width*c)}let h=-d/2;for(const u of s){const p=a.add.image(0,0,r,u).setOrigin(0,.7).setScale(c),y=p.frame.width*c;p.x=h,p.y=0,this.add(p),h+=y}this.setDepth(1e3),a.add.existing(this),a.tweens.add({targets:this,y:i-30,duration:1500,ease:"easeOut",alpha:0,onComplete:()=>this.destroy()})}}class mt extends Phaser.GameObjects.Container{constructor(e,i,s,o){super(e,s,o);n(this,"context");n(this,"background");n(this,"healthBar");n(this,"fullWidth",78);this.context=e,this.background=e.add.image(0,0,"HpBackground").setOrigin(0);const r=me(e,i)?"HpAlly":"HpEnemy";this.healthBar=e.add.image(0,0,r).setOrigin(0),this.setHealth(i.maxHealth,i.currentHealth),this.add([this.background,this.healthBar])}setHealth(e,i){const s=i/e;this.healthBar.displayWidth=this.fullWidth*s}}class De extends Phaser.GameObjects.Container{constructor(e,i,s){const{x:o,y:r}=e.centerPoints[i.boardPosition];super(e,o,r);n(this,"belongsTo");n(this,"maxHealth");n(this,"currentHealth");n(this,"isDestroyed");n(this,"isLastCrystal");n(this,"boardPosition");n(this,"row");n(this,"col");n(this,"debuffAmount");n(this,"debuffLevel");n(this,"isShielded");n(this,"paladinAura");n(this,"physicalDamageResistance");n(this,"magicalDamageResistance");n(this,"context");n(this,"pedestalImage");n(this,"crystalImage");n(this,"singleCrystalDebuff");n(this,"doubleCrystalDebuff");n(this,"annihilatorDebuff");n(this,"shieldImage");n(this,"attackReticle");n(this,"blockedLOS");n(this,"debuffEventSingle");n(this,"debuffEventDouble");n(this,"healthBar");n(this,"unitCard");this.context=e,this.maxHealth=i.maxHealth,this.currentHealth=i.currentHealth,this.isDestroyed=i.isDestroyed,this.isLastCrystal=s.tileType===A.CRYSTAL_BIG?!0:i.isLastCrystal,this.boardPosition=i.boardPosition,this.row=s.row,this.col=s.col,this.belongsTo=i.belongsTo,this.debuffAmount=i.debuffAmount<0?0:i.debuffAmount,this.debuffLevel=i.debuffLevel<0||i.debuffLevel===void 0?0:i.debuffLevel,this.isShielded=i.isShielded,this.paladinAura=i.paladinAura??0,this.physicalDamageResistance=i.physicalDamageResistance??0,this.magicalDamageResistance=i.magicalDamageResistance??0,this.healthBar=new mt(e,i,-38,-70),this.unitCard=new Ft(e,i).setVisible(!1);const c=this.maxHealth===9e3;this.pedestalImage=e.add.image(0,10,"pedestal").setScale(.8);const d=i.currentHealth<=i.maxHealth/2?"crystalDamaged":"crystalFull";this.crystalImage=e.add.image(0,-30,d).setScale(c?1:.8),this.blockedLOS=e.add.image(0,-10,"blockedLOS").setOrigin(.5).setName("blockedLOS").setVisible(!1);const h=this.belongsTo===1?3381759:10027008;this.crystalImage.setTint(h),this.singleCrystalDebuff=e.add.image(0,-30,"crystalDebuff_1").setVisible(!1),this.doubleCrystalDebuff=e.add.image(0,-30,"crystalDebuff_3").setVisible(!1),this.shieldImage=e.add.image(0,-30,"shield").setVisible(this.isShielded),this.annihilatorDebuff=e.add.image(0,-30,"annihilatorDebuff").setVisible(!1);const u=(y,T,P)=>{let w=0;return this.scene.time.addEvent({delay:100,loop:!0,callback:()=>{w=1-w,y.setTexture(w===0?T:P)}})};this.debuffEventSingle=u(this.singleCrystalDebuff,"crystalDebuff_1","crystalDebuff_2"),this.debuffEventDouble=u(this.doubleCrystalDebuff,"crystalDebuff_3","crystalDebuff_4"),this.attackReticle=e.add.image(0,-10,"attackReticle").setOrigin(.5).setScale(.8).setName("attackReticle").setVisible(!1),(y=>{e.tweens.add({targets:y,angle:360,duration:7e3,repeat:-1,ease:"Linear",onRepeat:()=>{y.angle=0}})})(this.attackReticle),this.add([this.pedestalImage,this.crystalImage,this.singleCrystalDebuff,this.doubleCrystalDebuff,this.shieldImage,this.annihilatorDebuff,this.healthBar,this.attackReticle,this.blockedLOS,this.unitCard]).setSize(90,95).setInteractive({useHandCursor:!0}).setDepth(this.boardPosition+10),$t(this,this.context),e.add.existing(this)}updateDebuffAnimation(e){switch(e===void 0&&(e=0),e){case 0:this.singleCrystalDebuff.setVisible(!1),this.doubleCrystalDebuff.setVisible(!1);break;case 1:this.singleCrystalDebuff.setVisible(!0),this.doubleCrystalDebuff.setVisible(!1);break;case 2:this.singleCrystalDebuff.setVisible(!1),this.doubleCrystalDebuff.setVisible(!0);break;default:console.error("updateDebuffAnimation() level and case dont match",e);break}this.debuffLevel=e}getTile(){var i,s;const e=(s=(i=this.context)==null?void 0:i.gameController)==null?void 0:s.board.getTileFromBoardPosition(this.boardPosition);if(!e)throw new Error("getTile() -> No tile found");return e}updateTileData(){const e=this.getTile();this.debuffLevel<0&&(this.debuffLevel=0,this.updateDebuffAnimation(this.debuffLevel)),this.debuffAmount<0&&(this.debuffAmount=0),e.crystal={belongsTo:this.belongsTo,maxHealth:this.maxHealth,currentHealth:this.currentHealth,isDestroyed:this.isDestroyed,isLastCrystal:this.isLastCrystal,boardPosition:this.boardPosition,row:this.row,col:this.col,debuffAmount:this.debuffAmount,debuffLevel:this.debuffLevel,isShielded:this.isShielded,paladinAura:this.paladinAura,physicalDamageResistance:this.physicalDamageResistance,magicalDamageResistance:this.magicalDamageResistance}}getsDamaged(e,i,s=1){var u,p;const o=i===z.PHYSICAL?this.physicalDamageResistance:this.magicalDamageResistance;if(this.isShielded){this.isShielded=!1,this.shieldImage.setVisible(!1),f(this.context,m.ENGINEER_SHIELD_BREAK);return}this.annihilatorDebuff.visible&&i===z.PHYSICAL&&(this.annihilatorDebuff.setVisible(!1),this.physicalDamageResistance);const r=e-e*o/100,c=this.debuffAmount*s,d=x(r+c),h=d>this.currentHealth?this.currentHealth:d;this.currentHealth-=h,this.debuffAmount>0?f(this.scene,m.CRYSTAL_DAMAGE_BUFF):f(this.scene,m.CRYSTAL_DAMAGE),this.currentHealth<=this.maxHealth/2&&this.crystalImage.setTexture("crystalDamaged"),this.healthBar.setHealth(this.maxHealth,this.currentHealth),h>0&&new pe(this.context,this.x,this.y-50,h.toString()),this.unitCard.updateCardHealth(this.currentHealth,this.maxHealth),this.updateTileData(),this.belongsTo===1&&((u=this.context.gameController)==null||u.gameUI.banner.playerOneHpBar.setHealth()),this.belongsTo===2&&((p=this.context.gameController)==null||p.gameUI.banner.playerTwoHpBar.setHealth()),this.currentHealth<=0&&this.removeFromGame()}removeFromGame(){f(this.scene,m.CRYSTAL_DESTROY);const e=this.getTile();e.crystal=void 0,e.obstacle=!1,e.tileType=A.BASIC;const i=this.context.gameController.board.crystals,s=i.findIndex(o=>o.boardPosition===this.boardPosition);if(i.splice(s,1),this.isLastCrystal)this.context.gameController.gameOver={winCondition:He.CRYSTAL,winner:this.context.activePlayer};else{const o=i.filter(r=>r.belongsTo===this.belongsTo);if(!o.length)throw new Error("Crystal getsDestroyed() No other crystals found");o.length===1&&(o[0].isLastCrystal=!0,o[0].updateTileData())}this.scene.tweens.killTweensOf(this),this.list.forEach(o=>{this.scene.tweens.killTweensOf(o)}),this.debuffEventSingle.remove(!1),this.debuffEventDouble.remove(!1),this.destroy(!0)}exportData(){return{belongsTo:this.belongsTo,maxHealth:this.maxHealth,currentHealth:this.currentHealth,isDestroyed:this.isDestroyed,isLastCrystal:this.isLastCrystal,boardPosition:this.boardPosition,row:this.row,col:this.col,debuffAmount:this.debuffAmount,debuffLevel:this.debuffLevel,isShielded:this.isShielded,paladinAura:this.paladinAura,physicalDamageResistance:this.physicalDamageResistance,magicalDamageResistance:this.magicalDamageResistance}}}function _e(t,a,e,i){const r=a?1:2,c={[g.ARCHER]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.CLERIC]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.KNIGHT]:{1:{charImageX:5,charImageY:-15},2:{charImageX:0,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.NINJA]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.WIZARD]:{1:{charImageX:10,charImageY:-15},2:{charImageX:-10,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.PRIESTESS]:{1:{charImageX:20,charImageY:-20},2:{charImageX:-15,charImageY:-20},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.IMPALER]:{1:{charImageX:10,charImageY:-15},2:{charImageX:-15,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:15,charImageY:-25}},[g.NECROMANCER]:{1:{charImageX:20,charImageY:-20},2:{charImageX:-5,charImageY:-20},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:10,charImageY:-25}},[g.PHANTOM]:{1:{charImageX:0,charImageY:0},2:{charImageX:0,charImageY:0},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.VOIDMONK]:{1:{charImageX:0,charImageY:-20},2:{charImageX:0,charImageY:-20},KO:{1:{charImageX:0,charImageY:0},2:{charImageX:0,charImageY:0}},hand:{charImageX:5,charImageY:-25}},[g.WRAITH]:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.PALADIN]:{1:{charImageX:15,charImageY:-15},2:{charImageX:-10,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:10,charImageY:-25}},[g.GUNNER]:{1:{charImageX:5,charImageY:-10},2:{charImageX:-5,charImageY:-10},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.GRENADIER]:{1:{charImageX:10,charImageY:-20},2:{charImageX:-10,charImageY:-20},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:5,charImageY:-25}},[g.ENGINEER]:{1:{charImageX:5,charImageY:-15},2:{charImageX:-5,charImageY:-15},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:0,charImageY:-25}},[g.ANNIHILATOR]:{1:{charImageX:20,charImageY:-25},2:{charImageX:-20,charImageY:-25},KO:{1:{charImageX:0,charImageY:-10},2:{charImageX:0,charImageY:-10}},hand:{charImageX:15,charImageY:-25}}};return e?c[t].hand:i?c[t].KO[r]:c[t][r]}class Ut extends Phaser.GameObjects.Container{constructor(e,i){const s=i.boardPosition>44?-200:0;super(e,0,s);n(this,"cardBackgroundImage");n(this,"unitPictureImage");n(this,"cardSeparatorImage");n(this,"hpBackgroundImage");n(this,"hpBarImage");n(this,"attackTypeImage");n(this,"magicalResistanceImage");n(this,"physicalResistanceImage");n(this,"movementRangeImage");n(this,"attackRangeImage");n(this,"movementSquareImages");n(this,"attackSquareImages");n(this,"hpIconImage");n(this,"context");n(this,"attackType");n(this,"unitType");n(this,"currentHpText");n(this,"powerText");n(this,"magicalResistanceText");n(this,"physicalResistanceText");n(this,"cardFlavorText");n(this,"cardTypeText");n(this,"cardNameText");n(this,"rangeText");this.context=e,this.attackType=i.attackType,this.unitType=i.unitType,this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,`${i.unitType}CardPic`).setOrigin(.5).setScale(.4),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3);const{cardText:o,cardType:r}=It(i.unitType);this.cardNameText=this.context.add.text(55,-170,ke(i.unitType),{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,ke(r),{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.hpBackgroundImage=e.add.image(-60,-60,"hpBackground").setOrigin(.5),this.hpBarImage=e.add.image(-118,-72,"hpBar").setOrigin(0),this.setHealthBar(i.currentHealth,i.maxHealth),this.currentHpText=this.context.add.text(80,-60,`${i.currentHealth}/${i.maxHealth}`,{fontFamily:"proLight",fontSize:35,color:i.maxHealth>i.baseHealth?"#00FF00":"#ffffff"}).setOrigin(.5),this.hpIconImage=e.add.image(-150,-60,"hpIcon").setOrigin(.5);const c=i.attackType===z.MAGICAL?"magicalDamage":"physicalDamage";this.attackTypeImage=e.add.image(-150,-15,c).setOrigin(.5),this.powerText=this.context.add.text(-40,-15,`${i.currentPower} ${i.attackType}`,{fontFamily:"proLight",fontSize:35,color:this.getTextColor(i.currentPower,i.basePower)}).setOrigin(.5),this.magicalResistanceImage=e.add.image(40,30,"magicalResistance").setOrigin(.5),this.magicalResistanceText=this.context.add.text(100,30,`${i.magicalDamageResistance} %`,{fontFamily:"proLight",fontSize:35,color:this.getTextColor(i.magicalDamageResistance,i.baseMagicalDamageResistance)}).setOrigin(.5),this.physicalResistanceImage=e.add.image(-150,30,"physicalResistance").setOrigin(.5),this.physicalResistanceText=this.context.add.text(-85,30,`${i.physicalDamageResistance} %`,{fontFamily:"proLight",fontSize:35,color:this.getTextColor(i.physicalDamageResistance,i.basePhysicalDamageResistance)}).setOrigin(.5),this.movementRangeImage=e.add.image(-10,120,"movementRange").setOrigin(.5),this.attackRangeImage=e.add.image(-10,80,"attackRange").setOrigin(.5),this.rangeText=this.context.add.text(-85,90,"Range:",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5);const d=(h,u,p,y)=>{const T=[];let P=0;for(let w=1;w<=h;w++){const D=e.add.image(u+P,p,y).setOrigin(.5);T.push(D),P+=25}return T};this.movementSquareImages=d(i.movement,20,120,"movementSquare"),this.attackSquareImages=d(i.attackRange,20,80,"attackSquare"),this.cardFlavorText=this.context.add.text(0,180,o,{fontFamily:"proLight",fontSize:25,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(.5),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.hpBackgroundImage,this.hpBarImage,this.attackTypeImage,this.magicalResistanceImage,this.physicalResistanceImage,this.movementRangeImage,this.attackRangeImage,this.hpIconImage,this.currentHpText,this.cardFlavorText,this.cardTypeText,this.cardNameText,this.powerText,this.physicalResistanceText,this.magicalResistanceText,this.rangeText,...this.movementSquareImages,...this.attackSquareImages])}getTextColor(e,i){return e>i?"#00FF00":e<i?"#ff0000":"#ffffff"}updateCardData(e){this.updateCardPower(e),this.updateCardPhysicalResistance(e),this.updateCardMagicalResistance(e),this.updateCardHealth(e)}updateCardPower(e){const i=e.getTotalPower();this.powerText.setText(`${x(i)} ${this.attackType}`);const s=e.unitType===g.WRAITH?250:e.basePower;e.priestessDebuff?this.powerText.setColor("#ff0000"):this.powerText.setColor(this.getTextColor(i,s))}updateCardPhysicalResistance(e){this.physicalResistanceText.setText(`${x(e.physicalDamageResistance)} %`),this.physicalResistanceText.setColor(this.getTextColor(e.physicalDamageResistance,e.basePhysicalDamageResistance))}updateCardMagicalResistance(e){this.magicalResistanceText.setText(`${x(e.magicalDamageResistance)} %`),this.magicalResistanceText.setColor(this.getTextColor(e.magicalDamageResistance,e.baseMagicalDamageResistance))}updateCardHealth(e){this.currentHpText.setText(`${x(e.currentHealth)}/${e.maxHealth}`),this.currentHpText.setColor(this.getTextColor(e.maxHealth,e.baseHealth)),this.setHealthBar(e.currentHealth,e.maxHealth)}setHealthBar(e,i){const s=this.hpBackgroundImage.width-10,o=e/i;this.hpBarImage.displayWidth=s*o}}class _ extends Phaser.GameObjects.Container{constructor(e,i,s){const{x:o,y:r}=e.centerPoints[i.boardPosition];super(e,o,r);n(this,"class",j.HERO);n(this,"faction");n(this,"unitType");n(this,"unitId");n(this,"boardPosition");n(this,"row");n(this,"col");n(this,"baseHealth");n(this,"maxHealth");n(this,"currentHealth");n(this,"isKO");n(this,"lastBreath");n(this,"movement");n(this,"attackRange");n(this,"healingRange");n(this,"attackType");n(this,"basePower");n(this,"physicalDamageResistance");n(this,"basePhysicalDamageResistance");n(this,"magicalDamageResistance");n(this,"baseMagicalDamageResistance");n(this,"factionBuff");n(this,"runeMetal");n(this,"shiningHelm");n(this,"superCharge");n(this,"attackTile");n(this,"isActiveValue");n(this,"belongsTo");n(this,"canHeal");n(this,"unitsConsumed");n(this,"priestessDebuff");n(this,"annihilatorDebuff");n(this,"isShielded");n(this,"isDrunk");n(this,"paladinAura");n(this,"manaVial");n(this,"speedTile");n(this,"context");n(this,"unitCard");n(this,"characterImage");n(this,"runeMetalImage");n(this,"shiningHelmImage");n(this,"factionBuffImage");n(this,"attackReticle");n(this,"healReticle");n(this,"allyReticle");n(this,"blockedLOS");n(this,"priestessDebuffImage");n(this,"annihilatorDebuffImage");n(this,"shieldImage");n(this,"crystalDebuffTileAnim");n(this,"powerTileAnim");n(this,"magicalResistanceTileAnim");n(this,"physicalResistanceTileAnim");n(this,"superChargeAnim");n(this,"reviveAnim");n(this,"smokeAnim");n(this,"crystalDebuffEvent");n(this,"powerTileEvent");n(this,"magicalResistanceTileEvent");n(this,"physicalResistanceTileEvent");n(this,"superChargeEvent");n(this,"reviveEvent");n(this,"smokeEvent");n(this,"spawnEvent");n(this,"healthBar");this.context=e,this.faction=i.faction,this.unitType=i.unitType,this.unitId=i.unitId,this.boardPosition=i.boardPosition,this.row=i.row,this.col=i.col,this.baseHealth=i.baseHealth,this.maxHealth=i.maxHealth,this.currentHealth=i.currentHealth,this.isKO=i.isKO,this.lastBreath=i.lastBreath,this.movement=i.movement,this.attackRange=i.attackRange,this.healingRange=i.healingRange,this.attackType=i.attackType,this.basePower=i.basePower,this.physicalDamageResistance=i.physicalDamageResistance,this.basePhysicalDamageResistance=i.basePhysicalDamageResistance,this.magicalDamageResistance=i.magicalDamageResistance,this.baseMagicalDamageResistance=i.baseMagicalDamageResistance,this.factionBuff=i.factionBuff,this.runeMetal=i.runeMetal,this.shiningHelm=i.shiningHelm,this.superCharge=i.superCharge,this.attackTile=i.attackTile,this.isActiveValue=!1,this.belongsTo=i.belongsTo??1,this.canHeal=i.canHeal??!1,this.unitsConsumed=i.unitsConsumed??0,this.priestessDebuff=i.priestessDebuff??!1,this.annihilatorDebuff=i.annihilatorDebuff??!1,this.isShielded=i.isShielded??!1,this.isDrunk=i.isDrunk??!1,this.paladinAura=i.paladinAura??0,this.manaVial=(i==null?void 0:i.manaVial)??void 0,this.speedTile=i.speedTile,this.unitCard=new Ut(e,{...i,currentPower:this.getTotalPower()}).setVisible(!1),this.healthBar=new mt(e,i,-38,-75),this.boardPosition>=45&&this.healthBar.setVisible(!1);const c=yt(this.boardPosition),{charImageX:d,charImageY:h}=_e(this.unitType,this.belongsTo===1,c,i.isKO);this.characterImage=e.add.image(d,h,this.updateCharacterImage()).setOrigin(.5).setName("body").setDepth(this.row+10),c&&this.characterImage.setScale(.8),this.belongsTo===2&&this.boardPosition<45&&this.characterImage.setFlipX(!0),this.runeMetalImage=e.add.image(33,25,"runeMetal").setOrigin(.5).setScale(.4).setName("runeMetal"),this.runeMetal||this.runeMetalImage.setVisible(!1),this.shiningHelmImage=e.add.image(-28,25,"shiningHelm").setOrigin(.5).setScale(.4).setName("shiningHelm"),this.shiningHelm||this.shiningHelmImage.setVisible(!1),this.faction===B.COUNCIL?this.factionBuffImage=e.add.image(5,25,"dragonScale").setOrigin(.5).setScale(.4).setName("dragonScale"):this.factionBuffImage=e.add.image(5,25,"soulStone").setOrigin(.5).setScale(.4).setName("soulStone"),this.factionBuff||this.factionBuffImage.setVisible(!1),this.faction===B.COUNCIL&&(this.smokeAnim=e.add.image(0,0,"smokeAnim_1").setOrigin(.5).setScale(2.5).setVisible(!1).setTint(3751239)),this.attackReticle=e.add.image(0,-10,"attackReticle").setOrigin(.5).setScale(.8).setName("attackReticle").setVisible(!1),this.healReticle=e.add.image(0,-10,"healReticle").setOrigin(.5).setScale(.8).setName("healReticle").setVisible(!1),this.allyReticle=e.add.image(0,-10,"allyReticle").setOrigin(.5).setScale(.6).setName("allyReticle").setVisible(!1),this.priestessDebuffImage=e.add.image(0,-10,"priestessDebuff").setOrigin(.5).setScale(2.5).setName("priesetessDebuff"),this.priestessDebuff?this.priestessDebuffImage.setVisible(!0):this.priestessDebuffImage.setVisible(!1),this.annihilatorDebuffImage=e.add.image(0,-10,"annihilatorDebuff").setOrigin(.5).setName("annihilatorDebuff"),this.priestessDebuff?this.annihilatorDebuffImage.setVisible(!0):this.annihilatorDebuffImage.setVisible(!1),this.shieldImage=e.add.image(0,-10,"shield").setOrigin(.5).setName("shield"),this.priestessDebuff?this.shieldImage.setVisible(!0):this.shieldImage.setVisible(!1);const u=y=>{e.tweens.add({targets:y,angle:360,duration:7e3,repeat:-1,ease:"Linear",onRepeat:()=>{y.angle=0}})};u(this.attackReticle),u(this.healReticle),u(this.allyReticle),u(this.priestessDebuffImage),this.blockedLOS=e.add.image(0,-10,"blockedLOS").setOrigin(.5).setName("blockedLOS").setVisible(!1),e.tweens.add({targets:this.blockedLOS,scale:1.2,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.crystalDebuffTileAnim=e.add.image(0,30,"crystalDamageAnim_1").setOrigin(.5).setScale(.6),(s==null?void 0:s.tileType)===A.CRYSTAL_DAMAGE&&!this.isKO?this.crystalDebuffTileAnim.setVisible(!0):this.crystalDebuffTileAnim.setVisible(!1),this.crystalDebuffEvent=this.continuousEvent(this.crystalDebuffTileAnim,["crystalDamageAnim_1","crystalDamageAnim_2","crystalDamageAnim_3"]),this.powerTileAnim=e.add.image(0,27,"powerTileAnim_1").setOrigin(.5).setScale(.6),(s==null?void 0:s.tileType)===A.POWER&&!this.isKO?this.powerTileAnim.setVisible(!0):this.powerTileAnim.setVisible(!1),this.powerTileEvent=this.continuousEvent(this.powerTileAnim,["powerTileAnim_1","powerTileAnim_2","powerTileAnim_3"]),this.magicalResistanceTileAnim=e.add.image(0,30,"magicalResistanceAnim_1").setOrigin(.5).setScale(.6),((s==null?void 0:s.tileType)===A.MAGICAL_RESISTANCE||(s==null?void 0:s.tileType)===A.SPEED)&&!this.isKO?this.magicalResistanceTileAnim.setVisible(!0):this.magicalResistanceTileAnim.setVisible(!1),this.magicalResistanceTileEvent=this.continuousEvent(this.magicalResistanceTileAnim,["magicalResistanceAnim_1","magicalResistanceAnim_2","magicalResistanceAnim_3"]),this.physicalResistanceTileAnim=e.add.image(0,30,"physicalResistanceAnim_1").setOrigin(.5).setScale(.6),(s==null?void 0:s.tileType)===A.PHYSICAL_RESISTANCE&&!this.isKO?this.physicalResistanceTileAnim.setVisible(!0):this.physicalResistanceTileAnim.setVisible(!1),this.physicalResistanceTileEvent=this.continuousEvent(this.physicalResistanceTileAnim,["physicalResistanceAnim_1","physicalResistanceAnim_2","physicalResistanceAnim_3"]),this.superChargeAnim=e.add.image(0,-18,"superChargeAnim_1").setOrigin(.5).setScale(.8),this.superCharge?this.superChargeAnim.setVisible(!0):this.superChargeAnim.setVisible(!1),this.superChargeEvent=this.continuousEvent(this.superChargeAnim,["superChargeAnim_1","superChargeAnim_2","superChargeAnim_3"]),this.reviveAnim=e.add.image(0,-10,"reviveAnim_1").setOrigin(.5).setScale(.7).setVisible(!1);const p=new Phaser.Geom.Rectangle(-35,-50,75,85);this.add([this.priestessDebuffImage,this.annihilatorDebuffImage,this.shieldImage,this.superChargeAnim,this.reviveAnim,this.characterImage,this.runeMetalImage,this.factionBuffImage,this.shiningHelmImage,this.healthBar,this.crystalDebuffTileAnim,this.powerTileAnim,this.magicalResistanceTileAnim,this.physicalResistanceTileAnim,this.attackReticle,this.healReticle,this.allyReticle,...this.smokeAnim?[this.smokeAnim]:[],this.blockedLOS,this.unitCard]).setInteractive({hitArea:p,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}).setName(this.unitId).setDepth(this.row+10),this.boardPosition===51&&this.setVisible(!1),ut(this,e),e.add.existing(this)}get isActive(){return this.isActiveValue}set isActive(e){this.isActiveValue=e,e?this.onActivate():this.onDeactivate()}updatePosition(e){const{x:i,y:s}=this.context.centerPoints[e.boardPosition];this.x=i,this.y=s,this.boardPosition=e.boardPosition,this.row=e.row,this.col=e.col,this.setDepth(this.row+10)}exportData(){return{class:this.class,faction:this.faction,unitType:this.unitType,unitId:this.unitId,boardPosition:this.boardPosition,row:this.row,col:this.col,baseHealth:this.baseHealth,maxHealth:this.maxHealth,currentHealth:this.currentHealth,isKO:this.isKO,lastBreath:this.lastBreath,movement:this.movement,attackRange:this.attackRange,healingRange:this.healingRange,attackType:this.attackType,basePower:this.basePower,physicalDamageResistance:this.physicalDamageResistance,basePhysicalDamageResistance:this.basePhysicalDamageResistance,magicalDamageResistance:this.magicalDamageResistance,baseMagicalDamageResistance:this.baseMagicalDamageResistance,factionBuff:this.factionBuff,runeMetal:this.runeMetal,shiningHelm:this.shiningHelm,superCharge:this.superCharge,attackTile:this.attackTile,belongsTo:this.belongsTo,canHeal:this.canHeal,unitsConsumed:this.unitsConsumed,priestessDebuff:this.priestessDebuff,annihilatorDebuff:this.annihilatorDebuff,isShielded:this.isShielded,paladinAura:this.paladinAura,isDrunk:this.isDrunk,manaVial:this.manaVial,speedTile:this.speedTile}}continuousEvent(e,i){let s=0;return this.scene.time.addEvent({delay:100,loop:!0,callback:()=>{e.setTexture(i[s]),s=(s+1)%i.length}})}singleEvent(e,i,s){let o=0;e.setVisible(!0);const r=this.scene.time.addEvent({delay:s,repeat:i.length-1,callback:()=>{e.setTexture(i[o]),o++,o===i.length&&(e.setVisible(!1),r.remove())}});return r}singleTween(e,i){e.setVisible(!0),this.context.tweens.add({targets:e,scaleX:0,scaleY:0,duration:i,ease:"Cubic.easeIn",onComplete:()=>{e.setVisible(!1)}})}onActivate(){console.log(`${this.unitId} is now active`),this.setScale(1.2)}onDeactivate(){console.log(`${this.unitId} is now inactive`),this.setScale(1)}getsDamaged(e,i){this.characterImage.setTint(16711680),this.scene.time.delayedCall(500,()=>this.characterImage.clearTint());const s=x(this.getLifeLost(e,i));return this.currentHealth-=s,this.currentHealth<=0&&this.getsKnockedDown(),this.healthBar.setHealth(this.maxHealth,this.currentHealth),s>0&&new pe(this.context,this.x,this.y-50,s.toString()),this.unitCard.updateCardData(this),this.updateTileData(),this instanceof _&&this.isKO&&this.unitType===g.PHANTOM&&this.removeFromGame(),s}getTotalPower(e=1){e===0&&(e=1);const i=this.runeMetal?1.5:1,s=this.attackTile,o=this.superCharge?3:1,r=this.priestessDebuff?.5:1,c=this.paladinAura*.05+1;return(this.basePower+s)*c*e*o*r*i}getLifeLost(e,i){const s={[z.MAGICAL]:this.magicalDamageResistance,[z.PHYSICAL]:this.physicalDamageResistance};if(this.isShielded)return this.isShielded=!1,this.shieldImage.setVisible(!1),0;this.isDrunk&&(this.physicalDamageResistance-=50,this.magicalDamageResistance-=50,this.isDrunk=!1),this.annihilatorDebuff&&i===z.PHYSICAL&&(this.physicalDamageResistance+=50,this.annihilatorDebuff=!1,this.annihilatorDebuffImage.setVisible(!1));const o=s[i],r=s?e-e*o/100:e;return r>this.currentHealth?this.currentHealth:r}getTotalHealing(e){const i=this.runeMetal?1.5:1,s=this.attackTile,o=this.superCharge?3:1,r=this.priestessDebuff?.5:1;return(this.basePower+s)*e*o*r*i}getsHealed(e,i=!0){if(e<=0)return;let s;return this.currentHealth+e>=this.maxHealth?(s=this.maxHealth-this.currentHealth,this.currentHealth=this.maxHealth):(this.currentHealth+=e,s=e),this.healthBar.setHealth(this.maxHealth,this.currentHealth),s>0&&i&&new pe(this.context,this.x,this.y-50,s.toString(),!0),this.isKO&&this.getsRevived(),this.unitCard.updateCardData(this),this.updateTileData(),s}getsRevived(){this.reviveEvent=this.singleEvent(this.reviveAnim,["reviveAnim_1","reviveAnim_2","reviveAnim_3"],150),this.isKO=!1,this.lastBreath=!1,this.characterImage.setTexture(this.updateCharacterImage());const{charImageX:e,charImageY:i}=_e(this.unitType,this.belongsTo===1,!1,!1);this.specialTileCheck(this.getTile()),this.characterImage.x=e,this.characterImage.y=i}increaseMaxHealth(e,i=!0){if(e<=0)return;this.isKO&&this.getsRevived();const s=x(e);this.maxHealth+=s,this.currentHealth+=s,this.healthBar.setHealth(this.maxHealth,this.currentHealth),i&&new pe(this.context,this.x,this.y-50,e.toString(),!0),this.unitCard.updateCardData(this),this.updateTileData()}healAndIncreaseHealth(e,i){const s=this.getsHealed(e,!1);this.increaseMaxHealth(i,!1);const o=s?s+i:i;new pe(this.context,this.x,this.y-50,o.toString(),!0)}getsKnockedDown(){this.unitType!==g.PHANTOM&&pa(this.scene,this.unitType),this.removeSpecialTileOnKo(),this.currentHealth=0,this.isKO=!0;const e=this.getTile();e.hero=this.exportData(),this.characterImage.setTexture(this.updateCharacterImage());const{charImageX:i,charImageY:s}=_e(this.unitType,this.belongsTo===1,!1,!0);this.characterImage.x=i,this.characterImage.y=s,et(this.context,this)}getTile(){var i,s;const e=(s=(i=this.context)==null?void 0:i.gameController)==null?void 0:s.board.getTileFromBoardPosition(this.boardPosition);if(!e)throw new Error("getTile() -> No tile found");return e}updateTileData(){const e=this.getTile();e.hero=this.exportData()}shuffleInDeck(){this.boardPosition=51;const e=this.exportData();this.context.gameController.hand.removeFromHand(e),this.context.gameController.deck.addToDeck(e),this.removeFromGame(!1)}removeFromGame(e=!0){var i;this.scene.tweens.killTweensOf(this),this.list.forEach(s=>{this.scene.tweens.killTweensOf(s)}),this.crystalDebuffEvent.remove(!1),this.powerTileEvent.remove(!1),this.magicalResistanceTileEvent.remove(!1),this.physicalResistanceTileEvent.remove(!1),this.superChargeEvent.remove(!1),this.spawnEvent&&((i=this.spawnEvent)==null||i.remove(!1)),e&&this.removeFromBoard(),this.destroy(!0)}removeFromBoard(){this.getTile().removeHero();const i=this.context.gameController.board.units.findIndex(s=>s.unitId===this.unitId);i!==-1&&this.context.gameController.board.units.splice(i,1),et(this.context,this)}getDistanceToTarget(e){const i=this.context.gameController,s=i.board.getTileFromBoardPosition(this.boardPosition),o=i.board.getTileFromBoardPosition(e.boardPosition);return!s||!o?(console.error("Archer attack() No attacker or target tile found"),0):Tt(s.row,s.col,o.row,o.col)}async move(e){const i=this.context.gameController,s=i.board.getTileFromBoardPosition(this.boardPosition);if(s){if(await ga(this.context,this,e),e.hero&&e.hero.isKO){const o=i.board.units.find(r=>{var c;return r.unitId===((c=e.hero)==null?void 0:c.unitId)});o||console.error("move() Found heroData on targetTile, but no Hero to remove",e),f(this.context,m.HERO_STOMP),o==null||o.removeFromGame(!0)}this.specialTileCheck(e,s),this.updatePosition(e),e.hero=this.exportData(),s.removeHero(),i.afterAction(b.MOVE,s.boardPosition,e.boardPosition)}}spawn(e){const i=this.boardPosition,s=this.context.gameController;if(e.hero&&(e.hero.isKO||e.isEnemy(this.context.userId)&&e.hero.unitType===g.PHANTOM)){const c=s.board.units.find(d=>{var h;return d.unitId===((h=e.hero)==null?void 0:h.unitId)});c||console.error("spawn() Found heroData on tile, but no Hero to remove",e),f(this.context,m.HERO_STOMP),c==null||c.removeFromGame(!0)}s.hand.removeFromHand(this),s.board.units.push(this),this.characterImage.setScale(1);const{charImageX:o,charImageY:r}=_e(this.unitType,this.belongsTo===1,!1,!1);this.characterImage.x=o,this.characterImage.y=r,this.setDepth(this.row+10),this.belongsTo===2&&this.characterImage.setFlipX(!0),this.unitCard.y=0,this.specialTileCheck(e),this.updatePosition(e),this.updateTileData(),this.healthBar.setVisible(!0),f(this.context,m.HERO_SPAWN),s.afterAction(b.SPAWN,i,e.boardPosition)}isFullHP(){return this.maxHealth===this.currentHealth}isAlreadyEquipped(e){return!!{[S.DRAGON_SCALE]:this.factionBuff,[S.SOUL_STONE]:this.factionBuff,[S.RUNE_METAL]:this.runeMetal,[S.SHINING_HELM]:this.shiningHelm,[S.SUPERCHARGE]:this.superCharge}[e.itemType]}equipShiningHelm(e){const i=this.scene.add.image(this.x,this.y,"shiningHelm").setDepth(100);ee(i),this.shiningHelm=!0,this.magicalDamageResistance+=20,this.increaseMaxHealth(this.baseHealth*.1),this.shiningHelmImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.unitCard.updateCardData(this),this.updateTileData(),this.context.gameController.afterAction(b.USE,e,this.boardPosition)}equipRunemetal(e){const i=this.scene.add.image(this.x,this.y,"runeMetal").setDepth(100);ee(i),this.runeMetal=!0,this.runeMetalImage.setVisible(!0),this.runeMetalImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.unitCard.updateCardData(this),this.updateTileData(),this.context.gameController.afterAction(b.USE,e,this.boardPosition)}equipSuperCharge(e){this.superCharge=!0,this.unitCard.updateCardData(this),this.updateTileData(),this.superChargeAnim.setVisible(!0),this.context.gameController.afterAction(b.USE,e,this.boardPosition)}updateCrystals(e){this.context.gameController.board.crystals.forEach(i=>{if(i.belongsTo!==this.belongsTo){let s=0;if(e>0)s=i.debuffLevel+1;else if(e<0&&i.debuffAmount>0)s=i.debuffLevel+1;else return;i.updateDebuffAnimation(s),i.debuffAmount+=e}})}specialTileCheck(e,i,s=!0){let o=1;this.faction===B.DWARVES&&(o=1.2,this.unitType===g.ENGINEER&&(o=1.4));const r=e.tileType;switch(i==null?void 0:i.tileType){case A.CRYSTAL_DAMAGE:this.updateCrystals(-300*o),this.crystalDebuffTileAnim.setVisible(!1);break;case A.POWER:this.attackTile=0,this.powerTileAnim.setVisible(!1);break;case A.MAGICAL_RESISTANCE:this.magicalDamageResistance-=20*o,this.magicalResistanceTileAnim.setVisible(!1);break;case A.PHYSICAL_RESISTANCE:this.physicalDamageResistance-=20*o,this.physicalResistanceTileAnim.setVisible(!1);break;case A.SPEED:this.speedTile=0,this.magicalResistanceTileAnim.setVisible(!1);break}switch(r){case A.CRYSTAL_DAMAGE:console.log("crystal"),this.updateCrystals(300*o),this.crystalDebuffTileAnim.setVisible(!0),s&&f(this.scene,m.CRYSTAL_TILE);break;case A.POWER:this.attackTile=100*o,this.powerTileAnim.setVisible(!0),s&&f(this.scene,m.SWORD_TILE);break;case A.MAGICAL_RESISTANCE:this.magicalDamageResistance+=20*o,this.magicalResistanceTileAnim.setVisible(!0),s&&f(this.scene,m.HELM_TILE);break;case A.PHYSICAL_RESISTANCE:this.physicalDamageResistance+=20*o,this.physicalResistanceTileAnim.setVisible(!0),s&&f(this.scene,m.SHIELD_TILE);break;case A.SPEED:this.speedTile=2,o<1&&(this.speedTile=3,o<1.2&&(this.speedTile=4)),this.magicalResistanceTileAnim.setVisible(!0),s&&f(this.scene,m.HELM_TILE);break}this.magicalDamageResistance-=this.paladinAura*5,this.physicalDamageResistance-=this.paladinAura*5,this.paladinAura=0,ie(this.context,this,e,!0).heroTiles.forEach(h=>{const u=this.context.gameController.board.units.find(p=>p.boardPosition===h.boardPosition);u&&!u.isKO&&u.unitType===g.PALADIN&&u!==this&&(this.magicalDamageResistance+=5,this.physicalDamageResistance+=5,this.paladinAura+=1)}),this.unitCard.updateCardData(this)}removeSpecialTileOnKo(){const e=this.getTile().tileType;let i=1;switch(this.faction===B.DWARVES&&(i=1.2,this.unitType===g.ENGINEER&&(i=1.4)),e){case A.CRYSTAL_DAMAGE:this.updateCrystals(-300*i),this.crystalDebuffTileAnim.setVisible(!1);break;case A.POWER:this.attackTile=0,this.powerTileAnim.setVisible(!1);break;case A.MAGICAL_RESISTANCE:this.magicalDamageResistance-=20*i,this.magicalResistanceTileAnim.setVisible(!1);break;case A.PHYSICAL_RESISTANCE:this.physicalDamageResistance-=20*i,this.physicalResistanceTileAnim.setVisible(!1);break;case A.SPEED:this.speedTile=0,this.magicalResistanceTileAnim.setVisible(!1);break}this.unitCard.updateCardData(this)}updateCharacterImage(){return this.unitType===g.PHANTOM?"phantom_1":this.isKO?`${this.unitType}_9`:this.runeMetal&&this.factionBuff&&this.shiningHelm?`${this.unitType}_8`:this.runeMetal&&this.shiningHelm?`${this.unitType}_7`:this.factionBuff&&this.shiningHelm?`${this.unitType}_6`:this.factionBuff&&this.runeMetal?`${this.unitType}_5`:this.factionBuff?`${this.unitType}_4`:this.shiningHelm?`${this.unitType}_3`:this.runeMetal?`${this.unitType}_2`:`${this.unitType}_1`}removeAttackModifiers(){this.priestessDebuff=!1,this.priestessDebuffImage.setVisible(!1),this.superCharge=!1,this.superChargeAnim.setVisible(!1),this.unitCard.updateCardData(this);const e=this.getTile();e.hero=this.exportData()}flashActingUnit(){this.characterImage.setTint(3381759),this.scene.time.delayedCall(800,()=>this.characterImage.clearTint())}}class Gt extends Phaser.GameObjects.Container{constructor(e,i){const s=i.boardPosition>44?-180:0;super(e,0,s);n(this,"cardBackgroundImage");n(this,"unitPictureImage");n(this,"cardSeparatorImage");n(this,"context");n(this,"cardFlavorText");n(this,"cardTypeText");n(this,"cardNameText");this.context=e,this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,`${i.itemType}CardPic`).setOrigin(.5).setScale(.4),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3);const{cardText:o,cardType:r,cardName:c}=It(i.itemType);this.cardNameText=this.context.add.text(55,-170,ke(c),{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,ke(r),{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cardFlavorText=this.context.add.text(-170,-80,o,{fontFamily:"proLight",fontSize:28,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(0),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.cardFlavorText,this.cardTypeText,this.cardNameText])}}class q extends Phaser.GameObjects.Container{constructor(e,i){const{x:s,y:o}=e.centerPoints[i.boardPosition];super(e,s,o-20);n(this,"class",j.ITEM);n(this,"faction");n(this,"unitId");n(this,"itemType");n(this,"boardPosition");n(this,"isActiveValue");n(this,"belongsTo");n(this,"canHeal");n(this,"dealsDamage");n(this,"itemImage");n(this,"context");n(this,"unitCard");n(this,"row",10);this.context=e,this.unitCard=new Gt(e,i).setVisible(!1),this.unitId=i.unitId,this.faction=i.faction,this.itemType=i.itemType,this.boardPosition=i.boardPosition,this.isActiveValue=!1,this.belongsTo=i.belongsTo??1,this.canHeal=i.canHeal??!1,this.dealsDamage=i.dealsDamage??!1,this.itemImage=e.add.image(0,0,this.itemType).setOrigin(.5).setName("itemImage"),ut(this,e),this.boardPosition===51&&this.setVisible(!1).disableInteractive(),this.itemImage.displayWidth=110,this.itemImage.displayHeight=110,this instanceof pt&&(this.itemImage.displayWidth=55,this.itemImage.displayHeight=55),this instanceof gt&&(this.itemImage.displayWidth=45,this.itemImage.displayHeight=65);const r=new Phaser.Geom.Rectangle(-35,-30,75,85);this.add([this.itemImage,this.unitCard]).setDepth(this.boardPosition).setInteractive({hitArea:r,hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!0}).setName(this.unitId),e.add.existing(this)}get isActive(){return this.isActiveValue}set isActive(e){this.isActiveValue=e,e?this.onActivate():this.onDeactivate()}exportData(){return{class:this.class,faction:this.faction,unitId:this.unitId,itemType:this.itemType,boardPosition:this.boardPosition,belongsTo:this.belongsTo,canHeal:this.canHeal,dealsDamage:this.dealsDamage}}updatePosition(e){const{x:i,y:s}=this.context.centerPoints[e];this.x=i,this.y=s,this.boardPosition=e}onActivate(){console.log(`${this.unitId} is now active`),this.setScale(1.2)}onDeactivate(){console.log(`${this.unitId} is now inactive`),this.setScale(1)}shuffleInDeck(){this.boardPosition=51;const e=this.exportData();this.context.gameController.deck.addToDeck(e),this.removeFromGame()}removeFromGame(){var e;this.scene.tweens.killTweensOf(this),(e=this.context.gameController)==null||e.hand.removeFromHand(this),this.destroy(!0)}}class gt extends q{constructor(a,e){super(a,e)}use(a){a.equipShiningHelm(this.boardPosition),f(this.scene,m.ITEM_USE),this.removeFromGame()}}class xt extends q{constructor(a,e){super(a,e)}use(a){a.equipRunemetal(this.boardPosition),f(this.scene,m.RUNE_METAL_USE),this.removeFromGame()}}class pt extends q{constructor(a,e){super(a,e)}use(a){a.equipSuperCharge(this.boardPosition),f(this.scene,m.SCROLL_USE),this.removeFromGame()}}class Ie extends _{constructor(a,e,i){super(a,e,i)}equipFactionBuff(a){f(this.scene,m.DRAGON_SCALE_USE);const e=this.scene.add.image(this.x+10,this.y-10,"dragonScale").setOrigin(.5).setDepth(100);ee(e),this.factionBuff=!0,this.factionBuffImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.physicalDamageResistance+=20,this.increaseMaxHealth(this.baseHealth*.1),this.unitCard.updateCardData(this),this.updateTileData(),this.scene.sound.play(m.DRAGON_SCALE_USE),this.context.gameController.afterAction(b.USE,a,this.boardPosition)}}class Vt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit();const e=this.getDistanceToTarget(a);L(this.context,this,a),e===1?a instanceof _&&a.isKO&&F(this.context,a.getTile())?(f(this.scene,m.ARCHER_ATTACK_MELEE),a.removeFromGame()):(f(this.scene,m.ARCHER_ATTACK_MELEE),a.getsDamaged(this.getTotalPower(.5),this.attackType),this.removeAttackModifiers()):(this.superCharge&&f(this.scene,m.ARCHER_ATTACK_BIG),this.superCharge||f(this.scene,m.ARCHER_ATTACK),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Kt extends Ie{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit();const e=this.context.gameController;L(this.context,this,a),a instanceof _&&a.isKO&&F(this.context,a.getTile())?(f(this.scene,m.KNIGHT_ATTACK),a.removeFromGame()):(this.superCharge&&f(this.scene,m.KNIGHT_ATTACK_BIG),this.superCharge||f(this.scene,m.ARCHER_ATTACK_MELEE),a.getsDamaged(this.getTotalPower(),this.attackType),a instanceof _&&a.unitType!==g.PHANTOM&&e.pushEnemy(this,a),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Wt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit();const e=this.context.gameController;if(L(this.context,this,a),this.getDistanceToTarget(a)===1&&a instanceof _&&a.isKO&&F(this.context,a.getTile()))f(this.scene,m.WIZARD_ATTACK),a.removeFromGame();else{this.superCharge&&f(this.scene,m.WIZARD_ATTACK_BIG),this.superCharge||f(this.scene,m.WIZARD_ATTACK);const s=e.board.getAttackDirection(this.boardPosition,a.boardPosition),o=this.context.isPlayerOne?[2,3,4]:[6,7,8],r=this.getNextTarget(a,s,o,e.board,!1);let c;r&&(c=this.getNextTarget(r,s,o,e.board,!1,[a.boardPosition,r.boardPosition])),a.getsDamaged(this.getTotalPower(),this.attackType),r&&r.getsDamaged(this.getTotalPower()*.75,this.attackType,.75),c&&c.getsDamaged(this.getTotalPower()*.56,this.attackType,.56),a&&a instanceof _&&a.isKO&&a.unitType===g.PHANTOM&&a.removeFromGame(),r&&r instanceof _&&r.isKO&&r.unitType===g.PHANTOM&&r.removeFromGame(),c&&c instanceof _&&c.isKO&&c.unitType===g.PHANTOM&&c.removeFromGame(),this.removeAttackModifiers()}this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}getNextTarget(a,e,i,s,o,r){const c=r||[a.boardPosition],d=this.getAdjacentEnemyTiles(a.boardPosition,c);let h=-1,u;for(const p of d){const y=s.getAttackDirection(a.boardPosition,p.boardPosition);let T=0;if(y===e&&(T+=2),this.getGeneralDirections(e).includes(y)&&(T+=1.5),i.includes(y)&&(T+=1),[1,3,5,7].includes(y)&&(T+=1),o||this.getAdjacentEnemyTiles(p.boardPosition,[p.boardPosition]).length&&(T+=1.5),T>h&&(h=T,u=p),h===6)break}if(!u){console.log("getNextTarget() No suitable adjacent target found.");return}if(u.hero){const p=s.units.find(y=>y.unitId===u.hero.unitId);if(p)return p}if(u.crystal){const p=s.crystals.find(y=>y.boardPosition===u.crystal.boardPosition);if(p)return p}throw new Error("getNextTarget() Target found on tile, but not in board units or crystals")}getAdjacentEnemyTiles(a,e=[]){const i=[-10,-9,-8,-1,1,8,9,10],s=[-10,-1,8],o=[10,1,-8],r=[],c=9,d=a%c===0,h=(a+1)%c===0;for(const u of i){if(d&&s.includes(u)||h&&o.includes(u))continue;const p=a+u;if(Ke(p)&&!e.includes(p)){const y=this.context.gameController.board.getTileFromBoardPosition(p);Ye(this,y)&&r.push(y)}}return r}getGeneralDirections(a){switch(a){case 1:return[1,2,8];case 2:return[[1,2,8],[2,3,4]].flat();case 3:return[2,3,4];case 4:return[[2,3,4],[4,5,6]].flat();case 5:return[4,5,6];case 6:return[[4,5,6],[6,7,8]].flat();case 7:return[6,7,8];case 8:return[[1,2,8],[6,7,8]].flat();default:return[]}}heal(a){}special(a){}}class Yt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit(),L(this.context,this,a);const e=this.getDistanceToTarget(a),i=()=>{this.superCharge&&f(this.scene,m.NINJA_ATTACK_BIG),this.superCharge||f(this.scene,m.NINJA_ATTACK)};e===1?a instanceof _&&a.isKO&&F(this.context,a.getTile())?(f(this.scene,m.NINJA_ATTACK),a.removeFromGame()):(i(),a.getsDamaged(this.getTotalPower(2),this.attackType),this.removeAttackModifiers()):(i(),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}special(a){f(this.scene,m.NINJA_SMOKE);const e=this.getTile(),i=a.getTile();this.singleTween(this.smokeAnim,500),a.singleTween(a.smokeAnim,500),a.specialTileCheck(e,i),a.updatePosition(e),e.hero=a.exportData(),this.specialTileCheck(i,e),this.updatePosition(i),i.hero=this.exportData(),this.context.gameController.afterAction(b.SPECIAL,e.boardPosition,i.boardPosition)}heal(a){}}class zt extends Ie{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit(),L(this.context,this,a),this.getDistanceToTarget(a)===1&&a instanceof _&&a.isKO&&F(this.context,a.getTile())?(this.superCharge||f(this.scene,m.CLERIC_ATTACK),a.removeFromGame()):(this.superCharge&&f(this.scene,m.CLERIC_ATTACK_BIG),this.superCharge||f(this.scene,m.CLERIC_ATTACK),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){var e;if(this.flashActingUnit(),this.superCharge||f(this.scene,m.HEAL),this.superCharge&&f(this.scene,m.HEAL_EXTRA),L(this.context,this,a),a.isKO){const i=this.getTotalHealing(2);a.getsHealed(i)}else{const i=this.getTotalHealing(3);a.getsHealed(i)}this.removeAttackModifiers(),(e=this.context.gameController)==null||e.afterAction(b.HEAL,this.boardPosition,a.boardPosition)}special(a){}}class jt extends q{constructor(a,e){super(a,e)}use(a){a.equipFactionBuff(this.boardPosition),this.removeFromGame()}}class Xt extends q{constructor(a,e){super(a,e)}use(a){f(this.scene,m.POTION_USE);const e=this.scene.add.image(a.x,a.y-10,"healingPotion").setDepth(100);ee(e);const i=a.isKO?100:1e3;a.getsHealed(i),this.removeFromGame(),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition)}}class qt extends q{constructor(a,e){super(a,e)}use(a){const e=this.scene.add.image(a.x,a.y,"infernoShockWave").setDepth(100);ee(e,3),f(this.scene,m.INFERNO_USE);const i=350,s=ie(this.context,this,a,!1),o=[...s.heroTiles,...s.crystalTiles];o==null||o.forEach(r=>{const c=this.context.gameController.board.units.find(d=>d.boardPosition===r.boardPosition)||this.context.gameController.board.crystals.find(d=>d.boardPosition===r.boardPosition);if(!c)throw new Error("Inferno use() hero not found");if(!(c instanceof De)&&c.isKO){c.removeFromGame(!0);return}c.getsDamaged(i,z.MAGICAL)}),this.removeFromGame(),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition)}}class Ae extends _{constructor(a,e,i){super(a,e,i)}equipFactionBuff(a){const e=this.scene.add.image(this.x,this.y-10,"soulStone").setOrigin(.5).setDepth(100);ee(e),this.factionBuff=!0,this.factionBuffImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.increaseMaxHealth(this.baseHealth*.1),this.unitCard.updateCardData(this),this.updateTileData(),f(this.scene,m.ITEM_USE),this.context.gameController.afterAction(b.USE,a,this.boardPosition)}lifeSteal(a){if(this.factionBuff){const e=x(a*.666);this.getsHealed(e)}else{const e=x(a*.333);this.getsHealed(e)}}}class Jt extends Ae{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit(),L(this.context,this,a);const e=this.getDistanceToTarget(a);if(e===1&&a instanceof _&&a.isKO&&F(this.context,a.getTile()))f(this.scene,m.IMPALER_ATTACK_MELEE),a.removeFromGame();else{this.superCharge?f(this.scene,m.IMPALER_ATTACK_BIG):(e===1&&f(this.scene,m.IMPALER_ATTACK_MELEE),e!==1&&f(this.scene,m.IMPALER_ATTACK));const i=a.getsDamaged(this.getTotalPower(),this.attackType);i!==void 0&&this.lifeSteal(i),this.removeAttackModifiers()}a instanceof _&&a.unitType!==g.PHANTOM&&this.context.gameController.pullEnemy(this,a),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Zt extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){this.flashActingUnit(),L(this.context,this,a);const e=[];if(this.superCharge&&f(this.scene,m.VOIDMONK_ATTACK_BIG),this.superCharge||f(this.scene,m.VOIDMONK_ATTACK),a instanceof _&&a.isKO&&F(this.context,a.getTile()))a.removeFromGame();else{const i=this.context.gameController.board,s=i.getAttackDirection(this.boardPosition,a.boardPosition),o=this.getOffsetTiles(a.boardPosition,s);if(!o.length)throw new Error(`voidMonk attack() No offsetTiles: ${this.boardPosition}, ${a.boardPosition}`);for(const d of o){const h=a.boardPosition+d;if(!Ke(h))continue;const u=i.getTileFromBoardPosition(h);if(!u)throw new Error("voidMonk attack() No tile found");if(Ye(this,u)){if(u.hero){const p=i.units.find(y=>y.unitId===u.hero.unitId);p&&e.push(p)}if(u.crystal){const p=i.crystals.find(y=>y.boardPosition===u.crystal.boardPosition);p&&e.push(p)}}}let r=0;const c=a.getsDamaged(this.getTotalPower(),this.attackType);if(c&&(r+=c),e.length){const d=this.getTotalPower()*.666;console.log(d),e.forEach(h=>{const u=h.getsDamaged(d,this.attackType,.666);u&&(r+=u)})}r&&this.lifeSteal(r),this.removeAttackModifiers()}e.forEach(i=>{i instanceof _&&i.unitType===g.PHANTOM&&i.isKO&&i.removeFromGame(!0)}),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}getOffsetTiles(a,e){switch(e){case 1:return[-1,1,-9];case 3:return[-9,1,9];case 5:return[-1,1,9];case 7:return[-9,-1,9];default:return[]}}heal(a){}special(a){}}class Qt extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){if(this.flashActingUnit(),L(this.context,this,a),a instanceof _&&a.isKO){this.special(a);return}else this.superCharge&&f(this.scene,m.NECROMANCER_ATTACK_BIG),this.superCharge||f(this.scene,m.NECROMANCER_ATTACK);const e=a.getsDamaged(this.getTotalPower(),this.attackType);e&&this.lifeSteal(e),this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){var s;f(this.scene,m.PHANTOM_SPAWN);const e=a.getTile(),i=new Ve(this.context,sa({unitId:`${this.context.userId}_phantom_${Ta()}`,boardPosition:a.boardPosition,belongsTo:this.belongsTo,row:a.row,col:a.col}),e,!0);a.removeFromGame(!0),(s=this.context.gameController)==null||s.board.units.push(i),e.hero=i.exportData(),this.context.gameController.afterAction(b.SPECIAL,this.boardPosition,a.boardPosition)}}class ea extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){if(this.flashActingUnit(),L(this.context,this,a),this.getDistanceToTarget(a)===1&&a instanceof _&&a.isKO&&F(this.context,a.getTile()))f(this.scene,m.PRIESTESS_ATTACK),a.removeFromGame();else{f(this.scene,m.PRIESTESS_ATTACK);const i=a.getsDamaged(this.getTotalPower(),this.attackType);i&&this.lifeSteal(i),a instanceof _&&(a.priestessDebuff=!0,a.priestessDebuffImage.setVisible(!0),a.updateTileData(),a.unitCard.updateCardData(a)),this.removeAttackModifiers()}this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}async heal(a){var e;if(this.flashActingUnit(),L(this.context,this,a),this.superCharge||f(this.scene,m.HEAL),this.superCharge&&f(this.scene,m.HEAL_EXTRA),a.isKO){const i=this.getTotalHealing(.5);a.getsHealed(i)}else{const i=this.getTotalHealing(2);a.getsHealed(i)}this.removeAttackModifiers(),(e=this.context.gameController)==null||e.afterAction(b.HEAL,this.boardPosition,a.boardPosition)}special(a){}}class ta extends Ae{constructor(a,e,i){super(a,e,i)}attack(a){if(this.flashActingUnit(),L(this.context,this,a),a instanceof _&&a.isKO)f(this.scene,m.WRAITH_CONSUME),a.removeFromGame(!0),this.unitsConsumed<3&&(this.basePower+=50,this.unitsConsumed++,this.increaseMaxHealth(100),this.updateTileData(),this.unitCard.updateCardData(this));else{this.superCharge&&f(this.scene,m.WRAITH_ATTACK_BIG),this.superCharge||f(this.scene,m.WRAITH_ATTACK);const e=a.getsDamaged(this.getTotalPower(),this.attackType);e&&this.lifeSteal(e),this.removeAttackModifiers()}this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class Ve extends _{constructor(e,i,s,o=!1){super(e,i,s);n(this,"spawnAnim");o&&s&&(this.spawnAnim=e.add.image(0,-15,"phantomSpawnAnim_1").setOrigin(.5).setScale(.9),this.specialTileCheck(s),this.add([this.spawnAnim]),this.singleTween(this.spawnAnim,200))}async attack(e){this.flashActingUnit(),L(this.context,this,e),f(this.scene,m.WRAITH_ATTACK),e instanceof _&&e.isKO&&F(this.context,e.getTile())?e.removeFromGame():(e.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers()),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,e.boardPosition)}heal(e){}special(e){}equipFactionBuff(){}}class aa extends q{constructor(a,e){super(a,e)}use(a){a.equipFactionBuff(this.boardPosition),this.removeFromGame()}}class ft extends q{constructor(a,e){super(a,e)}use(a){f(this.scene,m.POTION_USE);const e=this.scene.add.image(a.x,a.y-10,"manaVial").setDepth(100);ee(e),!a.isKO&&(a.manaVial?a.getsHealed(1e3):(a.healAndIncreaseHealth(1e3,50),a.manaVial=!0,a.updateTileData()),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition),this.removeFromGame())}}class ia extends q{constructor(a,e){super(a,e)}use(a){const e=this.scene.add.image(a.x,a.y-20,"soulHarvestShockWave").setDepth(100);ee(e),f(this.scene,m.USE_HARVEST);const i=this.context.gameController;if(!i){console.error("SoulHarvest use() No gamecontroller");return}const s=100,o=ie(this.context,this,a,!1),r=[...o.heroTiles,...o.crystalTiles];let c=0;r.forEach(u=>{const p=this.context.gameController.board.units.find(y=>y.boardPosition===u.boardPosition)||this.context.gameController.board.crystals.find(y=>y.boardPosition===u.boardPosition);if(!p)throw new Error("SoulHarvest use() hero not found");if(p instanceof _){if(p.isKO)return;c+=p.getsDamaged(s,z.MAGICAL)}});const d=i.board.units.filter(u=>u.belongsTo===this.belongsTo),h=x(1/(d.length+3)*c);d.forEach(u=>u.increaseMaxHealth(h)),i.afterAction(b.USE,this.boardPosition,a.boardPosition),this.removeFromGame()}}function sa(t){return{unitType:g.PHANTOM,baseHealth:100,maxHealth:100,currentHealth:t.currentHealth??100,movement:3,attackRange:1,healingRange:0,attackType:z.MAGICAL,basePower:100,physicalDamageResistance:0,basePhysicalDamageResistance:0,magicalDamageResistance:0,baseMagicalDamageResistance:0,canHeal:!1,...oa(t)}}function oa(t){return{class:j.HERO,faction:B.DARK_ELVES,unitId:t.unitId,boardPosition:t.boardPosition??51,isKO:t.isKO??!1,lastBreath:t.lastBreath??!1,factionBuff:t.factionBuff??!1,runeMetal:t.runeMetal??!1,shiningHelm:t.shiningHelm??!1,superCharge:t.superCharge??!1,belongsTo:t.belongsTo??1,row:t.row??0,col:t.col??0,isShielded:t.priestessDebuff??!1,isDrunk:t.isDrunk??!1,paladinAura:t.paladinAura??1,priestessDebuff:t.priestessDebuff??!1,annihilatorDebuff:t.priestessDebuff??!1,attackTile:t.attackTile??0}}function na(t,a,e=9,i=2){const s=[],o=Math.floor(t/e),r=t%e;for(let c=1;c<=i;c++)for(let d=-c;d<=c;d++){let h=o,u=r;switch(a){case 0:h=o-c,u=r+d;break;case 1:h=o-c,u=r+c;break;case 2:h=o,u=r+c;break;case 3:h=o+c,u=r+c;break;case 4:h=o+c,u=r+d;break;case 5:h=o+c,u=r-c;break;case 6:h=o,u=r-c;break;case 7:h=o-c,u=r-c;break}const p=h*e+u;Ke(p)&&s.push(p)}return s}class we extends _{constructor(a,e,i){super(a,e,i)}special(a){}equipFactionBuff(a){f(this.scene,m.DRAGON_SCALE_USE);const e=this.scene.add.image(this.x+10,this.y-10,"dragonScale").setOrigin(.5).setDepth(100);ee(e),this.factionBuff=!0,this.factionBuffImage.setVisible(!0),this.characterImage.setTexture(this.updateCharacterImage()),this.physicalDamageResistance+=20,this.increaseMaxHealth(this.baseHealth*.1),this.unitCard.updateCardData(this),this.updateTileData(),this.scene.sound.play(m.DRAGON_SCALE_USE),this.context.gameController.afterAction(b.USE,a,this.boardPosition)}}class ra extends we{constructor(a,e,i){super(a,e,i)}onHealingDone(a){const e=x(a*.5);this.getsHealed(e)}async attack(a){this.flashActingUnit(),L(this.context,this,a),this.superCharge?f(this.scene,m.PALADIN_ATTACK):f(this.scene,m.PALADIN_ATTACK_BIG),a.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}async heal(a){this.flashActingUnit(),L(this.context,this,a),this.playHealSounds();let e;a.isKO?(e=this.getTotalHealing(.5),a.isKO=!1):e=this.getTotalHealing(2),a.getsHealed(e),e>0&&this.onHealingDone(e),this.removeAttackModifiers(),this.context.gameController.afterAction(b.HEAL,this.boardPosition,a.boardPosition)}playHealSounds(){this.context.sound.play(m.HEAL,{volume:.5})}async move(a){let e=ie(this.context,this,this.getTile(),!0),i=[...e.heroTiles,...e.crystalTiles];i.forEach(s=>{const o=this.context.gameController.board.units.find(r=>r.boardPosition===s.boardPosition)||this.context.gameController.board.crystals.find(r=>r.boardPosition===s.boardPosition);o&&o!==this&&(this.magicalDamageResistance-=5,this.physicalDamageResistance-=5,this.paladinAura-=1)}),e=ie(this.context,this,a,!0),i=[...e.heroTiles,...e.crystalTiles],i.forEach(s=>{const o=this.context.gameController.board.units.find(r=>r.boardPosition===s.boardPosition)||this.context.gameController.board.crystals.find(r=>r.boardPosition===s.boardPosition);o&&o!==this&&(o.magicalDamageResistance+=5,o.physicalDamageResistance+=5,o.paladinAura+=1,o.unitCard.updateCardData(o))}),super.move(a)}special(a){}}class la extends we{constructor(a,e,i){super(a,e,i)}async attack(a){if(this.flashActingUnit(),L(this.context,this,a),this.getDistanceToTarget(a)===1)f(this.scene,m.GRENADIER_ATTACK_MELEE),a.getsDamaged(this.getTotalPower()*.5,this.attackType);else{this.superCharge?f(this.scene,m.GRENADIER_ATTACK_BIG):f(this.scene,m.GRENADIER_ATTACK);const i=this.getTotalPower(),s=i*.5;a.getsDamaged(i,this.attackType);const o=ie(this.context,this,a.getTile(),!1);[...o.heroTiles,...o.crystalTiles].forEach(c=>{const d=this.context.gameController.board.units.find(h=>h.boardPosition===c.boardPosition)||this.context.gameController.board.crystals.find(h=>h.boardPosition===c.boardPosition);console.log(d),d&&a!==d&&d.belongsTo!==this.belongsTo&&d.getsDamaged(s,this.attackType)})}this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class ca extends we{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit(),L(this.context,this,a);const e=this.getDistanceToTarget(a),i=this.context.gameController.board;if(e===1)f(this.scene,m.GUNNER_ATTACK_ONLY),a.getsDamaged(this.getTotalPower(),this.attackType);else{f(this.scene,m.GUNNER_ATTACK);const s=this.getTotalPower()*.66,o=i.getAttackDirection(this.boardPosition,a.boardPosition),r=na(a.boardPosition,o,this.boardPosition,2);a.getsDamaged(s,this.attackType);let c=0;r.forEach(d=>{if(c>=2)return;const h=i.getTileFromBoardPosition(d);if(h&&Ye(this,h)){const u=this.context.gameController.board.units.find(p=>p.boardPosition===h.boardPosition)||this.context.gameController.board.crystals.find(p=>p.boardPosition===h.boardPosition);u&&u!==a&&(u.getsDamaged(s,this.attackType),c++)}})}this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class ha extends we{constructor(e,i,s){super(e,i,s);n(this,"shieldedTarget",null)}async special(e){this.flashActingUnit(),f(this.scene,m.ENGINEER_SHIELD_MAKE),this.shieldedTarget&&(f(this.scene,m.ENGINEER_SHIELD_BREAK),this.shieldedTarget.shieldImage.setVisible(!1),this.shieldedTarget.isShielded=!1),this.shieldedTarget=e,e.isShielded=!0,e.shieldImage.setVisible(!0),this.context.gameController.afterAction(b.SPECIAL,this.boardPosition,e.boardPosition)}applyTilePassive(){const e=this.getTile();if(e){switch(e.tileType){case A.POWER:this.basePower+=240;break;case A.PHYSICAL_RESISTANCE:this.basePhysicalDamageResistance+=this.basePhysicalDamageResistance*.48;break;case A.MAGICAL_RESISTANCE:this.baseMagicalDamageResistance+=this.baseMagicalDamageResistance*.48;break;case A.CRYSTAL_DAMAGE:this.basePower+=720;break;case A.SPEED:this.movement+=4;break}this.unitCard.updateCardData(this),this.updateTileData()}}attack(e){this.flashActingUnit(),L(this.context,this,e),f(this.scene,m.ENGINEER_ATTACK),e.getsDamaged(this.getTotalPower(),this.attackType),this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,e.boardPosition)}heal(e){}}class da extends we{constructor(a,e,i){super(a,e,i)}async attack(a){this.flashActingUnit(),L(this.context,this,a),f(this.scene,m.ANNIHILATOR_SHOOT);const e=this.getTotalPower(),i=e*.2;a.annihilatorDebuff=!0,a.getsDamaged(e,this.attackType);const s=ie(this.context,this,a.getTile(),!0),o=[...s.heroTiles,...s.crystalTiles];let r=[];o.forEach(c=>{const d=this.context.gameController.board.units.find(h=>h.boardPosition===c.boardPosition)||this.context.gameController.board.crystals.find(h=>h.boardPosition===c.boardPosition);d&&d.belongsTo!==this.belongsTo&&(d.getsDamaged(i,this.attackType),d instanceof _&&r.push(d))}),r.forEach(c=>{this.context.gameController.pushEnemy(a,c)}),this.removeAttackModifiers(),this.context.gameController.afterAction(b.ATTACK,this.boardPosition,a.boardPosition)}heal(a){}special(a){}}class ua extends q{constructor(a,e){super(a,e)}use(a){a.getsHealed(1e3),a.isDrunk=!0,a.physicalDamageResistance+=50,a.magicalDamageResistance+=50,a.unitCard.updateCardData(a),a.updateTileData(),f(this.scene,m.BREW_USE),this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition),this.removeFromGame()}}class ma extends q{constructor(a,e){super(a,e)}use(a){const i=a.getsDamaged(600,z.PHYSICAL);if(f(this.scene,m.DRILL_USE),a instanceof _&&(a.factionBuff=!1,a.factionBuffImage.setVisible(!1),a.characterImage.setTexture(a.updateCharacterImage()),a.increaseMaxHealth(a.baseHealth*-.1),a.unitCard.updateCardData(a),a.updateTileData()),a instanceof De){const s=i*.33,o=ie(this.context,this,a.getTile(),!0);[...o.heroTiles,...o.crystalTiles].forEach(c=>{const d=this.context.gameController.board.units.find(h=>h.boardPosition===c.boardPosition)||this.context.gameController.board.crystals.find(h=>h.boardPosition===c.boardPosition);d&&d.getsDamaged(s,z.PHYSICAL)})}this.context.gameController.afterAction(b.USE,this.boardPosition,a.boardPosition),this.removeFromGame()}}function R(t){return t.class==="hero"}function ae(t){return t.class==="item"}function yt(t){return t>44&&t<51}function Ke(t){return t>=0&&t<=44}function me(t,a){const e=t.isPlayerOne?1:2;return a.belongsTo===e}function x(t){return Math.round(t/5)*5}function Tt(t,a,e,i){return Math.abs(t-e)+Math.abs(a-i)}function bt(t,a){const i={[S.SHINING_HELM]:()=>new gt(t,a),[S.SUPERCHARGE]:()=>new pt(t,a),[S.RUNE_METAL]:()=>new xt(t,a),[S.DRAGON_SCALE]:()=>new jt(t,a),[S.HEALING_POTION]:()=>new Xt(t,a),[S.INFERNO]:()=>new qt(t,a),[S.MANA_VIAL]:()=>new ft(t,a),[S.SOUL_HARVEST]:()=>new ia(t,a),[S.SOUL_STONE]:()=>new aa(t,a),[S.DWARVERN_BREW]:()=>new ua(t,a),[S.PULVERIZER]:()=>new ma(t,a)}[a.itemType];return i||console.error("Error creating item",a),i()}function We(t,a,e){const s={[g.ARCHER]:()=>new Vt(t,a,e),[g.CLERIC]:()=>new zt(t,a,e),[g.KNIGHT]:()=>new Kt(t,a,e),[g.NINJA]:()=>new Yt(t,a,e),[g.WIZARD]:()=>new Wt(t,a,e),[g.PRIESTESS]:()=>new ea(t,a,e),[g.IMPALER]:()=>new Jt(t,a,e),[g.NECROMANCER]:()=>new Qt(t,a,e),[g.PHANTOM]:()=>new Ve(t,a,e),[g.VOIDMONK]:()=>new Zt(t,a,e),[g.WRAITH]:()=>new ta(t,a,e),[g.PALADIN]:()=>new ra(t,a,e),[g.GUNNER]:()=>new ca(t,a,e),[g.GRENADIER]:()=>new la(t,a,e),[g.ENGINEER]:()=>new ha(t,a,e),[g.ANNIHILATOR]:()=>new da(t,a,e)}[a.unitType];return s||console.error("Error creating hero",a),s()}async function ga(t,a,e){[g.NECROMANCER,g.WRAITH,g.PHANTOM].includes(a.unitType)?f(t,m.MOVE_FLY):f(t,m.MOVE_WALK),t.input.enabled=!1;const s=a.getByName("body");let o;a.belongsTo===1&&e.x<a.x&&(s.setFlipX(!0),o=!0),a.belongsTo===2&&e.x>a.x&&(s.setFlipX(!1),o=!0),await((c,d)=>new Promise(h=>{t.tweens.add({targets:c,x:d.x,y:d.y,duration:400,ease:"Linear",onComplete:()=>{t.input.enabled=!0,o&&s.setFlipX(!s.flipX),h()}})})).call(t,a,e)}async function Je(t,a,e){t.input.enabled=!1,await((s,o)=>new Promise(r=>{t.tweens.add({targets:s,x:o.x,y:o.y,duration:200,ease:"Linear",onComplete:()=>{t.input.enabled=!0,r()}})})).call(t,a,e)}function Ze(t,a,e,i,s){let o=e-t,r=i-a;return o=Math.sign(o),r=Math.sign(r),s||(o*=-1,r*=-1),{row:e+o,col:i+r}}function f(t,a){t.sound.play(a)}function Qe(t,a){const i={[S.RUNE_METAL]:m.RUNE_METAL_SELECT,[S.SUPERCHARGE]:m.SCROLL_SELECT,[S.SHINING_HELM]:m.ITEM_SELECT,[S.DRAGON_SCALE]:m.SHIELD_SELECT,[S.HEALING_POTION]:m.POTION_SELECT,[S.INFERNO]:m.AOE_SPELL_SELECT,[S.SOUL_STONE]:m.ITEM_SELECT,[S.MANA_VIAL]:m.POTION_SELECT,[S.SOUL_HARVEST]:m.AOE_SPELL_SELECT,[S.DWARVERN_BREW]:m.BREW_SELECT,[S.PULVERIZER]:m.DRILL_SELECT}[a];i&&f(t,i)}function pa(t,a){const i={[g.ARCHER]:m.ARCHER_DEATH,[g.KNIGHT]:m.KNIGHT_DEATH,[g.CLERIC]:m.CLERIC_DEATH,[g.WIZARD]:m.WIZARD_DEATH,[g.NINJA]:m.NINJA_DEATH,[g.IMPALER]:m.IMPALER_DEATH,[g.VOIDMONK]:m.VOIDMONK_DEATH,[g.PRIESTESS]:m.PRIESTESS_DEATH,[g.NECROMANCER]:m.NECROMANCER_DEATH,[g.WRAITH]:m.WRAITH_DEATH,[g.PHANTOM]:m.PHANTOM_DEATH,[g.GRENADIER]:m.GRENADIER_DEATH,[g.GUNNER]:m.GUNNER_DEATH,[g.PALADIN]:m.PALADIN_DEATH,[g.ENGINEER]:m.GUNNER_DEATH,[g.ANNIHILATOR]:m.GRENADIER_DEATH}[a];i&&f(t,i)}function fa(t){return[b.PASS,b.DRAW,b.REMOVE_UNITS].includes(t)?Te.AUTO:Te.USER}function ie(t,a,e,i=!1){var d;const s=(d=t.gameController)==null?void 0:d.board;if(!s)throw new Error("Inferno use() board not found");const o=s.getAreaOfEffectTiles(e);let r=[],c=[];return i===!0?(r=o==null?void 0:o.filter(h=>{var u;return h.hero&&((u=h.hero)==null?void 0:u.belongsTo)===a.belongsTo}),c=o==null?void 0:o.filter(h=>{var u;return h.crystal&&((u=h.crystal)==null?void 0:u.belongsTo)===a.belongsTo})):i===!1?(r=o==null?void 0:o.filter(h=>{var u;return h.hero&&((u=h.hero)==null?void 0:u.belongsTo)!==a.belongsTo}),c=o==null?void 0:o.filter(h=>{var u;return h.crystal&&((u=h.crystal)==null?void 0:u.belongsTo)!==a.belongsTo})):(r=o,c=o),{heroTiles:r,crystalTiles:c}}function Ye(t,a){let e=!1;return a.hero&&a.hero.belongsTo!==t.belongsTo&&!a.hero.isKO&&(e=!0),a.crystal&&a.crystal.belongsTo!==t.belongsTo&&(e=!0),e}function ya(t,a){var y,T;let e,i;if(a.unitId.includes(t.player1.playerId)?(e=t.player2,i=t.player1):(e=t.player1,i=t.player2),!e||!i)throw new Error("updateUnitsLeft() No player found");const s=(y=t.gameController)==null?void 0:y.board.units;if(!s)throw new Error("updateUnitsLeft() no units array found");const o=s.filter(P=>P.belongsTo===a.belongsTo).find(P=>!P.isKO);let r,c;i.playerId===t.activePlayer?(r=(T=t.gameController)==null?void 0:T.hand.getHand(),c=r.find(P=>P.belongsTo===a.belongsTo&&P.class===j.HERO)):(r=i.factionData.unitsInHand,c=r.find(P=>P.belongsTo===a.belongsTo&&P.class===j.HERO));const h=i.factionData.unitsInDeck.find(P=>P.belongsTo===a.belongsTo&&P.class===j.HERO),u=[S.HEALING_POTION,S.SOUL_HARVEST],p=r?r.find(P=>u.includes(P==null?void 0:P.itemType)):void 0;return!(o||c||h||p)}function et(t,a){if(!ya(t,a))return;const e=a.unitId.includes(t.player1.playerId)?t.player2:t.player1;t.gameController.gameOver={winCondition:He.UNITS,winner:e.playerId}}function tt(t,a){const e=t.col<5?1:2;return t.tileType===A.SPAWN&&a.belongsTo===e}function F(t,a){return a.tileType===A.SPAWN&&(t.isPlayerOne?a.col>5:a.col<5)}function L(t,a,e){const i=a.belongsTo===1,s=a.characterImage;i&&e.col>=a.col||!i&&e.col<=a.col||(i||s.setFlipX(!1),i&&s.setFlipX(!0),t.time.delayedCall(500,()=>{s.setFlipX(!a.characterImage.flipX)}))}function It(t){return{[g.ARCHER]:{cardType:v.SHOOTER,cardText:"Marksman who does high damage to enemies at range. Weak melee attack."},[g.CLERIC]:{cardType:v.SUPPORT,cardText:"Spellcaster who revives and heals allies. Attacks enemies at range."},[g.KNIGHT]:{cardType:v.FIGHTER,cardText:"Heavily armored and an excellent defender. His attacks knock back enemies."},[g.NINJA]:{cardType:v.SUPER,cardText:"Deals double damage in melee range. He can teleport to allies."},[g.WIZARD]:{cardType:v.CASTER,cardText:"Powerful spellcaster, damages groups of enemies with chain lightning."},[g.PRIESTESS]:{cardType:v.SUPPORT,cardText:"She can heal up to 3 tiles away, and weakens enemy attacks."},[g.IMPALER]:{cardType:v.SHOOTER,cardText:"Wields a powerful harpoon that can pull enemies close."},[g.NECROMANCER]:{cardType:v.CASTER,cardText:"Dark caster who can create Phantoms from fallen units."},[g.PHANTOM]:{cardType:v.SUMMONED,cardText:"A summoned phantom from beyond."},[g.VOIDMONK]:{cardType:v.FIGHTER,cardText:"Strong melee fighter whose hits do splash damage."},[g.WRAITH]:{cardType:v.SUPER,cardText:"A terror who gains max health and power by draining K.O.'d units."},[g.GUNNER]:{cardType:v.SHOOTER,cardText:"Fires a shotgun, hitting up to 3 targets at range for 66% damage or 1 target for 100% damage"},[g.PALADIN]:{cardType:v.SUPPORT,cardText:"Spellcaster who revives and heals allies. Provides 5% defense to nearby allys."},[g.GRENADIER]:{cardType:v.CASTER,cardText:"Lobs explosives dealing 50% damage to all enemys around target."},[g.ANNIHILATOR]:{cardType:v.SUPER,cardText:"Fragile rocketeer who temporarily removes 50% physical defense on targets."},[g.ENGINEER]:{cardType:v.SUPPORT,cardText:"Can create a shield to protect allys and crystals. Additionally, gains 140% bonus from special tiles."},[S.SHINING_HELM]:{cardName:"Shining Helm",cardType:v.EQUIPMENT,cardText:"Adds 20% magical defense, and 10% max health."},[S.SUPERCHARGE]:{cardName:"Scroll",cardType:v.BUFF,cardText:"Multiplies an ally's attack power by 3 for one attack."},[S.RUNE_METAL]:{cardName:"Runemetal",cardType:v.EQUIPMENT,cardText:"Permanently increases an ally's power by 50%."},[S.DRAGON_SCALE]:{cardName:"Dragonscale",cardType:v.EQUIPMENT,cardText:"Adds 20% physical defense, and 10% max health."},[S.HEALING_POTION]:{cardName:"Healing Potion",cardType:v.CONSUMABLE,cardText:"Heals an ally for 1000 HP, or revives an ally with 100 HP."},[S.INFERNO]:{cardName:"Inferno",cardType:v.SPELL,cardText:"Damages all enemies in a 3x3 area and destroys knocked-out units."},[S.MANA_VIAL]:{cardName:"Mana Vial",cardType:v.CONSUMABLE,cardText:"Heals an ally for 1000 HP and increases max health by 50 HP."},[S.SOUL_HARVEST]:{cardName:"Soul Harvest",cardType:v.SPELL,cardText:"Drains health from enemies in a 3x3 area. Increases max health for all allies and revives knocked-out units."},[S.SOUL_STONE]:{cardName:"Soulstone",cardType:v.EQUIPMENT,cardText:"Doubles the effect of a unit's life leech and increases max health by 10%."},[S.DWARVERN_BREW]:{cardName:"Dwarvern Brew",cardType:v.CONSUMABLE,cardText:"Heals an ally for 1000 HP and temporarily adds 50% resistance."},[S.PULVERIZER]:{cardName:"Pulverizer",cardType:v.SPELL,cardText:"Targets 1 enemy destroying armor in process, or does 33% spash damage if target is a crystal."}}[t]}function ke(t){return t.charAt(0).toUpperCase()+t.slice(1)}function be(t,a){return t.length>a?t.slice(0,a-3)+"...":t}function Ne(t){var a;t.visibleUnitCard&&(t.visibleUnitCard.setDepth(t.visibleUnitCard.row+10),(a=t.visibleUnitCard.unitCard)==null||a.setVisible(!1))}function Ta(){return Math.floor(1e3+Math.random()*9e3)}function ee(t,a=2){t.scene.tweens.add({targets:t,scale:a,alpha:0,duration:1e3,onComplete:()=>{t.destroy()}})}function ba(t,a=2){return new Promise(e=>{t.scene.tweens.add({targets:t,scale:a,alpha:50,duration:1e3,onComplete:()=>{t.destroy(),e()}})})}function Re(t,a=1e3){return new Promise(e=>{t.scene.tweens.add({targets:t,alpha:0,duration:a,ease:"Linear",onComplete:()=>{t.destroy(),e()}})})}function Ue(t,a,e,i){return t.add.text(a,e,i,{fontFamily:"proLight",fontSize:60,color:"#fffb00"}).setDepth(9999)}const at={x:800,y:400};class ze extends Phaser.GameObjects.Container{constructor(e){const{context:i,opponentId:s,challengeType:o,username:r,gameId:c}=e;super(i,at.x,at.y);n(this,"blockingLayer");n(this,"backgroundImage");n(this,"councilButtonImage");n(this,"elvesButtonImage");n(this,"cancelButtonImage");n(this,"popupText");n(this,"cancelButtonText");this.blockingLayer=i.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=i.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.councilButtonImage=i.add.image(-150,60,B.COUNCIL).setScale(.4).setInteractive({useHandCursor:!0}),this.elvesButtonImage=i.add.image(-10,60,B.DARK_ELVES).setScale(.4).setInteractive({useHandCursor:!0}),this.cancelButtonImage=i.add.image(130,60,"popupButton").setTint(10027008).setDisplaySize(110,60).setInteractive({useHandCursor:!0});const d=o===he.SEND?`Pick a faction to challenge ${be(r,20)}`:"Pick a faction to accept the challenge";this.popupText=i.add.text(0,-50,d,{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.cancelButtonText=i.add.text(130,60,"BACK",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5);const h=async u=>{i.sound.play(C.BUTTON_GENERIC),this.setVisible(!1),o===he.SEND&&(await Bt(i.userId,u,s)||Re(i.add.text(200,350,"A player has reached the max amount of open games",{fontFamily:"proLight",fontSize:60,color:"#fffb00"}).setDepth(999),3e3)),o===he.ACCEPT&&i instanceof St&&ka(i.lobbyRoom,c,i.userId,u)};this.councilButtonImage.on("pointerdown",async()=>{f(this.scene,C.BUTTON_PLAY),await h(B.COUNCIL)}),this.elvesButtonImage.on("pointerdown",async()=>{f(this.scene,C.BUTTON_PLAY),await h(B.DARK_ELVES)}),this.cancelButtonImage.on("pointerdown",()=>{this.scene.sound.play(C.BUTTON_FAILED),this.setVisible(!1),this.destroy()}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.councilButtonImage,this.elvesButtonImage,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),i.add.existing(this)}}const Ge={player1:"",player2:""};function At(t){const a=document.getElementById("chatmessages");if(!a)return;const{username:e,message:i}=t,s=document.createElement("div");s.innerHTML=`<span class="username">${e}</span>: <span class="message">${i}</span>`;const o=s.querySelector(".username");o.style.color=Ge.player1===t.username?"#4fc3f7":"#f44336",o.style.fontWeight="bold",a.appendChild(s),a.scrollTop=a.scrollHeight}function Ia(t){Ge.player1=t.currentGame.players[0].userData.username,Ge.player2=t.currentGame.players[1].userData.username;const a=t.add.dom(495,800).createFromCache("chatComponent").setOrigin(.5),e=a.node;e.style.pointerEvents="auto";const i=a.getChildByID("chatcomponent"),s=a.getChildByID("chatinput"),o=a.getChildByID("chatmessages"),r=t.scale.width,c=t.scale.height;i.style.width=`${r*.705}px`,i.style.height=`${c*.19}px`,i.style.backgroundColor="#111",i.style.borderRadius="8px",i.style.padding="8px",i.style.boxShadow="0 0 10px rgba(0,0,0,0.5)",i.style.display="flex",i.style.flexDirection="column",i.style.gap="8px",o.style.flex="1",o.style.overflowY="auto",o.style.overflowX="hidden",o.style.whiteSpace="pre-wrap",o.style.backgroundColor="#222",o.style.color="#fff",o.style.fontFamily="proLight",o.style.fontSize="30px",o.style.padding="8px",o.style.borderRadius="4px",o.style.maxHeight=`${c*.25}px`,o.style.touchAction="manipulation",s.style.width="100%",s.style.height="25px",s.style.padding="6px",s.style.border="none",s.style.borderRadius="4px",s.style.fontSize="25px",s.style.fontFamily="proLight";const d=a.getChildByID("chatmessages");return d.style.maxHeight=`${c*.25}px`,s.addEventListener("keydown",u=>{u.key==="Enter"&&s.value.trim()&&(console.log("Message: ",s.value),Ca(t.currentRoom,s.value.trim()),s.value="")}),t.currentGame.chatLogs.messages.forEach(u=>At(u)),o.scrollTop=o.scrollHeight,a}async function Aa(t,a){const{colyseusClient:e,userId:i}=t,s=localStorage.getItem("jwt");if(!e||!i||!a||!s){console.error("createGame error: missing one of client / userId / faction / token");return}try{console.log("Checking for open games | creating a new game...");const o=await e.create("game_room",{userId:i,faction:a,token:s});t.currentRoom=o,wt(o),console.log("Created and joined room:")}catch(o){console.error("Failed to create or join room:",o)}}async function wa(t,a,e,i){const s=localStorage.getItem("jwt");if(!t||!a||!e||!s){console.error("joinGame, { client | userid | gameid | token } missing");return}let o;try{o=await t.joinOrCreate("game_room",{userId:a,roomId:e,token:s,mongoId:e}),console.log("Joined or created room:",o.roomId),i.currentRoom=o,wt(o)}catch(r){console.error("Failed to join or create room",r);return}return o}function wt(t){t.onMessage("chatMessageReceived",a=>{console.log("Received chat message:",a),At(a)}),t.onMessage("pong",()=>{}),t==null||t.onLeave(a=>{console.log("Left room with code:",a)})}function Ct(t,a,e,i,s){const o=localStorage.getItem("jwt");if(!t||!a||!e||!o){console.error("Error sending turn, missing one or more params");return}t.send("turnSent",{_id:t.roomId,currentTurn:a,newActivePlayer:e,gameOver:s,turnNumber:i,token:o}),console.log("Turn message sent")}function Ca(t,a){const e=localStorage.getItem("jwt");t.send("chatMessage",{_id:t.roomId,message:a,token:e}),console.log("Chat message sent")}function Sa(t){const a=new Date,e=new Date(t);let i=Math.floor((a.getTime()-e.getTime())/1e3);const s={year:31536e3,month:2592e3,day:86400,hour:3600,minute:60,second:1},o=[];for(const[r,c]of Object.entries(s)){const d=Math.floor(i/c);if(d>0&&(o.push(`${d} ${r}${d!==1?"s":""}`),i-=d*c,o.length===2))break}return o.length?o.join(" and ")+" ago":"just now"}async function Pa(t,a){t.currentRoom&&(console.log("Leaving game: ",t.currentRoom.roomId),await t.currentRoom.leave(),t.currentRoom=void 0,t.scene.stop("GameScene")),console.log("Accessing game: ",a._id);const e=await wa(t.colyseusClient,t.userId,a._id,t);e&&(t.currentRoom=e,t.scene.launch("GameScene",{userId:t.userId,colyseusClient:t.colyseusClient,currentGame:a,currentRoom:e}))}async function ce(t){if(!t.gameList){console.error("createGameList() no gameList in context");return}t.gameListContainer&&t.gameListContainer.destroy(!0);const a=[],e=[],i=[],s=[],o=[],r=[];t.gameList.forEach(E=>{E.status===N.SEARCHING&&i.push(E),E.status===N.PLAYING&&E.activePlayer===t.userId&&a.push(E),E.status===N.PLAYING&&E.activePlayer!==t.userId&&e.push(E),E.status===N.CHALLENGE&&(E.players[0].userData._id===t.userId&&s.push(E),E.players[1].userData._id===t.userId&&o.push(E)),E.status===N.FINISHED&&r.push(E)}),t.activeGamesAmount=a.length+e.length+i.length+o.length+s.length,a.length||o.length?document.title=`(${a.length+o.length}) Fan Academy`:document.title="Fan Academy";const c=142,d=700,h=20,u=40,p=915,y=400;let T=0;const P=19,w=65,D=t.add.container(P,w);t.gameListContainer=D;const O=E=>{E.forEach((k,Q)=>{const ne=k.players.find(le=>t.userId===le.userData._id),de=k.players.find(le=>t.userId!==le.userData._id);if(!ne)return;T+=(Q===0?u:c)+h;const re=t.add.image(0,T,"gameListButton").setOrigin(0).setTint(12303291),je=ne.faction?{faction:ne.faction,scale:.4}:{faction:"unknownFaction",scale:1.2},Pt=t.add.text(20,T+100,Sa(k.lastPlayedAt),{fontFamily:"proLight",fontSize:38,color:"#ffffff"}).setOrigin(0),Et=t.add.image(90,T+c/2,je.faction).setScale(je.scale);let Be,Le,Me;const Xe=le=>t.add.text(200,T+c/2-33,be(le,13),{fontSize:50,fontFamily:"proLight"});de?(Be=t.add.image(510,T+c/2,de.faction).setScale(.4),Le=t.add.image(632,T+c/2,de.userData.picture).setFlipX(!0).setDisplaySize(256*.4,256*.4),Me=Xe(de.userData.username)):(Be=t.add.image(510,T+c/2,"unknownFaction"),Le=t.add.image(632,T+c/2,"unknownOpponent").setFlipX(!0).setScale(.4),Me=Xe("Searching..."));const $e=t.add.image(d-30,T,"closeButton").setOrigin(0).setVisible(!1);(k.status===N.SEARCHING||k.status===N.CHALLENGE)&&($e.setVisible(!0).setInteractive({useHandCursor:!0}),$e.on("pointerup",async()=>{oe||(Da(t.lobbyRoom,k._id,t.userId),t.sound.play(C.GAME_DELETE),ce(t))}));const Ee=()=>{re.clearTint(),t.activeGameImage&&t.activeGameImage.setTint(12303291),t.activeGameImage=re,t.activeGameImageId=k._id};(k.status===N.PLAYING||k.status===N.FINISHED)&&(re.setInteractive({useHandCursor:!0}),t.activeGameImageId===k._id&&Ee(),re.on("pointerup",async()=>{oe||(Ee(),t.sound.play(C.BUTTON_GENERIC),await Pa(t,k))})),k.status===N.CHALLENGE&&o.find(le=>le._id===k._id)&&(re.setInteractive({useHandCursor:!0}),t.activeGameImageId===k._id&&Ee(),re.on("pointerup",async()=>{oe||(t.sound.play(C.GAME_DELETE),Ee(),t.currentRoom&&(console.log("Leaving game: ",t.currentRoom.roomId),await t.currentRoom.leave(),t.currentRoom=void 0,t.scene.stop("GameScene")),new ze({context:t,opponentId:de.userData._id,challengeType:he.ACCEPT,gameId:k._id}))})),D.add([re,Et,Be,Me,Le,$e,Pt])})},M=t.add.text(40,T+40,"Create a game",{fontSize:70,fontFamily:"proHeavy"}),J=t.add.image(0,T,"newGameButton").setOrigin(0),G=t.add.image(230,T,B.COUNCIL).setOrigin(0).setScale(.5).setInteractive({useHandCursor:!0}),I=t.add.image(380,T,B.DARK_ELVES).setOrigin(0).setScale(.5).setInteractive({useHandCursor:!0}),$=t.add.image(530,T,B.DWARVES).setOrigin(0).setScale(.5).setInteractive({useHandCursor:!0}),V=async E=>{var k;if(t.activeGamesAmount>=t.activeGamesAmountLimit){if(console.log("Reached game cap"),t.currentRoom)t.game.events.emit("messageToGameScene",{x:300,y:350,message:"You have reached the max amount of open games"});else{const Q=Ue(t,300,350,"You have reached the max amount of open games");Re(Q,3e3)}return}if(t.userId){t.sound.play(C.BUTTON_PLAY);const Q=t.currentRoom?t.currentRoom:void 0;if(await Aa(t,E),await((k=t.currentRoom)==null?void 0:k.leave()),t.currentRoom=void 0,Q&&(t.currentRoom=Q),t.currentRoom)t.game.events.emit("messageToGameScene",{x:700,y:350,message:"New game created"});else{const ne=Ue(t,700,350,"New game created");Re(ne,3e3)}}else console.error("No userId when creating a new game")};G.on("pointerdown",async()=>await V(B.COUNCIL)),I.on("pointerdown",async()=>await V(B.DARK_ELVES)),$.on("pointerdown",async()=>await V(B.DWARVES)),T+=150,D.add([J,M,G,I,$]);const te=E=>t.add.text(30,T,E,{fontSize:50,fontFamily:"proLight"}),H=(E,k)=>{if(!E.length)return;const Q=te(k);D.add(Q),O(E),T+=c+h};H(a,"Your turn"),H(o,"Challenges received"),H(e,"Opponent's turn"),H(s,"Challenges sent"),H(i,"Searching for players"),H(r,"Finished"),D.setScale(.51);const U=t.make.graphics();U.fillStyle(16777215),U.fillRect(19,65,y,p-15);const K=new Phaser.Display.Masks.GeometryMask(t,U);D.setMask(K);const W=E=>E.x>=19&&E.x<=19+y&&E.y>=w&&E.y<=w+p;let X=0;const Ce=0,Z=Math.min(p-T*.51-10,0);t.input.on("wheel",(E,k,Q,ne,de)=>{W(E)&&T>p&&(X-=ne,X=Phaser.Math.Clamp(X,Z,Ce),D.y=w+X)});let se=!1,Se=0,Pe=0,oe=!1;t.input.on("pointerdown",E=>{W(E)&&T>p?(se=!0,Se=E.y,Pe=X,oe=!1):(se=!1,Se=0,Pe=0,oe=!1)}),t.input.on("pointermove",E=>{if(!se)return;const k=E.y-Se;Math.abs(k)>5&&(oe=!0),X=Phaser.Math.Clamp(Pe+k,Z,0),D.y=65+X}),t.input.on("pointerup",()=>{se=!1,Se=0,Pe=0,oe=!1})}function Ea(){const t=document.getElementById("disconnect-warning");t&&(t.style.display="block")}function _a(t){t.add.dom(700,400).createFromCache("disconnectWarning")}async function va(t,a,e){let i;const s=localStorage.getItem("jwt");if(!s){console.error("Error connecting to game lobby: missing token");return}try{console.log("Connecting to game lobby..."),i=await t.joinOrCreate("lobby",{userId:a,token:s}),i.onMessage("newGameListUpdate",async o=>{var c,d;console.log("A game has been added"),e.gameList||console.error("newGameListUpdate - No context.gameList found");const r=e.gameList.findIndex(h=>h._id===o.game._id);r!==-1&&((c=e.gameList)==null||c.splice(r,1)),(d=e.gameList)==null||d.push(o.game),e.activeGamesAmount++,await ce(e)}),i.onMessage("gameListUpdate",async o=>{var d,h,u;console.log("A game has been updated");let r;const c=e.gameList.findIndex(p=>p._id===o.gameId);if(c!==-1&&(r=(d=e.gameList)==null?void 0:d.splice(c,1)[0]),!r)throw new Error("Colyseus lobby. No game found");r.previousTurn=o.previousTurn,r.activePlayer=o.newActivePlayer,r.turnNumber=o.turnNumber,r.lastPlayedAt=o.lastPlayedAt,(h=e.gameList)==null||h.push(r),await ce(e),o.gameId===((u=e.currentRoom)==null?void 0:u.roomId)&&e.scene.get("GameScene").scene.restart({userId:e.userId,colyseusClient:e.colyseusClient,currentGame:r,currentRoom:e.currentRoom,triggerReplay:o.newActivePlayer===e.userId})}),i.onMessage("gameOverUpdate",async o=>{var u;console.log("A game has ended, updating game list");const r=e.gameList;r||console.error("gameOverUpdate - No context.gameList found");const c=r==null?void 0:r.filter(p=>p.status!==N.FINISHED),d=r==null?void 0:r.filter(p=>p.status===N.FINISHED);d==null||d.sort((p,y)=>new Date(y.finishedAt).getTime()-new Date(p.finishedAt).getTime()),console.log("finished games",d),d&&d.length>4&&d.pop();const h=c==null?void 0:c.find(p=>p._id===o.gameId);if(!h)throw new Error("Colyseus lobby. No game found");h.previousTurn=o.previousTurn,h.turnNumber=o.turnNumber,h.status=N.FINISHED,h.lastPlayedAt=o.lastPlayedAt,h.gameOver=o.gameOver,e.gameList=[...c??[],...d??[]],e.activeGamesAmount--,await ce(e),o.gameId===((u=e.currentRoom)==null?void 0:u.roomId)&&e.scene.get("GameScene").scene.restart({userId:e.userId,colyseusClient:e.colyseusClient,currentGame:h,currentRoom:e.currentRoom})}),i.onMessage("gameDeletedUpdate",async o=>{var c;console.log("A game has been deleted, removing it from the game list"),e.gameList||console.error("gameDeletedUpdate - No context.gameList found");const r=e.gameList.findIndex(d=>d._id===o.gameId);r!==-1&&((c=e.gameList)==null||c.splice(r,1)),await ce(e),console.log("Game removed from list")}),i.onMessage("userDeletedUpdate",async o=>{console.log("A user has been deleted, removing affected games from the game list"),e.gameList||console.error("userDeletedUpdate - No context.gameList found"),o.gameIds.forEach(r=>{var d,h;const c=e.gameList.findIndex(u=>u._id===r);if(c!==-1){const u=(d=e.gameList)==null?void 0:d.splice(c,1);u!=null&&u.length&&((h=e.currentRoom)==null?void 0:h.roomId)===u[0]._id&&e.scene.get("GameScene").scene.stop()}}),e.activeGamesAmount--,await ce(e),console.log("Games removed from list")}),i.onMessage("pong",()=>{}),i.onLeave(o=>{console.log("Left room with code:",o),Ea()})}catch(o){console.error("Error joining lobby ->",o)}if(!i)throw new Error("connectToGameLobby() No lobby found");return i}function Da(t,a,e){const i=localStorage.getItem("jwt");t.send("gameDeletedMessage",{gameId:a,userId:e,token:i})}function ka(t,a,e,i){const s=localStorage.getItem("jwt");t.send("challengeAcceptedMessage",{gameId:a,userId:e,faction:i,token:s})}const l="https://cdn.jsdelivr.net/gh/nochinator/sa-assets@58bee66d21c333c39eb001e86482163f849725f1";class Ra extends Phaser.Scene{constructor(){super({key:"PreloaderScene"})}preload(){this.load.image("loadingScreen",`${l}/ui/loading.webp`),this.load.once("filecomplete-image-loadingScreen",()=>{this.add.image(0,0,"loadingScreen").setOrigin(0).setScale(2.8),this.loadRestOfAssets()})}loadRestOfAssets(){this.load.font("proHeavy","/fan-academy/fonts/BlambotFXProHeavyLowerCapsBB.woff","truetype"),this.load.font("proLight","/fan-academy/fonts/BlambotFXProLightBB.woff","truetype"),this.load.image("popupBackground",`${l}/images/gameItems/popup_button.webp`),this.load.image("popupButton",`${l}/images/gameItems/ColorSwatch_Color-hd.webp`),this.load.image("gameBackground",`${l}/ui/create_game.webp`)}create(){this.scene.start("MainMenuScene")}}const Oe=["archer_v1-hd","archer_v2-hd","archer_v3-hd","archer_v4-hd","cleric_v0-hd","cleric_v1-hd","cleric_v2-hd","cleric_v3-hd","cleric_v4-hd","impaler_v1-hd","impaler_v2-hd","impaler_v3-hd","impaler_v4-hd","knight_v0-hd","knight_v1-hd","knight_v2-hd","knight_v3-hd","knight_v4-hd","ninja_v1-hd","ninja_v2-hd","phantom_v1-hd","phantom_v2-hd","phantom_v3-hd","priestess_v0-hd","priestess_v1-hd","priestess_v2-hd","priestess_v3-hd","priestess_v4-hd","unknownAvatar-hd","wizard_v1-hd","wizard_v2-hd","wizard_v3-hd","wizard_v4-hd","wraith_v1-hd","wraith_v2-hd","voidmonk_v1-hd","voidmonk_v2-hd","voidmonk_v3-hd","voidmonk_v4-hd","necromancer_v0-hd","necromancer_v1-hd","necromancer_v2-hd","necromancer_v3-hd","necromancer_v4-hd","soulHarvestIcon","soulStoneIcon","shiningHelmIcon","superChargeIcon","runeMetalIcon","crystalIcon","manaVialIcon","infernoIcon","healingPotionIcon","dragonScaleIcon"];class St extends Phaser.Scene{constructor(){super({key:"UIScene"});n(this,"colyseusClient");n(this,"lobbyRoom");n(this,"userId");n(this,"gameListContainer");n(this,"gameList");n(this,"currentRoom");n(this,"gameScene");n(this,"activeGameImage");n(this,"activeGameImageId");n(this,"activeGamesAmountLimit",50);n(this,"activeGamesAmount",0);this.colyseusClient=new Ot.Client("https://scribble-academy-be.onrender.com")}init(e){this.userId=e.userId}preload(){this.load.image(B.COUNCIL,`${l}/ui/council_emblem.webp`),this.load.image(B.DARK_ELVES,`${l}/ui/elves_emblem.webp`),this.load.image(B.DWARVES,`${l}/ui/dwarves_emblem.png`),Oe.forEach(e=>{this.load.image(e,`${l}/images/profilePics/${e}.webp`)}),this.load.image("gameListButton",`${l}/ui/game_list_premade.webp`),this.load.image("newGameButton",`${l}/ui/new_game_btn.webp`),this.load.image("unknownFaction",`${l}/ui/unknown_faction.webp`),this.load.image("unknownOpponent",`${l}/images/profilePics/unknownAvatar-hd.webp`),this.load.image("closeButton",`${l}/ui/close_button.webp`),this.load.image("concedeButton",`${l}/ui/concede_button.webp`),this.load.html("disconnectWarning","html/disconnectWarning.html"),this.load.audio("deleteGameSound",`${l}/audio/ui/deleteGame.mp3`)}async create(){this.time.addEvent({delay:3e5,callback:()=>{this.lobbyRoom.send("ping")},loop:!0}),_a(this),this.add.image(0,0,"loadingScreen").setOrigin(0).setScale(2.8),this.lobbyRoom=await va(this.colyseusClient,this.userId,this),this.gameList=await Nt(this.userId),this.add.image(0,0,"uiBackground").setOrigin(0),await ce(this),new Ht(this),this.add.image(397,15,"gameBackground").setOrigin(0,0).setScale(1.06,1.2)}onShutdown(){this.sound.stopAll()}}async function Oa(t,a){try{const e=localStorage.getItem("jwt"),i=await fetch("https://scribble-academy-be.onrender.com/users/login",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({username:t,password:a})}),s=await i.json();return i.ok?(console.log("Successful login! :)"),localStorage.setItem("jwt",s.token),{success:!0,userData:s.userData}):(console.error("Server responded with an error:",s.message||"Unknown error"),{success:!1,error:s.message||"Unknown error"})}catch(e){return console.error("Error login in: ",e),{success:!1,error:"Network error. Please try again."}}}async function Ha(t,a,e){try{const i=localStorage.getItem("jwt"),s=await fetch("https://scribble-academy-be.onrender.com/users/signup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({email:t,username:a,password:e})}),o=await s.json();return s.ok?(console.log("Successful sign up! :)"),localStorage.setItem("jwt",o.token),{success:!0,userData:o.userData}):(console.log("Server responded with an error:",o.message||"Unknown error"),{success:!1,error:o.message||"Unknown error"})}catch(i){return console.error("Network error signing up:",i),{success:!1,error:"Network error. Please try again."}}}async function Na(){console.log("Checking Authentication Status...");const t=localStorage.getItem("jwt"),a=await fetch("https://scribble-academy-be.onrender.com/auth-check",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(a.status!=200){console.error("User not authenticated...");return}const e=await a.json();return console.log("User authenticated...",e.userId),e}async function fe(t=1){console.log("Fetching leaderboard data...");const a=localStorage.getItem("jwt"),e=await fetch(`https://scribble-academy-be.onrender.com/users/leaderboard?page=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),i=await e.json();return e.status!==200?(console.error("Error getting leaderboard data..."),null):(console.log("Leaderboard data fetched"),i)}async function Ba(){console.log("Fetching profile data...");const t=localStorage.getItem("jwt"),a=await fetch("https://scribble-academy-be.onrender.com/users/profile",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),e=await a.json();return a.status!==200?(console.error("Error getting profile data..."),null):(console.log("Profile data fetched"),e)}async function La(t){try{const a=localStorage.getItem("jwt"),e=await fetch("https://scribble-academy-be.onrender.com/users/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)}),i=await e.json();return e.ok?(console.log("Profile updated! :)"),{success:!0,user:i}):(console.log("Server responded with an error:",i.message||"Unknown error"),{success:!1,error:i.message||"Unknown error"})}catch(a){return console.error("Network error updating profile:",a),{success:!1,error:"Network error. Please try again."}}}async function Ma(){try{const t=localStorage.getItem("jwt"),a=await fetch("https://scribble-academy-be.onrender.com/users/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),e=await a.json();return a.ok?(console.log("Profile deleted :("),localStorage.removeItem("jwt"),e):(console.log("Server responded with an error:",e.message||"Unknown error"),{success:!1,error:e.message||"Unknown error"})}catch(t){return console.error("Network error while deleting account:",t),{success:!1,error:"Network error. Please try again."}}}function ue(t){const{thisParam:a,x:e,y:i,imageKey:s,text:o,font:r,tint:c,callback:d}=t,h=a.add.image(0,0,s).setOrigin(.5).setInteractive({useHandCursor:!0}),u=a.add.text(.5,.5,o,{font:r}).setOrigin(.5,.6);c&&h.setTint(10027008);const p=a.add.container(e,i,[h,u]);return h.on("pointerdown",()=>{d()}),p}class $a extends Phaser.Scene{constructor(){super({key:"MainMenuScene"});n(this,"userId");n(this,"gameList");n(this,"userPreferences");n(this,"currentSubScene")}init(){}preload(){this.load.html("loginForm","html/loginForm.html"),this.load.html("signUpForm","html/signUpForm.html"),this.load.image("uiBackground",`${l}/ui/game_screen.webp`),this.load.image("mainMenuImage",`${l}/ui/main_menu_image.webp`),this.load.image("mainMenuBottom",`${l}/ui/main_menu_bottom.webp`),this.load.image("playButton",`${l}/ui/play_button.webp`),this.load.image("mainMenuButton",`${l}/ui/main_menu_button.webp`),this.load.font("proHeavy","/fan-academy/fonts/BlambotFXProHeavyLowerCapsBB.woff","truetype"),this.load.font("proLight","/fan-academy/fonts/BlambotFXProLightBB.woff","truetype"),this.load.audio("buttonFailedSound",`${l}/audio/ui/buttonFailed.mp3`),this.load.audio("battleButtonSound",`${l}/audio/ui/battleButton.mp3`),this.load.audio("buttonPressGenericSound",`${l}/audio/ui/buttonPressGeneric.mp3`)}async create(){const e=await Na();e&&this.updateUserPreferences(e);const i=this.add.image(0,0,"uiBackground").setOrigin(0),s=this.add.image(0,0,"mainMenuImage").setOrigin(0),o=this.add.image(397,15,"gameBackground").setOrigin(0,0).setScale(1.06,1.2).setVisible(!1);s.x=i.width-s.width-14,s.y+=14;const r=this.add.image(0,0,"mainMenuBottom").setOrigin(0),c=this.add.text(.5,.5,"Welcome to the Hero Academy!",{font:"50px proLight",color:"#873600"}).setOrigin(-.4,-1.3);this.add.container(i.width-r.width-14,i.height-r.height-14,[r,c]),this.add.text(30,730,"This game is in beta state: Expect bugs and crashes. If you run into any issues, please let dadazbk know on Discord. Thanks!",{fontFamily:"proLight",fontSize:35,color:"#ffffff",wordWrap:{width:350,useAdvancedWrap:!0}});const d=this.textures.get("mainMenuButton").getSourceImage().height,h=200,u=20;ue({thisParam:this,x:h,y:d*4+u,imageKey:"mainMenuButton",text:"Profile",font:"70px proHeavy",callback:()=>{this.sound.play(C.BUTTON_GENERIC),o.setVisible(!0),s.setVisible(!1),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.launch("ProfileScene",{userId:this.userId}),this.currentSubScene="ProfileScene"}}),ue({thisParam:this,x:h,y:d*6-u,imageKey:"mainMenuButton",text:"Leaderboard",font:"70px proHeavy",callback:()=>{this.sound.play(C.BUTTON_GENERIC),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.launch("LeaderboardScene",{userId:this.userId}),this.currentSubScene="LeaderboardScene"}}),ue({thisParam:this,x:h,y:d*7+5,imageKey:"mainMenuButton",text:"About",font:"70px proHeavy",callback:()=>{this.sound.play(C.BUTTON_GENERIC),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.launch("AboutScene"),this.currentSubScene="AboutScene"}}),ue({thisParam:this,x:h,y:d*8.5,imageKey:"mainMenuButton",text:"Discord",font:"70px proHeavy",callback:()=>{this.sound.play(C.BUTTON_GENERIC),window.open("https://discord.gg/pkfwDvKyxX")}}),ue({thisParam:this,x:200,y:140,imageKey:"playButton",text:"Play!",font:"130px proHeavy",callback:()=>{this.sound.play(C.BUTTON_PLAY),this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.start("UIScene",{userId:this.userId}),this.currentSubScene="UIScene"}}),ue({thisParam:this,x:h,y:d*14+40,imageKey:"mainMenuButton",text:"Logout",font:"70px proHeavy",tint:"0x990000",callback:async()=>{this.sound.play(C.BUTTON_GENERIC),localStorage.removeItem("jwt"),this.userId=void 0,document.title="Fan Academy",this.currentSubScene&&this.scene.stop(this.currentSubScene),this.scene.restart()}}),this.createSignUpAndLoginForms(this.userId)}onShutdown(){this.sound.stopAll()}createSignUpAndLoginForms(e){const i=this.add.dom(800,400).createFromCache("loginForm"),s=this.add.dom(800,400).createFromCache("signUpForm");s.setVisible(!1);const o=this.add.rectangle(0,0,2900,2e3,0,.001).setOrigin(.5).setInteractive(),r=i.getChildByID("username"),c=i.getChildByID("password"),d=i.getChildByID("loginButton"),h=i.getChildByID("linkToSignUp"),u=i.getChildByID("loginError"),p=s.getChildByID("email"),y=s.getChildByID("username"),T=s.getChildByID("password"),P=s.getChildByID("passwordConfirm"),w=s.getChildByID("signUpButton"),D=s.getChildByID("linkToLogin"),O=s.getChildByID("signUpError"),M=(I,$)=>{I.innerText=$,I.style.display="block"},J=I=>{I.innerText="",I.style.display="none"};d.addEventListener("click",async()=>{if(r.value&&c.value){const I=await Oa(r.value,c.value);I.success?(I.userData&&this.updateUserPreferences(I.userData),i.setVisible(!1),o.setVisible(!1),this.sound.play(C.BUTTON_GENERIC),console.log("UserId after login:",this.userId)):(this.sound.play(C.BUTTON_FAILED),M(u,I.error))}else this.sound.play(C.BUTTON_FAILED),M(u,"Incorrect username or password.")}),w.addEventListener("click",async()=>{if(J(O),T.value!==P.value){this.sound.play(C.BUTTON_FAILED),M(O,"Passwords do not match");return}if(!dt(T.value)){this.sound.play(C.BUTTON_FAILED),M(O,"Password must be at least 8 characters long and contain a letter and a number");return}if(y.value.length>20){this.sound.play(C.BUTTON_FAILED),M(O,"Username must be 20 characters or shorter");return}if(p.value&&y.value&&T.value){const I=await Ha(p.value,y.value,T.value);I.success?(I.userData&&this.updateUserPreferences(I.userData),s.setVisible(!1),o.setVisible(!1),this.sound.play(C.BUTTON_GENERIC),console.log("UserId after sign up:",this.userId)):(this.sound.play(C.BUTTON_FAILED),M(O,I.error))}});const G=(I,$)=>{I.addEventListener("keydown",V=>{V.key==="Enter"&&$.click()})};return[r,c].forEach(I=>G(I,d)),[p,y,T,P].forEach(I=>G(I,w)),h.addEventListener("click",()=>{i.setVisible(!1),s.setVisible(!0)}),D.addEventListener("click",()=>{s.setVisible(!1),i.setVisible(!0)}),e&&(i.setVisible(!1),s.setVisible(!1),o.setVisible(!1)),{loginForm:i,signUpForm:s}}updateUserPreferences(e){this.userId=e.userId,this.registry.set("userPreferences",{chat:e.preferences.chat,sound:e.preferences.sound}),this.sound.mute=!e.preferences.sound}}function Fa(t){const a=t.add.image(460,70,"replayButton").setScale(1.3).setInteractive({useHandCursor:!0}).setVisible(!t.triggerReplay);return a.on("pointerdown",()=>{t.sound.play(C.BUTTON_GENERIC),t.scene.restart({userId:t.userId,colyseusClient:t.colyseusClient,currentGame:t.currentGame,currentRoom:t.currentRoom,triggerReplay:!0})}),a}const it={x:550,y:730};class Ua extends Phaser.GameObjects.Container{constructor(e){super(e,it.x,it.y);n(this,"actionCircle");n(this,"actionPie1");n(this,"actionPie2");n(this,"actionPie3");n(this,"actionPie4");n(this,"actionPie5");n(this,"actionArrow");n(this,"context");this.context=e,this.actionCircle=e.add.image(0,0,"actionCircle").setOrigin(.5).setName("actionCircle"),this.actionPie1=e.add.image(12,-19,"actionPie").setOrigin(.5).setRotation(-.3).setName("actionPie1"),this.actionPie2=e.add.image(24,6,"actionPie").setOrigin(.5).setRotation(.9).setName("actionPie2"),this.actionPie3=e.add.image(4,25,"actionPie").setOrigin(.5).setRotation(2.2).setName("actionPie3"),this.actionPie4=e.add.image(-18,13,"actionPie").setOrigin(.5).setRotation(3.4).setName("actionPie4"),this.actionPie5=e.add.image(-15,-15,"actionPie").setOrigin(.5).setRotation(4.7).setName("actionPie5"),this.actionArrow=e.add.image(-35,0,"actionArrow").setOrigin(.5).setRotation(-.1).setName("actionArrow").setVisible(!1),e.turnNumber===0&&e.activePlayer===e.userId&&(this.actionPie1.setVisible(!1),this.actionPie2.setVisible(!1)),this.add([this.actionCircle,this.actionPie1,this.actionPie2,this.actionPie3,this.actionPie4,this.actionPie5,this.actionArrow]),e.add.existing(this)}resetActionPie(){this.context.turnNumber!==0&&(this.actionPie1.setVisible(!0),this.popAnimation(this.actionPie1,!0),this.actionPie2.setVisible(!0),this.popAnimation(this.actionPie2,!0)),this.actionPie3.setVisible(!0),this.popAnimation(this.actionPie3,!0),this.actionPie4.setVisible(!0),this.popAnimation(this.actionPie4,!0),this.actionPie5.setVisible(!0),this.popAnimation(this.actionPie5,!0),this.actionArrow.setVisible(!1),this.removeInteractive()}popAnimation(e,i=!1){if(!e)return;const s=this.getIndex(e);this.bringToTop(e),this.context.tweens.add({targets:e,scale:1.5,duration:100,yoyo:!0,ease:"Quad.easeInOut",onComplete:()=>{e.visible=i,this.moveTo(e,s)}})}hideActionSlice(e){switch(e){case 1:this.popAnimation(this.actionPie1),this.actionArrow.setVisible(!0);break;case 2:this.popAnimation(this.actionPie2);break;case 3:this.popAnimation(this.actionPie3),this.actionArrow.setVisible(!0);break;case 4:this.popAnimation(this.actionPie4);break;case 5:this.popAnimation(this.actionPie5);break}this.setSize(90,90).setInteractive({useHandCursor:!0}),this.on("pointerdown",()=>{this.context.gameController.resetTurn()})}}class Ga extends Phaser.GameObjects.Container{constructor(e,i){super(e,0,0);n(this,"cardBackgroundImage");n(this,"unitPictureImage");n(this,"cardSeparatorImage");n(this,"cardNameText");n(this,"cardTypeText");n(this,"cardFlavorText");n(this,"context");this.context=e;let s="",o="",r="";switch(i){case A.SPAWN:s="spawnTile",o="Spawn Tile",r="Units can be spawned here.";break;case A.POWER:s="powerTile",o="Power Boost",r="Adds 100 damage to the unit on this tile.";break;case A.PHYSICAL_RESISTANCE:s="shieldTile",o="Defense Boost",r="Grants 20% physical resistance to the unit on this tile.";break;case A.MAGICAL_RESISTANCE:s="helmetTile",o="Resist Boost",r="Grants 20% magical resistance to the unit on this tile.";break;case A.CRYSTAL_DAMAGE:s="crystalDamageTile",o="Assault Boost",r="Adds 300 damage to all hits to crystals by any unit in the board.";break;case A.TELEPORTER:s="teleporterTile",o="Teleporter",r="Units on this tile can teleport to any other unoccupied teleporter.";break;case A.SPEED:s="speedTile",o="Speed Boost",r="Grants 2 extra movement to the unit on this tile.";break;default:s="specialTile",o="Special Tile",r="A unique tile with special properties.";break}this.cardBackgroundImage=e.add.image(10,10,"cardBackground"),this.unitPictureImage=e.add.image(-130,-140,s).setOrigin(.5).setScale(1.2),this.cardSeparatorImage=e.add.image(50,-100,"cardSeparator").setOrigin(.5).setScale(1.3),this.cardNameText=this.context.add.text(55,-170,o,{fontFamily:"proLight",fontSize:50,color:"#ffffff"}).setOrigin(.5),this.cardTypeText=this.context.add.text(55,-130,v.SPECIAL_TILE,{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cardFlavorText=this.context.add.text(0,-55,r,{fontFamily:"proLight",fontSize:30,color:"#ffffff",wordWrap:{width:this.cardBackgroundImage.width-50,useAdvancedWrap:!0}}).setOrigin(.5),this.add([this.cardBackgroundImage,this.unitPictureImage,this.cardSeparatorImage,this.cardNameText,this.cardTypeText,this.cardFlavorText])}}class xa extends Phaser.GameObjects.Container{constructor(e,i){super(e,i.x,i.y);n(this,"baseRectangle");n(this,"row");n(this,"col");n(this,"x");n(this,"y");n(this,"boardPosition");n(this,"obstacle");n(this,"hero");n(this,"crystal");n(this,"tileSize",90);n(this,"tileType");n(this,"isHighlighted");n(this,"unitCard");n(this,"icon");this.row=i.row,this.col=i.col,this.x=i.x,this.y=i.y,this.tileType=i.tileType,this.obstacle=i.obstacle,this.hero=i.hero,this.crystal=i.crystal,this.boardPosition=i.boardPosition,this.baseRectangle=e.add.rectangle(0,0,this.tileSize,this.tileSize),this.add(this.baseRectangle),this.isHighlighted=this.baseRectangle.isFilled,this.tileType!==A.BASIC&&(this.unitCard=new Ga(e,this.tileType).setVisible(!1)),[A.BASIC,A.CRYSTAL,A.CRYSTAL_SMALL,A.CRYSTAL_BIG].includes(this.tileType)||(this.icon=e.add.image(0,0,this.tileType),this.col>4&&this.icon.setFlipX(!0),this.add(this.icon)),this.setSize(90,90).setInteractive({useHandCursor:!0}).setDepth(2),Mt(this,e),this.unitCard&&this.add(this.unitCard),e.add.existing(this)}getTileData(){return{row:this.row,col:this.col,x:this.x,y:this.y,tileType:this.tileType,boardPosition:this.boardPosition,obstacle:this.obstacle,hero:this.hero,crystal:this.crystal}}removeHero(){this.hero=void 0}isFriendly(e){return this.hero&&this.hero.unitId.includes(e)}isEnemy(e){return this.hero&&!this.hero.unitId.includes(e)}setHighlight(){this.baseRectangle.setFillStyle(33023,.3),this.isHighlighted=this.baseRectangle.isFilled}clearHighlight(){this.baseRectangle.setFillStyle(),this.isHighlighted=this.baseRectangle.isFilled}}class Va{constructor(a,e){n(this,"topLeft",{x:545,y:225});n(this,"tileSize",90);n(this,"context");n(this,"tiles");n(this,"units",[]);n(this,"crystals",[]);this.context=a,this.tiles=this.createTileGrid(e),this.crystals.forEach(i=>i.updateDebuffAnimation(i.debuffAmount))}createTileGrid(a){const e=[];return a.forEach(i=>{const s=new xa(this.context,i);s.hero&&this.units.push(We(this.context,s.hero,s)),s.crystal&&this.crystals.push(new De(this.context,s.crystal,i)),e.push(s)}),e}getTileFromCoordinates(a,e){const i=this.tiles.find(s=>s.row===a&&s.col===e);if(!i)throw new Error("Board getTile() No tile found");return i}getTileFromBoardPosition(a){const e=this.tiles.find(i=>i.boardPosition===a);if(!e)throw new Error("Board getTile() No tile found");return e}getBoardState(){return this.tiles.map(a=>a.getTileData())}clearHighlights(){this.tiles.forEach(a=>a.clearHighlight())}highlightSpawns(a){const e=new Set;this.tiles.forEach(i=>{var o,r,c;const s=F(this.context,i);i.tileType===A.SPAWN&&!s&&(i.hero||e.add(i),(o=i.hero)!=null&&o.isKO&&e.add(i),((r=i.hero)==null?void 0:r.unitType)===g.PHANTOM&&e.add(i)),a===g.WRAITH&&((c=i.hero)!=null&&c.isKO)&&!F(this.context,i)&&e.add(i)}),this.highlightTiles([...e])}highlightEnemyTargets(a){const e=this.getHeroTilesInRange(a,Y.ATTACK);if(!e.length)return;const i=[];e.forEach(r=>{const c=r.hero?this.units.find(d=>d.unitId===r.hero.unitId):r.crystal?this.crystals.find(d=>{var h;return d.boardPosition===((h=r.crystal)==null?void 0:h.boardPosition)}):void 0;if(!c){console.error("No target found",r.hero);return}(c instanceof De&&c.belongsTo!==a.belongsTo||c instanceof _&&c.belongsTo!==a.belongsTo&&!c.isKO||(a.unitType===g.NECROMANCER||a.unitType===g.WRAITH)&&c instanceof _&&c.isKO||c instanceof _&&c.isKO&&this.isOrthogonalAdjacent(a,c)&&F(this.context,c.getTile())||a.unitType===g.GRENADIER)&&i.push(c)});const s=[],o=[];i.forEach(r=>{this.hasLineOfSight(a,r)?s.push(r):o.push(r)}),s.forEach(r=>r.attackReticle.setVisible(!0)),o.forEach(r=>r.blockedLOS.setVisible(!0))}highlightFriendlyTargets(a){if(!a.canHeal&&a.unitType!==g.ENGINEER)return;const e=this.getHeroTilesInRange(a,Y.HEAL);e.length&&e.forEach(i=>{if(i.crystal)return;const s=this.units.find(d=>{var h;return d.unitId===((h=i.hero)==null?void 0:h.unitId)});if(!s){console.error("No healing target found",i);return}const o=this.context.userId,r=s.maxHealth,c=s.currentHealth;i.isFriendly(o)&&(c<r||a.unitType===g.ENGINEER)&&s.healReticle.setVisible(!0)})}highlightMovementArea(a){const e=this.getHeroTilesInRange(a,Y.MOVE);this.highlightTiles(e)}highlightTeleportOptions(a){if(a.getTile().tileType===A.TELEPORTER){const i=this.tiles.filter(s=>s.tileType===A.TELEPORTER&&(!s.hero||s.hero.isKO));this.highlightTiles(i)}if(a.unitType!==g.NINJA)return;const e=[];this.units.forEach(i=>{a.belongsTo===i.belongsTo&&!i.isKO&&e.push(i)}),!(e.length<=1)&&e.forEach(i=>{i.allyReticle.setVisible(!0)})}highlightEquipmentTargets(a){const e=[];this.units.forEach(i=>{i.belongsTo===a.belongsTo&&(i instanceof Ve||i.isAlreadyEquipped(a)||a.canHeal&&i.isFullHP()||a.canHeal&&a instanceof ft&&i.isKO||!a.canHeal&&i.isKO||e.push(i.getTile()))}),this.highlightTiles(e)}highlightAllBoard(){this.highlightTiles(this.tiles)}highlightTiles(a){a.forEach(e=>{e.setHighlight()})}removeReticles(){this.units.forEach(a=>{a.attackReticle.setVisible(!1),a.blockedLOS.setVisible(!1),a.healReticle.setVisible(!1),a.allyReticle.setVisible(!1)}),this.crystals.forEach(a=>{a.attackReticle.setVisible(!1),a.blockedLOS.setVisible(!1)})}getHeroTilesInRange(a,e){const i=this.getTileFromBoardPosition(a.boardPosition);let s;switch(e){case Y.MOVE:s=a.speedTile?a.movement+2:a.movement;break;case Y.ATTACK:s=a.attackRange;break;case Y.HEAL:s=a.healingRange;break}if(!i)return console.error("No tile found - getTilesInRange"),[];const o=new Set;return this.tiles.forEach(r=>{Tt(r.row,r.col,i.row,i.col)<=s&&(e===Y.MOVE&&!F(this.context,r)&&(!r.hero||r.hero.isKO)&&!r.crystal&&o.add(r),(e===Y.ATTACK||e===Y.HEAL)&&(r.crystal||r.hero&&r.hero.unitId!==a.unitId)&&o.add(r))}),[...o]}getAreaOfEffectTiles(a){const s=[];for(let o=-1;o<=1;o++)for(let r=-1;r<=1;r++){const c=a.row+o,d=a.col+r,h=c>=0&&c<=4,u=d>=0&&d<=8;if(h&&u){const p=this.getTileFromCoordinates(c,d);s.push(p)}else console.warn("Invalid tile coordinates skipped:",c,d)}return s}getAttackDirection(a,e){const i=e-a;let s;switch(i){case-27:case-18:case-9:s=1;break;case-8:s=2;break;case 1:case 2:case 3:s=3;break;case 10:s=4;break;case 9:case 18:case 27:s=5;break;case 8:s=6;break;case-1:case-2:case-3:s=7;break;case-10:s=8;break;default:s=0;break}return s===0&&console.error(`getAttackDirection() No direction found between: ${a} and ${e}`),s}hasLineOfSight(a,e){if(this.isAdjacent(a,e))return!0;if(a.row===e.row||a.col===e.col){const d=this.getAttackDirection(a.boardPosition,e.boardPosition),u={1:[-9,-18],3:[1,2],5:[9,18],7:[-1,-2]}[d];if(!u)return!0;for(const p of u){const y=a.boardPosition+p;if(y===e.boardPosition)return!0;const T=this.getTileFromBoardPosition(y);if(T.crystal&&!me(this.context,T.crystal)||T.hero&&!me(this.context,T.hero)&&!T.hero.isKO)return!1}}const i={"1, 2":[[0,1],[1,1]],"1, -2":[[0,-1],[1,-1]],"-1, 2":[[0,1],[-1,1]],"-1, -2":[[0,-1],[-1,-1]],"2, 1":[[1,0],[1,1]],"2, -1":[[1,0],[1,-1]],"-2, 1":[[-1,0],[-1,1]],"-2, -1":[[-1,0],[-1,-1]]},s={row:e.row-a.row,col:e.col-a.col},o=`${s.row}, ${s.col}`,r=i[o];let c;if(r&&r.length)for(const d of r){const h=a.row+d[0],u=a.col+d[1],p=h<0||h>4,y=u<0||u>8;if(p||y)continue;const T=this.getTileFromCoordinates(h,u);if(T.boardPosition===e.boardPosition)return!0;if(T.crystal&&!me(this.context,T.crystal)||T.hero&&!me(this.context,T.hero)&&!T.hero.isKO){c=!1;break}}return c!==!1}isAdjacent(a,e){const i=Math.abs(a.row-e.row),s=Math.abs(a.col-e.col);return s<=1&&i<=1&&!(i===0&&s===0)}isOrthogonalAdjacent(a,e){const i=Math.abs(a.row-e.row),s=Math.abs(a.col-e.col);return i===1&&s===0||i===0&&s===1}}const st={x:800,y:400};class Ka extends Phaser.GameObjects.Container{constructor(e){super(e,st.x,st.y);n(this,"blockingLayer");n(this,"backgroundImage");n(this,"okButtonImage");n(this,"cancelButtonImage");n(this,"popupText");n(this,"okButtonText");n(this,"cancelButtonText");this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=e.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.okButtonImage=e.add.image(-90,60,"popupButton").setTint(10027008).setDisplaySize(120,60).setInteractive({useHandCursor:!0}),this.cancelButtonImage=e.add.image(90,60,"popupButton").setTint(31743).setDisplaySize(120,60).setInteractive({useHandCursor:!0}),this.popupText=e.add.text(0,-50,"You are about to concede this game. Are you sure?",{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.okButtonText=e.add.text(-90,60,"CONCEDE",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cancelButtonText=e.add.text(90,60,"CANCEL",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.okButtonImage.on("pointerdown",async()=>{var c,d;f(this.scene,C.RESIGN),this.setVisible(!1);const i=e.gameController,s=(c=e.currentGame.players.find(h=>h.userData._id.toString()!==e.userId))==null?void 0:c.userData._id;if(!s){console.error("concedePopup() no winnder found");return}const o={winCondition:He.CONCEDED,winner:s},r={...i.lastTurnState,action:{action:b.CONCEDE,actionClass:Te.USER}};i.currentTurn=[r],e.activePlayer=e.opponentId,e.turnNumber++,Ct(e.currentRoom,i.currentTurn,e.opponentId,e.turnNumber,o),i.gameOver&&console.log("GAME ENDS! THE WINNER IS",(d=i.gameOver)==null?void 0:d.winner)}),this.cancelButtonImage.on("pointerdown",()=>{f(this.scene,C.BUTTON_FAILED),this.setVisible(!1)}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.okButtonImage,this.okButtonText,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}}class Wa{constructor(a){n(this,"context");n(this,"deck");this.context=a,this.deck=[...xe(a).factionData.unitsInDeck]}getDeckSize(){return this.deck.length}getDeck(){return this.deck}removeFromDeck(a){return this.deck.splice(0,a)}addToDeck(a){return this.deck.push(a),this.deck}}class Ya extends Phaser.GameObjects.Container{constructor(e){super(e,450,715);n(this,"doorClosed");n(this,"doorOpen");n(this,"doorBanner");n(this,"bannerText");n(this,"context");this.context=e,this.doorClosed=e.add.image(50,-15,"doorClosed").setScale(.9),this.doorOpen=e.add.image(55,-15,"doorOpen").setVisible(!1),this.doorBanner=e.add.image(0,45,"doorBanner");const i=xe(e).factionData.unitsInDeck.length??99;this.bannerText=this.context.add.text(0,47,i.toString(),{fontFamily:"proLight",fontSize:30,color:"#000000"}).setOrigin(.5),this.add([this.doorClosed,this.doorOpen,this.doorBanner,this.bannerText]),this.setSize(70,100).setInteractive({useHandCursor:!0}),this.on("pointerdown",s=>{var o;if(s.button===0&&e.activeUnit&&yt(e.activeUnit.boardPosition)){f(this.scene,m.SHUFFLE);const r=e.activeUnit.boardPosition;e.activeUnit.shuffleInDeck(),(o=e.gameController)==null||o.afterAction(b.SHUFFLE,r,51),this.updateBannerText()}s.button===2&&console.log("Add list of items in Deck here")}),this.on("pointerover",s=>{s.rightButtonDown()}),this.on("pointerout",()=>{}),e.add.existing(this)}updateBannerText(){var i;const e=((i=this.context.gameController)==null?void 0:i.deck.getDeckSize())??0;this.bannerText.setText(e.toString())}openDoor(){this.doorOpen.setVisible(!0),this.doorClosed.setVisible(!1),this.scene.time.delayedCall(1e3,()=>{this.doorOpen.setVisible(!1),this.doorClosed.setVisible(!0)})}}class za extends ht.GameObjects.Container{constructor(e){super(e,0,0);n(this,"gameOverImage");n(this,"gameOverEffect");n(this,"context");this.context=e,e.add.existing(this).setDepth(999)}async init(){var s;await this.loadImages();let e,i;((s=this.context.currentGame.gameOver)==null?void 0:s.winner)===this.context.userId?(e="gameOverVictoryEffect",i="gameOverVictoryText"):(e="gameOverDefeatEffect",i="gameOverDefeatText"),this.gameOverEffect=this.context.add.image(880,400,e).setOrigin(.5).setName("gameOverEffect").setScale(1.5),this.gameOverImage=this.context.add.image(900,400,i).setOrigin(.5).setName("gameOverImage"),this.context.tweens.add({targets:this.gameOverEffect,angle:360,duration:1e4,repeat:-1,ease:"Linear"}),this.add([this.gameOverEffect,this.gameOverImage])}loadImages(){return new Promise(e=>{var i;((i=this.context.currentGame.gameOver)==null?void 0:i.winner)===this.context.userId?(this.context.load.image("gameOverVictoryText",`${l}/images/gameItems/gameOverVictoryText.webp`),this.context.load.image("gameOverVictoryEffect",`${l}/images/gameItems/gameOverVictoryEffect.webp`)):(this.context.load.image("gameOverDefeatText",`${l}/images/gameItems/gameOverDefeatText.webp`),this.context.load.image("gameOverDefeatEffect",`${l}/images/gameItems/gameOverDefeatEffect.webp`)),this.context.load.once("complete",()=>e()),this.context.load.start()})}}const ot={x:800,y:400};class ja extends Phaser.GameObjects.Container{constructor(e){super(e,ot.x,ot.y);n(this,"blockingLayer");n(this,"backgroundRectangle");n(this,"cardImages",[]);n(this,"context");this.context=e,this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.blockingLayer.on("pointerdown",()=>{f(this.scene,C.BUTTON_GENERIC),this.setVisible(!1)}),this.backgroundRectangle=e.add.rectangle(50,0,700,700,2236962,.5).setStrokeStyle(2,16777215),this.add([this.blockingLayer,this.backgroundRectangle]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}showDeckContents(e){this.cardImages.forEach(w=>w.destroy()),this.cardImages=[];const i={[j.HERO]:0,[j.ITEM]:1},s=[...e].sort((w,D)=>{const O=i[w.class]-i[D.class];return O!==0?O:w.unitId.localeCompare(D.unitId)}),o=-150,r=-250,c=100,d=100,h=5,u=s.length,p=Math.ceil(u/h),y=100,T=p*d,P=T+y;this.backgroundRectangle.setSize(this.backgroundRectangle.width,P),this.backgroundRectangle.setOrigin(.5),s.forEach((w,D)=>{const O=Math.floor(D/h),M=D%h,J=o+M*c,G=r+O*d;let I;w.class===j.HERO?I=`${w.unitType}CardPic`:I=`${w.itemType}CardPic`;const $=this.context.add.image(J,G,I).setDisplaySize(90,90).setOrigin(.5);this.add($),this.cardImages.push($)}),this.backgroundRectangle.y=r+T/2-d/2,this.setVisible(!0)}}class nt extends Phaser.GameObjects.Container{constructor(e,i,s){super(e,0,0);n(this,"context");n(this,"board");n(this,"background");n(this,"healthBar");n(this,"maxHealth",9e3);n(this,"currentHealth",0);n(this,"player");n(this,"fullWidth");this.context=e,this.board=i,this.player=s;const o={1:{x:640,y:65},2:{x:930,y:65}};this.background=e.add.image(o[s].x,o[s].y,"HpBackground").setScale(3).setOrigin(0),this.healthBar=e.add.image(o[s].x,o[s].y,"HpAlly").setScale(3).setOrigin(0),this.fullWidth=this.healthBar.displayWidth,this.setHealth(),this.add([this.background,this.healthBar])}setHealth(){this.currentHealth=0,this.board.crystals.forEach(i=>{i.belongsTo===this.player&&(this.currentHealth+=i.currentHealth)});const e=this.currentHealth/this.maxHealth;this.healthBar.displayWidth=this.fullWidth*e,this.player===1&&(this.healthBar.x=this.background.x+(this.fullWidth-this.healthBar.displayWidth))}}class Xa extends Phaser.GameObjects.Container{constructor(e,i,s){super(e,0,0);n(this,"playerOneHpBar");n(this,"playerTwoHpBar");n(this,"playerOneBanner");n(this,"playerTwoBanner");n(this,"playerOnePortrait");n(this,"playerTwoPortrait");n(this,"playerOneName");n(this,"playerTwoName");n(this,"deckPopup");n(this,"vsBanner");this.playerOneBanner=e.add.image(0,0,"playerBanner").setOrigin(.5).setPosition(705,80).setFlipX(!0).setTint(3381759),this.playerTwoBanner=e.add.image(0,0,"playerBanner").setOrigin(.5).setPosition(1095,80).setTint(10027008),this.playerOnePortrait=e.add.image(0,0,s[0].picture).setOrigin(.5).setPosition(600,73).setDisplaySize(256*.3,256*.3).setDepth(1).setInteractive({useHandCursor:!0}),this.playerTwoPortrait=e.add.image(0,0,s[1].picture).setOrigin(.5).setPosition(1200,73).setDisplaySize(256*.3,256*.3).setFlipX(!0).setDepth(1).setInteractive({useHandCursor:!0}),this.deckPopup=new ja(e);const o=r=>{if(r._id===e.userId)this.deckPopup.showDeckContents(e.gameController.deck.getDeck());else{const{opponent:c}=Fe(e),d=[...e[c].factionData.unitsInDeck,...e[c].factionData.unitsInHand];this.deckPopup.showDeckContents(d)}};this.playerOnePortrait.on("pointerdown",()=>{o(s[0])}),this.playerTwoPortrait.on("pointerdown",()=>{o(s[1])}),this.playerOneHpBar=new nt(e,i,1),this.playerTwoHpBar=new nt(e,i,2),this.playerOneName=e.add.text(645,35,be(s[0].username,14),{fontFamily:"proLight",color:"#ffffff",fontSize:40}),this.playerTwoName=e.add.text(950,35,be(s[1].username,14),{fontFamily:"proLight",color:"#ffffff",fontSize:40}),this.vsBanner=e.add.image(0,0,"vsBanner").setOrigin(.5).setPosition(900,75),this.add([this.playerOneBanner,this.playerTwoBanner,this.playerOneHpBar,this.playerTwoHpBar,this.playerOneName,this.playerTwoName,this.playerOnePortrait,this.playerTwoPortrait,this.vsBanner]),e.add.existing(this)}}class qa{constructor(a,e,i){n(this,"itemRack");n(this,"banner");const s=a.add.image(0,0,"gameBoard").setOrigin(0).setInteractive();s.x=1434-s.width-14,s.y+=14,this.itemRack=a.add.image(0,0,"itemRack").setOrigin(.5).setPosition(900,736).setScale(.9),this.banner=new Xa(a,e,i)}}class Ja{constructor(a){n(this,"context");n(this,"handData");n(this,"hand");var e;this.context=a,this.handData=xe(a).factionData.unitsInHand??[],this.hand=((e=this.handData)==null?void 0:e.map(i=>this.renderUnit(i)))??[]}getHandSize(){return this.hand.length}getHand(){return this.hand}renderUnit(a){if(R(a))return We(this.context,a);if(ae(a))return bt(this.context,a);throw new Error("Unit passed to renderUnit is not a recognized type")}addToHand(a){const e=[45,46,47,48,49,50];let i=-1;e.forEach(s=>{const o=this.hand.findIndex(r=>r.boardPosition===s);if(o!==-1)i=o;else{const r=a.shift();if(r){r.boardPosition=s;const c=this.renderUnit(r);this.hand.splice(++i,0,c)}}})}removeFromHand(a){const e=this.hand.findIndex(i=>i.unitId===a.unitId);e!==-1&&this.hand.splice(e,1)}exportHandData(){return this.hand.length===0?[]:this.hand.map(a=>a.exportData())}}class Za extends Phaser.GameObjects.Container{constructor(e){super(e,1300,725);n(this,"buttonImage");n(this,"buttonText");n(this,"context");this.context=e,this.buttonImage=e.add.image(0,0,"popupBackground").setOrigin(.5).setScale(1.1).setInteractive({useHandCursor:!0}),this.buttonText=e.add.text(0,-5,"Again!",{fontFamily:"proHeavy",fontSize:55,color:"#ffffff"}).setOrigin(.5),this.buttonImage.on("pointerdown",async()=>{var i;new ze({context:e,opponentId:e.opponentId,challengeType:he.SEND,username:(i=e.gameController.playerData.find(s=>s._id===e.opponentId))==null?void 0:i.username})}),this.add([this.buttonImage,this.buttonText]),e.add.existing(this)}}class Qa{constructor(a){n(this,"context");n(this,"buttonImage");this.context=a,this.buttonImage=a.add.image(1300,725,"turnButton").setOrigin(.5).setScale(1.1).setInteractive({useHandCursor:!0}),this.buttonImage.on("pointerdown",async()=>{if(a.currentGame&&a.activePlayer===a.userId){if(a.sound.play(C.BUTTON_PLAY),console.log("Clicked on send turn"),a.gameController.hasActionsLeft()){a.gameController.turnPopup.setVisible(!0);return}await this.handleSendingTurn()}})}async handleSendingTurn(){const a=this.context.gameController;this.context.currentTurnAction===1&&a.addActionToState(b.PASS),await a.removeKOUnits(),await a.endOfTurnActions()}}const rt={x:800,y:400};class ei extends Phaser.GameObjects.Container{constructor(e){super(e,rt.x,rt.y);n(this,"blockingLayer");n(this,"backgroundImage");n(this,"okButtonImage");n(this,"cancelButtonImage");n(this,"popupText");n(this,"okButtonText");n(this,"cancelButtonText");this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=e.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.okButtonImage=e.add.image(-90,60,"popupButton").setTint(31743).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.cancelButtonImage=e.add.image(90,60,"popupButton").setTint(10027008).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.popupText=e.add.text(0,-50,"You still have actions left. Send turn?",{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.okButtonText=e.add.text(-90,60,"SEND",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cancelButtonText=e.add.text(90,60,"BACK",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.okButtonImage.on("pointerdown",()=>{this.scene.sound.play(C.BUTTON_GENERIC),this.setVisible(!1),e.gameController.turnButton.handleSendingTurn()}),this.cancelButtonImage.on("pointerdown",()=>{this.scene.sound.play(C.BUTTON_FAILED),this.setVisible(!1)}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.okButtonImage,this.okButtonText,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}}class ti{constructor(a){n(this,"context");n(this,"game");n(this,"gameUI");n(this,"board");n(this,"hand");n(this,"deck");n(this,"actionPie");n(this,"door");n(this,"turnButton");n(this,"turnPopup");n(this,"rematchButton");n(this,"lastTurnState");n(this,"currentTurn");n(this,"blockingLayer");n(this,"replayButton");n(this,"playerData");n(this,"gameOver");n(this,"gameOverScreen");n(this,"concedeButton");n(this,"concedePopup");a.triggerReplay&&a.chatComponent&&(a.chatComponent.pointerEvents="none"),a.currentGame.status===N.FINISHED&&!a.triggerReplay&&new za(a).init(),this.context=a,this.game=a.currentGame,this.lastTurnState=a.currentGame.previousTurn[a.triggerReplay?0:a.currentGame.previousTurn.length-1],this.board=new Va(a,this.lastTurnState.boardState),this.playerData=a.currentGame.players.map(e=>e.userData),this.gameUI=new qa(a,this.board,this.playerData),a.player1=this.lastTurnState.player1,a.player2=this.lastTurnState.player2,this.deck=new Wa(a),this.hand=new Ja(a),this.actionPie=new Ua(a),this.turnButton=new Qa(a),this.turnPopup=new ei(a),this.rematchButton=new Za(a).setVisible(!1),this.concedeButton=this.addConcedeButton(a),this.concedePopup=new Ka(a),a.triggerReplay?(this.rematchButton.setVisible(!1),this.turnButton.buttonImage.setVisible(!1)):this.game.status===N.FINISHED&&(this.rematchButton.setVisible(!0),this.turnButton.buttonImage.setVisible(!1),this.gameOverEffects()),a.activePlayer!==a.userId&&this.turnButton.buttonImage.setVisible(!1),this.door=new Ya(a),this.blockingLayer=a.add.rectangle(910,0,1040,1650,0,.3).setOrigin(.5).setInteractive().setDepth(999).setVisible(this.context.triggerReplay),this.blockingLayer.on("pointerdown",()=>{a.scene.restart({userId:a.userId,colyseusClient:a.colyseusClient,currentGame:a.currentGame,currentRoom:a.currentRoom,triggerReplay:!1})}),this.replayButton=Fa(a),this.currentTurn=[],a.input.on("gameobjectdown",()=>Ne(a))}addConcedeButton(a){const e=a.add.image(1350,70,"concedeButton").setScale(.9).setInteractive({useHandCursor:!0});return e.on("pointerdown",()=>{f(this.context,C.BUTTON_GENERIC),this.concedePopup.setVisible(!0)}),e}async replayTurn(){var e;const a=[];if(this.context.activePlayer===this.context.userId){const i=this.context.isPlayerOne?this.lastTurnState.player2:this.lastTurnState.player1;i==null||i.factionData.unitsInHand.forEach(s=>{R(s)&&a.push(We(this.context,s).setVisible(!1).setInteractive(!1)),ae(s)&&a.push(bt(this.context,s).setVisible(!1).setInteractive(!1))})}for(let i=1;i<this.context.currentGame.previousTurn.length;i++){const s=this.context.currentGame.previousTurn[i],o=[b.DRAW,b.PASS],r=(e=s.action)==null?void 0:e.action;!r||o.includes(r)||await new Promise(c=>{this.context.time.delayedCall(1e3,async()=>{(r===b.SPAWN||r===b.MOVE)&&this.replaySpawnOrMove(s.action,a),(r===b.ATTACK||r===b.HEAL||r===b.SPECIAL)&&await this.replayAttackHealSpecial(s.action),r===b.SHUFFLE&&await this.replayShuffle(),r===b.USE&&await this.replayUse(s.action,a),r===b.REMOVE_UNITS&&await this.removeKOUnits(),c()})})}this.context.scene.restart({userId:this.context.userId,colyseusClient:this.context.colyseusClient,currentGame:this.context.currentGame,currentRoom:this.context.currentRoom,triggerReplay:!1,gameOver:void 0})}replaySpawnOrMove(a,e){const i=a.action,s=e.length?e:this.hand.hand,o=i===b.SPAWN?s.find(c=>c.boardPosition===a.actorPosition):this.board.units.find(c=>c.boardPosition===a.actorPosition),r=this.board.getTileFromBoardPosition(a.targetPosition);if(!o||!r)throw new Error("Missing hero or tile in spawn or move action");i===b.MOVE&&o.move(r),i===b.SPAWN&&o.setVisible(!0).spawn(r)}async replayAttackHealSpecial(a){const e=this.board.units.find(s=>s.boardPosition===a.actorPosition),i=this.board.crystals.find(s=>s.boardPosition===a.targetPosition)??this.board.units.find(s=>s.boardPosition===a.targetPosition);if(!e||!i)throw new Error("Missing hero or target in attack or heal action");a.action===b.HEAL&&await e.heal(i),a.action===b.SPECIAL&&await e.special(i)}async replayUse(a,e){const s=(e.length?e:this.hand.hand).find(o=>o.boardPosition===a.actorPosition);if(!s)throw new Error("Missing item in use action");if(s.dealsDamage){const o=this.board.getTileFromBoardPosition(a.targetPosition);if(!s)throw new Error("Missing tile in use action");await s.use(o)}if(!s.dealsDamage){const o=this.board.units.find(r=>r.boardPosition===a.targetPosition);if(!o)throw new Error("Missing target in use action");await s.use(o)}}async replayShuffle(){const a=this.context.add.text(600,350,"OPPONENT SWAPPED AN ITEM!",{fontFamily:"proLight",fontSize:50,color:"#fffb00"}).setDepth(999);f(this.context,m.SHUFFLE),await ba(a,1.3)}async resetTurn(){ye(this.context),this.context.longPressStart=void 0,this.context.visibleUnitCard=void 0,f(this.context,m.RESET_TURN),this.context.scene.restart()}getDeck(){return this.deck.getDeck()}drawUnits(){f(this.context,m.DRAW);const a=6-this.hand.getHandSize();if(this.deck.getDeckSize()===0||a===0)return;this.door.openDoor();const e=this.deck.removeFromDeck(a);this.hand.addToHand(e);const{player:i,opponent:s}=Fe(this.context),o={...this.context[i],factionData:{...this.context[i].factionData,unitsInHand:this.hand.exportHandData(),unitsInDeck:this.deck.getDeck()}},r=this.context[s];this.currentTurn.push({player1:this.context.isPlayerOne?o:r,player2:this.context.isPlayerOne?r:o,action:{actionClass:Te.AUTO,action:b.DRAW},boardState:this.board.getBoardState()})}async removeKOUnits(){const a=[];if(this.board.units.forEach(e=>{e.isKO&&(e.lastBreath&&a.push(e),e.lastBreath||(e.lastBreath=!0,e.updateTileData()))}),a.length){f(this.context,m.VANISH);const e=i=>new Promise(s=>{this.context.tweens.add({targets:i,alpha:0,duration:500,ease:"Linear",onComplete:()=>{i.removeFromGame(!0),s()}})});await Promise.all(a.map(i=>e.call(this.context,i)))}this.addActionToState(b.REMOVE_UNITS)}hasActionsLeft(){return this.context.turnNumber===0&&this.context.currentTurnAction<4||this.context.currentTurnAction<6}async endOfTurnActions(){this.context.activeUnit&&ye(this.context),this.actionPie.resetActionPie(),this.drawUnits(),this.door.updateBannerText(),this.currentTurn.unshift(this.lastTurnState),this.context.activePlayer=this.context.opponentId,this.context.turnNumber++,Ct(this.context.currentRoom,this.currentTurn,this.context.opponentId,this.context.turnNumber,this.gameOver),this.gameOver&&this.gameOverEffects()}async gameOverEffects(){var a;((a=this.gameOver)==null?void 0:a.winner)===this.context.activePlayer?f(this.context,C.WIN_SFX):f(this.context,C.LOSE_SFX)}onHeroClicked(a){console.log(`A hero in position ${a.boardPosition} has been clicked`),a.boardPosition>44&&this.board.highlightSpawns(a.unitType),a.boardPosition<45&&(this.board.highlightEnemyTargets(a),this.board.highlightFriendlyTargets(a),this.board.highlightMovementArea(a),(a.unitType===g.NINJA||a.getTile().tileType===A.TELEPORTER)&&this.board.highlightTeleportOptions(a))}onItemClicked(a){console.log(`An item ${a.unitId} has been clicked`),a.dealsDamage?this.board.highlightAllBoard():this.board.highlightEquipmentTargets(a)}onTileClicked(a){console.log(`A tile ${a.tileType} has been clicked`)}afterAction(a,e,i){this.context.triggerReplay||(this.addActionToState(a,e,i),this.actionPie.hideActionSlice(this.context.currentTurnAction++),this.context.activeUnit&&ye(this.context))}addActionToState(a,e,i){const{player:s,opponent:o}=Fe(this.context),r=fa(a),c={...this.context[s],factionData:{...this.context[s].factionData,unitsInHand:this.hand.exportHandData(),unitsInDeck:this.deck.getDeck()}},d=this.context[o];this.currentTurn.push({player1:this.context.isPlayerOne?c:d,player2:this.context.isPlayerOne?d:c,action:{actorPosition:e,targetPosition:i??e,action:a,actionClass:r},boardState:this.board.getBoardState()})}async pushEnemy(a,e){const i=this.board.getTileFromBoardPosition(a.boardPosition),s=this.board.getTileFromBoardPosition(e.boardPosition);if(!i||!s){console.error("pushEnemy() no attacker or target board position");return}console.log("this logs");const o=Ze(i.row,i.col,s.row,s.col,!0),r=o.row<0||o.row>4,c=o.col<0||o.col>8;if(r||c){console.error("pushEnemy() Cant push enemy out of the map");return}const d=this.board.getTileFromCoordinates(o.row,o.col);if(!d){console.error("pushEnemy() No destination tile found");return}if(d.crystal||d.hero){console.error("pushEnemy() Destination tile is occupied");return}if(d.tileType==A.SPAWN&&tt(d,a)&&!e.isKO){console.error("pushEnemy() Can't push a non-KO'd enemy onto a friendly spawn");return}e.isKO||e.specialTileCheck(d,s),await Je(this.context,e,d),e.updatePosition(d),d.hero=e.exportData(),s.removeHero()}async pullEnemy(a,e){const i=this.board.getTileFromBoardPosition(a.boardPosition),s=this.board.getTileFromBoardPosition(e.boardPosition);if(!i||!s){console.error("pullEnemy() no attacker or target board position");return}const o=Ze(i.row,i.col,s.row,s.col,!1),r=this.board.getTileFromCoordinates(o.row,o.col);if(!r){console.error("pullEnemy() No destination tile found");return}if(r.crystal||r.hero){console.error("pullEnemy() Destination tile is occupied");return}if(r.tileType==A.SPAWN&&tt(r,a)&&!e.isKO){console.error("pushEnemy() Can't pull a non-KO'd enemy onto a friendly spawn");return}e.isKO||e.specialTileCheck(r,s),await Je(this.context,e,r),e.updatePosition(r),r.hero=e.exportData(),s.removeHero()}}function ai(){const t={x:545,y:225},a=[];let e=0;for(let i=0;i<5;i++)for(let s=0;s<9;s++){const o=t.x+s*90,r=t.y+i*90;a.push({x:o,y:r,row:i,col:s,boardPosition:e}),e++}return a}function ii(){const t=ai(),a={x:700,y:745};for(let e=0;e<6;e++)t.push({x:a.x,y:a.y}),a.x+=80;return t.push({x:435,y:720}),t}function si(t){t.load.image("gameBoard",`${l}/images/maps/game_board.webp`),t.load.image("itemRack",`${l}/images/gameItems/item_rack.webp`),t.load.image("doorClosed",`${l}/images/gameItems/door_closed.webp`),t.load.image("doorOpen",`${l}/images/gameItems/door_open.webp`),t.load.image("doorBanner",`${l}/images/gameItems/door_banner.webp`),t.load.image("actionArrow",`${l}/images/gameItems/action_arrow.webp`),t.load.image("actionPie",`${l}/images/gameItems/action_pie.webp`),t.load.image("actionCircle",`${l}/images/gameItems/action_circle.webp`),t.load.image("turnButton",`${l}/ui/turn_button.webp`),t.load.image("playerBanner",`${l}/images/gameItems/player_banner.webp`),t.load.image("vsBanner",`${l}/images/gameItems/vs_banner.webp`),t.load.image("replayButton",`${l}/ui/replay.webp`)}function oi(t){t.load.image("spawnTile",`${l}/images/gameItems/DeployZone01-hd.webp`),t.load.image("helmetTile",`${l}/images/gameItems/PremiumTile_Resist-hd.webp`),t.load.image("powerTile",`${l}/images/gameItems/PremiumTile_Sword-hd.webp`),t.load.image("shieldTile",`${l}/images/gameItems/PremiumTile_Shield-hd.webp`),t.load.image("speedTile",`${l}/images/gameItems/PremiumTile_Speed-hd.webp`),t.load.image("crystalDamageTile",`${l}/images/gameItems/PremiumTile_VictoryDamageMultiplier-hd.webp`),t.load.image("teleporterTile",`${l}/images/gameItems/PremiumTile_Teleport-hd.webp`),t.load.image("crystalDamageAnim_1",`${l}/images/gameItems/animations/CrystalPremiumTile_BottomSplash01-hd.webp`),t.load.image("crystalDamageAnim_2",`${l}/images/gameItems/animations/CrystalPremiumTile_BottomSplash02-hd.webp`),t.load.image("crystalDamageAnim_3",`${l}/images/gameItems/animations/CrystalPremiumTile_BottomSplash03-hd.webp`),t.load.image("magicalResistanceAnim_1",`${l}/images/gameItems/animations/ResistPremiumTile_BottomSplash01-hd.webp`),t.load.image("magicalResistanceAnim_2",`${l}/images/gameItems/animations/ResistPremiumTile_BottomSplash02-hd.webp`),t.load.image("magicalResistanceAnim_3",`${l}/images/gameItems/animations/ResistPremiumTile_BottomSplash03-hd.webp`),t.load.image("physicalResistanceAnim_1",`${l}/images/gameItems/animations/ShieldPremiumTile_BottomSplash01-hd.webp`),t.load.image("physicalResistanceAnim_2",`${l}/images/gameItems/animations/ShieldPremiumTile_BottomSplash02-hd.webp`),t.load.image("physicalResistanceAnim_3",`${l}/images/gameItems/animations/ShieldPremiumTile_BottomSplash03-hd.webp`),t.load.image("powerTileAnim_1",`${l}/images/gameItems/animations/SwordPremiumTile_BottomSplash01-hd.webp`),t.load.image("powerTileAnim_2",`${l}/images/gameItems/animations/SwordPremiumTile_BottomSplash02-hd.webp`),t.load.image("powerTileAnim_3",`${l}/images/gameItems/animations/SwordPremiumTile_BottomSplash03-hd.webp`),t.load.image("superChargeAnim_1",`${l}/images/gameItems/animations/Scroll_Backspash01-hd.webp`),t.load.image("superChargeAnim_2",`${l}/images/gameItems/animations/Scroll_Backspash02-hd.webp`),t.load.image("superChargeAnim_3",`${l}/images/gameItems/animations/Scroll_Backspash03-hd.webp`),t.load.image("soulHarvestAnim_1",`${l}/images/gameItems/animations/SoulHarvest_Explosion01-hd.webp`),t.load.image("soulHarvestAnim_2",`${l}/images/gameItems/animations/SoulHarvest_Explosion02-hd.webp`),t.load.image("soulHarvestAnim_3",`${l}/images/gameItems/animations/SoulHarvest_Explosion03-hd.webp`),t.load.image("infernoAnim_1",`${l}/images/gameItems/animations/Inferno_Fireball01-hd.webp`),t.load.image("infernoAnim_2",`${l}/images/gameItems/animations/Inferno_Fireball02-hd.webp`),t.load.image("infernoAnim_3",`${l}/images/gameItems/animations/Inferno_Fireball03-hd.webp`),t.load.image("infernoAnim_4",`${l}/images/gameItems/animations/Inferno_Fireball04-hd.webp`),t.load.image("infernoAnim_5",`${l}/images/gameItems/animations/Inferno_Fireball05-hd.webp`),t.load.image("infernoAnim_6",`${l}/images/gameItems/animations/Inferno_Fireball06-hd.webp`),t.load.image("infernoShockWave",`${l}/images/factions/council/Inferno_Shockwave01-hd.webp`),t.load.image("soulHarvestShockWave",`${l}/images/factions/darkElves/SoulHarvest_Shockwave01-hd.webp`),t.load.image("smokeAnim_1",`${l}/images/gameItems/animations/NinjaSmoke_Puff01-hd.webp`),t.load.image("smokeAnim_2",`${l}/images/gameItems/animations/NinjaSmoke_Puff02-hd.webp`),t.load.image("smokeAnim_3",`${l}/images/gameItems/animations/NinjaSmoke_Puff03-hd.webp`),t.load.image("reviveAnim_1",`${l}/images/gameItems/animations/Revive_Backsplash01-hd.webp`),t.load.image("reviveAnim_2",`${l}/images/gameItems/animations/Revive_Backsplash02-hd.webp`),t.load.image("reviveAnim_3",`${l}/images/gameItems/animations/Revive_Backsplash03-hd.webp`),t.load.image("phantomSpawnAnim_1",`${l}/images/gameItems/animations/PhantomSpawn_Explosion01-hd.webp`),t.load.image("phantomSpawnAnim_2",`${l}/images/gameItems/animations/PhantomSpawn_Explosion02-hd.webp`),t.load.image("priestessDebuff",`${l}/images/gameItems/animations/MoveDebuff_PurpleGlow-hd.webp`),t.load.image("annihilatorDebuff",`${l}/images/factions/dwarves/ArmorDebuff2_ShieldBroken1-hd.png`),t.load.image("shield",`${l}/images/factions/dwarves/EngineerShield_Color-hd.png`),t.load.image("crystalFull",`${l}/images/gameItems/crystal_full.webp`),t.load.image("pedestal",`${l}/images/gameItems/crystal_pedestal.webp`),t.load.image("crystalDamaged",`${l}/images/gameItems/crystal_damaged.webp`),t.load.image("crystalDebuff_1",`${l}/images/gameItems/animations/CrystalDebuff1_BgFlames01-hd.webp`),t.load.image("crystalDebuff_2",`${l}/images/gameItems/animations/CrystalDebuff1_BgFlames02-hd.webp`),t.load.image("crystalDebuff_3",`${l}/images/gameItems/animations/CrystalDebuff2_BgFlames01-hd.webp`),t.load.image("crystalDebuff_4",`${l}/images/gameItems/animations/CrystalDebuff2_BgFlames02-hd.webp`),t.load.image("crystalCardPic",`${l}/images/profilePics/crystalIcon.webp`);const a=["archer","cleric","knight","ninja","wizard"],e=["priestess","impaler","necromancer","phantom","voidmonk","wraith"],i=["paladin","engineer","gunner","grenadier","annihilator"];a.forEach(s=>{for(let o=1;o<=9;o++)t.load.image(`${s}_${o}`,`${l}/images/factions/council/${s}/${s}_${o}.webp`);t.load.image(`${s}CardPic`,`${l}/images/profilePics/${s}_v1-hd.webp`)}),e.forEach(s=>{if(s!==g.PHANTOM)for(let o=1;o<=9;o++)t.load.image(`${s}_${o}`,`${l}/images/factions/darkElves/${s}/${s}_${o}.webp`);else t.load.image(`${s}_1`,`${l}/images/factions/darkElves/${s}/${s}_1.webp`);t.load.image(`${s}CardPic`,`${l}/images/profilePics/${s}_v1-hd.webp`)}),i.forEach(s=>{for(let o=1;o<=9;o++)t.load.image(`${s}_${o}`,`${l}/images/factions/dwarves/${s}/${s}_${o}.webp`);t.load.image(`${s}CardPic`,`${l}/images/profilePics/${s}_v1-hd.webp`)}),Object.entries(S).forEach(([s,o])=>{t.load.image(`${o}CardPic`,`${l}/images/profilePics/${o}Icon.webp`)}),t.load.image("dragonScale",`${l}/images/factions/council/dragon_scale.webp`),t.load.image("inferno",`${l}/images/factions/council/inferno.webp`),t.load.image("healingPotion",`${l}/images/factions/council/healing_potion.webp`),t.load.image("soulStone",`${l}/images/factions/darkElves/soul_stone.webp`),t.load.image("soulHarvest",`${l}/images/factions/darkElves/soul_harvest.webp`),t.load.image("manaVial",`${l}/images/factions/darkElves/mana_vial.webp`),t.load.image("dwarvernBrew",`${l}/images/factions/dwarves/Ale-hd.png`),t.load.image("pulverizer",`${l}/images/factions/dwarves/ShatterDrill_Icon-hd.png`),t.load.image("superCharge",`${l}/images/factions/common/super_charge.webp`),t.load.image("runeMetal",`${l}/images/factions/common/rune_metal.webp`),t.load.image("shiningHelm",`${l}/images/factions/common/shining_helm.webp`),t.load.image("attackReticle",`${l}/images/gameItems/attack_reticle.webp`),t.load.image("healReticle",`${l}/images/gameItems/heal_reticle.webp`),t.load.image("allyReticle",`${l}/images/gameItems/ally_reticle.webp`),t.load.image("blockedLOS",`${l}/images/gameItems/blocked_los.webp`),t.load.image("HpBackground",`${l}/images/gameItems/hp_background.webp`),t.load.image("HpAlly",`${l}/images/gameItems/hp_green.webp`),t.load.image("HpEnemy",`${l}/images/gameItems/hp_red.webp`),t.load.atlas("greenFont",`${l}/fonts/green_font.png`,`${l}/fonts/green_font.json`),t.load.atlas("redFont",`${l}/fonts/red_font.png`,`${l}/fonts/red_font.json`),t.load.image("cardBackground",`${l}/images/gameItems/card/HelpTooltip_BG-hd.webp`),t.load.image("cardSeparator",`${l}/images/gameItems/card/HelpTooltip_Separator.webp`),t.load.image("hpBackground",`${l}/images/gameItems/card/HelpTooltip_InsetHP-hd.webp`),t.load.image("hpBar",`${l}/images/gameItems/card/HelpTooltip_HPBar-hd.webp`),t.load.image("magicalDamage",`${l}/images/gameItems/card/TooltipIcon_MagicDmg-hd.webp`),t.load.image("physicalDamage",`${l}/images/gameItems/card/TooltipIcon_PhysDmg-hd.webp`),t.load.image("magicalResistance",`${l}/images/gameItems/card/TooltipIcon_MagicRes-hd.webp`),t.load.image("physicalResistance",`${l}/images/gameItems/card/TooltipIcon_PhysDef-hd.webp`),t.load.image("movementRange",`${l}/images/gameItems/card/TooltipIcon_Movement-hd.webp`),t.load.image("attackRange",`${l}/images/gameItems/card/TooltipIcon_Range-hd.webp`),t.load.image("movementSquare",`${l}/images/gameItems/card/TooltipIcon_MovementTile-hd.webp`),t.load.image("attackSquare",`${l}/images/gameItems/card/TooltipIcon_RangeTile-hd.webp`),t.load.image("hpIcon",`${l}/images/gameItems/card/HelpTooltip_HP-hd.webp`),t.load.audio("resignSound",`${l}/audio/ui/resignGame.mp3`),t.load.audio("resetTurnSound",`${l}/audio/ui/turnReset.mp3`),t.load.audio("selectHeroFromHandSound",`${l}/audio/game/Game_Pickup_CharacterTile_Generic.mp3`),t.load.audio("selectHeroFromBoardSound",`${l}/audio/game/Game_Select_Character.mp3`),t.load.audio("spawnHeroSound",`${l}/audio/game/Game_Place_CharacterTile.mp3`),t.load.audio("moveHeroSound",`${l}/audio/game/Game_Release_ToMove_Character.mp3`),t.load.audio("moveFlySound",`${l}/audio/game/Character_Movement_Flying.mp3`),t.load.audio("moveWalkSound",`${l}/audio/game/Character_Movement_Steps.mp3`),t.load.audio("stompSound",`${l}/audio/game/KO_Player_Stomp.mp3`),t.load.audio("vanishSound",`${l}/audio/game/KO_Player_Vanish.mp3`),t.load.audio("reviveHeroSound",`${l}/audio/game/Game_Revive.mp3`),t.load.audio("healSound",`${l}/audio/game/Civ_Cleric_Heal.mp3`),t.load.audio("healExtraSound",`${l}/audio/game/Game_Heal.mp3`),t.load.audio("selectScrollSound",`${l}/audio/game/Game_Touch_Scroll.mp3`),t.load.audio("selectRuneMetalSound",`${l}/audio/game/Touch_Sword.mp3`),t.load.audio("selectDragonScaleSound",`${l}/audio/game/Touch_Shield.mp3`),t.load.audio("selectItemGenericSound",`${l}/audio/game/Touch_Generic.mp3`),t.load.audio("selectPotionSound",`${l}/audio/game/Touch_Potion.mp3`),t.load.audio("useScrollSound",`${l}/audio/game/Game_Use_Scroll.mp3`),t.load.audio("useRuneMetalSound",`${l}/audio/game/Game_Equip_Sword.mp3`),t.load.audio("useDragonScaleSound",`${l}/audio/game/Deploy_Shield.mp3`),t.load.audio("useItemGenericSound",`${l}/audio/game/Deploy_Generic.mp3`),t.load.audio("usePotionSound",`${l}/audio/game/Deploy_Potion.mp3`),t.load.audio("useInfernoSound",`${l}/audio/game/Game_FireBomb_Activate.mp3`),t.load.audio("swordTileSound",`${l}/audio/game/Game_Land_Sword.mp3`),t.load.audio("shieldTileSound",`${l}/audio/game/Game_Land_Shield.mp3`),t.load.audio("helmTileSound",`${l}/audio/game/Tile_Resist_Magic.mp3`),t.load.audio("crystalTileSound",`${l}/audio/game/Game_Land_X.mp3`),t.load.audio("newItemsSound",`${l}/audio/game/UI_Door_KickOpenClose.mp3`),t.load.audio("returnItemSound",`${l}/audio/game/UI_Game_Chest_Tap.mp3`),t.load.audio("damageCrystal1Sound",`${l}/audio/game/Game_Crystal_Damage_1.mp3`),t.load.audio("damageCrystal2Sound",`${l}/audio/game/Game_Crystal_Damage_2.mp3`),t.load.audio("destroyCrystalSound",`${l}/audio/game/Game_Crystal_Destroy.mp3`),t.load.audio("winSFXSound",`${l}/audio/game/Game_Win_SFX_01.mp3`),t.load.audio("loseSFXSound",`${l}/audio/game/Game_Lose_SFX_01.mp3`),t.load.audio("archerAttackSound",`${l}/audio/council/Civ_Archer_Attack_Arrow.mp3`),t.load.audio("archerAttackBigSound",`${l}/audio/council/Civ_Human_Archer_BigAttack.mp3`),t.load.audio("archerAttackMeleeSound",`${l}/audio/council/Civ_Human_Archer_Attack_CloseRange.mp3`),t.load.audio("archerDeathSound",`${l}/audio/council/Civ_Death_Archer_Element.mp3`),t.load.audio("clericAttackSound",`${l}/audio/council/Civ_Human_Cleric_Attack_CloseRange.mp3`),t.load.audio("clericAttackBigSound",`${l}/audio/council/Civ_Human_Cleric_AttackBig.mp3`),t.load.audio("clericDeathSound",`${l}/audio/council/Civ_Death_Cleric_Element.mp3`),t.load.audio("knightAttackSound",`${l}/audio/council/Civ_Knight_Attack.mp3`),t.load.audio("knightAttackBigSound",`${l}/audio/council/Civ_Human_Fighter_BigAttack.mp3`),t.load.audio("knightDeathSound",`${l}/audio/council/Civ_Death_Knight_Element.mp3`),t.load.audio("ninjaAttackSound",`${l}/audio/council/Civ_Human_Ninja_Attack_CloseRange.mp3`),t.load.audio("ninjaAttackBigSound",`${l}/audio/council/Civ_Human_Ninja_AttackBig.mp3`),t.load.audio("ninjaAttackRangedSound",`${l}/audio/council/Civ_Ninja_ThrowingStar_Attack.mp3`),t.load.audio("ninjaDeathSound",`${l}/audio/council/Civ_Death_Ninja_Element.mp3`),t.load.audio("ninjaSmokeSound",`${l}/audio/council/Civ_Ninja_Deploy_SmokeBomb.mp3`),t.load.audio("wizardAttackSound",`${l}/audio/council/Civ_Wizard_Attack.mp3`),t.load.audio("wizardAttackBigSound",`${l}/audio/council/Civ_Human_Wizard_BigAttack.mp3`),t.load.audio("wizardDeathSound",`${l}/audio/council/Civ_Death_Wizard_Element.mp3`),t.load.audio("selectInfernoSound",`${l}/audio/council/Game_FireBomb_Grab_Tile.mp3`),t.load.audio("priestessAttackSound",`${l}/audio/elves/DE-Heretic_Attack_Curse.mp3`),t.load.audio("priestessDeathSound",`${l}/audio/elves/DE-Heretic_Death.mp3`),t.load.audio("impalerAttackSound",`${l}/audio/elves/DE-Impaler_Attack_Throw_Spear.mp3`),t.load.audio("impalerAttackBigSound",`${l}/audio/elves/DE-Impaler_BigAttack.mp3`),t.load.audio("impalerAttackMeleeSound",`${l}/audio/elves/DE-Impaler_Melee_Attack.mp3`),t.load.audio("impalerDeathSound",`${l}/audio/elves/DE-Impaler_Death.mp3`),t.load.audio("necroAttackSound",`${l}/audio/elves/DE-Necro_Attack.mp3`),t.load.audio("necroAttackBigSound",`${l}/audio/elves/DE-Necro_AttackBig.mp3`),t.load.audio("necromancerDeathSound",`${l}/audio/elves/DE-Heretic_Death.mp3`),t.load.audio("phantomSpawnSound",`${l}/audio/elves/DE-Phantom_Spawn.mp3`),t.load.audio("phantomDeathSound",`${l}/audio/elves/DE-Phantom_Death.mp3`),t.load.audio("voidmonkAttackSound",`${l}/audio/elves/DE-VoidMonk_Attack_Punch.mp3`),t.load.audio("voidmonkAttackBigSound",`${l}/audio/elves/DE-VoidMonk_AttackBig.mp3`),t.load.audio("voidmonkDeathSound",`${l}/audio/elves/DE-VoidMonk_Death.mp3`),t.load.audio("wraithSpawnSound",`${l}/audio/elves/DE-Wraith_Birth.mp3`),t.load.audio("wraithAttackSound",`${l}/audio/elves/Civ_DarkElf_Attack_Spell_1.mp3`),t.load.audio("wraithAttackBigSound",`${l}/audio/elves/DE-Wraith_BigAttack.mp3`),t.load.audio("wraithDeathSound",`${l}/audio/elves/DE-Wraith_Death.mp3`),t.load.audio("wraithConsumeSound",`${l}/audio/elves/DE-Wraith_Consume.mp3`),t.load.audio("useHarvestSound",`${l}/audio/elves/Civ_DarkElf_Inferno_Explosion.mp3`),t.load.audio("paladinHealSound",`${l}/audio/dwarves/DWF_Paladin_Heal.mp3`),t.load.audio("paladinAttackSound",`${l}/audio/dwarves/DWF_Paladin_Melee.mp3`),t.load.audio("paladinAttackBigSound",`${l}/audio/dwarves/DWF_Paladin_Special.mp3`),t.load.audio("paladinDeath",`${l}/audio/dwarves/DWF_Paladin_Deploy.mp3`),t.load.audio("engineerAttackSound",`${l}/audio/dwarves/DWF_Engineer_Attack_Melee.mp3`),t.load.audio("engineerAttackBigSound",`${l}/audio/dwarves/DWF_Engineer_BigAttack.mp3`),t.load.audio("engineerShieldMake",`${l}/audio/dwarves/DWF_Engineer_Cast_Shield_Buff.mp3`),t.load.audio("engineerShieldBreak",`${l}/audio/dwarves/DWF_Engineer_Shield_Shatter.mp3`),t.load.audio("grenadierAttack",`${l}/audio/dwarves/DWF_Grenadier_Attack_Throw_01.mp3`),t.load.audio("grenadierAttackBig",`${l}/audio/dwarves/DWF_Grenadier_Attack_Throw_01.mp3`),t.load.audio("grenadierAttackMelee",`${l}/audio/dwarves/DWF_Grenadier_Melee.mp3`),t.load.audio("grenadierDeath",`${l}/audio/dwarves/DWF_Grenadier_Bomb_Catch.mp3`),t.load.audio("gunnerAttack",`${l}/audio/dwarves/DWF_Gunner_Attack_Rifle_rev1.mp3`),t.load.audio("gunnerJump",`${l}/audio/dwarves/DWF_Gunner_Jump.mp3`),t.load.audio("gunnerAttackGunOnly",`${l}/audio/dwarves/DWF_Gunner_Attack_Rifle_01.mp3`),t.load.audio("gunnerDeath",`${l}/audio/dwarves/DE-VoidMonk_Attack_Punch.mp3`),t.load.audio("annihilatorShoot",`${l}/audio/dwarves/DWF_Bazooka_Fire.mp3`),t.load.audio("annihilatorHit",`${l}/audio/dwarves/DWF_Bazooka_Fire.mp3`),t.load.audio("annihilatorWindup",`${l}/audio/dwarves/DWF_Bazooka_Fire.mp3`),t.load.audio("brewSelect",`${l}/audio/dwarves/DWF_Item_Pickup_Beer.mp3`),t.load.audio("brewUse",`${l}/audio/dwarves/DWF_Item_Beer_Use.mp3`),t.load.audio("drillSelect",`${l}/audio/dwarves/DWF_Item_Pickup_Drill.mp3`),t.load.audio("drillUse",`${l}/audio/dwarves/DWF_Item_Drill.mp3`)}class ni extends Phaser.Scene{constructor(){super({key:"GameScene"});n(this,"userId");n(this,"colyseusClient");n(this,"centerPoints");n(this,"currentRoom");n(this,"currentGame");n(this,"currentTurnAction");n(this,"turnNumber");n(this,"activeUnit");n(this,"gameController");n(this,"activePlayer");n(this,"isPlayerOne");n(this,"opponentId");n(this,"player1");n(this,"player2");n(this,"longPressStart");n(this,"visibleUnitCard");n(this,"triggerReplay",!0);n(this,"chatComponent");this.centerPoints=ii()}init(e){var s;this.userId=e.userId,this.colyseusClient=e.colyseusClient,this.turnNumber=e.currentGame.turnNumber,this.currentGame=e.currentGame,this.currentRoom=e.currentRoom;const i=e.currentGame.players.find(o=>e.userId!==o.userData._id);this.opponentId=i.userData._id,this.triggerReplay=e.triggerReplay??!0,this.activePlayer=this.currentGame.activePlayer.toString(),this.isPlayerOne=((s=this.currentGame)==null?void 0:s.players[0].userData._id)===this.userId,this.currentTurnAction=this.turnNumber===0?3:1}preload(){this.load.html("chatComponent","html/chat.html"),oi(this),si(this)}create(){this.time.addEvent({delay:3e5,callback:()=>{this.currentRoom.send("ping")},loop:!0}),this.registry.get("userPreferences").chat&&(this.chatComponent=Ia(this)),this.input.mouse.disableContextMenu(),this.gameController=new ti(this),this.triggerReplay&&this.gameController.replayTurn(),this.game.events.on("messageToGameScene",i=>{const{x:s,y:o,message:r}=i,c=Ue(this,s,o,r);Re(c,3e3)})}onShutdown(){this.sound.stopAll()}}class ge extends Phaser.GameObjects.Container{constructor(e,i){const s={x:350,y:50};super(e,0,0);n(this,"header");n(this,"rows");n(this,"paginationBar");n(this,"context");this.context=e;const o={fontFamily:"proLight",color:"#ffffff",wordWrap:{width:190,useAdvancedWrap:!0}},r={...o,fontSize:45},c={...o,fontSize:35};this.header=e.add.container(s.x,s.y);const d=e.add.text(100,0,"Username",r),h=e.add.text(320,0,"Games",r),u=e.add.text(520,0,"Wins",r),p=e.add.text(720,0,"Council",r),y=e.add.text(920,0,"Elves",r);this.header.add([d,h,u,p,y]),s.y+=20,this.rows=i.players.map(I=>{s.y+=50;const $=e.add.container(s.x,s.y),V=e.add.text(100,0,be(I.username,13),c),te=e.add.text(350,0,`${I.stats.totalGames}`,c),H=e.add.text(550,0,`${I.stats.totalWins}`,c),U=e.add.text(750,0,`${I.stats.councilWins}`,c),K=e.add.text(950,0,`${I.stats.elvesWins}`,c),W=e.add.image(1030,15,"challengeIcon").setInteractive({useHandCursor:!0});return W.on("pointerdown",()=>{f(this.scene,C.BUTTON_GENERIC),new ze({context:e,username:I.username,challengeType:he.SEND,opponentId:I._id})}),I._id===e.userId&&W.setVisible(!1).disableInteractive(),$.add([V,te,H,U,K,W]),$});let T=i.currentPage;const P=730,w=900;this.paginationBar=e.add.container(w,P+10);const D=e.add.text(0,0,`${T} / ${i.totalPages}`,r).setOrigin(.5),O=e.add.image(-180,0,"arrowButton").setFlipX(!0).setScale(.7).setVisible(T>1),M=e.add.image(-120,0,"curvedArrowButton").setScale(.7).setVisible(T>1),J=e.add.image(120,0,"curvedArrowButton").setFlipX(!0).setScale(.7).setVisible(T!==i.totalPages),G=e.add.image(180,0,"arrowButton").setScale(.7).setVisible(T!==i.totalPages);O.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{if(this.scene.sound.play(C.BUTTON_GENERIC),T>1){const I=await fe(1);I&&(new ge(this.context,I),this.destroy())}}),M.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{if(this.scene.sound.play(C.BUTTON_GENERIC),T>1){const I=await fe(--T);I&&(new ge(this.context,I),this.destroy())}}),J.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{this.scene.sound.play(C.BUTTON_GENERIC);const I=await fe(++T);I&&(new ge(this.context,I),this.destroy())}),G.setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{if(this.scene.sound.play(C.BUTTON_GENERIC),T!==i.totalPages){const I=await fe(i.totalPages);I&&(new ge(this.context,I),this.destroy())}}),this.paginationBar.add([O,M,D,J,G]),this.add([this.header,...this.rows,this.paginationBar]),this.context.add.existing(this)}}function ri(t){t.load.image("challengeIcon",`${l}/images/gameItems/card/TooltipIcon_PhysDmg-hd.webp`),t.load.image("arrowButton",`${l}/ui/arrow_button.webp`),t.load.image("curvedArrowButton",`${l}/ui/curved_arrow_button.webp`),t.load.image(B.COUNCIL,`${l}/ui/council_emblem.webp`),t.load.image(B.DARK_ELVES,`${l}/ui/elves_emblem.webp`)}class li extends Phaser.Scene{constructor(){super({key:"LeaderboardScene"});n(this,"userId")}init(e){this.userId=e.userId}preload(){ri(this)}async create(){this.add.image(396,14,"gameBackground").setOrigin(0,0).setScale(1.07,1.2);const e=await fe();e&&new ge(this,e)}onShutdown(){this.sound.stopAll()}}const lt={x:800,y:400};class ci extends Phaser.GameObjects.Container{constructor(e,i){super(e,lt.x,lt.y);n(this,"blockingLayer");n(this,"backgroundImage");n(this,"okButtonImage");n(this,"cancelButtonImage");n(this,"popupText");n(this,"okButtonText");n(this,"cancelButtonText");this.blockingLayer=e.add.rectangle(0,0,2e3,2e3,0,.001).setOrigin(.5).setInteractive(),this.backgroundImage=e.add.image(0,0,"popupBackground").setDisplaySize(500,300),this.okButtonImage=e.add.image(-90,60,"popupButton").setTint(10027008).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.cancelButtonImage=e.add.image(90,60,"popupButton").setTint(31743).setDisplaySize(110,60).setInteractive({useHandCursor:!0}),this.popupText=e.add.text(0,-50,"Delete account? All data will be lost",{fontFamily:"proLight",fontSize:40,color:"#ffffff",align:"center",lineSpacing:10,wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5),this.okButtonText=e.add.text(-90,60,"DELETE",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.cancelButtonText=e.add.text(90,60,"CANCEL",{fontFamily:"proLight",fontSize:30,color:"#ffffff"}).setOrigin(.5),this.okButtonImage.on("pointerdown",async()=>{f(this.scene,C.BUTTON_GENERIC),this.setVisible(!1),await i.handleDelete()}),this.cancelButtonImage.on("pointerdown",()=>{this.scene.sound.play(C.BUTTON_FAILED),this.setVisible(!1),i.toggleFormVisibility(!0)}),this.add([this.blockingLayer,this.backgroundImage,this.popupText,this.okButtonImage,this.okButtonText,this.cancelButtonImage,this.cancelButtonText]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this)}}class hi extends Phaser.GameObjects.Container{constructor(e,i){super(e,900,400);n(this,"visibleFlag");const s=new Phaser.GameObjects.Container(e,0,0),o=e.add.rectangle(0,0,3e3,2e3,0,.001).setOrigin(.5).setInteractive(),r=600,c=500,d=256*.4,h=10,u=4,p=e.add.rectangle(0,0,r,c,2236962,1).setStrokeStyle(2,16777215);s.add(p);const y=new Phaser.GameObjects.Container(e,-600/2+h,-500/2+h);s.add(y);const T=[],P=()=>{const H=-250+h+25,U=H+(c-60);T.forEach(K=>{var Z;const W=K.y+y.y;W+K.displayHeight>H&&W<U?(Z=K.input)!=null&&Z.enabled||K.setInteractive({useHandCursor:!0}):K.disableInteractive()})};Oe.forEach((H,U)=>{const K=Math.floor(U/u),X=U%u*(d+h),Ce=K*(d+h),Z=e.add.image(X+120,Ce-160,H).setInteractive({useHandCursor:!0}).setDisplaySize(d,d).setData("key",H);Z.on("pointerup",()=>{var se;te||!this.visibleFlag||(e.userData.picture=H,i.setTexture(H).setDisplaySize(256*.5,256*.5),this.setVisible(!1),(se=e.profile)==null||se.toggleFormVisibility(!0))}),T.push(Z),y.add(Z)});const w=this.x+y.x,D=this.y+y.y,O=e.make.graphics({});O.fillStyle(16777215),O.fillRect(w,D+25,r-2*h,c-60);const M=new Phaser.Display.Masks.GeometryMask(e,O);y.setMask(M);const I=-(Math.ceil(Oe.length/u)*(d+h))+c-2*h-100;y.y=0,P(),e.input.on("wheel",(H,U,K,W,X)=>{this.visible&&(y.y-=W*1,y.y=Phaser.Math.Clamp(y.y,I,0),P())});let $=!1,V=0,te=!1;e.input.on("pointerdown",H=>{this.visible&&($=!0,V=H.y,te=!1)}),e.input.on("pointermove",H=>{if(!$)return;const U=H.y-V;Math.abs(U)>5&&(te=!0),y.y+=U*.7,y.y=Phaser.Math.Clamp(y.y,I,0),P(),V=H.y}),e.input.on("gameobjectup",()=>{$=!1,V=0,te=!1}),this.add([o,s]),this.setDepth(1002),this.setVisible(!1),e.add.existing(this),this.visibleFlag=!0}}class di extends Phaser.GameObjects.Container{constructor(e){var s,o,r,c;super(e,0,0);n(this,"context");n(this,"profilePicturePopup");n(this,"emailInput");n(this,"passwordInput");n(this,"passwordConfirmInput");n(this,"profileUpdateError");n(this,"profileUpdateSuccess");n(this,"notificationsCheckBox");n(this,"chatCheckBox");n(this,"soundCheckBox");n(this,"saveButtonImage");n(this,"saveButtonText");n(this,"deleteAccountButtonImage");n(this,"deleteAccountButtonText");n(this,"deletePopup");n(this,"profilePicture");n(this,"previousPicture");this.context=e,this.context.add.image(396,14,"gameBackground").setOrigin(0,0).setScale(1.07,1.2),this.context.add.text(800,40,"PROFILE",{fontFamily:"proHeavy",fontSize:80,color:"#ffffff"}),this.context.add.text(1e3,150,"PREFERENCES",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff"}),this.context.add.text(550,150,"DATA",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff"}),this.previousPicture=this.context.userData.picture,this.profilePicture=this.context.add.image(580,550,this.context.userData.picture).setDisplaySize(256*.5,256*.5).setInteractive({useHandCursor:!0}),this.profilePicture.on("pointerdown",()=>{this.profilePicturePopup.setVisible(!0),this.toggleFormVisibility(!1),this.bringToTop(this.profilePicturePopup)}),this.profilePicturePopup=new hi(this.context,this.profilePicture),this.emailInput=this.createInputField(600,230,"email","Email"),this.passwordInput=this.createInputField(600,290,"New password","password"),this.passwordConfirmInput=this.createInputField(600,350,"Confirm Password","password"),this.profileUpdateError=this.context.add.dom(450,380).createFromHTML(`
  <div id="profileError" class="proLightFont" style="color: white; font-size: 30px; margin-bottom: 10px; display: none; max-width: 500px; background-color: #8e0000; padding: 10px"></div>`),this.profileUpdateSuccess=this.context.add.dom(450,380).createFromHTML(`
  <div id="profileSuccess" class="proLightFont" style="color: white; font-size: 30px; margin-bottom: 10px; display: none; max-width: 500px; background-color: #14452f; padding: 10px"></div>`);const i=e.userData.preferences;this.notificationsCheckBox=this.createCheckbox(1150,230,"Email notifications",i.emailNotifications),this.chatCheckBox=this.createCheckbox(1087,290,"Enable chat",i.chat),this.soundCheckBox=this.createCheckbox(1103,350,"Enable sound",i.sound),e.add.text(1e3,390,"STATS",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff"}),e.add.text(1e3,440,`Games: ${(s=e.userData)==null?void 0:s.stats.totalGames}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),e.add.text(1e3,490,`Wins: ${(o=e.userData)==null?void 0:o.stats.totalWins}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),e.add.text(1e3,540,`Council wins: ${(r=e.userData)==null?void 0:r.stats.councilWins}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),e.add.text(1e3,590,`Elves wins: ${(c=e.userData)==null?void 0:c.stats.elvesWins}`,{fontFamily:"proLight",fontSize:35,color:"#ffffff"}),this.saveButtonImage=this.context.add.image(895,700,"popupButton").setTint(3381759).setDisplaySize(230,100).setInteractive({useHandCursor:!0}),this.saveButtonText=this.context.add.text(830,655,"SAVE CHANGES",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff",align:"center",wordWrap:{width:150,useAdvancedWrap:!0}}),this.saveButtonImage.on("pointerdown",async()=>{f(this.scene,C.BUTTON_GENERIC),await this.handleSubmit()}),this.loadUserData(),this.deletePopup=new ci(e,this),this.deleteAccountButtonImage=this.context.add.image(1265,700,"popupButton").setTint(10027008).setDisplaySize(230,100).setInteractive({useHandCursor:!0}),this.deleteAccountButtonText=this.context.add.text(1200,655,"DELETE ACCOUNT",{fontFamily:"proHeavy",fontSize:40,color:"#ffffff",align:"center",wordWrap:{width:150,useAdvancedWrap:!0}}),this.deleteAccountButtonImage.on("pointerdown",()=>{f(this.scene,C.BUTTON_GENERIC),console.log("Clicked on delete account"),this.toggleFormVisibility(!1),this.deletePopup.setVisible(!0)}),this.add([this.emailInput,this.passwordInput,this.passwordConfirmInput,this.profileUpdateError,this.profileUpdateSuccess,this.notificationsCheckBox,this.chatCheckBox,this.soundCheckBox,this.saveButtonImage,this.saveButtonText,this.deleteAccountButtonImage,this.deleteAccountButtonText,this.profilePicturePopup]),this.bringToTop(this.profilePicturePopup),this.context.add.existing(this)}createInputField(e,i,s,o,r=""){const c=`
    <input
      type="${o}"
      placeholder="${s}"
      value="${r}"
      style="font-size:25px; width: 300px; height: 30px; font-family: proLight"
    />
  `;return this.context.add.dom(e,i).createFromHTML(c)}createCheckbox(e,i,s,o){return this.context.add.dom(e,i).createFromHTML(`
      <label style="color:white; font-size: 50px; font-family: proLight">
        <input type="checkbox" ${o?"checked":""} style="width: 35px; height: 35px;"/> ${s}
      </label>
    `)}loadUserData(){this.emailInput.getChildByName("").value=this.context.userData.email,this.notificationsCheckBox.getChildByName("").checked=this.context.userData.preferences.emailNotifications,this.chatCheckBox.getChildByName("").checked=this.context.userData.preferences.chat,this.soundCheckBox.getChildByName("").checked=this.context.userData.preferences.sound}async handleSubmit(){var p,y,T,P,w;this.profileUpdateError.setVisible(!1),this.profileUpdateSuccess.setVisible(!1);const e=this.emailInput.getChildByName("").value,i=this.passwordInput.getChildByName("").value,s=this.passwordConfirmInput.getChildByName("").value,o=this.notificationsCheckBox.getChildByName("").checked,r=this.chatCheckBox.getChildByName("").checked,c=this.soundCheckBox.getChildByName("").checked;if(!this.emailInput.node.querySelector("input").checkValidity()){this.showForm(this.profileUpdateError,"profileError","Incorrect email format");return}if(i.trim()!==""){if(i!==s){this.showForm(this.profileUpdateError,"profileError","Passwords do not match");return}if(!dt(i)){this.showForm(this.profileUpdateError,"profileError","Password must be at least 8 characters long and contain a letter and a number");return}}const h={};if(e&&e!==((p=this.context.userData)==null?void 0:p.email)&&(h.email=e),i&&i.trim()!==""&&(h.password=i),o!==void 0&&o!==((y=this.context.userData)==null?void 0:y.preferences.emailNotifications)&&(h.emailNotifications=o),r!==void 0&&r!==((T=this.context.userData)==null?void 0:T.preferences.chat)&&(h.chat=r),c!==void 0&&c!==((P=this.context.userData)==null?void 0:P.preferences.sound)&&(h.sound=c),((w=this.context.userData)==null?void 0:w.picture)!==this.previousPicture&&(h.picture=this.context.userData.picture),Object.keys(h).length===0)return;const u=await La(h);u.success?(console.log("Profile updated"),this.showForm(this.profileUpdateSuccess,"profileSuccess","Profile successfully updated"),this.context.userData=u.user,this.scene.registry.set("userPreferences",{chat:u.user.preferences.chat,sound:u.user.preferences.sound}),this.scene.sound.mute=!u.user.preferences.sound):(this.loadUserData(),this.profilePicture.setTexture(this.previousPicture),this.showForm(this.profileUpdateError,"profileError",u.error))}async handleDelete(){(await Ma()).success&&this.context.scene.start("MainMenuScene")}toggleFormVisibility(e){this.emailInput.setVisible(e),this.passwordInput.setVisible(e),this.passwordConfirmInput.setVisible(e),this.notificationsCheckBox.setVisible(e),this.chatCheckBox.setVisible(e),this.soundCheckBox.setVisible(e),this.profileUpdateError.setVisible(e),this.profileUpdateSuccess.setVisible(e)}showForm(e,i,s){var r;e.setVisible(!0);const o=(r=e.getChildByID)==null?void 0:r.call(e,i);o&&(o.innerText=s,o.style.display="block")}hideForm(e,i){var o;const s=(o=e.getChildByID)==null?void 0:o.call(e,i);s&&(s.innerText="",s.style.display="none")}}class ui extends Phaser.Scene{constructor(){super({key:"ProfileScene"});n(this,"userId");n(this,"profile");n(this,"userData")}init(e){this.userId=e.userId}preload(){Oe.forEach(e=>{this.load.image(e,`${l}/images/profilePics/${e}.webp`)})}async create(){this.userData=await Ba(),this.profile=new di(this)}onShutdown(){console.log("Profile scene shutdown logs, remove"),this.sound.stopAll()}}const mi=`Fan Academy is a fan-made revival of the game Hero Academy, a turn-based tactics game developed by Robot Entertainment. This project aims to bring back the joy of the original game, offering a way for fans to rediscover it.

This is not a reverse engineering of the game. The game logic is being implemented from scratch while using the original assets to try to preserve the game's aesthetic as much as possible.`,gi="Hero Academy is a player-versus-player turn-based tactics game where players choose a team of heroes and use their units and items to defeat their opponents. Unfortunately, the game is currently deadf, delisted from all stores and its online servers shut down. It is no longer possible for people who purchased the game to play it.",pi="This project includes proprietary assets from Hero Academy, which are the property of Robot Entertainment. These assets are used for educational and non-commercial purposes under the assumption of fair use for a fan project. This license applies only to the code in this repository and not to the assets. All rights to the proprietary assets remain with their respective owners.",fi=`You can create a game by clicking on the icon of the faction you want to play as. Matchmaking happens automatically: if there is already a game looking for players, you will be paired immediately. If not, you will see your game under the "Looking for games" section.

Games in the game list are organized on sections based on their status. Here's the order in which they appear in the game list:

-Your turn: You should probably click on these and play your turn.

-Challenges received: Click on these games to select a faction and start playing against the player who challenged you. You can also decline by clicking the X button on the top-right corner of the game.

-Opponent's turn. Your opponent should probably click on those and play their turn.

-Searching for players: As mentioned earlier, these are open games created by you. When another player looks for a game they will be paired with you. If you don't want to search for a game anymore, you can click the X button on the top-right corner of the game to delete it.

-Challenges sent: These games are waiting for the player you challenged to pick a faction or decline the challenge. You can remove the challenge by, you guessed it, clicking on the X button on the top-right corner of the game.

-Finished: Here you will find your 5 more recent finished games. You can click on a game to see the final game state and challenge your opponent to a rematch.

Please note that one ore more of these categories may not be present in your game if you don't have any games that qualify. E.g., you won't see a "Challenges sent" category if you have not sent any challenges.

You can come back to the main menu by clicking on the "Home" button.`,yi=`Here you can update your email, password, profile pics and communication preferences. No changes are saved until you click on the "Save changes" button.

-Email preferences: The game sends an email when it's your turn to play, when a game ends and when you receive a challenge. If you don't wish to receive emails, leave the checkbox blank. Note: An email confirmation email was sent to you when you created the account. If you have not confirmed your email, you will not receive email notifications, even if the checkbox is ticked.

-Enable chat: Having this option checked allows people to message you in the in-game chat. Or it will, once I add an in-game chat to the game.

-Delete account: Clicking on this button will open a confirmation popup. Deleting your account is irreversible, I have no way to recover your data.`,Ti=`Shows a list of all players, sorted by number of victories. If two or more players have the same amount of wins, the player with the fewer played games appears above.

You can send a challenge to a player from the leaderboard by clicking the sword icon on the right hand side of the screen. You will be prompted to pick a faction before sending the challenge.`,bi=`If you are new to Hero Academy, here you will find resources to learn how to play. Fan Academy plays exactly the same than Hero Academy. And if it doesn't, please let me know.

The information below is taken from a guide written by Hamlet on his defunct site, iam.yellingontheinternet.com, thanks to the magic of the Internet Archive. I have edited some parts for clarification.`,Ii=`Basic:

     5 action points (AP) per turn (3 AP for the first player on their first turn to balance first player advantage).

     1 AP can be used to:
    	- deploy a unit to deploy square
    	- move a unit
    	- attack an enemy unit or crystal
    	- heal or revive a friendly unit
    	- use a unit special ability
    	- equip a unit with an upgrade
    	- use a one-time item
    	- return a unit or item from your hand back into the deck (the door icon) to draw a random one next turn

     A unit that reaches 0 HP is knocked out, but can be revived by an ally. It vanishes from the board permanently if:
    	- any player moves a unit onto it (stomps it)
    	- destroys it with certain spells
    	- its owner takes a full turn without reviving it

     A player loses upon having all of his crystals destroyed, or by having all of the units in his deck stomped or knocked out (the game will end even if he has an item left that can revive a KO'd unit).

     Units are drawn in random order throughout the game, except that your starting hand always has at least 3 units.

Map features:

     Crystals. There are two per faction, each one with 4500 hp. Destroy both of your opponent's crystals to win the game.

     Deploy square. Enemy units cannot move onto it, even to stomp. An enemy unit adjacent to a deploy square can attack a corpse that's on the square (which destroys it), without moving onto it. A Necromancer or Inferno can also destroy a KO'd unit on a deploy square.

     Attack square (red sword). A unit on the square has +100 attack power, applied before all %-based bonuses.

     Defense square (blue shield). A unit on the square has +20% physical resist.

     Magic Defense square (dark blue helm). A unit on the square has +20% magical resist.

     Assault square (purple gem). While a friendly unit is standing on this square, all attacks against enemy crystals do an extra 300 damage. Multiple assault bonuses stack. The bonus is reduced accordingly if the crystal takes AoE or chain damage. The bonus damage has no type and is not affected by any resist.

     Teleport square (light blue dot). A unit on the square can use 1 AP to teleport to the other teleport square, if it is open.

Advanced:

     Range is counted orthogonally only, not diagonally (e.g. a unit one square diagonally from another is at range 2).

     Each unit has an attack power, and a damage type (physical or magical).  Ordinary attacks hit for damage equal to the unit's attack power, but some multiply by certain percentage or add other bonuses. The attack power is what's shown in the unit's info window.

     Each target also has a physical and magical resist, which reduce incoming damage of the appropriate type by a fixed percentage.

     Ranged attacks (but not ranged friendly actions) require line of sight to the target. Enemy units and crystals block line of sight, but friendly ones do not. An attack to an immediately diagonal square can't be blocked.

     A unit that can act on a corpse (healer reviving a friendly corpse, or Necromancer/Wraith destroying an enemy one) can't choose to move and stomp the corpse instead. Clicking on the corpse causes the unit to act on it. However, if the unit does not have line of sight to the enemy corpse, it will move and stomp instead.

     Knockbacks only occur if the target square is open, otherwise the unit simply doesn't move. If a unit is KO'd by the knockback, it still moves. A unit can't be knocked onto an enemy start tile, unless it's also KO'd (in which case an enemy spawning there will stomp it).

     A unit can wind up on an enemy deploy square if it's KO'd onto it and then revived, or if it's a Wraith that spawned from a corpse on that square. It will block the enemy from deploying units there so long as it remains.
     A corpse on its own deploy square will be stomped automatically if a friendly unit deploys there.

     Units cannot target themselves with heals or other buffs.`,Ai=`Knight (3):
1000 HP
20% P resist
200 attack (P), range 1
Attack knocks target back one square.
Move 2

Archer (3):
800 HP
300 attack (P), range 3
50% damage in melee, 100% damage at range.
Move 2

Wizard (3):
800 HP
10% M resist
200 attack (M), range 2
Attack can hit up to 3 enemy units or crystals if they are adjacent. Main target takes 100% damage, first jump does 75%, second jump 56%.
Move 2

Cleric (3):
800 HP
200 attack (M), range 2
Heals for 300% attack, revives for 200% attack, range 2
Move 2

Ninja (1):
800 HP
200 attack (P), range 2.
200% damage in melee, 100% damage at range.
Can use 1 AP to swap places with any friendly unit.
Move 3`,wi=`Upgrades:
-Sword (3): +50% attack
-Armor (3): +20% physical resist, +10% HP
-Helm (3): +20% magical resist, +10% HP

Consumables:
-Scroll (2): Targets one friendly. Unit has 300% attack power for one attack/heal.

-Inferno (2): Targets a 33 area. KO'd enemies are destroyed, and other enemies take 350 M.

-Potion (2): Targets one friendly. Heals for 1000. In addition, can revive a KO'd unit for 100.

Faction passive: None`,Ci=`Void Monk (3):
800 HP
20% P resist, 20% M resist
200 attack (P), range 1
100% damage to target, splashes for 66% damage to any enemies adjacent (not diagonal) to target.
Move 3

Impaler (3):
800 HP
300 attack (P), range 2
If target is at range 2 in a straight line, pulled one square towards Impaler.
Move 2

Necromancer (3):
800 HP
200 attack (M), range 3
Can use 1 AP to turn any KO'd unit into a Phantom at range 3, including on an enemy start tile.
Move 2

Priestess (3):
800 HP
200 attack (M), range 2
Heals for 200% attack, revives for 50% attack, range 3
An unit damaged by the Priestess has 50% attack power for its next attack/heal (doesn't affect Barbed Crystals).
Move 2

Wraith (1):
800 HP
250 attack (M), range 1.
Can use 1 AP to consume a KO'd unit at range 1. Increases current and max HP by 100 and attack power by 50 (bonus can only be obtained 3 times per game although you can continue to consume).
Can deploy onto any KO'd unit (stomping it) instead of a deploy tile, unless the KO'd unit is on an enemy deploy tile.
Move 3

Phantom:
100 HP
100 attack (M), range 1
Does not leave a corpse when killed.
If spawned on an enemy deploy tile, will be automatically destroyed if an enemy deploys there.
Move 3`,Si=`Upgrades:
-Sword (3): +50% attack
-Soulstone (3): Passive life leech increased to 66%, +10% HP (bonus applied to base -HP only)
-Helm (3): +20% magical resist, +10% HP (bonus applied to base HP only)

Consumables:
-Scroll (2): Targets one friendly. Unit has 300% attack power for one attack/heal.

-Soul Harvest (2): Targets a 33 area. Enemies take 100 M. All friendly units in play gain D/(N+3) current and max HP (reviving KO'd units in the process), where D is the total damage dealt to non-Crystal units by the spell, and N is the number of friendly units in play.

-Mana Vial (2): Targets one friendly. Heals for 1000 and increases max HP by 50.

Faction passive:
Units are healed for 33% of any damage they deal to enemy units (not crystals).`;function Pi(t){const a=new Phaser.GameObjects.Container(t,420,25),e={fontFamily:"proLight",fontSize:35,color:"#ffffff",wordWrap:{width:1e3,useAdvancedWrap:!0}};return a.add(t.add.text(0,0,"Index",{...e,fontSize:50})),a.add(t.add.text(0,220,"What is Fan Academy?",{...e,fontSize:50})),a.add(t.add.text(0,280,mi,e)),a.add(t.add.text(0,540,"What is Hero Academy?",{...e,fontSize:50})),a.add(t.add.text(0,600,gi,e)),a.add(t.add.text(0,790,"Disclaimer for third-party assets",{...e,fontSize:50})),a.add(t.add.text(0,850,pi,e)),a.add(t.add.text(0,1030,"Menu guide",{...e,fontSize:50})),a.add(t.add.text(0,2050,fi,e)),a.add(t.add.text(0,4100,yi,e)),a.add(t.add.text(0,5e3,Ti,e)),a.add(t.add.text(0,5250,"Game guide",{...e,fontSize:60})),a.add(t.add.text(0,5320,bi,e)),a.add(t.add.text(0,5570,"General mechanics",{...e,fontSize:50})),a.add(t.add.text(0,5630,Ii,e)),a.add(t.add.text(0,8660,"Factions",{...e,fontSize:60})),a.add(t.add.image(450,8890,"councilAbout")),a.add(t.add.text(0,9040,Ai,{...e,wordWrap:{width:700,useAdvancedWrap:!0}})),a.add(t.add.text(0,10230,wi,e)),a.add(t.add.image(450,10950,"elvesAbout")),a.add(t.add.text(0,11110,Ci,{...e,wordWrap:{width:750,useAdvancedWrap:!0}})),a.add(t.add.text(0,12770,Si,e)),a}function Ei(t){let a=0;return t.iterate(e=>{const i=e.y+(e.height??0);i>a&&(a=i)}),a}function _i(t,a,e,i,s){[{title:"Menu guide",y:1030},{title:"Game guide",y:5240},{title:"Factions",y:8660}].forEach((c,d)=>{const h=ct(t,c,d,60,a,e,i,s);a.add(h)}),[{title:"Play!",y:1210},{title:"Profile",y:3200},{title:"Leaderboard",y:4620}].forEach((c,d)=>{const h=ct(t,c,d,1090,a,e,i,s);a.add(h)})}function ct(t,a,e,i,s,o,r,c){const d=t.add.text(0,i+e*50,a.title,{fontFamily:"proLight",color:"#ffffff",fontSize:35,backgroundColor:"#00f",padding:{x:10}});return d.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{s.y=o-a.y;const h=o+(r-c);s.y=Phaser.Math.Clamp(s.y,h,o)}),d}function vi(t,a){a.add(t.add.image(87,1280,"aboutPlayButton").setScale(.5)),a.add(t.add.image(490,1690,"aboutPlayPage").setScale(.7)),a.add(t.add.image(170,3270,"aboutProfileButton")),a.add(t.add.image(490,3700,"aboutProfilePage")),a.add(t.add.image(170,4670,"aboutLeaderboardButton")),a.add(t.add.image(490,4860,"aboutLeaderboardPage"));const e=840;a.add(t.add.image(e,9130,"knightAbout").setScale(1.5)),a.add(t.add.image(e,9360,"archerAbout").setScale(1.5)),a.add(t.add.image(e,9560,"wizardAbout").setScale(1.5)),a.add(t.add.image(e,9845,"clericAbout").setScale(1.5)),a.add(t.add.image(e,10070,"ninjaAbout").setScale(1.5)),a.add(t.add.image(e,11210,"voidmonkAbout").setScale(1.5)),a.add(t.add.image(e,11460,"impalerAbout").setScale(1.5)),a.add(t.add.image(e,11680,"necromancerAbout").setScale(1.5)),a.add(t.add.image(e,11930,"priestessAbout").setScale(1.5)),a.add(t.add.image(e,12230,"wraithAbout").setScale(1.5)),a.add(t.add.image(e,12580,"phantomAbout").setScale(1.5))}function Di(t){t.load.image("archerAbout",`${l}/images/aboutImages/Archer_tile.webp`),t.load.image("clericAbout",`${l}/images/aboutImages/Cleric_tile.webp`),t.load.image("councilAbout",`${l}/images/aboutImages/Council_SplashScreen1.webp`),t.load.image("elvesAbout",`${l}/images/aboutImages/DarkElves_SplashScreen.webp`),t.load.image("impalerAbout",`${l}/images/aboutImages/Impaler_tile.webp`),t.load.image("knightAbout",`${l}/images/aboutImages/Knight_tile.webp`),t.load.image("necromancerAbout",`${l}/images/aboutImages/Necromancer_tile.webp`),t.load.image("ninjaAbout",`${l}/images/aboutImages/Ninja_tile.webp`),t.load.image("phantomAbout",`${l}/images/aboutImages/Phantom_tile.webp`),t.load.image("priestessAbout",`${l}/images/aboutImages/Priestess_tile.webp`),t.load.image("voidmonkAbout",`${l}/images/aboutImages/VoidMonk_tile.webp`),t.load.image("wizardAbout",`${l}/images/aboutImages/Wizard_tile.webp`),t.load.image("wraithAbout",`${l}/images/aboutImages/Wraith_tile.webp`),t.load.image("arrowAbout",`${l}/images/aboutImages/AvatarArrow-hd.webp`),t.load.image("aboutPlayButton",`${l}/images/aboutImages/play_button.webp`),t.load.image("aboutProfileButton",`${l}/images/aboutImages/profile_button.webp`),t.load.image("aboutLeaderboardButton",`${l}/images/aboutImages/leaderboard_button.webp`),t.load.image("aboutPlayPage",`${l}/images/aboutImages/play_page.webp`),t.load.image("aboutProfilePage",`${l}/images/aboutImages/profile_page.webp`),t.load.image("aboutLeaderboardPage",`${l}/images/aboutImages/leaderboard_page.webp`)}class ki extends Phaser.Scene{constructor(){super({key:"AboutScene"})}preload(){Di(this)}async create(){this.add.image(396,14,"gameBackground").setOrigin(0,0).setScale(1.07,1.2).setTint(10066329);const a=Pi(this),e=396,i=2e3,s=20,o=750,r=this.make.graphics();r.fillRect(e,s,i,o);const c=new Phaser.Display.Masks.GeometryMask(this,r);a.setMask(c);const d=w=>w.x>=e&&w.x<=i&&w.y>=s&&w.y<=o,h=Ei(a),u=o;_i(this,a,s,o,h),vi(this,a),this.input.on("wheel",(w,D,O,M,J)=>{if(d(w)&&h>u){a.y-=M*1;const G=s+(u-h);a.y=Phaser.Math.Clamp(a.y,G,s)}});let p=!1,y=0,T=0;this.input.on("pointerdown",w=>{d(w)&&h>u?(p=!0,y=w.y,T=a.y):(p=!1,y=0,T=0)}),this.input.on("pointermove",w=>{if(!p)return;const D=w.y-y,O=s+(u-h);a.y=Phaser.Math.Clamp(T+D,O,s)}),this.input.on("pointerup",()=>{p=!1,y=0,T=0}),this.add.image(1350,60,"arrowAbout").setScale(2).setInteractive({useHandCursor:!0}).setScrollFactor(0).setDepth(999).on("pointerdown",()=>{a.y=s;const w=s+(u-h);a.y=Phaser.Math.Clamp(a.y,w,s)}),this.add.existing(a)}}const Ri={backgroundColor:"#808080",type:ve.AUTO,scene:[Ra,$a,St,ni,li,ui,ki],scale:{mode:ve.Scale.FIT,autoCenter:ve.Scale.CENTER_BOTH,width:1434,height:990},dom:{createContainer:!0},parent:"app"};new ve.Game(Ri);
